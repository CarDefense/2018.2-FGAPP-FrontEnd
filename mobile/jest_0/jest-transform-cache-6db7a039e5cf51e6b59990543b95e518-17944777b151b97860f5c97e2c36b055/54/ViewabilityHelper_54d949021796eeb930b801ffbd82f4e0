d7747e6b51055a1dd77c782ae5c14c69
'use strict';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[typeof Symbol==='function'?Symbol.iterator:'@@iterator'](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if((typeof Symbol==='function'?Symbol.iterator:'@@iterator')in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var invariant=require('fbjs/lib/invariant');var ViewabilityHelper=function(){function ViewabilityHelper(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{viewAreaCoveragePercentThreshold:0};_classCallCheck(this,ViewabilityHelper);this._hasInteracted=false;this._timers=new Set();this._viewableIndices=[];this._viewableItems=new Map();this._config=config;}_createClass(ViewabilityHelper,[{key:'dispose',value:function dispose(){this._timers.forEach(clearTimeout);}},{key:'computeViewableItems',value:function computeViewableItems(itemCount,scrollOffset,viewportHeight,getFrameMetrics,renderRange){var _config=this._config,itemVisiblePercentThreshold=_config.itemVisiblePercentThreshold,viewAreaCoveragePercentThreshold=_config.viewAreaCoveragePercentThreshold;var viewAreaMode=viewAreaCoveragePercentThreshold!=null;var viewablePercentThreshold=viewAreaMode?viewAreaCoveragePercentThreshold:itemVisiblePercentThreshold;invariant(viewablePercentThreshold!=null&&itemVisiblePercentThreshold!=null!==(viewAreaCoveragePercentThreshold!=null),'Must set exactly one of itemVisiblePercentThreshold or viewAreaCoveragePercentThreshold');var viewableIndices=[];if(itemCount===0){return viewableIndices;}var firstVisible=-1;var _ref=renderRange||{first:0,last:itemCount-1},first=_ref.first,last=_ref.last;invariant(last<itemCount,'Invalid render range '+JSON.stringify({renderRange:renderRange,itemCount:itemCount}));for(var idx=first;idx<=last;idx++){var metrics=getFrameMetrics(idx);if(!metrics){continue;}var top=metrics.offset-scrollOffset;var bottom=top+metrics.length;if(top<viewportHeight&&bottom>0){firstVisible=idx;if(_isViewable(viewAreaMode,viewablePercentThreshold,top,bottom,viewportHeight,metrics.length)){viewableIndices.push(idx);}}else if(firstVisible>=0){break;}}return viewableIndices;}},{key:'onUpdate',value:function onUpdate(itemCount,scrollOffset,viewportHeight,getFrameMetrics,createViewToken,onViewableItemsChanged,renderRange){var _this=this;if(this._config.waitForInteraction&&!this._hasInteracted||itemCount===0||!getFrameMetrics(0)){return;}var viewableIndices=[];if(itemCount){viewableIndices=this.computeViewableItems(itemCount,scrollOffset,viewportHeight,getFrameMetrics,renderRange);}if(this._viewableIndices.length===viewableIndices.length&&this._viewableIndices.every(function(v,ii){return v===viewableIndices[ii];})){return;}this._viewableIndices=viewableIndices;if(this._config.minimumViewTime){var handle=setTimeout(function(){_this._timers.delete(handle);_this._onUpdateSync(viewableIndices,onViewableItemsChanged,createViewToken);},this._config.minimumViewTime);this._timers.add(handle);}else{this._onUpdateSync(viewableIndices,onViewableItemsChanged,createViewToken);}}},{key:'resetViewableIndices',value:function resetViewableIndices(){this._viewableIndices=[];}},{key:'recordInteraction',value:function recordInteraction(){this._hasInteracted=true;}},{key:'_onUpdateSync',value:function _onUpdateSync(viewableIndicesToCheck,onViewableItemsChanged,createViewToken){var _this2=this;viewableIndicesToCheck=viewableIndicesToCheck.filter(function(ii){return _this2._viewableIndices.includes(ii);});var prevItems=this._viewableItems;var nextItems=new Map(viewableIndicesToCheck.map(function(ii){var viewable=createViewToken(ii,true);return[viewable.key,viewable];}));var changed=[];for(var _iterator=nextItems,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var _ref4;if(_isArray){if(_i>=_iterator.length)break;_ref4=_iterator[_i++];}else{_i=_iterator.next();if(_i.done)break;_ref4=_i.value;}var _ref2=_ref4;var _ref3=_slicedToArray(_ref2,2);var _key=_ref3[0];var viewable=_ref3[1];if(!prevItems.has(_key)){changed.push(viewable);}}for(var _iterator2=prevItems,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var _ref7;if(_isArray2){if(_i2>=_iterator2.length)break;_ref7=_iterator2[_i2++];}else{_i2=_iterator2.next();if(_i2.done)break;_ref7=_i2.value;}var _ref5=_ref7;var _ref6=_slicedToArray(_ref5,2);var _key2=_ref6[0];var _viewable=_ref6[1];if(!nextItems.has(_key2)){changed.push(_extends({},_viewable,{isViewable:false}));}}if(changed.length>0){this._viewableItems=nextItems;onViewableItemsChanged({viewableItems:Array.from(nextItems.values()),changed:changed,viewabilityConfig:this._config});}}}]);return ViewabilityHelper;}();function _isViewable(viewAreaMode,viewablePercentThreshold,top,bottom,viewportHeight,itemLength){if(_isEntirelyVisible(top,bottom,viewportHeight)){return true;}else{var pixels=_getPixelsVisible(top,bottom,viewportHeight);var percent=100*(viewAreaMode?pixels/viewportHeight:pixels/itemLength);return percent>=viewablePercentThreshold;}}function _getPixelsVisible(top,bottom,viewportHeight){var visibleHeight=Math.min(bottom,viewportHeight)-Math.max(top,0);return Math.max(0,visibleHeight);}function _isEntirelyVisible(top,bottom,viewportHeight){return top>=0&&bottom<=viewportHeight&&bottom>top;}module.exports=ViewabilityHelper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlZpZXdhYmlsaXR5SGVscGVyLmpzIl0sIm5hbWVzIjpbImludmFyaWFudCIsInJlcXVpcmUiLCJWaWV3YWJpbGl0eUhlbHBlciIsImNvbmZpZyIsInZpZXdBcmVhQ292ZXJhZ2VQZXJjZW50VGhyZXNob2xkIiwiX2hhc0ludGVyYWN0ZWQiLCJfdGltZXJzIiwiU2V0IiwiX3ZpZXdhYmxlSW5kaWNlcyIsIl92aWV3YWJsZUl0ZW1zIiwiTWFwIiwiX2NvbmZpZyIsImZvckVhY2giLCJjbGVhclRpbWVvdXQiLCJpdGVtQ291bnQiLCJzY3JvbGxPZmZzZXQiLCJ2aWV3cG9ydEhlaWdodCIsImdldEZyYW1lTWV0cmljcyIsInJlbmRlclJhbmdlIiwiaXRlbVZpc2libGVQZXJjZW50VGhyZXNob2xkIiwidmlld0FyZWFNb2RlIiwidmlld2FibGVQZXJjZW50VGhyZXNob2xkIiwidmlld2FibGVJbmRpY2VzIiwiZmlyc3RWaXNpYmxlIiwiZmlyc3QiLCJsYXN0IiwiSlNPTiIsInN0cmluZ2lmeSIsImlkeCIsIm1ldHJpY3MiLCJ0b3AiLCJvZmZzZXQiLCJib3R0b20iLCJsZW5ndGgiLCJfaXNWaWV3YWJsZSIsInB1c2giLCJjcmVhdGVWaWV3VG9rZW4iLCJvblZpZXdhYmxlSXRlbXNDaGFuZ2VkIiwid2FpdEZvckludGVyYWN0aW9uIiwiY29tcHV0ZVZpZXdhYmxlSXRlbXMiLCJldmVyeSIsInYiLCJpaSIsIm1pbmltdW1WaWV3VGltZSIsImhhbmRsZSIsInNldFRpbWVvdXQiLCJkZWxldGUiLCJfb25VcGRhdGVTeW5jIiwiYWRkIiwidmlld2FibGVJbmRpY2VzVG9DaGVjayIsImZpbHRlciIsImluY2x1ZGVzIiwicHJldkl0ZW1zIiwibmV4dEl0ZW1zIiwibWFwIiwidmlld2FibGUiLCJrZXkiLCJjaGFuZ2VkIiwiaGFzIiwiaXNWaWV3YWJsZSIsInZpZXdhYmxlSXRlbXMiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJ2aWV3YWJpbGl0eUNvbmZpZyIsIml0ZW1MZW5ndGgiLCJfaXNFbnRpcmVseVZpc2libGUiLCJwaXhlbHMiLCJfZ2V0UGl4ZWxzVmlzaWJsZSIsInBlcmNlbnQiLCJ2aXNpYmxlSGVpZ2h0IiwiTWF0aCIsIm1pbiIsIm1heCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBLGEseS9DQUVBLEdBQU1BLFdBQVlDLE9BQVosc0JBQU4sQyxHQTJETUMsa0IsWUFVSiw0QkFFRSxJQURBQyxPQUNBLDJEQUQ0QixDQUFDQyxpQ0FBa0MsQ0FBbkMsQ0FDNUIsOENBVkZDLGNBVUUsQ0FWd0IsS0FVeEIsTUFORkMsT0FNRSxDQU5xQixHQUFJQyxJQUFKLEVBTXJCLE1BTEZDLGdCQUtFLENBTGdDLEVBS2hDLE1BSkZDLGNBSUUsQ0FKdUMsR0FBSUMsSUFBSixFQUl2QyxDQUNBLEtBQUtDLE9BQUwsQ0FBZVIsTUFBZixDQUNELEMsdUVBS1MsQ0FDUixLQUFLRyxPQUFMLENBQWFNLE9BQWIsQ0FBcUJDLFlBQXJCLEVBQ0QsQyxrRUFNQ0MsUyxDQUNBQyxZLENBQ0FDLGMsQ0FDQUMsZSxDQUNBQyxXLENBQ2UsYUFJWCxLQUFLUCxPQUpNLENBRWJRLDJCQUZhLFNBRWJBLDJCQUZhLENBR2JmLGdDQUhhLFNBR2JBLGdDQUhhLENBS2YsR0FBTWdCLGNBQWVoQixrQ0FBb0MsSUFBekQsQ0FDQSxHQUFNaUIsMEJBQTJCRCxhQUM3QmhCLGdDQUQ2QixDQUU3QmUsMkJBRkosQ0FHQW5CLFVBQ0VxQiwwQkFBNEIsSUFBNUIsRUFDR0YsNkJBQStCLElBQWhDLElBQ0dmLGtDQUFvQyxJQUR2QyxDQUZKLENBSUUseUZBSkYsRUFNQSxHQUFNa0IsaUJBQWtCLEVBQXhCLENBQ0EsR0FBSVIsWUFBYyxDQUFsQixDQUFxQixDQUNuQixNQUFPUSxnQkFBUCxDQUNELENBQ0QsR0FBSUMsY0FBZSxDQUFDLENBQXBCLENBbkJlLFNBb0JPTCxhQUFlLENBQUNNLE1BQU8sQ0FBUixDQUFXQyxLQUFNWCxVQUFZLENBQTdCLENBcEJ0QixDQW9CUlUsS0FwQlEsTUFvQlJBLEtB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Q0osS0FBT2pELGFBQWUrQyxPQUFTbkQsY0FBeEIsQ0FBeUNtRCxPQUFTRixVQUF6RCxDQURGLENBRUEsTUFBT0ksVUFBV2hELHdCQUFsQixDQUNELENBQ0YsQ0FFRCxRQUFTK0Msa0JBQVQsQ0FDRXRDLEdBREYsQ0FFRUUsTUFGRixDQUdFaEIsY0FIRixDQUlVLENBQ1IsR0FBTXNELGVBQWdCQyxLQUFLQyxHQUFMLENBQVN4QyxNQUFULENBQWlCaEIsY0FBakIsRUFBbUN1RCxLQUFLRSxHQUFMLENBQVMzQyxHQUFULENBQWMsQ0FBZCxDQUF6RCxDQUNBLE1BQU95QyxNQUFLRSxHQUFMLENBQVMsQ0FBVCxDQUFZSCxhQUFaLENBQVAsQ0FDRCxDQUVELFFBQVNKLG1CQUFULENBQ0VwQyxHQURGLENBRUVFLE1BRkYsQ0FHRWhCLGNBSEYsQ0FJVyxDQUNULE1BQU9jLE1BQU8sQ0FBUCxFQUFZRSxRQUFVaEIsY0FBdEIsRUFBd0NnQixPQUFTRixHQUF4RCxDQUNELENBRUQ0QyxPQUFPQyxPQUFQLENBQWlCekUsaUJBQWpCIiwiZmlsZSI6IlZpZXdhYmlsaXR5SGVscGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgVmlld2FiaWxpdHlIZWxwZXJcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5cbmV4cG9ydCB0eXBlIFZpZXdUb2tlbiA9IHtcbiAgaXRlbTogYW55LFxuICBrZXk6IHN0cmluZyxcbiAgaW5kZXg6ID9udW1iZXIsXG4gIGlzVmlld2FibGU6IGJvb2xlYW4sXG4gIHNlY3Rpb24/OiBhbnksXG59O1xuXG5leHBvcnQgdHlwZSBWaWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpciA9IHtcbiAgdmlld2FiaWxpdHlDb25maWc6IFZpZXdhYmlsaXR5Q29uZmlnLFxuICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkOiAoaW5mbzoge1xuICAgIHZpZXdhYmxlSXRlbXM6IEFycmF5PFZpZXdUb2tlbj4sXG4gICAgY2hhbmdlZDogQXJyYXk8Vmlld1Rva2VuPixcbiAgfSkgPT4gdm9pZCxcbn07XG5cbmV4cG9ydCB0eXBlIFZpZXdhYmlsaXR5Q29uZmlnID0ge3xcbiAgLyoqXG4gICAqIE1pbmltdW0gYW1vdW50IG9mIHRpbWUgKGluIG1pbGxpc2Vjb25kcykgdGhhdCBhbiBpdGVtIG11c3QgYmUgcGh5c2ljYWxseSB2aWV3YWJsZSBiZWZvcmUgdGhlXG4gICAqIHZpZXdhYmlsaXR5IGNhbGxiYWNrIHdpbGwgYmUgZmlyZWQuIEEgaGlnaCBudW1iZXIgbWVhbnMgdGhhdCBzY3JvbGxpbmcgdGhyb3VnaCBjb250ZW50IHdpdGhvdXRcbiAgICogc3RvcHBpbmcgd2lsbCBub3QgbWFyayB0aGUgY29udGVudCBhcyB2aWV3YWJsZS5cbiAgICovXG4gIG1pbmltdW1WaWV3VGltZT86IG51bWJlcixcblxuICAvKipcbiAgICogUGVyY2VudCBvZiB2aWV3cG9ydCB0aGF0IG11c3QgYmUgY292ZXJlZCBmb3IgYSBwYXJ0aWFsbHkgb2NjbHVkZWQgaXRlbSB0byBjb3VudCBhc1xuICAgKiBcInZpZXdhYmxlXCIsIDAtMTAwLiBGdWxseSB2aXNpYmxlIGl0ZW1zIGFyZSBhbHdheXMgY29uc2lkZXJlZCB2aWV3YWJsZS4gQSB2YWx1ZSBvZiAwIG1lYW5zXG4gICAqIHRoYXQgYSBzaW5nbGUgcGl4ZWwgaW4gdGhlIHZpZXdwb3J0IG1ha2VzIHRoZSBpdGVtIHZpZXdhYmxlLCBhbmQgYSB2YWx1ZSBvZiAxMDAgbWVhbnMgdGhhdFxuICAgKiBhbiBpdGVtIG11c3QgYmUgZWl0aGVyIGVudGlyZWx5IHZpc2libGUgb3IgY292ZXIgdGhlIGVudGlyZSB2aWV3cG9ydCB0byBjb3VudCBhcyB2aWV3YWJsZS5cbiAgICovXG4gIHZpZXdBcmVhQ292ZXJhZ2VQZXJjZW50VGhyZXNob2xkPzogbnVtYmVyLFxuXG4gIC8qKlxuICAgKiBTaW1pbGFyIHRvIGB2aWV3QXJlYVBlcmNlbnRUaHJlc2hvbGRgLCBidXQgY29uc2lkZXJzIHRoZSBwZXJjZW50IG9mIHRoZSBpdGVtIHRoYXQgaXMgdmlzaWJsZSxcbiAgICogcmF0aGVyIHRoYW4gdGhlIGZyYWN0aW9uIG9mIHRoZSB2aWV3YWJsZSBhcmVhIGl0IGNvdmVycy5cbiAgICovXG4gIGl0ZW1WaXNpYmxlUGVyY2VudFRocmVzaG9sZD86IG51bWJlcixcblxuICAvKipcbiAgICogTm90aGluZyBpcyBjb25zaWRlcmVkIHZpZXdhYmxlIHVudGlsIHRoZSB1c2VyIHNjcm9sbHMgb3IgYHJlY29yZEludGVyYWN0aW9uYCBpcyBjYWxsZWQgYWZ0ZXJcbiAgICogcmVuZGVyLlxuICAgKi9cbiAgd2FpdEZvckludGVyYWN0aW9uPzogYm9vbGVhbixcbnx9O1xuXG4vKipcbiAqIEEgVXRpbGl0eSBjbGFzcyBmb3IgY2FsY3VsYXRpbmcgdmlld2FibGUgaXRlbXMgYmFzZWQgb24gY3VycmVudCBtZXRyaWNzIGxpa2Ugc2Nyb2xsIHBvc2l0aW9uIGFuZFxuICogbGF5b3V0LlxuICpcbiAqIEFuIGl0ZW0gaXMgc2FpZCB0byBiZSBpbiBhIFwidmlld2FibGVcIiBzdGF0ZSB3aGVuIGFueSBvZiB0aGUgZm9sbG93aW5nXG4gKiBpcyB0cnVlIGZvciBsb25nZXIgdGhhbiBgbWluaW11bVZpZXdUaW1lYCBtaWxsaXNlY29uZHMgKGFmdGVyIGFuIGludGVyYWN0aW9uIGlmIGB3YWl0Rm9ySW50ZXJhY3Rpb25gXG4gKiBpcyB0cnVlKTpcbiAqXG4gKiAtIE9jY3VweWluZyA+PSBgdmlld0FyZWFDb3ZlcmFnZVBlcmNlbnRUaHJlc2hvbGRgIG9mIHRoZSB2aWV3IGFyZWEgWE9SIGZyYWN0aW9uIG9mIHRoZSBpdGVtXG4gKiAgIHZpc2libGUgaW4gdGhlIHZpZXcgYXJlYSA+PSBgaXRlbVZpc2libGVQZXJjZW50VGhyZXNob2xkYC5cbiAqIC0gRW50aXJlbHkgdmlzaWJsZSBvbiBzY3JlZW5cbiAqL1xuY2xhc3MgVmlld2FiaWxpdHlIZWxwZXIge1xuICBfY29uZmlnOiBWaWV3YWJpbGl0eUNvbmZpZztcbiAgX2hhc0ludGVyYWN0ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgLyogJEZsb3dGaXhNZSg+PTAuNjMuMCBzaXRlPXJlYWN0X25hdGl2ZV9mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW4gZXJyb3JcbiAgICogZm91bmQgd2hlbiBGbG93IHYwLjYzIHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciBkZWxldGUgdGhpcyBjb21tZW50XG4gICAqIGFuZCBydW4gRmxvdy4gKi9cbiAgX3RpbWVyczogU2V0PG51bWJlcj4gPSBuZXcgU2V0KCk7XG4gIF92aWV3YWJsZUluZGljZXM6IEFycmF5PG51bWJlcj4gPSBbXTtcbiAgX3ZpZXdhYmxlSXRlbXM6IE1hcDxzdHJpbmcsIFZpZXdUb2tlbj4gPSBuZXcgTWFwKCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgY29uZmlnOiBWaWV3YWJpbGl0eUNvbmZpZyA9IHt2aWV3QXJlYUNvdmVyYWdlUGVyY2VudFRocmVzaG9sZDogMH0sXG4gICkge1xuICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwLCBlLmcuIG9uIHVubW91bnQuIENsZWFycyBhbnkgcGVuZGluZyB0aW1lcnMuXG4gICAqL1xuICBkaXNwb3NlKCkge1xuICAgIHRoaXMuX3RpbWVycy5mb3JFYWNoKGNsZWFyVGltZW91dCk7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyB3aGljaCBpdGVtcyBhcmUgdmlld2FibGUgYmFzZWQgb24gdGhlIGN1cnJlbnQgbWV0cmljcyBhbmQgY29uZmlnLlxuICAgKi9cbiAgY29tcHV0ZVZpZXdhYmxlSXRlbXMoXG4gICAgaXRlbUNvdW50OiBudW1iZXIsXG4gICAgc2Nyb2xsT2Zmc2V0OiBudW1iZXIsXG4gICAgdmlld3BvcnRIZWlnaHQ6IG51bWJlcixcbiAgICBnZXRGcmFtZU1ldHJpY3M6IChpbmRleDogbnVtYmVyKSA9PiA/e2xlbmd0aDogbnVtYmVyLCBvZmZzZXQ6IG51bWJlcn0sXG4gICAgcmVuZGVyUmFuZ2U/OiB7Zmlyc3Q6IG51bWJlciwgbGFzdDogbnVtYmVyfSwgLy8gT3B0aW9uYWwgb3B0aW1pemF0aW9uIHRvIHJlZHVjZSB0aGUgc2NhbiBzaXplXG4gICk6IEFycmF5PG51bWJlcj4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGl0ZW1WaXNpYmxlUGVyY2VudFRocmVzaG9sZCxcbiAgICAgIHZpZXdBcmVhQ292ZXJhZ2VQZXJjZW50VGhyZXNob2xkLFxuICAgIH0gPSB0aGlzLl9jb25maWc7XG4gICAgY29uc3Qgdmlld0FyZWFNb2RlID0gdmlld0FyZWFDb3ZlcmFnZVBlcmNlbnRUaHJlc2hvbGQgIT0gbnVsbDtcbiAgICBjb25zdCB2aWV3YWJsZVBlcmNlbnRUaHJlc2hvbGQgPSB2aWV3QXJlYU1vZGVcbiAgICAgID8gdmlld0FyZWFDb3ZlcmFnZVBlcmNlbnRUaHJlc2hvbGRcbiAgICAgIDogaXRlbVZpc2libGVQZXJjZW50VGhyZXNob2xkO1xuICAgIGludmFyaWFudChcbiAgICAgIHZpZXdhYmxlUGVyY2VudFRocmVzaG9sZCAhPSBudWxsICYmXG4gICAgICAgIChpdGVtVmlzaWJsZVBlcmNlbnRUaHJlc2hvbGQgIT0gbnVsbCkgIT09XG4gICAgICAgICAgKHZpZXdBcmVhQ292ZXJhZ2VQZXJjZW50VGhyZXNob2xkICE9IG51bGwpLFxuICAgICAgJ011c3Qgc2V0IGV4YWN0bHkgb25lIG9mIGl0ZW1WaXNpYmxlUGVyY2VudFRocmVzaG9sZCBvciB2aWV3QXJlYUNvdmVyYWdlUGVyY2VudFRocmVzaG9sZCcsXG4gICAgKTtcbiAgICBjb25zdCB2aWV3YWJsZUluZGljZXMgPSBbXTtcbiAgICBpZiAoaXRlbUNvdW50ID09PSAwKSB7XG4gICAgICByZXR1cm4gdmlld2FibGVJbmRpY2VzO1xuICAgIH1cbiAgICBsZXQgZmlyc3RWaXNpYmxlID0gLTE7XG4gICAgY29uc3Qge2ZpcnN0LCBsYXN0fSA9IHJlbmRlclJhbmdlIHx8IHtmaXJzdDogMCwgbGFzdDogaXRlbUNvdW50IC0gMX07XG4gICAgaW52YXJpYW50KFxuICAgICAgbGFzdCA8IGl0ZW1Db3VudCxcbiAgICAgICdJbnZhbGlkIHJlbmRlciByYW5nZSAnICsgSlNPTi5zdHJpbmdpZnkoe3JlbmRlclJhbmdlLCBpdGVtQ291bnR9KSxcbiAgICApO1xuICAgIGZvciAobGV0IGlkeCA9IGZpcnN0OyBpZHggPD0gbGFzdDsgaWR4KyspIHtcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBnZXRGcmFtZU1ldHJpY3MoaWR4KTtcbiAgICAgIGlmICghbWV0cmljcykge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRvcCA9IG1ldHJpY3Mub2Zmc2V0IC0gc2Nyb2xsT2Zmc2V0O1xuICAgICAgY29uc3QgYm90dG9tID0gdG9wICsgbWV0cmljcy5sZW5ndGg7XG4gICAgICBpZiAodG9wIDwgdmlld3BvcnRIZWlnaHQgJiYgYm90dG9tID4gMCkge1xuICAgICAgICBmaXJzdFZpc2libGUgPSBpZHg7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBfaXNWaWV3YWJsZShcbiAgICAgICAgICAgIHZpZXdBcmVhTW9kZSxcbiAgICAgICAgICAgIHZpZXdhYmxlUGVyY2VudFRocmVzaG9sZCxcbiAgICAgICAgICAgIHRvcCxcbiAgICAgICAgICAgIGJvdHRvbSxcbiAgICAgICAgICAgIHZpZXdwb3J0SGVpZ2h0LFxuICAgICAgICAgICAgbWV0cmljcy5sZW5ndGgsXG4gICAgICAgICAgKVxuICAgICAgICApIHtcbiAgICAgICAgICB2aWV3YWJsZUluZGljZXMucHVzaChpZHgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGZpcnN0VmlzaWJsZSA+PSAwKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmlld2FibGVJbmRpY2VzO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpZ3VyZXMgb3V0IHdoaWNoIGl0ZW1zIGFyZSB2aWV3YWJsZSBhbmQgaG93IHRoYXQgaGFzIGNoYW5nZWQgZnJvbSBiZWZvcmUgYW5kIGNhbGxzXG4gICAqIGBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkYCBhcyBhcHByb3ByaWF0ZS5cbiAgICovXG4gIG9uVXBkYXRlKFxuICAgIGl0ZW1Db3VudDogbnVtYmVyLFxuICAgIHNjcm9sbE9mZnNldDogbnVtYmVyLFxuICAgIHZpZXdwb3J0SGVpZ2h0OiBudW1iZXIsXG4gICAgZ2V0RnJhbWVNZXRyaWNzOiAoaW5kZXg6IG51bWJlcikgPT4gP3tsZW5ndGg6IG51bWJlciwgb2Zmc2V0OiBudW1iZXJ9LFxuICAgIGNyZWF0ZVZpZXdUb2tlbjogKGluZGV4OiBudW1iZXIsIGlzVmlld2FibGU6IGJvb2xlYW4pID0+IFZpZXdUb2tlbixcbiAgICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkOiAoe1xuICAgICAgdmlld2FibGVJdGVtczogQXJyYXk8Vmlld1Rva2VuPixcbiAgICAgIGNoYW5nZWQ6IEFycmF5PFZpZXdUb2tlbj4sXG4gICAgfSkgPT4gdm9pZCxcbiAgICByZW5kZXJSYW5nZT86IHtmaXJzdDogbnVtYmVyLCBsYXN0OiBudW1iZXJ9LCAvLyBPcHRpb25hbCBvcHRpbWl6YXRpb24gdG8gcmVkdWNlIHRoZSBzY2FuIHNpemVcbiAgKTogdm9pZCB7XG4gICAgaWYgKFxuICAgICAgKHRoaXMuX2NvbmZpZy53YWl0Rm9ySW50ZXJhY3Rpb24gJiYgIXRoaXMuX2hhc0ludGVyYWN0ZWQpIHx8XG4gICAgICBpdGVtQ291bnQgPT09IDAgfHxcbiAgICAgICFnZXRGcmFtZU1ldHJpY3MoMClcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHZpZXdhYmxlSW5kaWNlcyA9IFtdO1xuICAgIGlmIChpdGVtQ291bnQpIHtcbiAgICAgIHZpZXdhYmxlSW5kaWNlcyA9IHRoaXMuY29tcHV0ZVZpZXdhYmxlSXRlbXMoXG4gICAgICAgIGl0ZW1Db3VudCxcbiAgICAgICAgc2Nyb2xsT2Zmc2V0LFxuICAgICAgICB2aWV3cG9ydEhlaWdodCxcbiAgICAgICAgZ2V0RnJhbWVNZXRyaWNzLFxuICAgICAgICByZW5kZXJSYW5nZSxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChcbiAgICAgIHRoaXMuX3ZpZXdhYmxlSW5kaWNlcy5sZW5ndGggPT09IHZpZXdhYmxlSW5kaWNlcy5sZW5ndGggJiZcbiAgICAgIHRoaXMuX3ZpZXdhYmxlSW5kaWNlcy5ldmVyeSgodiwgaWkpID0+IHYgPT09IHZpZXdhYmxlSW5kaWNlc1tpaV0pXG4gICAgKSB7XG4gICAgICAvLyBXZSBtaWdodCBnZXQgYSBsb3Qgb2Ygc2Nyb2xsIGV2ZW50cyB3aGVyZSB2aXNpYmlsaXR5IGRvZXNuJ3QgY2hhbmdlIGFuZCB3ZSBkb24ndCB3YW50IHRvIGRvXG4gICAgICAvLyBleHRyYSB3b3JrIGluIHRob3NlIGNhc2VzLlxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl92aWV3YWJsZUluZGljZXMgPSB2aWV3YWJsZUluZGljZXM7XG4gICAgaWYgKHRoaXMuX2NvbmZpZy5taW5pbXVtVmlld1RpbWUpIHtcbiAgICAgIGNvbnN0IGhhbmRsZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLl90aW1lcnMuZGVsZXRlKGhhbmRsZSk7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlU3luYyhcbiAgICAgICAgICB2aWV3YWJsZUluZGljZXMsXG4gICAgICAgICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCxcbiAgICAgICAgICBjcmVhdGVWaWV3VG9rZW4sXG4gICAgICAgICk7XG4gICAgICB9LCB0aGlzLl9jb25maWcubWluaW11bVZpZXdUaW1lKTtcbiAgICAgIHRoaXMuX3RpbWVycy5hZGQoaGFuZGxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fb25VcGRhdGVTeW5jKFxuICAgICAgICB2aWV3YWJsZUluZGljZXMsXG4gICAgICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQsXG4gICAgICAgIGNyZWF0ZVZpZXdUb2tlbixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGNsZWFuLXVwIGNhY2hlZCBfdmlld2FibGVJbmRpY2VzIHRvIGV2YWx1YXRlIGNoYW5nZWQgaXRlbXMgb24gbmV4dCB1cGRhdGVcbiAgICovXG4gIHJlc2V0Vmlld2FibGVJbmRpY2VzKCkge1xuICAgIHRoaXMuX3ZpZXdhYmxlSW5kaWNlcyA9IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZHMgdGhhdCBhbiBpbnRlcmFjdGlvbiBoYXMgaGFwcGVuZWQgZXZlbiBpZiB0aGVyZSBoYXMgYmVlbiBubyBzY3JvbGwuXG4gICAqL1xuICByZWNvcmRJbnRlcmFjdGlvbigpIHtcbiAgICB0aGlzLl9oYXNJbnRlcmFjdGVkID0gdHJ1ZTtcbiAgfVxuXG4gIF9vblVwZGF0ZVN5bmMoXG4gICAgdmlld2FibGVJbmRpY2VzVG9DaGVjayxcbiAgICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkLFxuICAgIGNyZWF0ZVZpZXdUb2tlbixcbiAgKSB7XG4gICAgLy8gRmlsdGVyIG91dCBpbmRpY2VzIHRoYXQgaGF2ZSBnb25lIG91dCBvZiB2aWV3IHNpbmNlIHRoaXMgY2FsbCB3YXMgc2NoZWR1bGVkLlxuICAgIHZpZXdhYmxlSW5kaWNlc1RvQ2hlY2sgPSB2aWV3YWJsZUluZGljZXNUb0NoZWNrLmZpbHRlcihpaSA9PlxuICAgICAgdGhpcy5fdmlld2FibGVJbmRpY2VzLmluY2x1ZGVzKGlpKSxcbiAgICApO1xuICAgIGNvbnN0IHByZXZJdGVtcyA9IHRoaXMuX3ZpZXdhYmxlSXRlbXM7XG4gICAgY29uc3QgbmV4dEl0ZW1zID0gbmV3IE1hcChcbiAgICAgIHZpZXdhYmxlSW5kaWNlc1RvQ2hlY2subWFwKGlpID0+IHtcbiAgICAgICAgY29uc3Qgdmlld2FibGUgPSBjcmVhdGVWaWV3VG9rZW4oaWksIHRydWUpO1xuICAgICAgICByZXR1cm4gW3ZpZXdhYmxlLmtleSwgdmlld2FibGVdO1xuICAgICAgfSksXG4gICAgKTtcblxuICAgIGNvbnN0IGNoYW5nZWQgPSBbXTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZpZXdhYmxlXSBvZiBuZXh0SXRlbXMpIHtcbiAgICAgIGlmICghcHJldkl0ZW1zLmhhcyhrZXkpKSB7XG4gICAgICAgIGNoYW5nZWQucHVzaCh2aWV3YWJsZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAoY29uc3QgW2tleSwgdmlld2FibGVdIG9mIHByZXZJdGVtcykge1xuICAgICAgaWYgKCFuZXh0SXRlbXMuaGFzKGtleSkpIHtcbiAgICAgICAgY2hhbmdlZC5wdXNoKHsuLi52aWV3YWJsZSwgaXNWaWV3YWJsZTogZmFsc2V9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNoYW5nZWQubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5fdmlld2FibGVJdGVtcyA9IG5leHRJdGVtcztcbiAgICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQoe1xuICAgICAgICB2aWV3YWJsZUl0ZW1zOiBBcnJheS5mcm9tKG5leHRJdGVtcy52YWx1ZXMoKSksXG4gICAgICAgIGNoYW5nZWQsXG4gICAgICAgIHZpZXdhYmlsaXR5Q29uZmlnOiB0aGlzLl9jb25maWcsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gX2lzVmlld2FibGUoXG4gIHZpZXdBcmVhTW9kZTogYm9vbGVhbixcbiAgdmlld2FibGVQZXJjZW50VGhyZXNob2xkOiBudW1iZXIsXG4gIHRvcDogbnVtYmVyLFxuICBib3R0b206IG51bWJlcixcbiAgdmlld3BvcnRIZWlnaHQ6IG51bWJlcixcbiAgaXRlbUxlbmd0aDogbnVtYmVyLFxuKTogYm9vbGVhbiB7XG4gIGlmIChfaXNFbnRpcmVseVZpc2libGUodG9wLCBib3R0b20sIHZpZXdwb3J0SGVpZ2h0KSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHBpeGVscyA9IF9nZXRQaXhlbHNWaXNpYmxlKHRvcCwgYm90dG9tLCB2aWV3cG9ydEhlaWdodCk7XG4gICAgY29uc3QgcGVyY2VudCA9XG4gICAgICAxMDAgKiAodmlld0FyZWFNb2RlID8gcGl4ZWxzIC8gdmlld3BvcnRIZWlnaHQgOiBwaXhlbHMgLyBpdGVtTGVuZ3RoKTtcbiAgICByZXR1cm4gcGVyY2VudCA+PSB2aWV3YWJsZVBlcmNlbnRUaHJlc2hvbGQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gX2dldFBpeGVsc1Zpc2libGUoXG4gIHRvcDogbnVtYmVyLFxuICBib3R0b206IG51bWJlcixcbiAgdmlld3BvcnRIZWlnaHQ6IG51bWJlcixcbik6IG51bWJlciB7XG4gIGNvbnN0IHZpc2libGVIZWlnaHQgPSBNYXRoLm1pbihib3R0b20sIHZpZXdwb3J0SGVpZ2h0KSAtIE1hdGgubWF4KHRvcCwgMCk7XG4gIHJldHVybiBNYXRoLm1heCgwLCB2aXNpYmxlSGVpZ2h0KTtcbn1cblxuZnVuY3Rpb24gX2lzRW50aXJlbHlWaXNpYmxlKFxuICB0b3A6IG51bWJlcixcbiAgYm90dG9tOiBudW1iZXIsXG4gIHZpZXdwb3J0SGVpZ2h0OiBudW1iZXIsXG4pOiBib29sZWFuIHtcbiAgcmV0dXJuIHRvcCA+PSAwICYmIGJvdHRvbSA8PSB2aWV3cG9ydEhlaWdodCAmJiBib3R0b20gPiB0b3A7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVmlld2FiaWxpdHlIZWxwZXI7XG4iXX0=