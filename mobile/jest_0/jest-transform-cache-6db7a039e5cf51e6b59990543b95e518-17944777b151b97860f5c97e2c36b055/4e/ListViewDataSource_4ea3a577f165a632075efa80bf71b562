43bced23fa93f2cdaf4ac15a6b2cb2ab
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var invariant=require('fbjs/lib/invariant');var isEmpty=require('isEmpty');var warning=require('fbjs/lib/warning');function defaultGetRowData(dataBlob,sectionID,rowID){return dataBlob[sectionID][rowID];}function defaultGetSectionHeaderData(dataBlob,sectionID){return dataBlob[sectionID];}var ListViewDataSource=function(){function ListViewDataSource(params){_classCallCheck(this,ListViewDataSource);invariant(params&&typeof params.rowHasChanged==='function','Must provide a rowHasChanged function.');this._rowHasChanged=params.rowHasChanged;this._getRowData=params.getRowData||defaultGetRowData;this._sectionHeaderHasChanged=params.sectionHeaderHasChanged;this._getSectionHeaderData=params.getSectionHeaderData||defaultGetSectionHeaderData;this._dataBlob=null;this._dirtyRows=[];this._dirtySections=[];this._cachedRowCount=0;this.rowIdentities=[];this.sectionIdentities=[];}_createClass(ListViewDataSource,[{key:'cloneWithRows',value:function cloneWithRows(dataBlob,rowIdentities){var rowIds=rowIdentities?[[].concat(_toConsumableArray(rowIdentities))]:null;if(!this._sectionHeaderHasChanged){this._sectionHeaderHasChanged=function(){return false;};}return this.cloneWithRowsAndSections({s1:dataBlob},['s1'],rowIds);}},{key:'cloneWithRowsAndSections',value:function cloneWithRowsAndSections(dataBlob,sectionIdentities,rowIdentities){invariant(typeof this._sectionHeaderHasChanged==='function','Must provide a sectionHeaderHasChanged function with section data.');invariant(!sectionIdentities||!rowIdentities||sectionIdentities.length===rowIdentities.length,'row and section ids lengths must be the same');var newSource=new ListViewDataSource({getRowData:this._getRowData,getSectionHeaderData:this._getSectionHeaderData,rowHasChanged:this._rowHasChanged,sectionHeaderHasChanged:this._sectionHeaderHasChanged});newSource._dataBlob=dataBlob;if(sectionIdentities){newSource.sectionIdentities=sectionIdentities;}else{newSource.sectionIdentities=Object.keys(dataBlob);}if(rowIdentities){newSource.rowIdentities=rowIdentities;}else{newSource.rowIdentities=[];newSource.sectionIdentities.forEach(function(sectionID){newSource.rowIdentities.push(Object.keys(dataBlob[sectionID]));});}newSource._cachedRowCount=countRows(newSource.rowIdentities);newSource._calculateDirtyArrays(this._dataBlob,this.sectionIdentities,this.rowIdentities);return newSource;}},{key:'getRowCount',value:function getRowCount(){return this._cachedRowCount;}},{key:'getRowAndSectionCount',value:function getRowAndSectionCount(){return this._cachedRowCount+this.sectionIdentities.length;}},{key:'rowShouldUpdate',value:function rowShouldUpdate(sectionIndex,rowIndex){var needsUpdate=this._dirtyRows[sectionIndex][rowIndex];warning(needsUpdate!==undefined,'missing dirtyBit for section, row: '+sectionIndex+', '+rowIndex);return needsUpdate;}},{key:'getRowData',value:function getRowData(sectionIndex,rowIndex){var sectionID=this.sectionIdentities[sectionIndex];var rowID=this.rowIdentities[sectionIndex][rowIndex];warning(sectionID!==undefined&&rowID!==undefined,'rendering invalid section, row: '+sectionIndex+', '+rowIndex);return this._getRowData(this._dataBlob,sectionID,rowID);}},{key:'getRowIDForFlatIndex',value:function getRowIDForFlatIndex(index){var accessIndex=index;for(var ii=0;ii<this.sectionIdentities.length;ii++){if(accessIndex>=this.rowIdentities[ii].length){accessIndex-=this.rowIdentities[ii].length;}else{return this.rowIdentities[ii][accessIndex];}}return null;}},{key:'getSectionIDForFlatIndex',value:function getSectionIDForFlatIndex(index){var accessIndex=index;for(var ii=0;ii<this.sectionIdentities.length;ii++){if(accessIndex>=this.rowIdentities[ii].length){accessIndex-=this.rowIdentities[ii].length;}else{return this.sectionIdentities[ii];}}return null;}},{key:'getSectionLengths',value:function getSectionLengths(){var results=[];for(var ii=0;ii<this.sectionIdentities.length;ii++){results.push(this.rowIdentities[ii].length);}return results;}},{key:'sectionHeaderShouldUpdate',value:function sectionHeaderShouldUpdate(sectionIndex){var needsUpdate=this._dirtySections[sectionIndex];warning(needsUpdate!==undefined,'missing dirtyBit for section: '+sectionIndex);return needsUpdate;}},{key:'getSectionHeaderData',value:function getSectionHeaderData(sectionIndex){if(!this._getSectionHeaderData){return null;}var sectionID=this.sectionIdentities[sectionIndex];warning(sectionID!==undefined,'renderSection called on invalid section: '+sectionIndex);return this._getSectionHeaderData(this._dataBlob,sectionID);}},{key:'_calculateDirtyArrays',value:function _calculateDirtyArrays(prevDataBlob,prevSectionIDs,prevRowIDs){var prevSectionsHash=keyedDictionaryFromArray(prevSectionIDs);var prevRowsHash={};for(var ii=0;ii<prevRowIDs.length;ii++){var sectionID=prevSectionIDs[ii];warning(!prevRowsHash[sectionID],'SectionID appears more than once: '+sectionID);prevRowsHash[sectionID]=keyedDictionaryFromArray(prevRowIDs[ii]);}this._dirtySections=[];this._dirtyRows=[];var dirty;for(var sIndex=0;sIndex<this.sectionIdentities.length;sIndex++){var sectionID=this.sectionIdentities[sIndex];dirty=!prevSectionsHash[sectionID];var sectionHeaderHasChanged=this._sectionHeaderHasChanged;if(!dirty&&sectionHeaderHasChanged){dirty=sectionHeaderHasChanged(this._getSectionHeaderData(prevDataBlob,sectionID),this._getSectionHeaderData(this._dataBlob,sectionID));}this._dirtySections.push(!!dirty);this._dirtyRows[sIndex]=[];for(var rIndex=0;rIndex<this.rowIdentities[sIndex].length;rIndex++){var rowID=this.rowIdentities[sIndex][rIndex];dirty=!prevSectionsHash[sectionID]||!prevRowsHash[sectionID][rowID]||this._rowHasChanged(this._getRowData(prevDataBlob,sectionID,rowID),this._getRowData(this._dataBlob,sectionID,rowID));this._dirtyRows[sIndex].push(!!dirty);}}}}]);return ListViewDataSource;}();function countRows(allRowIDs){var totalRows=0;for(var sectionIdx=0;sectionIdx<allRowIDs.length;sectionIdx++){var rowIDs=allRowIDs[sectionIdx];totalRows+=rowIDs.length;}return totalRows;}function keyedDictionaryFromArray(arr){if(isEmpty(arr)){return{};}var result={};for(var ii=0;ii<arr.length;ii++){var key=arr[ii];warning(!result[key],'Value appears more than once in array: '+key);result[key]=true;}return result;}module.exports=ListViewDataSource;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpc3RWaWV3RGF0YVNvdXJjZS5qcyJdLCJuYW1lcyI6WyJpbnZhcmlhbnQiLCJyZXF1aXJlIiwiaXNFbXB0eSIsIndhcm5pbmciLCJkZWZhdWx0R2V0Um93RGF0YSIsImRhdGFCbG9iIiwic2VjdGlvbklEIiwicm93SUQiLCJkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGEiLCJMaXN0Vmlld0RhdGFTb3VyY2UiLCJwYXJhbXMiLCJyb3dIYXNDaGFuZ2VkIiwiX3Jvd0hhc0NoYW5nZWQiLCJfZ2V0Um93RGF0YSIsImdldFJvd0RhdGEiLCJfc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQiLCJzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCIsIl9nZXRTZWN0aW9uSGVhZGVyRGF0YSIsImdldFNlY3Rpb25IZWFkZXJEYXRhIiwiX2RhdGFCbG9iIiwiX2RpcnR5Um93cyIsIl9kaXJ0eVNlY3Rpb25zIiwiX2NhY2hlZFJvd0NvdW50Iiwicm93SWRlbnRpdGllcyIsInNlY3Rpb25JZGVudGl0aWVzIiwicm93SWRzIiwiY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zIiwiczEiLCJsZW5ndGgiLCJuZXdTb3VyY2UiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInB1c2giLCJjb3VudFJvd3MiLCJfY2FsY3VsYXRlRGlydHlBcnJheXMiLCJzZWN0aW9uSW5kZXgiLCJyb3dJbmRleCIsIm5lZWRzVXBkYXRlIiwidW5kZWZpbmVkIiwiaW5kZXgiLCJhY2Nlc3NJbmRleCIsImlpIiwicmVzdWx0cyIsInByZXZEYXRhQmxvYiIsInByZXZTZWN0aW9uSURzIiwicHJldlJvd0lEcyIsInByZXZTZWN0aW9uc0hhc2giLCJrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkiLCJwcmV2Um93c0hhc2giLCJkaXJ0eSIsInNJbmRleCIsInJJbmRleCIsImFsbFJvd0lEcyIsInRvdGFsUm93cyIsInNlY3Rpb25JZHgiLCJyb3dJRHMiLCJhcnIiLCJyZXN1bHQiLCJrZXkiLCJtb2R1bGUiLCJleHBv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QUlpQixLQUFNRixJQUFJZixFQUFKLENBQVYsQ0FDQXZDLFFBQVEsQ0FBQ3VELE9BQU9DLEdBQVAsQ0FBVCxDQUFzQiwwQ0FBNENBLEdBQWxFLEVBQ0FELE9BQU9DLEdBQVAsRUFBYyxJQUFkLENBQ0QsQ0FDRCxNQUFPRCxPQUFQLENBQ0QsQ0FFREUsT0FBT0MsT0FBUCxDQUFpQnBELGtCQUFqQiIsImZpbGUiOiJMaXN0Vmlld0RhdGFTb3VyY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBwcm92aWRlc01vZHVsZSBMaXN0Vmlld0RhdGFTb3VyY2VcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxudmFyIGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xudmFyIGlzRW1wdHkgPSByZXF1aXJlKCdpc0VtcHR5Jyk7XG4vKiAkRmxvd0ZpeE1lKD49MC41NC4wIHNpdGU9cmVhY3RfbmF0aXZlX29zcykgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW4gZXJyb3JcbiAqIGZvdW5kIHdoZW4gRmxvdyB2MC41NCB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IgZGVsZXRlIHRoaXMgY29tbWVudCBhbmRcbiAqIHJ1biBGbG93LiAqL1xudmFyIHdhcm5pbmcgPSByZXF1aXJlKCdmYmpzL2xpYi93YXJuaW5nJyk7XG5cbmZ1bmN0aW9uIGRlZmF1bHRHZXRSb3dEYXRhKFxuICBkYXRhQmxvYjogYW55LFxuICBzZWN0aW9uSUQ6IG51bWJlciB8IHN0cmluZyxcbiAgcm93SUQ6IG51bWJlciB8IHN0cmluZyxcbik6IGFueSB7XG4gIHJldHVybiBkYXRhQmxvYltzZWN0aW9uSURdW3Jvd0lEXTtcbn1cblxuZnVuY3Rpb24gZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhKFxuICBkYXRhQmxvYjogYW55LFxuICBzZWN0aW9uSUQ6IG51bWJlciB8IHN0cmluZyxcbik6IGFueSB7XG4gIHJldHVybiBkYXRhQmxvYltzZWN0aW9uSURdO1xufVxuXG50eXBlIGRpZmZlclR5cGUgPSAoZGF0YTE6IGFueSwgZGF0YTI6IGFueSkgPT4gYm9vbGVhbjtcblxudHlwZSBQYXJhbVR5cGUgPSB7XG4gIHJvd0hhc0NoYW5nZWQ6IGRpZmZlclR5cGUsXG4gIGdldFJvd0RhdGE/OiA/dHlwZW9mIGRlZmF1bHRHZXRSb3dEYXRhLFxuICBzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZD86ID9kaWZmZXJUeXBlLFxuICBnZXRTZWN0aW9uSGVhZGVyRGF0YT86ID90eXBlb2YgZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhLFxufTtcblxuLyoqXG4gKiBQcm92aWRlcyBlZmZpY2llbnQgZGF0YSBwcm9jZXNzaW5nIGFuZCBhY2Nlc3MgdG8gdGhlXG4gKiBgTGlzdFZpZXdgIGNvbXBvbmVudC4gIEEgYExpc3RWaWV3RGF0YVNvdXJjZWAgaXMgY3JlYXRlZCB3aXRoIGZ1bmN0aW9ucyBmb3JcbiAqIGV4dHJhY3RpbmcgZGF0YSBmcm9tIHRoZSBpbnB1dCBibG9iLCBhbmQgY29tcGFyaW5nIGVsZW1lbnRzICh3aXRoIGRlZmF1bHRcbiAqIGltcGxlbWVudGF0aW9ucyBmb3IgY29udmVuaWVuY2UpLiAgVGhlIGlucHV0IGJsb2IgY2FuIGJlIGFzIHNpbXBsZSBhcyBhblxuICogYXJyYXkgb2Ygc3RyaW5ncywgb3IgYW4gb2JqZWN0IHdpdGggcm93cyBuZXN0ZWQgaW5zaWRlIHNlY3Rpb24gb2JqZWN0cy5cbiAqXG4gKiBUbyB1cGRhdGUgdGhlIGRhdGEgaW4gdGhlIGRhdGFzb3VyY2UsIHVzZSBgY2xvbmVXaXRoUm93c2AgKG9yXG4gKiBgY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zYCBpZiB5b3UgY2FyZSBhYm91dCBzZWN0aW9ucykuICBUaGUgZGF0YSBpbiB0aGVcbiAqIGRhdGEgc291cmNlIGlzIGltbXV0YWJsZSwgc28geW91IGNhbid0IG1vZGlmeSBpdCBkaXJlY3RseS4gIFRoZSBjbG9uZSBtZXRob2RzXG4gKiBzdWNrIGluIHRoZSBuZXcgZGF0YSBhbmQgY29tcHV0ZSBhIGRpZmYgZm9yIGVhY2ggcm93IHNvIExpc3RWaWV3IGtub3dzXG4gKiB3aGV0aGVyIHRvIHJlLXJlbmRlciBpdCBvciBub3QuXG4gKlxuICogSW4gdGhpcyBleGFtcGxlLCBhIGNvbXBvbmVudCByZWNlaXZlcyBkYXRhIGluIGNodW5rcywgaGFuZGxlZCBieVxuICogYF9vbkRhdGFBcnJpdmVkYCwgd2hpY2ggY29uY2F0cyB0aGUgbmV3IGRhdGEgb250byB0aGUgb2xkIGRhdGEgYW5kIHVwZGF0ZXMgdGhlXG4gKiBkYXRhIHNvdXJjZS4gIFdlIHVzZSBgY29uY2F0YCB0byBjcmVhdGUgYSBuZXcgYXJyYXkgLSBtdXRhdGluZyBgdGhpcy5fZGF0YWAsXG4gKiBlLmcuIHdpdGggYHRoaXMuX2RhdGEucHVzaChuZXdSb3dEYXRhKWAsIHdvdWxkIGJlIGFuIGVycm9yLiBgX3Jvd0hhc0NoYW5nZWRgXG4gKiB1bmRlcnN0YW5kcyB0aGUgc2hhcGUgb2YgdGhlIHJvdyBkYXRhIGFuZCBrbm93cyBob3cgdG8gZWZmaWNpZW50bHkgY29tcGFyZVxuICogaXQuXG4gKlxuICogYGBgXG4gKiBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICogICB2YXIgZHMgPSBuZXcgTGlzdFZpZXcuRGF0YVNvdXJjZSh7cm93SGFzQ2hhbmdlZDogdGhpcy5fcm93SGFzQ2hhbmdlZH0pO1xuICogICByZXR1cm4ge2RzfTtcbiAqIH0sXG4gKiBfb25EYXRhQXJyaXZlZChuZXdEYXRhKSB7XG4gKiAgIHRoaXMuX2RhdGEgPSB0aGlzLl9kYXRhLmNvbmNhdChuZXdEYXRhKTtcbiAqICAgdGhpcy5zZXRTdGF0ZSh7XG4gKiAgICAgZHM6IHRoaXMuc3RhdGUuZHMuY2xvbmVXaXRoUm93cyh0aGlzLl9kYXRhKVxuICogICB9KTtcbiAqIH1cbiAqIGBgYFxuICovXG5cbmNsYXNzIExpc3RWaWV3RGF0YVNvdXJjZSB7XG4gIC8qKlxuICAgKiBZb3UgY2FuIHByb3ZpZGUgY3VzdG9tIGV4dHJhY3Rpb24gYW5kIGBoYXNDaGFuZ2VkYCBmdW5jdGlvbnMgZm9yIHNlY3Rpb25cbiAgICogaGVhZGVycyBhbmQgcm93cy4gIElmIGFic2VudCwgZGF0YSB3aWxsIGJlIGV4dHJhY3RlZCB3aXRoIHRoZVxuICAgKiBgZGVmYXVsdEdldFJvd0RhdGFgIGFuZCBgZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhYCBmdW5jdGlvbnMuXG4gICAqXG4gICAqIFRoZSBkZWZhdWx0IGV4dHJhY3RvciBleHBlY3RzIGRhdGEgb2Ygb25lIG9mIHRoZSBmb2xsb3dpbmcgZm9ybXM6XG4gICAqXG4gICAqICAgICAgeyBzZWN0aW9uSURfMTogeyByb3dJRF8xOiA8cm93RGF0YTE+LCAuLi4gfSwgLi4uIH1cbiAgICpcbiAgICogICAgb3JcbiAgICpcbiAgICogICAgICB7IHNlY3Rpb25JRF8xOiBbIDxyb3dEYXRhMT4sIDxyb3dEYXRhMj4sIC4uLiBdLCAuLi4gfVxuICAgKlxuICAgKiAgICBvclxuICAgKlxuICAgKiAgICAgIFsgWyA8cm93RGF0YTE+LCA8cm93RGF0YTI+LCAuLi4gXSwgLi4uIF1cbiAgICpcbiAgICogVGhlIGNvbnN0cnVjdG9yIHRha2VzIGluIGEgcGFyYW1zIGFyZ3VtZW50IHRoYXQgY2FuIGNvbnRhaW4gYW55IG9mIHRoZVxuICAgKiBmb2xsb3dpbmc6XG4gICAqXG4gICAqIC0gZ2V0Um93RGF0YShkYXRhQmxvYiwgc2VjdGlvbklELCByb3dJRCk7XG4gICAqIC0gZ2V0U2VjdGlvbkhlYWRlckRhdGEoZGF0YUJsb2IsIHNlY3Rpb25JRCk7XG4gICAqIC0gcm93SGFzQ2hhbmdlZChwcmV2Um93RGF0YSwgbmV4dFJvd0RhdGEpO1xuICAgKiAtIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkKHByZXZTZWN0aW9uRGF0YSwgbmV4dFNlY3Rpb25EYXRhKTtcbiAgICovXG4gIGNvbnN0cnVjdG9yKHBhcmFtczogUGFyYW1UeXBlKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgcGFyYW1zICYmIHR5cGVvZiBwYXJhbXMucm93SGFzQ2hhbmdlZCA9PT0gJ2Z1bmN0aW9uJyxcbiAgICAgICdNdXN0IHByb3ZpZGUgYSByb3dIYXNDaGFuZ2VkIGZ1bmN0aW9uLicsXG4gICAgKTtcbiAgICB0aGlzLl9yb3dIYXNDaGFuZ2VkID0gcGFyYW1zLnJvd0hhc0NoYW5nZWQ7XG4gICAgdGhpcy5fZ2V0Um93RGF0YSA9IHBhcmFtcy5nZXRSb3dEYXRhIHx8IGRlZmF1bHRHZXRSb3dEYXRhO1xuICAgIHRoaXMuX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkID0gcGFyYW1zLnNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkO1xuICAgIHRoaXMuX2dldFNlY3Rpb25IZWFkZXJEYXRhID1cbiAgICAgIHBhcmFtcy5nZXRTZWN0aW9uSGVhZGVyRGF0YSB8fCBkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGE7XG5cbiAgICB0aGlzLl9kYXRhQmxvYiA9IG51bGw7XG4gICAgdGhpcy5fZGlydHlSb3dzID0gW107XG4gICAgdGhpcy5fZGlydHlTZWN0aW9ucyA9IFtdO1xuICAgIHRoaXMuX2NhY2hlZFJvd0NvdW50ID0gMDtcblxuICAgIC8vIFRoZXNlIHR3byBwcml2YXRlIHZhcmlhYmxlcyBhcmUgYWNjZXNzZWQgYnkgb3V0c2lkZXJzIGJlY2F1c2UgTGlzdFZpZXdcbiAgICAvLyB1c2VzIHRoZW0gdG8gaXRlcmF0ZSBvdmVyIHRoZSBkYXRhIGluIHRoaXMgY2xhc3MuXG4gICAgdGhpcy5yb3dJZGVudGl0aWVzID0gW107XG4gICAgdGhpcy5zZWN0aW9uSWRlbnRpdGllcyA9IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb25lcyB0aGlzIGBMaXN0Vmlld0RhdGFTb3VyY2VgIHdpdGggdGhlIHNwZWNpZmllZCBgZGF0YUJsb2JgIGFuZFxuICAgKiBgcm93SWRlbnRpdGllc2AuIFRoZSBgZGF0YUJsb2JgIGlzIGp1c3QgYW4gYXJiaXRyYXJ5IGJsb2Igb2YgZGF0YS4gQXRcbiAgICogY29uc3RydWN0aW9uIGFuIGV4dHJhY3RvciB0byBnZXQgdGhlIGludGVyZXN0aW5nIGluZm9ybWF0aW9uIHdhcyBkZWZpbmVkXG4gICAqIChvciB0aGUgZGVmYXVsdCB3YXMgdXNlZCkuXG4gICAqXG4gICAqIFRoZSBgcm93SWRlbnRpdGllc2AgaXMgYSAyRCBhcnJheSBvZiBpZGVudGlmaWVycyBmb3Igcm93cy5cbiAgICogaWUuIFtbJ2ExJywgJ2EyJ10sIFsnYjEnLCAnYjInLCAnYjMnXSwgLi4uXS4gIElmIG5vdCBwcm92aWRlZCwgaXQnc1xuICAgKiBhc3N1bWVkIHRoYXQgdGhlIGtleXMgb2YgdGhlIHNlY3Rpb24gZGF0YSBhcmUgdGhlIHJvdyBpZGVudGl0aWVzLlxuICAgKlxuICAgKiBOb3RlOiBUaGlzIGZ1bmN0aW9uIGRvZXMgTk9UIGNsb25lIHRoZSBkYXRhIGluIHRoaXMgZGF0YSBzb3VyY2UuIEl0IHNpbXBseVxuICAgKiBwYXNzZXMgdGhlIGZ1bmN0aW9ucyBkZWZpbmVkIGF0IGNvbnN0cnVjdGlvbiB0byBhIG5ldyBkYXRhIHNvdXJjZSB3aXRoXG4gICAqIHRoZSBkYXRhIHNwZWNpZmllZC4gSWYgeW91IHdpc2ggdG8gbWFpbnRhaW4gdGhlIGV4aXN0aW5nIGRhdGEgeW91IG11c3RcbiAgICogaGFuZGxlIG1lcmdpbmcgb2Ygb2xkIGFuZCBuZXcgZGF0YSBzZXBhcmF0ZWx5IGFuZCB0aGVuIHBhc3MgdGhhdCBpbnRvXG4gICAqIHRoaXMgZnVuY3Rpb24gYXMgdGhlIGBkYXRhQmxvYmAuXG4gICAqL1xuICBjbG9uZVdpdGhSb3dzKFxuICAgIGRhdGFCbG9iOiAkUmVhZE9ubHlBcnJheTxhbnk+IHwgeytba2V5OiBzdHJpbmddOiBhbnl9LFxuICAgIHJvd0lkZW50aXRpZXM6ID8kUmVhZE9ubHlBcnJheTxzdHJpbmc+LFxuICApOiBMaXN0Vmlld0RhdGFTb3VyY2Uge1xuICAgIHZhciByb3dJZHMgPSByb3dJZGVudGl0aWVzID8gW1suLi5yb3dJZGVudGl0aWVzXV0gOiBudWxsO1xuICAgIGlmICghdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQpIHtcbiAgICAgIHRoaXMuX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkID0gKCkgPT4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNsb25lV2l0aFJvd3NBbmRTZWN0aW9ucyh7czE6IGRhdGFCbG9ifSwgWydzMSddLCByb3dJZHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgcGVyZm9ybXMgdGhlIHNhbWUgZnVuY3Rpb24gYXMgdGhlIGBjbG9uZVdpdGhSb3dzYCBmdW5jdGlvbiBidXQgaGVyZVxuICAgKiB5b3UgYWxzbyBzcGVjaWZ5IHdoYXQgeW91ciBgc2VjdGlvbklkZW50aXRpZXNgIGFyZS4gSWYgeW91IGRvbid0IGNhcmVcbiAgICogYWJvdXQgc2VjdGlvbnMgeW91IHNob3VsZCBzYWZlbHkgYmUgYWJsZSB0byB1c2UgYGNsb25lV2l0aFJvd3NgLlxuICAgKlxuICAgKiBgc2VjdGlvbklkZW50aXRpZXNgIGlzIGFuIGFycmF5IG9mIGlkZW50aWZpZXJzIGZvciBzZWN0aW9ucy5cbiAgICogaWUuIFsnczEnLCAnczInLCAuLi5dLiAgVGhlIGlkZW50aWZpZXJzIHNob3VsZCBjb3JyZXNwb25kIHRvIHRoZSBrZXlzIG9yIGFycmF5IGluZGV4ZXNcbiAgICogb2YgdGhlIGRhdGEgeW91IHdpc2ggdG8gaW5jbHVkZS4gIElmIG5vdCBwcm92aWRlZCwgaXQncyBhc3N1bWVkIHRoYXQgdGhlXG4gICAqIGtleXMgb2YgZGF0YUJsb2IgYXJlIHRoZSBzZWN0aW9uIGlkZW50aXRpZXMuXG4gICAqXG4gICAqIE5vdGU6IHRoaXMgcmV0dXJucyBhIG5ldyBvYmplY3QhXG4gICAqXG4gICAqIGBgYFxuICAgKiBjb25zdCBkYXRhU291cmNlID0gZHMuY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zKHtcbiAgICogICBhZGRyZXNzZXM6IFsncm93IDEnLCAncm93IDInXSxcbiAgICogICBwaG9uZV9udW1iZXJzOiBbJ2RhdGEgMScsICdkYXRhIDInXSxcbiAgICogfSwgWydwaG9uZV9udW1iZXJzJ10pO1xuICAgKiBgYGBcbiAgICovXG4gIGNsb25lV2l0aFJvd3NBbmRTZWN0aW9ucyhcbiAgICBkYXRhQmxvYjogYW55LFxuICAgIHNlY3Rpb25JZGVudGl0aWVzOiA/QXJyYXk8c3RyaW5nPixcbiAgICByb3dJZGVudGl0aWVzOiA/QXJyYXk8QXJyYXk8c3RyaW5nPj4sXG4gICk6IExpc3RWaWV3RGF0YVNvdXJjZSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgdHlwZW9mIHRoaXMuX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkID09PSAnZnVuY3Rpb24nLFxuICAgICAgJ011c3QgcHJvdmlkZSBhIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkIGZ1bmN0aW9uIHdpdGggc2VjdGlvbiBkYXRhLicsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhc2VjdGlvbklkZW50aXRpZXMgfHxcbiAgICAgICAgIXJvd0lkZW50aXRpZXMgfHxcbiAgICAgICAgc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoID09PSByb3dJZGVudGl0aWVzLmxlbmd0aCxcbiAgICAgICdyb3cgYW5kIHNlY3Rpb24gaWRzIGxlbmd0aHMgbXVzdCBiZSB0aGUgc2FtZScsXG4gICAgKTtcblxuICAgIHZhciBuZXdTb3VyY2UgPSBuZXcgTGlzdFZpZXdEYXRhU291cmNlKHtcbiAgICAgIGdldFJvd0RhdGE6IHRoaXMuX2dldFJvd0RhdGEsXG4gICAgICBnZXRTZWN0aW9uSGVhZGVyRGF0YTogdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEsXG4gICAgICByb3dIYXNDaGFuZ2VkOiB0aGlzLl9yb3dIYXNDaGFuZ2VkLFxuICAgICAgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ6IHRoaXMuX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkLFxuICAgIH0pO1xuICAgIG5ld1NvdXJjZS5fZGF0YUJsb2IgPSBkYXRhQmxvYjtcbiAgICBpZiAoc2VjdGlvbklkZW50aXRpZXMpIHtcbiAgICAgIG5ld1NvdXJjZS5zZWN0aW9uSWRlbnRpdGllcyA9IHNlY3Rpb25JZGVudGl0aWVzO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXMgPSBPYmplY3Qua2V5cyhkYXRhQmxvYik7XG4gICAgfVxuICAgIGlmIChyb3dJZGVudGl0aWVzKSB7XG4gICAgICBuZXdTb3VyY2Uucm93SWRlbnRpdGllcyA9IHJvd0lkZW50aXRpZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld1NvdXJjZS5yb3dJZGVudGl0aWVzID0gW107XG4gICAgICBuZXdTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXMuZm9yRWFjaChzZWN0aW9uSUQgPT4ge1xuICAgICAgICBuZXdTb3VyY2Uucm93SWRlbnRpdGllcy5wdXNoKE9iamVjdC5rZXlzKGRhdGFCbG9iW3NlY3Rpb25JRF0pKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBuZXdTb3VyY2UuX2NhY2hlZFJvd0NvdW50ID0gY291bnRSb3dzKG5ld1NvdXJjZS5yb3dJZGVudGl0aWVzKTtcblxuICAgIG5ld1NvdXJjZS5fY2FsY3VsYXRlRGlydHlBcnJheXMoXG4gICAgICB0aGlzLl9kYXRhQmxvYixcbiAgICAgIHRoaXMuc2VjdGlvbklkZW50aXRpZXMsXG4gICAgICB0aGlzLnJvd0lkZW50aXRpZXMsXG4gICAgKTtcblxuICAgIHJldHVybiBuZXdTb3VyY2U7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIGRhdGEgc291cmNlLlxuICAgKlxuICAgKiBJZiB5b3UgYXJlIHNwZWNpZnlpbmcgdGhlIHJvd0lkZW50aXRpZXMgb3Igc2VjdGlvbklkZW50aXRpZXMsIHRoZW4gYGdldFJvd0NvdW50YCB3aWxsIHJldHVybiB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIGZpbHRlcmVkIGRhdGEgc291cmNlLlxuICAgKi9cbiAgZ2V0Um93Q291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fY2FjaGVkUm93Q291bnQ7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIGRhdGEgc291cmNlIChzZWUgYGdldFJvd0NvdW50YCBmb3IgaG93IHRoaXMgaXMgY2FsY3VsYXRlZCkgcGx1cyB0aGUgbnVtYmVyIG9mIHNlY3Rpb25zIGluIHRoZSBkYXRhLlxuICAgKlxuICAgKiBJZiB5b3UgYXJlIHNwZWNpZnlpbmcgdGhlIHJvd0lkZW50aXRpZXMgb3Igc2VjdGlvbklkZW50aXRpZXMsIHRoZW4gYGdldFJvd0FuZFNlY3Rpb25Db3VudGAgd2lsbCByZXR1cm4gdGhlIG51bWJlciBvZiByb3dzICYgc2VjdGlvbnMgaW4gdGhlIGZpbHRlcmVkIGRhdGEgc291cmNlLlxuICAgKi9cbiAgZ2V0Um93QW5kU2VjdGlvbkNvdW50KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2NhY2hlZFJvd0NvdW50ICsgdGhpcy5zZWN0aW9uSWRlbnRpdGllcy5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBpZiB0aGUgcm93IGlzIGRpcnRpZWQgYW5kIG5lZWRzIHRvIGJlIHJlcmVuZGVyZWRcbiAgICovXG4gIHJvd1Nob3VsZFVwZGF0ZShzZWN0aW9uSW5kZXg6IG51bWJlciwgcm93SW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHZhciBuZWVkc1VwZGF0ZSA9IHRoaXMuX2RpcnR5Um93c1tzZWN0aW9uSW5kZXhdW3Jvd0luZGV4XTtcbiAgICB3YXJuaW5nKFxuICAgICAgbmVlZHNVcGRhdGUgIT09IHVuZGVmaW5lZCxcbiAgICAgICdtaXNzaW5nIGRpcnR5Qml0IGZvciBzZWN0aW9uLCByb3c6ICcgKyBzZWN0aW9uSW5kZXggKyAnLCAnICsgcm93SW5kZXgsXG4gICAgKTtcbiAgICByZXR1cm4gbmVlZHNVcGRhdGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgZGF0YSByZXF1aXJlZCB0byByZW5kZXIgdGhlIHJvdy5cbiAgICovXG4gIGdldFJvd0RhdGEoc2VjdGlvbkluZGV4OiBudW1iZXIsIHJvd0luZGV4OiBudW1iZXIpOiBhbnkge1xuICAgIHZhciBzZWN0aW9uSUQgPSB0aGlzLnNlY3Rpb25JZGVudGl0aWVzW3NlY3Rpb25JbmRleF07XG4gICAgdmFyIHJvd0lEID0gdGhpcy5yb3dJZGVudGl0aWVzW3NlY3Rpb25JbmRleF1bcm93SW5kZXhdO1xuICAgIHdhcm5pbmcoXG4gICAgICBzZWN0aW9uSUQgIT09IHVuZGVmaW5lZCAmJiByb3dJRCAhPT0gdW5kZWZpbmVkLFxuICAgICAgJ3JlbmRlcmluZyBpbnZhbGlkIHNlY3Rpb24sIHJvdzogJyArIHNlY3Rpb25JbmRleCArICcsICcgKyByb3dJbmRleCxcbiAgICApO1xuICAgIHJldHVybiB0aGlzLl9nZXRSb3dEYXRhKHRoaXMuX2RhdGFCbG9iLCBzZWN0aW9uSUQsIHJvd0lEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSByb3dJRCBhdCBpbmRleCBwcm92aWRlZCBpZiB0aGUgZGF0YVNvdXJjZSBhcnJheXMgd2VyZSBmbGF0dGVuZWQsXG4gICAqIG9yIG51bGwgb2Ygb3V0IG9mIHJhbmdlIGluZGV4ZXMuXG4gICAqL1xuICBnZXRSb3dJREZvckZsYXRJbmRleChpbmRleDogbnVtYmVyKTogP3N0cmluZyB7XG4gICAgdmFyIGFjY2Vzc0luZGV4ID0gaW5kZXg7XG4gICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICBpZiAoYWNjZXNzSW5kZXggPj0gdGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGgpIHtcbiAgICAgICAgYWNjZXNzSW5kZXggLT0gdGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5yb3dJZGVudGl0aWVzW2lpXVthY2Nlc3NJbmRleF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHNlY3Rpb25JRCBhdCBpbmRleCBwcm92aWRlZCBpZiB0aGUgZGF0YVNvdXJjZSBhcnJheXMgd2VyZSBmbGF0dGVuZWQsXG4gICAqIG9yIG51bGwgZm9yIG91dCBvZiByYW5nZSBpbmRleGVzLlxuICAgKi9cbiAgZ2V0U2VjdGlvbklERm9yRmxhdEluZGV4KGluZGV4OiBudW1iZXIpOiA/c3RyaW5nIHtcbiAgICB2YXIgYWNjZXNzSW5kZXggPSBpbmRleDtcbiAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgdGhpcy5zZWN0aW9uSWRlbnRpdGllcy5sZW5ndGg7IGlpKyspIHtcbiAgICAgIGlmIChhY2Nlc3NJbmRleCA+PSB0aGlzLnJvd0lkZW50aXRpZXNbaWldLmxlbmd0aCkge1xuICAgICAgICBhY2Nlc3NJbmRleCAtPSB0aGlzLnJvd0lkZW50aXRpZXNbaWldLmxlbmd0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlY3Rpb25JZGVudGl0aWVzW2lpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIHRoZSBudW1iZXIgb2Ygcm93cyBpbiBlYWNoIHNlY3Rpb25cbiAgICovXG4gIGdldFNlY3Rpb25MZW5ndGhzKCk6IEFycmF5PG51bWJlcj4ge1xuICAgIHZhciByZXN1bHRzID0gW107XG4gICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICByZXN1bHRzLnB1c2godGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGgpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGlmIHRoZSBzZWN0aW9uIGhlYWRlciBpcyBkaXJ0aWVkIGFuZCBuZWVkcyB0byBiZSByZXJlbmRlcmVkXG4gICAqL1xuICBzZWN0aW9uSGVhZGVyU2hvdWxkVXBkYXRlKHNlY3Rpb25JbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgdmFyIG5lZWRzVXBkYXRlID0gdGhpcy5fZGlydHlTZWN0aW9uc1tzZWN0aW9uSW5kZXhdO1xuICAgIHdhcm5pbmcoXG4gICAgICBuZWVkc1VwZGF0ZSAhPT0gdW5kZWZpbmVkLFxuICAgICAgJ21pc3NpbmcgZGlydHlCaXQgZm9yIHNlY3Rpb246ICcgKyBzZWN0aW9uSW5kZXgsXG4gICAgKTtcbiAgICByZXR1cm4gbmVlZHNVcGRhdGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgZGF0YSByZXF1aXJlZCB0byByZW5kZXIgdGhlIHNlY3Rpb24gaGVhZGVyXG4gICAqL1xuICBnZXRTZWN0aW9uSGVhZGVyRGF0YShzZWN0aW9uSW5kZXg6IG51bWJlcik6IGFueSB7XG4gICAgaWYgKCF0aGlzLl9nZXRTZWN0aW9uSGVhZGVyRGF0YSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHZhciBzZWN0aW9uSUQgPSB0aGlzLnNlY3Rpb25JZGVudGl0aWVzW3NlY3Rpb25JbmRleF07XG4gICAgd2FybmluZyhcbiAgICAgIHNlY3Rpb25JRCAhPT0gdW5kZWZpbmVkLFxuICAgICAgJ3JlbmRlclNlY3Rpb24gY2FsbGVkIG9uIGludmFsaWQgc2VjdGlvbjogJyArIHNlY3Rpb25JbmRleCxcbiAgICApO1xuICAgIHJldHVybiB0aGlzLl9nZXRTZWN0aW9uSGVhZGVyRGF0YSh0aGlzLl9kYXRhQmxvYiwgc2VjdGlvbklEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIG1lbWJlcnMgYW5kIG1ldGhvZHMuXG4gICAqL1xuXG4gIF9nZXRSb3dEYXRhOiB0eXBlb2YgZGVmYXVsdEdldFJvd0RhdGE7XG4gIF9nZXRTZWN0aW9uSGVhZGVyRGF0YTogdHlwZW9mIGRlZmF1bHRHZXRTZWN0aW9uSGVhZGVyRGF0YTtcbiAgX3Jvd0hhc0NoYW5nZWQ6IGRpZmZlclR5cGU7XG4gIF9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZDogP2RpZmZlclR5cGU7XG5cbiAgX2RhdGFCbG9iOiBhbnk7XG4gIF9kaXJ0eVJvd3M6IEFycmF5PEFycmF5PGJvb2xlYW4+PjtcbiAgX2RpcnR5U2VjdGlvbnM6IEFycmF5PGJvb2xlYW4+O1xuICBfY2FjaGVkUm93Q291bnQ6IG51bWJlcjtcblxuICAvLyBUaGVzZSB0d28gJ3Byb3RlY3RlZCcgdmFyaWFibGVzIGFyZSBhY2Nlc3NlZCBieSBMaXN0VmlldyB0byBpdGVyYXRlIG92ZXJcbiAgLy8gdGhlIGRhdGEgaW4gdGhpcyBjbGFzcy5cbiAgcm93SWRlbnRpdGllczogQXJyYXk8QXJyYXk8c3RyaW5nPj47XG4gIHNlY3Rpb25JZGVudGl0aWVzOiBBcnJheTxzdHJpbmc+O1xuXG4gIF9jYWxjdWxhdGVEaXJ0eUFycmF5cyhcbiAgICBwcmV2RGF0YUJsb2I6IGFueSxcbiAgICBwcmV2U2VjdGlvbklEczogQXJyYXk8c3RyaW5nPixcbiAgICBwcmV2Um93SURzOiBBcnJheTxBcnJheTxzdHJpbmc+PixcbiAgKTogdm9pZCB7XG4gICAgLy8gY29uc3RydWN0IGEgaGFzaG1hcCBvZiB0aGUgZXhpc3RpbmcgKG9sZCkgaWQgYXJyYXlzXG4gICAgdmFyIHByZXZTZWN0aW9uc0hhc2ggPSBrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkocHJldlNlY3Rpb25JRHMpO1xuICAgIHZhciBwcmV2Um93c0hhc2ggPSB7fTtcbiAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgcHJldlJvd0lEcy5sZW5ndGg7IGlpKyspIHtcbiAgICAgIHZhciBzZWN0aW9uSUQgPSBwcmV2U2VjdGlvbklEc1tpaV07XG4gICAgICB3YXJuaW5nKFxuICAgICAgICAhcHJldlJvd3NIYXNoW3NlY3Rpb25JRF0sXG4gICAgICAgICdTZWN0aW9uSUQgYXBwZWFycyBtb3JlIHRoYW4gb25jZTogJyArIHNlY3Rpb25JRCxcbiAgICAgICk7XG4gICAgICBwcmV2Um93c0hhc2hbc2VjdGlvbklEXSA9IGtleWVkRGljdGlvbmFyeUZyb21BcnJheShwcmV2Um93SURzW2lpXSk7XG4gICAgfVxuXG4gICAgLy8gY29tcGFyZSB0aGUgMiBpZGVudGl0eSBhcnJheSBhbmQgZ2V0IHRoZSBkaXJ0aWVkIHJvd3NcbiAgICB0aGlzLl9kaXJ0eVNlY3Rpb25zID0gW107XG4gICAgdGhpcy5fZGlydHlSb3dzID0gW107XG5cbiAgICB2YXIgZGlydHk7XG4gICAgZm9yICh2YXIgc0luZGV4ID0gMDsgc0luZGV4IDwgdGhpcy5zZWN0aW9uSWRlbnRpdGllcy5sZW5ndGg7IHNJbmRleCsrKSB7XG4gICAgICB2YXIgc2VjdGlvbklEID0gdGhpcy5zZWN0aW9uSWRlbnRpdGllc1tzSW5kZXhdO1xuICAgICAgLy8gZGlydHkgaWYgdGhlIHNlY3Rpb25IZWFkZXIgaXMgbmV3IG9yIF9zZWN0aW9uSGFzQ2hhbmdlZCBpcyB0cnVlXG4gICAgICBkaXJ0eSA9ICFwcmV2U2VjdGlvbnNIYXNoW3NlY3Rpb25JRF07XG4gICAgICB2YXIgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgPSB0aGlzLl9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZDtcbiAgICAgIGlmICghZGlydHkgJiYgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQpIHtcbiAgICAgICAgZGlydHkgPSBzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZChcbiAgICAgICAgICB0aGlzLl9nZXRTZWN0aW9uSGVhZGVyRGF0YShwcmV2RGF0YUJsb2IsIHNlY3Rpb25JRCksXG4gICAgICAgICAgdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEodGhpcy5fZGF0YUJsb2IsIHNlY3Rpb25JRCksXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0aGlzLl9kaXJ0eVNlY3Rpb25zLnB1c2goISFkaXJ0eSk7XG5cbiAgICAgIHRoaXMuX2RpcnR5Um93c1tzSW5kZXhdID0gW107XG4gICAgICBmb3IgKFxuICAgICAgICB2YXIgckluZGV4ID0gMDtcbiAgICAgICAgckluZGV4IDwgdGhpcy5yb3dJZGVudGl0aWVzW3NJbmRleF0ubGVuZ3RoO1xuICAgICAgICBySW5kZXgrK1xuICAgICAgKSB7XG4gICAgICAgIHZhciByb3dJRCA9IHRoaXMucm93SWRlbnRpdGllc1tzSW5kZXhdW3JJbmRleF07XG4gICAgICAgIC8vIGRpcnR5IGlmIHRoZSBzZWN0aW9uIGlzIG5ldywgcm93IGlzIG5ldyBvciBfcm93SGFzQ2hhbmdlZCBpcyB0cnVlXG4gICAgICAgIGRpcnR5ID1cbiAgICAgICAgICAhcHJldlNlY3Rpb25zSGFzaFtzZWN0aW9uSURdIHx8XG4gICAgICAgICAgIXByZXZSb3dzSGFzaFtzZWN0aW9uSURdW3Jvd0lEXSB8fFxuICAgICAgICAgIHRoaXMuX3Jvd0hhc0NoYW5nZWQoXG4gICAgICAgICAgICB0aGlzLl9nZXRSb3dEYXRhKHByZXZEYXRhQmxvYiwgc2VjdGlvbklELCByb3dJRCksXG4gICAgICAgICAgICB0aGlzLl9nZXRSb3dEYXRhKHRoaXMuX2RhdGFCbG9iLCBzZWN0aW9uSUQsIHJvd0lEKSxcbiAgICAgICAgICApO1xuICAgICAgICB0aGlzLl9kaXJ0eVJvd3Nbc0luZGV4XS5wdXNoKCEhZGlydHkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBjb3VudFJvd3MoYWxsUm93SURzKSB7XG4gIHZhciB0b3RhbFJvd3MgPSAwO1xuICBmb3IgKHZhciBzZWN0aW9uSWR4ID0gMDsgc2VjdGlvbklkeCA8IGFsbFJvd0lEcy5sZW5ndGg7IHNlY3Rpb25JZHgrKykge1xuICAgIHZhciByb3dJRHMgPSBhbGxSb3dJRHNbc2VjdGlvbklkeF07XG4gICAgdG90YWxSb3dzICs9IHJvd0lEcy5sZW5ndGg7XG4gIH1cbiAgcmV0dXJuIHRvdGFsUm93cztcbn1cblxuZnVuY3Rpb24ga2V5ZWREaWN0aW9uYXJ5RnJvbUFycmF5KGFycikge1xuICBpZiAoaXNFbXB0eShhcnIpKSB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG4gIHZhciByZXN1bHQgPSB7fTtcbiAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IGFyci5sZW5ndGg7IGlpKyspIHtcbiAgICB2YXIga2V5ID0gYXJyW2lpXTtcbiAgICB3YXJuaW5nKCFyZXN1bHRba2V5XSwgJ1ZhbHVlIGFwcGVhcnMgbW9yZSB0aGFuIG9uY2UgaW4gYXJyYXk6ICcgKyBrZXkpO1xuICAgIHJlc3VsdFtrZXldID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IExpc3RWaWV3RGF0YVNvdXJjZTtcbiJdfQ==