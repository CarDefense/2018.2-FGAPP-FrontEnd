b09daf1b865d921ae7f73458fb6fcc62
'use strict';var Dimensions=require('Dimensions');var FrameRateLogger=require('FrameRateLogger');var Keyboard=require('Keyboard');var ReactNative=require('ReactNative');var Subscribable=require('Subscribable');var TextInputState=require('TextInputState');var UIManager=require('UIManager');var invariant=require('fbjs/lib/invariant');var nullthrows=require('fbjs/lib/nullthrows');var performanceNow=require('fbjs/lib/performanceNow');var warning=require('fbjs/lib/warning');var _require=require('NativeModules'),ScrollViewManager=_require.ScrollViewManager;var _require2=require('ReactNativeComponentTree'),getInstanceFromNode=_require2.getInstanceFromNode;var IS_ANIMATING_TOUCH_START_THRESHOLD_MS=16;function isTagInstanceOfTextInput(tag){var instance=getInstanceFromNode(tag);return instance&&instance.viewConfig&&(instance.viewConfig.uiViewClassName==='AndroidTextInput'||instance.viewConfig.uiViewClassName==='RCTMultilineTextInputView'||instance.viewConfig.uiViewClassName==='RCTSinglelineTextInputView');}var ScrollResponderMixin={mixins:[Subscribable.Mixin],scrollResponderMixinGetInitialState:function scrollResponderMixinGetInitialState(){return{isTouching:false,lastMomentumScrollBeginTime:0,lastMomentumScrollEndTime:0,observedScrollSinceBecomingResponder:false,becameResponderWhileAnimating:false};},scrollResponderHandleScrollShouldSetResponder:function scrollResponderHandleScrollShouldSetResponder(){return this.state.isTouching;},scrollResponderHandleStartShouldSetResponder:function scrollResponderHandleStartShouldSetResponder(e){var currentlyFocusedTextInput=TextInputState.currentlyFocusedField();if(this.props.keyboardShouldPersistTaps==='handled'&&currentlyFocusedTextInput!=null&&e.target!==currentlyFocusedTextInput){return true;}return false;},scrollResponderHandleStartShouldSetResponderCapture:function scrollResponderHandleStartShouldSetResponderCapture(e){var currentlyFocusedTextInput=TextInputState.currentlyFocusedField();var keyboardShouldPersistTaps=this.props.keyboardShouldPersistTaps;var keyboardNeverPersistTaps=!keyboardShouldPersistTaps||keyboardShouldPersistTaps==='never';if(keyboardNeverPersistTaps&&currentlyFocusedTextInput!=null&&!isTagInstanceOfTextInput(e.target)){return true;}return this.scrollResponderIsAnimating();},scrollResponderHandleResponderReject:function scrollResponderHandleResponderReject(){},scrollResponderHandleTerminationRequest:function scrollResponderHandleTerminationRequest(){return!this.state.observedScrollSinceBecomingResponder;},scrollResponderHandleTouchEnd:function scrollResponderHandleTouchEnd(e){var nativeEvent=e.nativeEvent;this.state.isTouching=nativeEvent.touches.length!==0;this.props.onTouchEnd&&this.props.onTouchEnd(e);},scrollResponderHandleTouchCancel:function scrollResponderHandleTouchCancel(e){this.state.isTouching=false;this.props.onTouchCancel&&this.props.onTouchCancel(e);},scrollResponderHandleResponderRelease:function scrollResponderHandleResponderRelease(e){this.props.onResponderRelease&&this.props.onResponderRelease(e);var currentlyFocusedTextInput=TextInputState.currentlyFocusedField();if(this.props.keyboardShouldPersistTaps!==true&&this.props.keyboardShouldPersistTaps!=='always'&&currentlyFocusedTextInput!=null&&e.target!==currentlyFocusedTextInput&&!this.state.observedScrollSinceBecomingResponder&&!this.state.becameResponderWhileAnimating){this.props.onScrollResponderKeyboardDismissed&&this.props.onScrollResponderKeyboardDismissed(e);TextInputState.blurTextInput(currentlyFocusedTextInput);}},scrollResponderHandleScroll:function scrollResponderHandleScroll(e){this.state.observedScrollSinceBecomingResponder=true;this.props.onScroll&&this.props.onScroll(e);},scrollResponderHandleResponderGrant:function scrollResponderHandleResponderGrant(e){this.state.observedScrollSinceBecomingResponder=false;this.props.onResponderGrant&&this.props.onResponderGrant(e);this.state.becameResponderWhileAnimating=this.scrollResponderIsAnimating();},scrollResponderHandleScrollBeginDrag:function scrollResponderHandleScrollBeginDrag(e){FrameRateLogger.beginScroll();this.props.onScrollBeginDrag&&this.props.onScrollBeginDrag(e);},scrollResponderHandleScrollEndDrag:function scrollResponderHandleScrollEndDrag(e){var velocity=e.nativeEvent.velocity;if(!this.scrollResponderIsAnimating()&&(!velocity||velocity.x===0&&velocity.y===0)){FrameRateLogger.endScroll();}this.props.onScrollEndDrag&&this.props.onScrollEndDrag(e);},scrollResponderHandleMomentumScrollBegin:function scrollResponderHandleMomentumScrollBegin(e){this.state.lastMomentumScrollBeginTime=performanceNow();this.props.onMomentumScrollBegin&&this.props.onMomentumScrollBegin(e);},scrollResponderHandleMomentumScrollEnd:function scrollResponderHandleMomentumScrollEnd(e){FrameRateLogger.endScroll();this.state.lastMomentumScrollEndTime=performanceNow();this.props.onMomentumScrollEnd&&this.props.onMomentumScrollEnd(e);},scrollResponderHandleTouchStart:function scrollResponderHandleTouchStart(e){this.state.isTouching=true;this.props.onTouchStart&&this.props.onTouchStart(e);},scrollResponderHandleTouchMove:function scrollResponderHandleTouchMove(e){this.props.onTouchMove&&this.props.onTouchMove(e);},scrollResponderIsAnimating:function scrollResponderIsAnimating(){var now=performanceNow();var timeSinceLastMomentumScrollEnd=now-this.state.lastMomentumScrollEndTime;var isAnimating=timeSinceLastMomentumScrollEnd<IS_ANIMATING_TOUCH_START_THRESHOLD_MS||this.state.lastMomentumScrollEndTime<this.state.lastMomentumScrollBeginTime;return isAnimating;},scrollResponderGetScrollableNode:function scrollResponderGetScrollableNode(){return this.getScrollableNode?this.getScrollableNode():ReactNative.findNodeHandle(this);},scrollResponderScrollTo:function scrollResponderScrollTo(x,y,animated){if(typeof x==='number'){console.warn('`scrollResponderScrollTo(x, y, animated)` is deprecated. Use `scrollResponderScrollTo({x: 5, y: 5, animated: true})` instead.');}else{var _ref=x||{};x=_ref.x;y=_ref.y;animated=_ref.animated;}UIManager.dispatchViewManagerCommand(nullthrows(this.scrollResponderGetScrollableNode()),UIManager.RCTScrollView.Commands.scrollTo,[x||0,y||0,animated!==false]);},scrollResponderScrollToEnd:function scrollResponderScrollToEnd(options){var animated=(options&&options.animated)!==false;UIManager.dispatchViewManagerCommand(this.scrollResponderGetScrollableNode(),UIManager.RCTScrollView.Commands.scrollToEnd,[animated]);},scrollResponderScrollWithoutAnimationTo:function scrollResponderScrollWithoutAnimationTo(offsetX,offsetY){console.warn('`scrollResponderScrollWithoutAnimationTo` is deprecated. Use `scrollResponderScrollTo` instead');this.scrollResponderScrollTo({x:offsetX,y:offsetY,animated:false});},scrollResponderZoomTo:function scrollResponderZoomTo(rect,animated){invariant(ScrollViewManager&&ScrollViewManager.zoomToRect,'zoomToRect is not implemented');if('animated'in rect){animated=rect.animated;delete rect.animated;}else if(typeof animated!=='undefined'){console.warn('`scrollResponderZoomTo` `animated` argument is deprecated. Use `options.animated` instead');}ScrollViewManager.zoomToRect(this.scrollResponderGetScrollableNode(),rect,animated!==false);},scrollResponderFlashScrollIndicators:function scrollResponderFlashScrollIndicators(){UIManager.dispatchViewManagerCommand(this.scrollResponderGetScrollableNode(),UIManager.RCTScrollView.Commands.flashScrollIndicators,[]);},scrollResponderScrollNativeHandleToKeyboard:function scrollResponderScrollNativeHandleToKeyboard(nodeHandle,additionalOffset,preventNegativeScrollOffset){this.additionalScrollOffset=additionalOffset||0;this.preventNegativeScrollOffset=!!preventNegativeScrollOffset;UIManager.measureLayout(nodeHandle,ReactNative.findNodeHandle(this.getInnerViewNode()),this.scrollResponderTextInputFocusError,this.scrollResponderInputMeasureAndScrollToKeyboard);},scrollResponderInputMeasureAndScrollToKeyboard:function scrollResponderInputMeasureAndScrollToKeyboard(left,top,width,height){var keyboardScreenY=Dimensions.get('window').height;if(this.keyboardWillOpenTo){keyboardScreenY=this.keyboardWillOpenTo.endCoordinates.screenY;}var scrollOffsetY=top-keyboardScreenY+height+this.additionalScrollOffset;if(this.preventNegativeScrollOffset){scrollOffsetY=Math.max(0,scrollOffsetY);}this.scrollResponderScrollTo({x:0,y:scrollOffsetY,animated:true});this.additionalOffset=0;this.preventNegativeScrollOffset=false;},scrollResponderTextInputFocusError:function scrollResponderTextInputFocusError(e){console.error('Error measuring text field: ',e);},UNSAFE_componentWillMount:function UNSAFE_componentWillMount(){var keyboardShouldPersistTaps=this.props.keyboardShouldPersistTaps;warning(typeof keyboardShouldPersistTaps!=='boolean','\'keyboardShouldPersistTaps={'+keyboardShouldPersistTaps+'}\' is deprecated. '+('Use \'keyboardShouldPersistTaps="'+(keyboardShouldPersistTaps?'always':'never')+'"\' instead'));this.keyboardWillOpenTo=null;this.additionalScrollOffset=0;this.addListenerOn(Keyboard,'keyboardWillShow',this.scrollResponderKeyboardWillShow);this.addListenerOn(Keyboard,'keyboardWillHide',this.scrollResponderKeyboardWillHide);this.addListenerOn(Keyboard,'keyboardDidShow',this.scrollResponderKeyboardDidShow);this.addListenerOn(Keyboard,'keyboardDidHide',this.scrollResponderKeyboardDidHide);},scrollResponderKeyboardWillShow:function scrollResponderKeyboardWillShow(e){this.keyboardWillOpenTo=e;this.props.onKeyboardWillShow&&this.props.onKeyboardWillShow(e);},scrollResponderKeyboardWillHide:function scrollResponderKeyboardWillHide(e){this.keyboardWillOpenTo=null;this.props.onKeyboardWillHide&&this.props.onKeyboardWillHide(e);},scrollResponderKeyboardDidShow:function scrollResponderKeyboardDidShow(e){if(e){this.keyboardWillOpenTo=e;}this.props.onKeyboardDidShow&&this.props.onKeyboardDidShow(e);},scrollResponderKeyboardDidHide:function scrollResponderKeyboardDidHide(e){this.keyboardWillOpenTo=null;this.props.onKeyboardDidHide&&this.props.onKeyboardDidHide(e);}};var ScrollResponder={Mixin:ScrollResponderMixin};module.exports=ScrollResponder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNjcm9sbFJlc3BvbmRlci5qcyJdLCJuYW1lcyI6WyJEaW1lbnNpb25zIiwicmVxdWlyZSIsIkZyYW1lUmF0ZUxvZ2dlciIsIktleWJvYXJkIiwiUmVhY3ROYXRpdmUiLCJTdWJzY3JpYmFibGUiLCJUZXh0SW5wdXRTdGF0ZSIsIlVJTWFuYWdlciIsImludmFyaWFudCIsIm51bGx0aHJvd3MiLCJwZXJmb3JtYW5jZU5vdyIsIndhcm5pbmciLCJTY3JvbGxWaWV3TWFuYWdlciIsImdldEluc3RhbmNlRnJvbU5vZGUiLCJJU19BTklNQVRJTkdfVE9VQ0hfU1RBUlRfVEhSRVNIT0xEX01TIiwiaXNUYWdJbnN0YW5jZU9mVGV4dElucHV0IiwidGFnIiwiaW5zdGFuY2UiLCJ2aWV3Q29uZmlnIiwidWlWaWV3Q2xhc3NOYW1lIiwiU2Nyb2xsUmVzcG9uZGVyTWl4aW4iLCJtaXhpbnMiLCJNaXhpbiIsInNjcm9sbFJlc3BvbmRlck1peGluR2V0SW5pdGlhbFN0YXRlIiwiaXNUb3VjaGluZyIsImxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSIsImxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUiLCJvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIiLCJiZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbFNob3VsZFNldFJlc3BvbmRlciIsInN0YXRlIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlU3RhcnRTaG91bGRTZXRSZXNwb25kZXIiLCJlIiwiY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCIsImN1cnJlbnRseUZvY3VzZWRGaWVsZCIsInByb3BzIiwia2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyIsInRhcmdldCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSIsImtleWJvYXJkTmV2ZXJQZXJzaXN0VGFwcyIsInNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVqZWN0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVGVybWluYXRpb25SZXF1ZXN0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hFbmQiLCJuYXRpdmVFdmVudCIsInRvdWNoZXMiLCJsZW5ndGgiLCJvblRvdWNoRW5kIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hDYW5jZWwiLCJvblRvdWNoQ2FuY2VsIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVsZWFzZSIsIm9uUmVzcG9uZGVyUmVsZWFzZSIsIm9uU2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaXNtaXNzZWQiLCJibHVyVGV4dElucHV0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsIiwib25TY3JvbGwiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJHcmFudCIsIm9uUmVzcG9uZGVyR3JhbnQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxCZWdpbkRyYWciLCJiZWdpblNjcm9sbCIsIm9uU2Nyb2xsQmVnaW5EcmFnIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsRW5kRHJhZyIsInZlbG9jaXR5IiwieCIsInkiLCJlbmRTY3JvbGwiLCJvblNjcm9sbEVuZERyYWciLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVNb21lbnR1bVNjcm9sbEJlZ2luIiwib25Nb21lbnR1bVNjcm9sbEJlZ2luIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxFbmQiLCJvbk1vbWVudHVtU2Nyb2xsRW5kIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hTdGFydCIsIm9uVG91Y2hTdGFydCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoTW92ZSIsIm9uVG91Y2hNb3ZlIiwibm93IiwidGltZVNpbmNlTGFzdE1vbWVudHVtU2Nyb2xsRW5kIiwiaXNBbmltYXRpbmciLCJzY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZSIsImdldFNjcm9sbGFibGVOb2RlIiwiZmluZE5vZGVIYW5kbGUiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyIsImFuaW1hdGVkIiwiY29uc29sZSIsIndhcm4iLCJkaXNwYXRjaFZpZXdNYW5hZ2VyQ29tbWFuZCIsIlJDVFNjcm9sbFZpZXciLCJDb21tYW5kcyIsInNjcm9sbFRvIiwic2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG9FbmQiLCJvcHRpb25zIiwic2Nyb2xsVG9FbmQiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxXaXRob3V0QW5pbWF0aW9uVG8iLCJvZmZzZXRYIiwib2Zmc2V0WSIsInNjcm9sbFJlc3BvbmRlclpvb21UbyIsInJlY3QiLCJ6b29tVG9SZWN0Iiwic2Nyb2xsUmVzcG9uZGVyRmxhc2hTY3JvbGxJbmRpY2F0b3JzIiwiZmxhc2hTY3JvbGxJbmRpY2F0b3JzIiwic2Nyb2xsUmVzcG9uZGVyU2Nyb2xsTmF0aXZlSGFuZGxlVG9LZXlib2FyZCIsIm5vZGVIYW5kbGUiLCJhZGRpdGlvbmFsT2Zmc2V0IiwicHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0IiwiYWRkaXRpb25hbFNjcm9sbE9mZnNldCIsIm1lYXN1cmVMYXlvdXQiLCJnZXRJbm5lclZpZXdOb2RlIiwic2Nyb2xsUmVzcG9uZGVyVGV4dElucHV0Rm9jdXNFcnJvciIsInNjcm9sbFJlc3BvbmRlcklucHV0TWVhc3VyZUFuZFNjcm9sbFRvS2V5Ym9hcmQiLCJsZWZ0IiwidG9wIiwid2lkdGgiLCJoZWlnaHQiLCJrZXlib2FyZFNjcmVlblkiLCJnZXQiLCJrZXlib2FyZFdpbGxPcGVuVG8iLCJlbmRDb29yZGluYXRlcyIsInNjcmVlblkiLCJzY3JvbGxPZmZzZXRZIiwiTWF0aCIsIm1heCIsImVycm9yIiwiVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCIsImFkZExpc3RlbmVyT24iLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxTaG93Iiwic2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsSGlkZSIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkU2hvdyIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkSGlkZSIsIm9uS2V5Ym9hcmRXaWxsU2hvdyIsIm9uS2V5Ym9hcmRXaWxsSGlkZSIsIm9uS2V5Ym9hcmREaWRTaG93Iiwib25LZXlib2FyZERpZEhpZGUiLCJTY3JvbGxSZXNwb25kZXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFTQSxhQUVBLEdBQU1BLFlBQWFDLE9BQWIsY0FBTixDQUNBLEdBQU1DLGlCQUFrQkQsT0FBbEIsbUJBQU4sQ0FDQSxHQUFNRSxVQUFXRixPQUFYLFlBQU4sQ0FDQSxHQUFNRyxhQUFjSCxPQUFkLGVBQU4sQ0FDQSxHQUFNSSxjQUFlSixPQUFmLGdCQUFOLENBQ0EsR0FBTUssZ0JBQWlCTCxPQUFqQixrQkFBTixDQUNBLEdBQU1NLFdBQVlOLE9BQVosYUFBTixDQUVBLEdBQU1PLFdBQVlQLE9BQVosc0JBQU4sQ0FDQSxHQUFNUSxZQUFhUixPQUFiLHVCQUFOLENBQ0EsR0FBTVMsZ0JBQWlCVCxPQUFqQiwyQkFBTixDQUNBLEdBQU1VLFNBQVVWLE9BQVYsb0JBQU4sQyxhQUU4QkEsTyxrQkFBdEJXLGlCLFVBQUFBLGlCLGVBQ3dCWCxPLDZCQUF4QlksbUIsV0FBQUEsbUIsQ0FnRlIsR0FBTUMsdUNBQXdDLEVBQTlDLENBV0EsUUFBU0MseUJBQVQsQ0FBa0NDLEdBQWxDLENBQXVDLENBQ3JDLEdBQU1DLFVBQVdKLG9CQUFvQkcsR0FBcEIsQ0FBakIsQ0FDQSxNQUFPQyxXQUFZQSxTQUFTQyxVQUFyQixHQUNMRCxTQUFTQyxVQUFULENBQW9CQyxlQUFwQixHQUF3QyxrQkFBeEMsRUFDQUYsU0FBU0MsVUFBVCxDQUFvQkMsZUFBcEIsR0FBd0MsMkJBRHhDLEVBRUFGLFNBQVNDLFVBQVQsQ0FBb0JDLGVBQXBCLEdBQXdDLDRCQUhuQyxDQUFQLENBS0QsQ0FFRCxHQUFNQyxzQkFBdUIsQ0FDM0JDLE9BQVEsQ0FBQ2hCLGFBQWFpQixLQUFkLENBRG1CLENBRTNCQyxvQ0FBcUMs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QVc2RixrQkFBWCxDQUE4QmhHLENBQTlCLENBQWpDLENBQ0QsQ0F0ZDBCLENBd2QzQjZGLGdDQUFpQyx5Q0FBUzdGLENBQVQsQ0FBbUIsQ0FDbEQsS0FBS21GLGtCQUFMLENBQTBCLElBQTFCLENBQ0EsS0FBS2hGLEtBQUwsQ0FBVzhGLGtCQUFYLEVBQWlDLEtBQUs5RixLQUFMLENBQVc4RixrQkFBWCxDQUE4QmpHLENBQTlCLENBQWpDLENBQ0QsQ0EzZDBCLENBNmQzQjhGLCtCQUFnQyx3Q0FBUzlGLENBQVQsQ0FBbUIsQ0FHakQsR0FBSUEsQ0FBSixDQUFPLENBQ0wsS0FBS21GLGtCQUFMLENBQTBCbkYsQ0FBMUIsQ0FDRCxDQUNELEtBQUtHLEtBQUwsQ0FBVytGLGlCQUFYLEVBQWdDLEtBQUsvRixLQUFMLENBQVcrRixpQkFBWCxDQUE2QmxHLENBQTdCLENBQWhDLENBQ0QsQ0FwZTBCLENBc2UzQitGLCtCQUFnQyx3Q0FBUy9GLENBQVQsQ0FBbUIsQ0FDakQsS0FBS21GLGtCQUFMLENBQTBCLElBQTFCLENBQ0EsS0FBS2hGLEtBQUwsQ0FBV2dHLGlCQUFYLEVBQWdDLEtBQUtoRyxLQUFMLENBQVdnRyxpQkFBWCxDQUE2Qm5HLENBQTdCLENBQWhDLENBQ0QsQ0F6ZTBCLENBQTdCLENBNmVBLEdBQU1vRyxpQkFBa0IsQ0FDdEI5RyxNQUFPRixvQkFEZSxDQUF4QixDQUlBaUgsT0FBT0MsT0FBUCxDQUFpQkYsZUFBakIiLCJmaWxlIjoiU2Nyb2xsUmVzcG9uZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgU2Nyb2xsUmVzcG9uZGVyXG4gKiBAZmxvd1xuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IERpbWVuc2lvbnMgPSByZXF1aXJlKCdEaW1lbnNpb25zJyk7XG5jb25zdCBGcmFtZVJhdGVMb2dnZXIgPSByZXF1aXJlKCdGcmFtZVJhdGVMb2dnZXInKTtcbmNvbnN0IEtleWJvYXJkID0gcmVxdWlyZSgnS2V5Ym9hcmQnKTtcbmNvbnN0IFJlYWN0TmF0aXZlID0gcmVxdWlyZSgnUmVhY3ROYXRpdmUnKTtcbmNvbnN0IFN1YnNjcmliYWJsZSA9IHJlcXVpcmUoJ1N1YnNjcmliYWJsZScpO1xuY29uc3QgVGV4dElucHV0U3RhdGUgPSByZXF1aXJlKCdUZXh0SW5wdXRTdGF0ZScpO1xuY29uc3QgVUlNYW5hZ2VyID0gcmVxdWlyZSgnVUlNYW5hZ2VyJyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuY29uc3QgbnVsbHRocm93cyA9IHJlcXVpcmUoJ2ZianMvbGliL251bGx0aHJvd3MnKTtcbmNvbnN0IHBlcmZvcm1hbmNlTm93ID0gcmVxdWlyZSgnZmJqcy9saWIvcGVyZm9ybWFuY2VOb3cnKTtcbmNvbnN0IHdhcm5pbmcgPSByZXF1aXJlKCdmYmpzL2xpYi93YXJuaW5nJyk7XG5cbmNvbnN0IHsgU2Nyb2xsVmlld01hbmFnZXIgfSA9IHJlcXVpcmUoJ05hdGl2ZU1vZHVsZXMnKTtcbmNvbnN0IHsgZ2V0SW5zdGFuY2VGcm9tTm9kZSB9ID0gcmVxdWlyZSgnUmVhY3ROYXRpdmVDb21wb25lbnRUcmVlJyk7XG5cbi8qKlxuICogTWl4aW4gdGhhdCBjYW4gYmUgaW50ZWdyYXRlZCBpbiBvcmRlciB0byBoYW5kbGUgc2Nyb2xsaW5nIHRoYXQgcGxheXMgd2VsbFxuICogd2l0aCBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLiBJbnRlZ3JhdGUgd2l0aCB5b3VyIHBsYXRmb3JtIHNwZWNpZmljIHNjcm9sbFxuICogdmlld3MsIG9yIGV2ZW4geW91ciBjdXN0b20gYnVpbHQgKGV2ZXJ5LWZyYW1lIGFuaW1hdGluZykgc2Nyb2xsIHZpZXdzIHNvIHRoYXRcbiAqIGFsbCBvZiB0aGVzZSBzeXN0ZW1zIHBsYXkgd2VsbCB3aXRoIHRoZSBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLlxuICpcbiAqIGlPUyBzY3JvbGwgZXZlbnQgdGltaW5nIG51YW5jZXM6XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKlxuICpcbiAqIFNjcm9sbGluZyB3aXRob3V0IGJvdW5jaW5nLCBpZiB5b3UgdG91Y2ggZG93bjpcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqXG4gKiAxLiBgb25Nb21lbnR1bVNjcm9sbEJlZ2luYCAod2hlbiBhbmltYXRpb24gYmVnaW5zIGFmdGVyIGxldHRpbmcgdXApXG4gKiAgICAuLi4gcGh5c2ljYWwgdG91Y2ggc3RhcnRzIC4uLlxuICogMi4gYG9uVG91Y2hTdGFydENhcHR1cmVgICAgKHdoZW4geW91IHByZXNzIGRvd24gdG8gc3RvcCB0aGUgc2Nyb2xsKVxuICogMy4gYG9uVG91Y2hTdGFydGAgICAgICAgICAgKHNhbWUsIGJ1dCBidWJibGUgcGhhc2UpXG4gKiA0LiBgb25SZXNwb25kZXJSZWxlYXNlYCAgICAod2hlbiBsaWZ0aW5nIHVwIC0geW91IGNvdWxkIHBhdXNlIGZvcmV2ZXIgYmVmb3JlICogbGlmdGluZylcbiAqIDUuIGBvbk1vbWVudHVtU2Nyb2xsRW5kYFxuICpcbiAqXG4gKiBTY3JvbGxpbmcgd2l0aCBib3VuY2luZywgaWYgeW91IHRvdWNoIGRvd246XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKlxuICogMS4gYG9uTW9tZW50dW1TY3JvbGxCZWdpbmAgKHdoZW4gYW5pbWF0aW9uIGJlZ2lucyBhZnRlciBsZXR0aW5nIHVwKVxuICogICAgLi4uIGJvdW5jZSBiZWdpbnMgLi4uXG4gKiAgICAuLi4gc29tZSB0aW1lIGVsYXBzZXMgLi4uXG4gKiAgICAuLi4gcGh5c2ljYWwgdG91Y2ggZHVyaW5nIGJvdW5jZSAuLi5cbiAqIDIuIGBvbk1vbWVudHVtU2Nyb2xsRW5kYCAgIChNYWtlcyBubyBzZW5zZSB3aHkgdGhpcyBvY2N1cnMgZmlyc3QgZHVyaW5nIGJvdW5jZSlcbiAqIDMuIGBvblRvdWNoU3RhcnRDYXB0dXJlYCAgIChpbW1lZGlhdGVseSBhZnRlciBgb25Nb21lbnR1bVNjcm9sbEVuZGApXG4gKiA0LiBgb25Ub3VjaFN0YXJ0YCAgICAgICAgICAoc2FtZSwgYnV0IGJ1YmJsZSBwaGFzZSlcbiAqIDUuIGBvblRvdWNoRW5kYCAgICAgICAgICAgIChZb3UgY291bGQgaG9sZCB0aGUgdG91Y2ggc3RhcnQgZm9yIGEgbG9uZyB0aW1lKVxuICogNi4gYG9uTW9tZW50dW1TY3JvbGxCZWdpbmAgKFdoZW4gcmVsZWFzaW5nIHRoZSB2aWV3IHN0YXJ0cyBib3VuY2luZyBiYWNrKVxuICpcbiAqIFNvIHdoZW4gd2UgcmVjZWl2ZSBhbiBgb25Ub3VjaFN0YXJ0YCwgaG93IGNhbiB3ZSB0ZWxsIGlmIHdlIGFyZSB0b3VjaGluZ1xuICogKmR1cmluZyogYW4gYW5pbWF0aW9uICh3aGljaCB0aGVuIGNhdXNlcyB0aGUgYW5pbWF0aW9uIHRvIHN0b3ApPyBUaGUgb25seSB3YXlcbiAqIHRvIHRlbGwgaXMgaWYgdGhlIGB0b3VjaFN0YXJ0YCBvY2N1cnJlZCBpbW1lZGlhdGVseSBhZnRlciB0aGVcbiAqIGBvbk1vbWVudHVtU2Nyb2xsRW5kYC5cbiAqXG4gKiBUaGlzIGlzIGFic3RyYWN0ZWQgb3V0IGZvciB5b3UsIHNvIHlvdSBjYW4ganVzdCBjYWxsIHRoaXMuc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmcoKSBpZlxuICogbmVjZXNzYXJ5XG4gKlxuICogYFNjcm9sbFJlc3BvbmRlcmAgYWxzbyBpbmNsdWRlcyBsb2dpYyBmb3IgYmx1cnJpbmcgYSBjdXJyZW50bHkgZm9jdXNlZCBpbnB1dFxuICogaWYgb25lIGlzIGZvY3VzZWQgd2hpbGUgc2Nyb2xsaW5nLiBUaGUgYFNjcm9sbFJlc3BvbmRlcmAgaXMgYSBuYXR1cmFsIHBsYWNlXG4gKiB0byBwdXQgdGhpcyBsb2dpYyBzaW5jZSBpdCBjYW4gc3VwcG9ydCBub3QgZGlzbWlzc2luZyB0aGUga2V5Ym9hcmQgd2hpbGVcbiAqIHNjcm9sbGluZywgdW5sZXNzIGEgcmVjb2duaXplZCBcInRhcFwiLWxpa2UgZ2VzdHVyZSBoYXMgb2NjdXJyZWQuXG4gKlxuICogVGhlIHB1YmxpYyBsaWZlY3ljbGUgQVBJIGluY2x1ZGVzIGV2ZW50cyBmb3Iga2V5Ym9hcmQgaW50ZXJhY3Rpb24sIHJlc3BvbmRlclxuICogaW50ZXJhY3Rpb24sIGFuZCBzY3JvbGxpbmcgKGFtb25nIG90aGVycykuIFRoZSBrZXlib2FyZCBjYWxsYmFja3NcbiAqIGBvbktleWJvYXJkV2lsbC9EaWQvKmAgYXJlICpnbG9iYWwqIGV2ZW50cywgYnV0IGFyZSBpbnZva2VkIG9uIHNjcm9sbFxuICogcmVzcG9uZGVyJ3MgcHJvcHMgc28gdGhhdCB5b3UgY2FuIGd1YXJhbnRlZSB0aGF0IHRoZSBzY3JvbGwgcmVzcG9uZGVyJ3NcbiAqIGludGVybmFsIHN0YXRlIGhhcyBiZWVuIHVwZGF0ZWQgYWNjb3JkaW5nbHkgKGFuZCBkZXRlcm1pbmlzdGljYWxseSkgYnlcbiAqIHRoZSB0aW1lIHRoZSBwcm9wcyBjYWxsYmFja3MgYXJlIGludm9rZS4gT3RoZXJ3aXNlLCB5b3Ugd291bGQgYWx3YXlzIHdvbmRlclxuICogaWYgdGhlIHNjcm9sbCByZXNwb25kZXIgaXMgY3VycmVudGx5IGluIGEgc3RhdGUgd2hlcmUgaXQgcmVjb2duaXplcyBuZXdcbiAqIGtleWJvYXJkIHBvc2l0aW9ucyBldGMuIElmIGNvb3JkaW5hdGluZyBzY3JvbGxpbmcgd2l0aCBrZXlib2FyZCBtb3ZlbWVudCxcbiAqICphbHdheXMqIHVzZSB0aGVzZSBob29rcyBpbnN0ZWFkIG9mIGxpc3RlbmluZyB0byB5b3VyIG93biBnbG9iYWwga2V5Ym9hcmRcbiAqIGV2ZW50cy5cbiAqXG4gKiBQdWJsaWMga2V5Ym9hcmQgbGlmZWN5Y2xlIEFQSTogKHByb3BzIGNhbGxiYWNrcylcbiAqXG4gKiBTdGFuZGFyZCBLZXlib2FyZCBBcHBlYXJhbmNlIFNlcXVlbmNlOlxuICpcbiAqICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3dcbiAqICAgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkU2hvd1xuICpcbiAqIGBvblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkYCB3aWxsIGJlIGludm9rZWQgaWYgYW4gYXBwcm9wcmlhdGVcbiAqIHRhcCBpbnNpZGUgdGhlIHNjcm9sbCByZXNwb25kZXIncyBzY3JvbGxhYmxlIHJlZ2lvbiB3YXMgcmVzcG9uc2libGVcbiAqIGZvciB0aGUgZGlzbWlzc2FsIG9mIHRoZSBrZXlib2FyZC4gVGhlcmUgYXJlIG90aGVyIHJlYXNvbnMgd2h5IHRoZVxuICoga2V5Ym9hcmQgY291bGQgYmUgZGlzbWlzc2VkLlxuICpcbiAqICAgdGhpcy5wcm9wcy5vblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkXG4gKlxuICogU3RhbmRhcmQgS2V5Ym9hcmQgSGlkZSBTZXF1ZW5jZTpcbiAqXG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxIaWRlXG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZERpZEhpZGVcbiAqL1xuXG5jb25zdCBJU19BTklNQVRJTkdfVE9VQ0hfU1RBUlRfVEhSRVNIT0xEX01TID0gMTY7XG5cbnR5cGUgU3RhdGUgPSB7XG4gICAgaXNUb3VjaGluZzogYm9vbGVhbixcbiAgICBsYXN0TW9tZW50dW1TY3JvbGxCZWdpblRpbWU6IG51bWJlcixcbiAgICBsYXN0TW9tZW50dW1TY3JvbGxFbmRUaW1lOiBudW1iZXIsXG4gICAgb2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyOiBib29sZWFuLFxuICAgIGJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nOiBib29sZWFuLFxufTtcbnR5cGUgRXZlbnQgPSBPYmplY3Q7XG5cbmZ1bmN0aW9uIGlzVGFnSW5zdGFuY2VPZlRleHRJbnB1dCh0YWcpIHtcbiAgY29uc3QgaW5zdGFuY2UgPSBnZXRJbnN0YW5jZUZyb21Ob2RlKHRhZyk7XG4gIHJldHVybiBpbnN0YW5jZSAmJiBpbnN0YW5jZS52aWV3Q29uZmlnICYmIChcbiAgICBpbnN0YW5jZS52aWV3Q29uZmlnLnVpVmlld0NsYXNzTmFtZSA9PT0gJ0FuZHJvaWRUZXh0SW5wdXQnIHx8XG4gICAgaW5zdGFuY2Uudmlld0NvbmZpZy51aVZpZXdDbGFzc05hbWUgPT09ICdSQ1RNdWx0aWxpbmVUZXh0SW5wdXRWaWV3JyB8fFxuICAgIGluc3RhbmNlLnZpZXdDb25maWcudWlWaWV3Q2xhc3NOYW1lID09PSAnUkNUU2luZ2xlbGluZVRleHRJbnB1dFZpZXcnXG4gICk7XG59XG5cbmNvbnN0IFNjcm9sbFJlc3BvbmRlck1peGluID0ge1xuICBtaXhpbnM6IFtTdWJzY3JpYmFibGUuTWl4aW5dLFxuICBzY3JvbGxSZXNwb25kZXJNaXhpbkdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKTogU3RhdGUge1xuICAgIHJldHVybiB7XG4gICAgICBpc1RvdWNoaW5nOiBmYWxzZSxcbiAgICAgIGxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZTogMCxcbiAgICAgIGxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWU6IDAsXG5cbiAgICAgIC8vIFJlc2V0IHRvIGZhbHNlIGV2ZXJ5IHRpbWUgYmVjb21lcyByZXNwb25kZXIuIFRoaXMgaXMgdXNlZCB0bzpcbiAgICAgIC8vIC0gRGV0ZXJtaW5lIGlmIHRoZSBzY3JvbGwgdmlldyBoYXMgYmVlbiBzY3JvbGxlZCBhbmQgdGhlcmVmb3JlIHNob3VsZFxuICAgICAgLy8gcmVmdXNlIHRvIGdpdmUgdXAgaXRzIHJlc3BvbmRlciBsb2NrLlxuICAgICAgLy8gLSBEZXRlcm1pbmUgaWYgcmVsZWFzaW5nIHNob3VsZCBkaXNtaXNzIHRoZSBrZXlib2FyZCB3aGVuIHdlIGFyZSBpblxuICAgICAgLy8gdGFwLXRvLWRpc21pc3MgbW9kZSAodGhpcy5wcm9wcy5rZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSAnYWx3YXlzJykuXG4gICAgICBvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXI6IGZhbHNlLFxuICAgICAgYmVjYW1lUmVzcG9uZGVyV2hpbGVBbmltYXRpbmc6IGZhbHNlLFxuICAgIH07XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU2Nyb2xsYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbFNob3VsZFNldFJlc3BvbmRlcjogZnVuY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuaXNUb3VjaGluZztcbiAgfSxcblxuICAvKipcbiAgICogTWVyZWx5IHRvdWNoIHN0YXJ0aW5nIGlzIG5vdCBzdWZmaWNpZW50IGZvciBhIHNjcm9sbCB2aWV3IHRvIGJlY29tZSB0aGVcbiAgICogcmVzcG9uZGVyLiBCZWluZyB0aGUgXCJyZXNwb25kZXJcIiBtZWFucyB0aGF0IHRoZSB2ZXJ5IG5leHQgdG91Y2ggbW92ZS9lbmRcbiAgICogZXZlbnQgd2lsbCByZXN1bHQgaW4gYW4gYWN0aW9uL21vdmVtZW50LlxuICAgKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyYCBldmVudC5cbiAgICpcbiAgICogYG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJgIGlzIHVzZWQgd2hlbiB0aGUgbmV4dCBtb3ZlL2VuZCB3aWxsIHRyaWdnZXJcbiAgICogc29tZSBVSSBtb3ZlbWVudC9hY3Rpb24sIGJ1dCB3aGVuIHlvdSB3YW50IHRvIHlpZWxkIHByaW9yaXR5IHRvIHZpZXdzXG4gICAqIG5lc3RlZCBpbnNpZGUgb2YgdGhlIHZpZXcuXG4gICAqXG4gICAqIFRoZXJlIG1heSBiZSBzb21lIGNhc2VzIHdoZXJlIHNjcm9sbCB2aWV3cyBhY3R1YWxseSBzaG91bGQgcmV0dXJuIGB0cnVlYFxuICAgKiBmcm9tIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyYDogQW55IHRpbWUgd2UgYXJlIGRldGVjdGluZyBhIHN0YW5kYXJkIHRhcFxuICAgKiB0aGF0IGdpdmVzIHByaW9yaXR5IHRvIG5lc3RlZCB2aWV3cy5cbiAgICpcbiAgICogLSBJZiBhIHNpbmdsZSB0YXAgb24gdGhlIHNjcm9sbCB2aWV3IHRyaWdnZXJzIGFuIGFjdGlvbiBzdWNoIGFzXG4gICAqICAgcmVjZW50ZXJpbmcgYSBtYXAgc3R5bGUgdmlldyB5ZXQgd2FudHMgdG8gZ2l2ZSBwcmlvcml0eSB0byBpbnRlcmFjdGlvblxuICAgKiAgIHZpZXdzIGluc2lkZSAoc3VjaCBhcyBkcm9wcGVkIHBpbnMgb3IgbGFiZWxzKSwgdGhlbiB3ZSB3b3VsZCByZXR1cm4gdHJ1ZVxuICAgKiAgIGZyb20gdGhpcyBtZXRob2Qgd2hlbiB0aGVyZSBpcyBhIHNpbmdsZSB0b3VjaC5cbiAgICpcbiAgICogLSBTaW1pbGFyIHRvIHRoZSBwcmV2aW91cyBjYXNlLCBpZiBhIHR3byBmaW5nZXIgXCJ0YXBcIiBzaG91bGQgdHJpZ2dlciBhXG4gICAqICAgem9vbSwgd2Ugd291bGQgY2hlY2sgdGhlIGB0b3VjaGVzYCBjb3VudCwgYW5kIGlmIGA+PSAyYCwgd2Ugd291bGQgcmV0dXJuXG4gICAqICAgdHJ1ZS5cbiAgICpcbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyOiBmdW5jdGlvbihlOiBFdmVudCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgPSBUZXh0SW5wdXRTdGF0ZS5jdXJyZW50bHlGb2N1c2VkRmllbGQoKTtcblxuICAgIGlmICh0aGlzLnByb3BzLmtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPT09ICdoYW5kbGVkJyAmJlxuICAgICAgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAhPSBudWxsICYmXG4gICAgICBlLnRhcmdldCAhPT0gY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICAvKipcbiAgICogVGhlcmUgYXJlIHRpbWVzIHdoZW4gdGhlIHNjcm9sbCB2aWV3IHdhbnRzIHRvIGJlY29tZSB0aGUgcmVzcG9uZGVyXG4gICAqIChtZWFuaW5nIHJlc3BvbmQgdG8gdGhlIG5leHQgaW1tZWRpYXRlIGB0b3VjaFN0YXJ0L3RvdWNoRW5kYCksIGluIGEgd2F5XG4gICAqIHRoYXQgKmRvZXNuJ3QqIGdpdmUgcHJpb3JpdHkgdG8gbmVzdGVkIHZpZXdzIChoZW5jZSB0aGUgY2FwdHVyZSBwaGFzZSk6XG4gICAqXG4gICAqIC0gQ3VycmVudGx5IGFuaW1hdGluZy5cbiAgICogLSBUYXBwaW5nIGFueXdoZXJlIHRoYXQgaXMgbm90IGEgdGV4dCBpbnB1dCwgd2hpbGUgdGhlIGtleWJvYXJkIGlzXG4gICAqICAgdXAgKHdoaWNoIHNob3VsZCBkaXNtaXNzIHRoZSBrZXlib2FyZCkuXG4gICAqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZTogZnVuY3Rpb24oZTogRXZlbnQpOiBib29sZWFuIHtcbiAgICAvLyBGaXJzdCBzZWUgaWYgd2Ugd2FudCB0byBlYXQgdGFwcyB3aGlsZSB0aGUga2V5Ym9hcmQgaXMgdXBcbiAgICBjb25zdCBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ID0gVGV4dElucHV0U3RhdGUuY3VycmVudGx5Rm9jdXNlZEZpZWxkKCk7XG4gICAgY29uc3Qge2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHN9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBrZXlib2FyZE5ldmVyUGVyc2lzdFRhcHMgPSAha2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA9PT0gJ25ldmVyJztcbiAgICBpZiAoa2V5Ym9hcmROZXZlclBlcnNpc3RUYXBzICYmXG4gICAgICBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ICE9IG51bGwgJiZcbiAgICAgICFpc1RhZ0luc3RhbmNlT2ZUZXh0SW5wdXQoZS50YXJnZXQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmcoKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25SZXNwb25kZXJSZWplY3RgIGV2ZW50LlxuICAgKlxuICAgKiBTb21lIG90aGVyIGVsZW1lbnQgaXMgbm90IHlpZWxkaW5nIGl0cyByb2xlIGFzIHJlc3BvbmRlci4gTm9ybWFsbHksIHdlJ2RcbiAgICoganVzdCBkaXNhYmxlIHRoZSBgVUlTY3JvbGxWaWV3YCwgYnV0IGEgdG91Y2ggaGFzIGFscmVhZHkgYmVnYW4gb24gaXQsIHRoZVxuICAgKiBgVUlTY3JvbGxWaWV3YCB3aWxsIG5vdCBhY2NlcHQgYmVpbmcgZGlzYWJsZWQgYWZ0ZXIgdGhhdC4gVGhlIGVhc2llc3RcbiAgICogc29sdXRpb24gZm9yIG5vdyBpcyB0byBhY2NlcHQgdGhlIGxpbWl0YXRpb24gb2YgZGlzYWxsb3dpbmcgdGhpc1xuICAgKiBhbHRvZ2V0aGVyLiBUbyBpbXByb3ZlIHRoaXMsIGZpbmQgYSB3YXkgdG8gZGlzYWJsZSB0aGUgYFVJU2Nyb2xsVmlld2AgYWZ0ZXJcbiAgICogYSB0b3VjaCBoYXMgYWxyZWFkeSBzdGFydGVkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVqZWN0OiBmdW5jdGlvbigpIHtcbiAgfSxcblxuICAvKipcbiAgICogV2Ugd2lsbCBhbGxvdyB0aGUgc2Nyb2xsIHZpZXcgdG8gZ2l2ZSB1cCBpdHMgbG9jayBpZmYgaXQgYWNxdWlyZWQgdGhlIGxvY2tcbiAgICogZHVyaW5nIGFuIGFuaW1hdGlvbi4gVGhpcyBpcyBhIHZlcnkgdXNlZnVsIGRlZmF1bHQgdGhhdCBoYXBwZW5zIHRvIHNhdGlzZnlcbiAgICogbWFueSBjb21tb24gdXNlciBleHBlcmllbmNlcy5cbiAgICpcbiAgICogLSBTdG9wIGEgc2Nyb2xsIG9uIHRoZSBsZWZ0IGVkZ2UsIHRoZW4gdHVybiB0aGF0IGludG8gYW4gb3V0ZXIgdmlldydzXG4gICAqICAgYmFja3N3aXBlLlxuICAgKiAtIFN0b3AgYSBzY3JvbGwgbWlkLWJvdW5jZSBhdCB0aGUgdG9wLCBjb250aW51ZSBwdWxsaW5nIHRvIGhhdmUgdGhlIG91dGVyXG4gICAqICAgdmlldyBkaXNtaXNzLlxuICAgKiAtIEhvd2V2ZXIsIHdpdGhvdXQgY2F0Y2hpbmcgdGhlIHNjcm9sbCB2aWV3IG1pZC1ib3VuY2UgKHdoaWxlIGl0IGlzXG4gICAqICAgbW90aW9ubGVzcyksIGlmIHlvdSBkcmFnIGZhciBlbm91Z2ggZm9yIHRoZSBzY3JvbGwgdmlldyB0byBiZWNvbWVcbiAgICogICByZXNwb25kZXIgKGFuZCB0aGVyZWZvcmUgZHJhZyB0aGUgc2Nyb2xsIHZpZXcgYSBiaXQpLCBhbnkgYmFja3N3aXBlXG4gICAqICAgbmF2aWdhdGlvbiBvZiBhIHN3aXBlIGdlc3R1cmUgaGlnaGVyIGluIHRoZSB2aWV3IGhpZXJhcmNoeSwgc2hvdWxkIGJlXG4gICAqICAgcmVqZWN0ZWQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUZXJtaW5hdGlvblJlcXVlc3Q6IGZ1bmN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5zdGF0ZS5vYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXI7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hFbmRgIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge1N5bnRoZXRpY0V2ZW50fSBlIEV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hFbmQ6IGZ1bmN0aW9uKGU6IEV2ZW50KSB7XG4gICAgY29uc3QgbmF0aXZlRXZlbnQgPSBlLm5hdGl2ZUV2ZW50O1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IG5hdGl2ZUV2ZW50LnRvdWNoZXMubGVuZ3RoICE9PSAwO1xuICAgIHRoaXMucHJvcHMub25Ub3VjaEVuZCAmJiB0aGlzLnByb3BzLm9uVG91Y2hFbmQoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hDYW5jZWxgIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge1N5bnRoZXRpY0V2ZW50fSBlIEV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hDYW5jZWw6IGZ1bmN0aW9uKGU6IEV2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5pc1RvdWNoaW5nID0gZmFsc2U7XG4gICAgdGhpcy5wcm9wcy5vblRvdWNoQ2FuY2VsICYmIHRoaXMucHJvcHMub25Ub3VjaENhbmNlbChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25SZXNwb25kZXJSZWxlYXNlYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlclJlbGVhc2U6IGZ1bmN0aW9uKGU6IEV2ZW50KSB7XG4gICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UgJiYgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UoZSk7XG5cbiAgICAvLyBCeSBkZWZhdWx0IHNjcm9sbCB2aWV3cyB3aWxsIHVuZm9jdXMgYSB0ZXh0RmllbGRcbiAgICAvLyBpZiBhbm90aGVyIHRvdWNoIG9jY3VycyBvdXRzaWRlIG9mIGl0XG4gICAgY29uc3QgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCA9IFRleHRJbnB1dFN0YXRlLmN1cnJlbnRseUZvY3VzZWRGaWVsZCgpO1xuICAgIGlmICh0aGlzLnByb3BzLmtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgIT09IHRydWUgJiZcbiAgICAgIHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyAhPT0gJ2Fsd2F5cycgJiZcbiAgICAgIGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgIT0gbnVsbCAmJlxuICAgICAgZS50YXJnZXQgIT09IGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgICYmXG4gICAgICAhdGhpcy5zdGF0ZS5vYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIgJiZcbiAgICAgICF0aGlzLnN0YXRlLmJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nKSB7XG4gICAgICB0aGlzLnByb3BzLm9uU2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaXNtaXNzZWQgJiZcbiAgICAgICAgdGhpcy5wcm9wcy5vblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkKGUpO1xuICAgICAgVGV4dElucHV0U3RhdGUuYmx1clRleHRJbnB1dChjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0KTtcbiAgICB9XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsOiBmdW5jdGlvbihlOiBFdmVudCkge1xuICAgIHRoaXMuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyID0gdHJ1ZTtcbiAgICB0aGlzLnByb3BzLm9uU2Nyb2xsICYmIHRoaXMucHJvcHMub25TY3JvbGwoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uUmVzcG9uZGVyR3JhbnRgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyR3JhbnQ6IGZ1bmN0aW9uKGU6IEV2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5vYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIgPSBmYWxzZTtcbiAgICB0aGlzLnByb3BzLm9uUmVzcG9uZGVyR3JhbnQgJiYgdGhpcy5wcm9wcy5vblJlc3BvbmRlckdyYW50KGUpO1xuICAgIHRoaXMuc3RhdGUuYmVjYW1lUmVzcG9uZGVyV2hpbGVBbmltYXRpbmcgPSB0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFVuZm9ydHVuYXRlbHksIGBvblNjcm9sbEJlZ2luRHJhZ2AgYWxzbyBmaXJlcyB3aGVuICpzdG9wcGluZyogdGhlIHNjcm9sbFxuICAgKiBhbmltYXRpb24sIGFuZCB0aGVyZSdzIG5vdCBhbiBlYXN5IHdheSB0byBkaXN0aW5ndWlzaCBhIGRyYWcgdnMuIHN0b3BwaW5nXG4gICAqIG1vbWVudHVtLlxuICAgKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblNjcm9sbEJlZ2luRHJhZ2AgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxCZWdpbkRyYWc6IGZ1bmN0aW9uKGU6IEV2ZW50KSB7XG4gICAgRnJhbWVSYXRlTG9nZ2VyLmJlZ2luU2Nyb2xsKCk7IC8vIFRPRE86IHRyYWNrIGFsbCBzY3JvbGxzIGFmdGVyIGltcGxlbWVudGluZyBvblNjcm9sbEVuZEFuaW1hdGlvblxuICAgIHRoaXMucHJvcHMub25TY3JvbGxCZWdpbkRyYWcgJiYgdGhpcy5wcm9wcy5vblNjcm9sbEJlZ2luRHJhZyhlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TY3JvbGxFbmREcmFnYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbEVuZERyYWc6IGZ1bmN0aW9uKGU6IEV2ZW50KSB7XG4gICAgY29uc3Qge3ZlbG9jaXR5fSA9IGUubmF0aXZlRXZlbnQ7XG4gICAgLy8gLSBJZiB3ZSBhcmUgYW5pbWF0aW5nLCB0aGVuIHRoaXMgaXMgYSBcImRyYWdcIiB0aGF0IGlzIHN0b3BwaW5nIHRoZSBzY3JvbGx2aWV3IGFuZCBtb21lbnR1bSBlbmRcbiAgICAvLyAgIHdpbGwgZmlyZS5cbiAgICAvLyAtIElmIHZlbG9jaXR5IGlzIG5vbi16ZXJvLCB0aGVuIHRoZSBpbnRlcmFjdGlvbiB3aWxsIHN0b3Agd2hlbiBtb21lbnR1bSBzY3JvbGwgZW5kcyBvclxuICAgIC8vICAgYW5vdGhlciBkcmFnIHN0YXJ0cyBhbmQgZW5kcy5cbiAgICAvLyAtIElmIHdlIGRvbid0IGdldCB2ZWxvY2l0eSwgYmV0dGVyIHRvIHN0b3AgdGhlIGludGVyYWN0aW9uIHR3aWNlIHRoYW4gbm90IHN0b3AgaXQuXG4gICAgaWYgKCF0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCkgJiZcbiAgICAgICAgKCF2ZWxvY2l0eSB8fCB2ZWxvY2l0eS54ID09PSAwICYmIHZlbG9jaXR5LnkgPT09IDApKSB7XG4gICAgICBGcmFtZVJhdGVMb2dnZXIuZW5kU2Nyb2xsKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25TY3JvbGxFbmREcmFnICYmIHRoaXMucHJvcHMub25TY3JvbGxFbmREcmFnKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxCZWdpbjogZnVuY3Rpb24oZTogRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsQmVnaW4gJiYgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsQmVnaW4oZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uTW9tZW50dW1TY3JvbGxFbmRgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxFbmQ6IGZ1bmN0aW9uKGU6IEV2ZW50KSB7XG4gICAgRnJhbWVSYXRlTG9nZ2VyLmVuZFNjcm9sbCgpO1xuICAgIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZSA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsRW5kICYmIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEVuZChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaFN0YXJ0YCBldmVudC5cbiAgICpcbiAgICogU2luY2Ugd2Uga25vdyB0aGF0IHRoZSBgU2ltcGxlRXZlbnRQbHVnaW5gIG9jY3VycyBsYXRlciBpbiB0aGUgcGx1Z2luXG4gICAqIG9yZGVyLCBhZnRlciBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLCB3ZSBjYW4gZGV0ZWN0IHRoYXQgd2Ugd2VyZSAqbm90KlxuICAgKiBwZXJtaXR0ZWQgdG8gYmUgdGhlIHJlc3BvbmRlciAocHJlc3VtYWJseSBiZWNhdXNlIGEgY29udGFpbmVkIHZpZXcgYmVjYW1lXG4gICAqIHJlc3BvbmRlcikuIFRoZSBgb25SZXNwb25kZXJSZWplY3RgIHdvbid0IGZpcmUgaW4gdGhhdCBjYXNlIC0gaXQgb25seVxuICAgKiBmaXJlcyB3aGVuIGEgKmN1cnJlbnQqIHJlc3BvbmRlciByZWplY3RzIG91ciByZXF1ZXN0LlxuICAgKlxuICAgKiBAcGFyYW0ge1N5bnRoZXRpY0V2ZW50fSBlIFRvdWNoIFN0YXJ0IGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hTdGFydDogZnVuY3Rpb24oZTogRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLmlzVG91Y2hpbmcgPSB0cnVlO1xuICAgIHRoaXMucHJvcHMub25Ub3VjaFN0YXJ0ICYmIHRoaXMucHJvcHMub25Ub3VjaFN0YXJ0KGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblRvdWNoTW92ZWAgZXZlbnQuXG4gICAqXG4gICAqIFNpbmNlIHdlIGtub3cgdGhhdCB0aGUgYFNpbXBsZUV2ZW50UGx1Z2luYCBvY2N1cnMgbGF0ZXIgaW4gdGhlIHBsdWdpblxuICAgKiBvcmRlciwgYWZ0ZXIgYFJlc3BvbmRlckV2ZW50UGx1Z2luYCwgd2UgY2FuIGRldGVjdCB0aGF0IHdlIHdlcmUgKm5vdCpcbiAgICogcGVybWl0dGVkIHRvIGJlIHRoZSByZXNwb25kZXIgKHByZXN1bWFibHkgYmVjYXVzZSBhIGNvbnRhaW5lZCB2aWV3IGJlY2FtZVxuICAgKiByZXNwb25kZXIpLiBUaGUgYG9uUmVzcG9uZGVyUmVqZWN0YCB3b24ndCBmaXJlIGluIHRoYXQgY2FzZSAtIGl0IG9ubHlcbiAgICogZmlyZXMgd2hlbiBhICpjdXJyZW50KiByZXNwb25kZXIgcmVqZWN0cyBvdXIgcmVxdWVzdC5cbiAgICpcbiAgICogQHBhcmFtIHtTeW50aGV0aWNFdmVudH0gZSBUb3VjaCBTdGFydCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoTW92ZTogZnVuY3Rpb24oZTogRXZlbnQpIHtcbiAgICB0aGlzLnByb3BzLm9uVG91Y2hNb3ZlICYmIHRoaXMucHJvcHMub25Ub3VjaE1vdmUoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIGZvciB0aGlzIGNsYXNzIHRoYXQgbGV0cyB1cyBxdWlja2x5IGRldGVybWluZSBpZiB0aGVcbiAgICogdmlldyBpcyBjdXJyZW50bHkgYW5pbWF0aW5nLiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgdG8ga25vdyB3aGVuXG4gICAqIGEgdG91Y2ggaGFzIGp1c3Qgc3RhcnRlZCBvciBlbmRlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nOiBmdW5jdGlvbigpOiBib29sZWFuIHtcbiAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZU5vdygpO1xuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RNb21lbnR1bVNjcm9sbEVuZCA9IG5vdyAtIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZTtcbiAgICBjb25zdCBpc0FuaW1hdGluZyA9IHRpbWVTaW5jZUxhc3RNb21lbnR1bVNjcm9sbEVuZCA8IElTX0FOSU1BVElOR19UT1VDSF9TVEFSVF9USFJFU0hPTERfTVMgfHxcbiAgICAgIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZSA8IHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsQmVnaW5UaW1lO1xuICAgIHJldHVybiBpc0FuaW1hdGluZztcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgbm9kZSB0aGF0IHJlcHJlc2VudHMgbmF0aXZlIHZpZXcgdGhhdCBjYW4gYmUgc2Nyb2xsZWQuXG4gICAqIENvbXBvbmVudHMgY2FuIHBhc3Mgd2hhdCBub2RlIHRvIHVzZSBieSBkZWZpbmluZyBhIGBnZXRTY3JvbGxhYmxlTm9kZWBcbiAgICogZnVuY3Rpb24gb3RoZXJ3aXNlIGB0aGlzYCBpcyB1c2VkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyR2V0U2Nyb2xsYWJsZU5vZGU6IGZ1bmN0aW9uKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U2Nyb2xsYWJsZU5vZGUgP1xuICAgICAgdGhpcy5nZXRTY3JvbGxhYmxlTm9kZSgpIDpcbiAgICAgIFJlYWN0TmF0aXZlLmZpbmROb2RlSGFuZGxlKHRoaXMpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBIGhlbHBlciBmdW5jdGlvbiB0byBzY3JvbGwgdG8gYSBzcGVjaWZpYyBwb2ludCBpbiB0aGUgU2Nyb2xsVmlldy5cbiAgICogVGhpcyBpcyBjdXJyZW50bHkgdXNlZCB0byBoZWxwIGZvY3VzIGNoaWxkIFRleHRWaWV3cywgYnV0IGNhbiBhbHNvXG4gICAqIGJlIHVzZWQgdG8gcXVpY2tseSBzY3JvbGwgdG8gYW55IGVsZW1lbnQgd2Ugd2FudCB0byBmb2N1cy4gU3ludGF4OlxuICAgKlxuICAgKiBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8ob3B0aW9uczoge3g6IG51bWJlciA9IDA7IHk6IG51bWJlciA9IDA7IGFuaW1hdGVkOiBib29sZWFuID0gdHJ1ZX0pYFxuICAgKlxuICAgKiBOb3RlOiBUaGUgd2VpcmQgYXJndW1lbnQgc2lnbmF0dXJlIGlzIGR1ZSB0byB0aGUgZmFjdCB0aGF0LCBmb3IgaGlzdG9yaWNhbCByZWFzb25zLFxuICAgKiB0aGUgZnVuY3Rpb24gYWxzbyBhY2NlcHRzIHNlcGFyYXRlIGFyZ3VtZW50cyBhcyBhcyBhbHRlcm5hdGl2ZSB0byB0aGUgb3B0aW9ucyBvYmplY3QuXG4gICAqIFRoaXMgaXMgZGVwcmVjYXRlZCBkdWUgdG8gYW1iaWd1aXR5ICh5IGJlZm9yZSB4KSwgYW5kIFNIT1VMRCBOT1QgQkUgVVNFRC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvOiBmdW5jdGlvbihcbiAgICB4PzogbnVtYmVyIHwgeyB4PzogbnVtYmVyLCB5PzogbnVtYmVyLCBhbmltYXRlZD86IGJvb2xlYW4gfSxcbiAgICB5PzogbnVtYmVyLFxuICAgIGFuaW1hdGVkPzogYm9vbGVhblxuICApIHtcbiAgICBpZiAodHlwZW9mIHggPT09ICdudW1iZXInKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ2BzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh4LCB5LCBhbmltYXRlZClgIGlzIGRlcHJlY2F0ZWQuIFVzZSBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8oe3g6IDUsIHk6IDUsIGFuaW1hdGVkOiB0cnVlfSlgIGluc3RlYWQuJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICh7eCwgeSwgYW5pbWF0ZWR9ID0geCB8fCB7fSk7XG4gICAgfVxuICAgIFVJTWFuYWdlci5kaXNwYXRjaFZpZXdNYW5hZ2VyQ29tbWFuZChcbiAgICAgIG51bGx0aHJvd3ModGhpcy5zY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZSgpKSxcbiAgICAgIFVJTWFuYWdlci5SQ1RTY3JvbGxWaWV3LkNvbW1hbmRzLnNjcm9sbFRvLFxuICAgICAgW3ggfHwgMCwgeSB8fCAwLCBhbmltYXRlZCAhPT0gZmFsc2VdLFxuICAgICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNjcm9sbHMgdG8gdGhlIGVuZCBvZiB0aGUgU2Nyb2xsVmlldywgZWl0aGVyIGltbWVkaWF0ZWx5IG9yIHdpdGggYSBzbW9vdGhcbiAgICogYW5pbWF0aW9uLlxuICAgKlxuICAgKiBFeGFtcGxlOlxuICAgKlxuICAgKiBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG9FbmQoe2FuaW1hdGVkOiB0cnVlfSlgXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZDogZnVuY3Rpb24oXG4gICAgb3B0aW9ucz86IHsgYW5pbWF0ZWQ/OiBib29sZWFuIH0sXG4gICkge1xuICAgIC8vIERlZmF1bHQgdG8gdHJ1ZVxuICAgIGNvbnN0IGFuaW1hdGVkID0gKG9wdGlvbnMgJiYgb3B0aW9ucy5hbmltYXRlZCkgIT09IGZhbHNlO1xuICAgIFVJTWFuYWdlci5kaXNwYXRjaFZpZXdNYW5hZ2VyQ29tbWFuZChcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyR2V0U2Nyb2xsYWJsZU5vZGUoKSxcbiAgICAgIFVJTWFuYWdlci5SQ1RTY3JvbGxWaWV3LkNvbW1hbmRzLnNjcm9sbFRvRW5kLFxuICAgICAgW2FuaW1hdGVkXSxcbiAgICApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEZXByZWNhdGVkLCBkbyBub3QgdXNlLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsV2l0aG91dEFuaW1hdGlvblRvOiBmdW5jdGlvbihvZmZzZXRYOiBudW1iZXIsIG9mZnNldFk6IG51bWJlcikge1xuICAgIGNvbnNvbGUud2FybignYHNjcm9sbFJlc3BvbmRlclNjcm9sbFdpdGhvdXRBbmltYXRpb25Ub2AgaXMgZGVwcmVjYXRlZC4gVXNlIGBzY3JvbGxSZXNwb25kZXJTY3JvbGxUb2AgaW5zdGVhZCcpO1xuICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8oe3g6IG9mZnNldFgsIHk6IG9mZnNldFksIGFuaW1hdGVkOiBmYWxzZX0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBIGhlbHBlciBmdW5jdGlvbiB0byB6b29tIHRvIGEgc3BlY2lmaWMgcmVjdCBpbiB0aGUgc2Nyb2xsdmlldy4gVGhlIGFyZ3VtZW50IGhhcyB0aGUgc2hhcGVcbiAgICoge3g6IG51bWJlcjsgeTogbnVtYmVyOyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlcjsgYW5pbWF0ZWQ6IGJvb2xlYW4gPSB0cnVlfVxuICAgKlxuICAgKiBAcGxhdGZvcm0gaW9zXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJab29tVG86IGZ1bmN0aW9uKFxuICAgIHJlY3Q6IHt8IHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgYW5pbWF0ZWQ/OiBib29sZWFuIHx9LFxuICAgIGFuaW1hdGVkPzogYm9vbGVhbiAvLyBkZXByZWNhdGVkLCBwdXQgdGhpcyBpbnNpZGUgdGhlIHJlY3QgYXJndW1lbnQgaW5zdGVhZFxuICApIHtcbiAgICBpbnZhcmlhbnQoU2Nyb2xsVmlld01hbmFnZXIgJiYgU2Nyb2xsVmlld01hbmFnZXIuem9vbVRvUmVjdCwgJ3pvb21Ub1JlY3QgaXMgbm90IGltcGxlbWVudGVkJyk7XG4gICAgaWYgKCdhbmltYXRlZCcgaW4gcmVjdCkge1xuICAgICAgYW5pbWF0ZWQgPSByZWN0LmFuaW1hdGVkO1xuICAgICAgZGVsZXRlIHJlY3QuYW5pbWF0ZWQ7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgYW5pbWF0ZWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ2BzY3JvbGxSZXNwb25kZXJab29tVG9gIGBhbmltYXRlZGAgYXJndW1lbnQgaXMgZGVwcmVjYXRlZC4gVXNlIGBvcHRpb25zLmFuaW1hdGVkYCBpbnN0ZWFkJyk7XG4gICAgfVxuICAgIFNjcm9sbFZpZXdNYW5hZ2VyLnpvb21Ub1JlY3QodGhpcy5zY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZSgpLCByZWN0LCBhbmltYXRlZCAhPT0gZmFsc2UpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEaXNwbGF5cyB0aGUgc2Nyb2xsIGluZGljYXRvcnMgbW9tZW50YXJpbHkuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJGbGFzaFNjcm9sbEluZGljYXRvcnM6IGZ1bmN0aW9uKCkge1xuICAgIFVJTWFuYWdlci5kaXNwYXRjaFZpZXdNYW5hZ2VyQ29tbWFuZChcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyR2V0U2Nyb2xsYWJsZU5vZGUoKSxcbiAgICAgIFVJTWFuYWdlci5SQ1RTY3JvbGxWaWV3LkNvbW1hbmRzLmZsYXNoU2Nyb2xsSW5kaWNhdG9ycyxcbiAgICAgIFtdXG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogVGhpcyBtZXRob2Qgc2hvdWxkIGJlIHVzZWQgYXMgdGhlIGNhbGxiYWNrIHRvIG9uRm9jdXMgaW4gYSBUZXh0SW5wdXRzJ1xuICAgKiBwYXJlbnQgdmlldy4gTm90ZSB0aGF0IGFueSBtb2R1bGUgdXNpbmcgdGhpcyBtaXhpbiBuZWVkcyB0byByZXR1cm5cbiAgICogdGhlIHBhcmVudCB2aWV3J3MgcmVmIGluIGdldFNjcm9sbFZpZXdSZWYoKSBpbiBvcmRlciB0byB1c2UgdGhpcyBtZXRob2QuXG4gICAqIEBwYXJhbSB7YW55fSBub2RlSGFuZGxlIFRoZSBUZXh0SW5wdXQgbm9kZSBoYW5kbGVcbiAgICogQHBhcmFtIHtudW1iZXJ9IGFkZGl0aW9uYWxPZmZzZXQgVGhlIHNjcm9sbCB2aWV3J3MgYm90dG9tIFwiY29udGVudEluc2V0XCIuXG4gICAqICAgICAgICBEZWZhdWx0IGlzIDAuXG4gICAqIEBwYXJhbSB7Ym9vbH0gcHJldmVudE5lZ2F0aXZlU2Nyb2xsaW5nIFdoZXRoZXIgdG8gYWxsb3cgcHVsbGluZyB0aGUgY29udGVudFxuICAgKiAgICAgICAgZG93biB0byBtYWtlIGl0IG1lZXQgdGhlIGtleWJvYXJkJ3MgdG9wLiBEZWZhdWx0IGlzIGZhbHNlLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsTmF0aXZlSGFuZGxlVG9LZXlib2FyZDogZnVuY3Rpb24obm9kZUhhbmRsZTogYW55LCBhZGRpdGlvbmFsT2Zmc2V0PzogbnVtYmVyLCBwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQ/OiBib29sKSB7XG4gICAgdGhpcy5hZGRpdGlvbmFsU2Nyb2xsT2Zmc2V0ID0gYWRkaXRpb25hbE9mZnNldCB8fCAwO1xuICAgIHRoaXMucHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0ID0gISFwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQ7XG4gICAgVUlNYW5hZ2VyLm1lYXN1cmVMYXlvdXQoXG4gICAgICBub2RlSGFuZGxlLFxuICAgICAgUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUodGhpcy5nZXRJbm5lclZpZXdOb2RlKCkpLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkXG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGNhbGN1bGF0aW9ucyBwZXJmb3JtZWQgaGVyZSBhc3N1bWUgdGhlIHNjcm9sbCB2aWV3IHRha2VzIHVwIHRoZSBlbnRpcmVcbiAgICogc2NyZWVuIC0gZXZlbiBpZiBoYXMgc29tZSBjb250ZW50IGluc2V0LiBXZSB0aGVuIG1lYXN1cmUgdGhlIG9mZnNldHMgb2YgdGhlXG4gICAqIGtleWJvYXJkLCBhbmQgY29tcGVuc2F0ZSBib3RoIGZvciB0aGUgc2Nyb2xsIHZpZXcncyBcImNvbnRlbnRJbnNldFwiLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gbGVmdCBQb3NpdGlvbiBvZiBpbnB1dCB3LnIudC4gdGFibGUgdmlldy5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHRvcCBQb3NpdGlvbiBvZiBpbnB1dCB3LnIudC4gdGFibGUgdmlldy5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIFdpZHRoIG9mIHRoZSB0ZXh0IGlucHV0LlxuICAgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IEhlaWdodCBvZiB0aGUgdGV4dCBpbnB1dC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlcklucHV0TWVhc3VyZUFuZFNjcm9sbFRvS2V5Ym9hcmQ6IGZ1bmN0aW9uKGxlZnQ6IG51bWJlciwgdG9wOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XG4gICAgbGV0IGtleWJvYXJkU2NyZWVuWSA9IERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKS5oZWlnaHQ7XG4gICAgaWYgKHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvKSB7XG4gICAgICBrZXlib2FyZFNjcmVlblkgPSB0aGlzLmtleWJvYXJkV2lsbE9wZW5Uby5lbmRDb29yZGluYXRlcy5zY3JlZW5ZO1xuICAgIH1cbiAgICBsZXQgc2Nyb2xsT2Zmc2V0WSA9IHRvcCAtIGtleWJvYXJkU2NyZWVuWSArIGhlaWdodCArIHRoaXMuYWRkaXRpb25hbFNjcm9sbE9mZnNldDtcblxuICAgIC8vIEJ5IGRlZmF1bHQsIHRoaXMgY2FuIHNjcm9sbCB3aXRoIG5lZ2F0aXZlIG9mZnNldCwgcHVsbGluZyB0aGUgY29udGVudFxuICAgIC8vIGRvd24gc28gdGhhdCB0aGUgdGFyZ2V0IGNvbXBvbmVudCdzIGJvdHRvbSBtZWV0cyB0aGUga2V5Ym9hcmQncyB0b3AuXG4gICAgLy8gSWYgcmVxdWVzdGVkIG90aGVyd2lzZSwgY2FwIHRoZSBvZmZzZXQgYXQgMCBtaW5pbXVtIHRvIGF2b2lkIGNvbnRlbnRcbiAgICAvLyBzaGlmdGluZyBkb3duLlxuICAgIGlmICh0aGlzLnByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldCkge1xuICAgICAgc2Nyb2xsT2Zmc2V0WSA9IE1hdGgubWF4KDAsIHNjcm9sbE9mZnNldFkpO1xuICAgIH1cbiAgICB0aGlzLnNjcm9sbFJlc3BvbmRlclNjcm9sbFRvKHt4OiAwLCB5OiBzY3JvbGxPZmZzZXRZLCBhbmltYXRlZDogdHJ1ZX0pO1xuXG4gICAgdGhpcy5hZGRpdGlvbmFsT2Zmc2V0ID0gMDtcbiAgICB0aGlzLnByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldCA9IGZhbHNlO1xuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlclRleHRJbnB1dEZvY3VzRXJyb3I6IGZ1bmN0aW9uKGU6IEV2ZW50KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbWVhc3VyaW5nIHRleHQgZmllbGQ6ICcsIGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBgY29tcG9uZW50V2lsbE1vdW50YCBpcyB0aGUgY2xvc2VzdCB0aGluZyB0byBhICBzdGFuZGFyZCBcImNvbnN0cnVjdG9yXCIgZm9yXG4gICAqIFJlYWN0IGNvbXBvbmVudHMuXG4gICAqXG4gICAqIFRoZSBga2V5Ym9hcmRXaWxsU2hvd2AgaXMgY2FsbGVkIGJlZm9yZSBpbnB1dCBmb2N1cy5cbiAgICovXG4gIFVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHtrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzfSA9IHRoaXMucHJvcHM7XG4gICAgd2FybmluZyhcbiAgICAgIHR5cGVvZiBrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSAnYm9vbGVhbicsXG4gICAgICBgJ2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHM9eyR7a2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwc319JyBpcyBkZXByZWNhdGVkLiBgXG4gICAgICArIGBVc2UgJ2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHM9XCIke2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPyAnYWx3YXlzJyA6ICduZXZlcid9XCInIGluc3RlYWRgXG4gICAgKTtcblxuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gbnVsbDtcbiAgICB0aGlzLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQgPSAwO1xuICAgIHRoaXMuYWRkTGlzdGVuZXJPbihLZXlib2FyZCwgJ2tleWJvYXJkV2lsbFNob3cnLCB0aGlzLnNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbFNob3cpO1xuICAgIHRoaXMuYWRkTGlzdGVuZXJPbihLZXlib2FyZCwgJ2tleWJvYXJkV2lsbEhpZGUnLCB0aGlzLnNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbEhpZGUpO1xuICAgIHRoaXMuYWRkTGlzdGVuZXJPbihLZXlib2FyZCwgJ2tleWJvYXJkRGlkU2hvdycsIHRoaXMuc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRTaG93KTtcbiAgICB0aGlzLmFkZExpc3RlbmVyT24oS2V5Ym9hcmQsICdrZXlib2FyZERpZEhpZGUnLCB0aGlzLnNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkSGlkZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFdhcm5pbmcsIHRoaXMgbWF5IGJlIGNhbGxlZCBzZXZlcmFsIHRpbWVzIGZvciBhIHNpbmdsZSBrZXlib2FyZCBvcGVuaW5nLlxuICAgKiBJdCdzIGJlc3QgdG8gc3RvcmUgdGhlIGluZm9ybWF0aW9uIGluIHRoaXMgbWV0aG9kIGFuZCB0aGVuIHRha2UgYW55IGFjdGlvblxuICAgKiBhdCBhIGxhdGVyIHBvaW50IChlaXRoZXIgaW4gYGtleWJvYXJkRGlkU2hvd2Agb3Igb3RoZXIpLlxuICAgKlxuICAgKiBIZXJlJ3MgdGhlIG9yZGVyIHRoYXQgZXZlbnRzIG9jY3VyIGluOlxuICAgKiAtIGZvY3VzXG4gICAqIC0gd2lsbFNob3cge3N0YXJ0Q29vcmRpbmF0ZXMsIGVuZENvb3JkaW5hdGVzfSBzZXZlcmFsIHRpbWVzXG4gICAqIC0gZGlkU2hvdyBzZXZlcmFsIHRpbWVzXG4gICAqIC0gYmx1clxuICAgKiAtIHdpbGxIaWRlIHtzdGFydENvb3JkaW5hdGVzLCBlbmRDb29yZGluYXRlc30gc2V2ZXJhbCB0aW1lc1xuICAgKiAtIGRpZEhpZGUgc2V2ZXJhbCB0aW1lc1xuICAgKlxuICAgKiBUaGUgYFNjcm9sbFJlc3BvbmRlcmAgcHJvdmlkZXNNb2R1bGUgY2FsbGJhY2tzIGZvciBlYWNoIG9mIHRoZXNlIGV2ZW50cy5cbiAgICogRXZlbiB0aG91Z2ggYW55IHVzZXIgY291bGQgaGF2ZSBlYXNpbHkgbGlzdGVuZWQgdG8ga2V5Ym9hcmQgZXZlbnRzXG4gICAqIHRoZW1zZWx2ZXMsIHVzaW5nIHRoZXNlIGBwcm9wc2AgY2FsbGJhY2tzIGVuc3VyZXMgdGhhdCBvcmRlcmluZyBvZiBldmVudHNcbiAgICogaXMgY29uc2lzdGVudCAtIGFuZCBub3QgZGVwZW5kZW50IG9uIHRoZSBvcmRlciB0aGF0IHRoZSBrZXlib2FyZCBldmVudHMgYXJlXG4gICAqIHN1YnNjcmliZWQgdG8uIFRoaXMgbWF0dGVycyB3aGVuIHRlbGxpbmcgdGhlIHNjcm9sbCB2aWV3IHRvIHNjcm9sbCB0byB3aGVyZVxuICAgKiB0aGUga2V5Ym9hcmQgaXMgaGVhZGVkIC0gdGhlIHNjcm9sbCByZXNwb25kZXIgYmV0dGVyIGhhdmUgYmVlbiBub3RpZmllZCBvZlxuICAgKiB0aGUga2V5Ym9hcmQgZGVzdGluYXRpb24gYmVmb3JlIGJlaW5nIGluc3RydWN0ZWQgdG8gc2Nyb2xsIHRvIHdoZXJlIHRoZVxuICAgKiBrZXlib2FyZCB3aWxsIGJlLiBTdGljayB0byB0aGUgYFNjcm9sbFJlc3BvbmRlcmAgY2FsbGJhY2tzLCBhbmQgZXZlcnl0aGluZ1xuICAgKiB3aWxsIHdvcmsuXG4gICAqXG4gICAqIFdBUk5JTkc6IFRoZXNlIGNhbGxiYWNrcyB3aWxsIGZpcmUgZXZlbiBpZiBhIGtleWJvYXJkIGlzIGRpc3BsYXllZCBpbiBhXG4gICAqIGRpZmZlcmVudCBuYXZpZ2F0aW9uIHBhbmUuIEZpbHRlciBvdXQgdGhlIGV2ZW50cyB0byBkZXRlcm1pbmUgaWYgdGhleSBhcmVcbiAgICogcmVsZXZhbnQgdG8geW91LiAoRm9yIGV4YW1wbGUsIG9ubHkgaWYgeW91IHJlY2VpdmUgdGhlc2UgY2FsbGJhY2tzIGFmdGVyXG4gICAqIHlvdSBoYWQgZXhwbGljaXRseSBmb2N1c2VkIGEgbm9kZSBldGMpLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsU2hvdzogZnVuY3Rpb24oZTogRXZlbnQpIHtcbiAgICB0aGlzLmtleWJvYXJkV2lsbE9wZW5UbyA9IGU7XG4gICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3cgJiYgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3coZSk7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsSGlkZTogZnVuY3Rpb24oZTogRXZlbnQpIHtcbiAgICB0aGlzLmtleWJvYXJkV2lsbE9wZW5UbyA9IG51bGw7XG4gICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbEhpZGUgJiYgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbEhpZGUoZSk7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRTaG93OiBmdW5jdGlvbihlOiBFdmVudCkge1xuICAgIC8vIFRPRE8oNzY5Mzk2MSk6IFRoZSBldmVudCBmb3IgRGlkU2hvdyBpcyBub3QgYXZhaWxhYmxlIG9uIGlPUyB5ZXQuXG4gICAgLy8gVXNlIHRoZSBvbmUgZnJvbSBXaWxsU2hvdyBhbmQgZG8gbm90IGFzc2lnbi5cbiAgICBpZiAoZSkge1xuICAgICAgdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8gPSBlO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRTaG93ICYmIHRoaXMucHJvcHMub25LZXlib2FyZERpZFNob3coZSk7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRIaWRlOiBmdW5jdGlvbihlOiBFdmVudCkge1xuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gbnVsbDtcbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRIaWRlICYmIHRoaXMucHJvcHMub25LZXlib2FyZERpZEhpZGUoZSk7XG4gIH1cblxufTtcblxuY29uc3QgU2Nyb2xsUmVzcG9uZGVyID0ge1xuICBNaXhpbjogU2Nyb2xsUmVzcG9uZGVyTWl4aW4sXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNjcm9sbFJlc3BvbmRlcjtcbiJdfQ==