{"version":3,"sources":["Feed.js"],"names":["tk","register","Expo","Permissions","askAsync","NOTIFICATIONS","status","alert","Notifications","getExpoPushTokenAsync","value","console","log","Feed","listener","addListener","listen","props","origin","data","sendIdData","navigation","state","token","params","undefined","user","notification","JSON","stringify","id_token","user_id","notification_token","fetch","PROFILE_API","method","headers","body","then","response","json","jsonResponse","catch","error","getFeedInfo","NOTIFICATIONS_API","responseJson","setState","isLoading","dataSource","_onRefresh","refreshing","componentDidMount","styles","item","item2","text1","title","uri","image","width","height","text","message","index","id","React","Component","StyleSheet","create","backgroundColor","margin","shadowColor","shadowOpacity","shadowRadius","shadowOffset","elevation","alignItems","justifyContent","flexGrow","padding","borderRadius","color","fontWeight"],"mappings":"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","file":"Feed.js","sourcesContent":["import React from 'react';\nimport { FlatList, Text, View, StyleSheet, ScrollView, RefreshControl, Image } from 'react-native';\nimport jwt_decode from 'jwt-decode';\nimport { NOTIFICATIONS_API, PROFILE_API } from './TabNavigator/const/Const.js'\nimport Expo from 'expo'\nvar tk\n\nasync function register() {\n  const { status } = await Expo.Permissions.askAsync(\n    Expo.Permissions.NOTIFICATIONS\n  );\n  if (status != 'granted') {\n    alert('You need to enable permissions in settings');\n    return;\n  }\n\n  const value = await Expo.Notifications.getExpoPushTokenAsync();\n  tk = value;\n  console.log(status, value);\n\n}\n\nexport default class Feed extends React.Component {\n\n  componentWillMount() {\n    register();\n    this.listener = Expo.Notifications.addListener(this.listen);\n  }\n  componentWillUnmount() {\n    this.listener && Expo.Notifications.addListener(this.listen);\n  }\n\n  listen = ({ origin, data }) => {\n    console.log('cool data', origin, data);\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = { refreshing: false, }\n  }\n\n  sendIdData = () => {\n    const { state } = this.props.navigation;\n    var token = state.params ? state.params.token : undefined;\n    user = jwt_decode(token)\n\n    let notification = JSON.stringify({\n      id_token: user.user_id,\n      notification_token: tk,\n    })\n    console.log(notification);\n    fetch(PROFILE_API + '/set_token/', {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n      },\n      body: notification\n    }).then(response => { return response.json() }\n    ).then(jsonResponse => {\n      console.log(jsonResponse);\n    }\n    ).catch(error => {\n      console.log(error)\n    })\n\n  }\n\n  getFeedInfo = () => {\n    return fetch(NOTIFICATIONS_API + '/emergencynotifications/')\n      .then((response) => response.json())\n      .then((responseJson) => {\n\n        this.setState({\n          isLoading: false,\n          dataSource: responseJson,\n        }, function () {\n\n        });\n\n      })\n      .catch((error) => {\n        console.error(error);\n      });\n  }\n\n  async componentDidMount() {\n    this.sendIdData()\n    this.getFeedInfo()\n  }\n\n  _onRefresh = () => {\n    this.setState({ refreshing: true });\n    this.componentDidMount().then(() => {\n      this.setState({ refreshing: false });\n    });\n  }\n  render() {\n    return (\n      <ScrollView style={styles.item}\n        refreshControl={\n          <RefreshControl\n            refreshing={this.state.refreshing}\n            onRefresh={this._onRefresh}\n          />\n        }\n      >\n        <FlatList\n          data={this.state.dataSource}\n          renderItem={({ item }) => {\n            return (\n              <View style={styles.item2}>\n                <Text style={styles.text1}>{item.title}</Text>\n                <Image source={{ uri: item.image }}\n                  style={{ width: 400, height: 200 }} />\n                <Text style={styles.text}>{item.message}</Text>\n              </View>\n            );\n          }}\n          keyExtractor={({ id }, index) => id}\n\n        />\n      </ScrollView>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  item: {\n    backgroundColor: \"#ffffff\",\n    margin: 4,\n    shadowColor: \"#000000\",\n    shadowOpacity: 0.8,\n    shadowRadius: 2,\n    shadowOffset: {\n      height: 1,\n      width: 1\n    },\n    elevation: 4\n  },\n  item2: {\n    alignItems: \"center\",\n    justifyContent: 'center',\n    backgroundColor: \"#ffffff\",\n    flexGrow: 1,\n    margin: 4,\n    padding: 20,\n    borderRadius: 10,\n    shadowColor: \"#000000\",\n    shadowOpacity: 0.8,\n    shadowRadius: 2,\n    shadowOffset: {\n      height: 1,\n      width: 1\n    },\n    elevation: 4\n  },\n  text: {\n    color: \"#540b71\",\n    fontWeight: '100'\n  },\n  text1: {\n    color: \"#540b71\",\n    fontWeight: 'bold',\n  }\n});\n"]}