9af535a5a7384f4a355a3a87ad0154e5
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var _shouldPolyfillES6Collection=require('_shouldPolyfillES6Collection');var guid=require('guid');var isNode=require('fbjs/lib/isNode');var toIterator=require('toIterator');module.exports=function(global,undefined){if(!_shouldPolyfillES6Collection('Map')){return global.Map;}var KIND_KEY='key';var KIND_VALUE='value';var KIND_KEY_VALUE='key+value';var KEY_PREFIX='$map_';var SECRET_SIZE_PROP;if(__DEV__){SECRET_SIZE_PROP='$size'+guid();}var OLD_IE_HASH_PREFIX='IE_HASH_';var Map=function(){function Map(iterable){_classCallCheck(this,Map);if(!isObject(this)){throw new TypeError('Wrong map object type.');}initMap(this);if(iterable!=null){var it=toIterator(iterable);var next;while(!(next=it.next()).done){if(!isObject(next.value)){throw new TypeError('Expected iterable items to be pair objects.');}this.set(next.value[0],next.value[1]);}}}_createClass(Map,[{key:'clear',value:function clear(){initMap(this);}},{key:'has',value:function has(key){var index=getIndex(this,key);return!!(index!=null&&this._mapData[index]);}},{key:'set',value:function set(key,value){var index=getIndex(this,key);if(index!=null&&this._mapData[index]){this._mapData[index][1]=value;}else{index=this._mapData.push([key,value])-1;setIndex(this,key,index);if(__DEV__){this[SECRET_SIZE_PROP]+=1;}else{this.size+=1;}}return this;}},{key:'get',value:function get(key){var index=getIndex(this,key);if(index==null){return undefined;}else{return this._mapData[index][1];}}},{key:'delete',value:function _delete(key){var index=getIndex(this,key);if(index!=null&&this._mapData[index]){setIndex(this,key,undefined);this._mapData[index]=undefined;if(__DEV__){this[SECRET_SIZE_PROP]-=1;}else{this.size-=1;}return true;}else{return false;}}},{key:'entries',value:function entries(){return new MapIterator(this,KIND_KEY_VALUE);}},{key:'keys',value:function keys(){return new MapIterator(this,KIND_KEY);}},{key:'values',value:function values(){return new MapIterator(this,KIND_VALUE);}},{key:'forEach',value:function forEach(callback,thisArg){if(typeof callback!=='function'){throw new TypeError('Callback must be callable.');}var boundCallback=callback.bind(thisArg||undefined);var mapData=this._mapData;for(var i=0;i<mapData.length;i++){var entry=mapData[i];if(entry!=null){boundCallback(entry[1],entry[0],this);}}}}]);return Map;}();Map.prototype[toIterator.ITERATOR_SYMBOL]=Map.prototype.entries;var MapIterator=function(){function MapIterator(map,kind){_classCallCheck(this,MapIterator);if(!(isObject(map)&&map._mapData)){throw new TypeError('Object is not a map.');}if([KIND_KEY,KIND_KEY_VALUE,KIND_VALUE].indexOf(kind)===-1){throw new Error('Invalid iteration kind.');}this._map=map;this._nextIndex=0;this._kind=kind;}_createClass(MapIterator,[{key:'next',value:function next(){if(!this instanceof Map){throw new TypeError('Expected to be called on a MapIterator.');}var map=this._map;var index=this._nextIndex;var kind=this._kind;if(map==null){return createIterResultObject(undefined,true);}var entries=map._mapData;while(index<entries.length){var record=entries[index];index+=1;this._nextIndex=index;if(record){if(kind===KIND_KEY){return createIterResultObject(record[0],false);}else if(kind===KIND_VALUE){return createIterResultObject(record[1],false);}else if(kind){return createIterResultObject(record,false);}}}this._map=undefined;return createIterResultObject(undefined,true);}}]);return MapIterator;}();MapIterator.prototype[toIterator.ITERATOR_SYMBOL]=function(){return this;};function getIndex(map,key){if(isObject(key)){var hash=getHash(key);return map._objectIndex[hash];}else{var prefixedKey=KEY_PREFIX+key;if(typeof key==='string'){return map._stringIndex[prefixedKey];}else{return map._otherIndex[prefixedKey];}}}function setIndex(map,key,index){var shouldDelete=index==null;if(isObject(key)){var hash=getHash(key);if(shouldDelete){delete map._objectIndex[hash];}else{map._objectIndex[hash]=index;}}else{var prefixedKey=KEY_PREFIX+key;if(typeof key==='string'){if(shouldDelete){delete map._stringIndex[prefixedKey];}else{map._stringIndex[prefixedKey]=index;}}else{if(shouldDelete){delete map._otherIndex[prefixedKey];}else{map._otherIndex[prefixedKey]=index;}}}}function initMap(map){map._mapData=[];map._objectIndex={};map._stringIndex={};map._otherIndex={};if(__DEV__){if(isES5){if(map.hasOwnProperty(SECRET_SIZE_PROP)){map[SECRET_SIZE_PROP]=0;}else{Object.defineProperty(map,SECRET_SIZE_PROP,{value:0,writable:true});Object.defineProperty(map,'size',{set:function set(v){console.error('PLEASE FIX ME: You are changing the map size property which '+'should not be writable and will break in production.');throw new Error('The map size property is not writable.');},get:function get(){return map[SECRET_SIZE_PROP];}});}return;}}map.size=0;}function isObject(o){return o!=null&&(typeof o==='object'||typeof o==='function');}function createIterResultObject(value,done){return{value:value,done:done};}var isES5=function(){try{Object.defineProperty({},'x',{});return true;}catch(e){return false;}}();function isExtensible(o){if(!isES5){return true;}else{return Object.isExtensible(o);}}function getIENodeHash(node){var uniqueID;switch(node.nodeType){case 1:uniqueID=node.uniqueID;break;case 9:uniqueID=node.documentElement.uniqueID;break;default:return null;}if(uniqueID){return OLD_IE_HASH_PREFIX+uniqueID;}else{return null;}}var getHash=function(){var propIsEnumerable=Object.prototype.propertyIsEnumerable;var hashProperty=guid();var hashCounter=0;return function getHash(o){if(o[hashProperty]){return o[hashProperty];}else if(!isES5&&o.propertyIsEnumerable&&o.propertyIsEnumerable[hashProperty]){return o.propertyIsEnumerable[hashProperty];}else if(!isES5&&isNode(o)&&getIENodeHash(o)){return getIENodeHash(o);}else if(!isES5&&o[hashProperty]){return o[hashProperty];}if(isExtensible(o)){hashCounter+=1;if(isES5){Object.defineProperty(o,hashProperty,{enumerable:false,writable:false,configurable:false,value:hashCounter});}else if(o.propertyIsEnumerable){o.propertyIsEnumerable=function(){return propIsEnumerable.apply(this,arguments);};o.propertyIsEnumerable[hashProperty]=hashCounter;}else if(isNode(o)){o[hashProperty]=hashCounter;}else{throw new Error('Unable to set a non-enumerable property on object.');}return hashCounter;}else{throw new Error('Non-extensible objects are not allowed as keys.');}};}();return Map;}(Function('return this')());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1hcC5qcyJdLCJuYW1lcyI6WyJfc2hvdWxkUG9seWZpbGxFUzZDb2xsZWN0aW9uIiwicmVxdWlyZSIsImd1aWQiLCJpc05vZGUiLCJ0b0l0ZXJhdG9yIiwibW9kdWxlIiwiZXhwb3J0cyIsImdsb2JhbCIsInVuZGVmaW5lZCIsIk1hcCIsIktJTkRfS0VZIiwiS0lORF9WQUxVRSIsIktJTkRfS0VZX1ZBTFVFIiwiS0VZX1BSRUZJWCIsIlNFQ1JFVF9TSVpFX1BST1AiLCJfX0RFVl9fIiwiT0xEX0lFX0hBU0hfUFJFRklYIiwiaXRlcmFibGUiLCJpc09iamVjdCIsIlR5cGVFcnJvciIsImluaXRNYXAiLCJpdCIsIm5leHQiLCJkb25lIiwidmFsdWUiLCJzZXQiLCJrZXkiLCJpbmRleCIsImdldEluZGV4IiwiX21hcERhdGEiLCJwdXNoIiwic2V0SW5kZXgiLCJzaXplIiwiTWFwSXRlcmF0b3IiLCJjYWxsYmFjayIsInRoaXNBcmciLCJib3VuZENhbGxiYWNrIiwiYmluZCIsIm1hcERhdGEiLCJpIiwibGVuZ3RoIiwiZW50cnkiLCJwcm90b3R5cGUiLCJJVEVSQVRPUl9TWU1CT0wiLCJlbnRyaWVzIiwibWFwIiwia2luZCIsImluZGV4T2YiLCJFcnJvciIsIl9tYXAiLCJfbmV4dEluZGV4IiwiX2tpbmQiLCJjcmVhdGVJdGVyUmVzdWx0T2JqZWN0IiwicmVjb3JkIiwiaGFzaCIsImdldEhhc2giLCJfb2JqZWN0SW5kZXgiLCJwcmVmaXhlZEtleSIsIl9zdHJpbmdJbmRleCIsIl9vdGhlckluZGV4Iiwic2hvdWxkRGVsZXRlIiwiaXNFUzUiLCJoYXNPd25Qcm9wZXJ0eSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwid3JpdGFibGUiLCJ2IiwiY29uc29sZSIsImVycm9yIiwiZ2V0IiwibyIsImUiLCJpc0V4dGVuc2libGUiLCJnZXRJRU5vZGVIYXNoIiwibm9kZSIsInVuaXF1ZUlEIiwibm9kZVR5cGUiLCJkb2N1bWVudEVsZW1lbnQiLCJwcm9wSXNFbnVtZXJhYmxlIiwicHJvcGVydHlJc0VudW1lcmFibGUiLCJoYXNoUHJvcGVydHkiLCJoYXNoQ291bnRlciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJhcHBseSIsImFyZ3VtZW50cyIsIkZ1bmN0aW9uIl0sIm1hcHBpbmdzIjoiQUFhQSxhLCtvQkFFQSxHQUFJQSw4QkFBK0JDLE9BQS9CLGdDQUFKLENBQ0EsR0FBSUMsTUFBT0QsT0FBUCxRQUFKLENBQ0EsR0FBSUUsUUFBU0YsT0FBVCxtQkFBSixDQUNBLEdBQUlHLFlBQWFILE9BQWIsY0FBSixDQUVBSSxPQUFPQyxPQUFQLENBQWtCLFNBQVNDLE1BQVQsQ0FBaUJDLFNBQWpCLENBQTRCLENBSzVDLEdBQUksQ0FBQ1IsNkJBQTZCLEtBQTdCLENBQUwsQ0FBMEMsQ0FDeEMsTUFBT08sUUFBT0UsR0FBZCxDQUNELENBeURELEdBQUlDLFVBQVcsS0FBZixDQUNBLEdBQUlDLFlBQWEsT0FBakIsQ0FDQSxHQUFJQyxnQkFBaUIsV0FBckIsQ0FJQSxHQUFJQyxZQUFhLE9BQWpCLENBSUEsR0FBSUMsaUJBQUosQ0FDQSxHQUFJQyxPQUFKLENBQWEsQ0FDWEQsaUJBQW1CLFFBQVVaLE1BQTdCLENBQ0QsQ0FHRCxHQUFJYyxvQkFBcUIsVUFBekIsQ0FoRjRDLEdBa0Z0Q1AsSUFsRnNDLFlBNkYxQyxhQUFZUSxRQUFaLENBQXNCLDJCQUNwQixHQUFJLENBQUNDLFNBQVMsSUFBVCxDQUFMLENBQXFCLENBQ25CLEtBQU0sSUFBSUMsVUFBSixDQUFjLHdCQUFkLENBQU4sQ0FDRCxDQUVEQyxRQUFRLElBQVIsRUFFQSxHQUFJSCxVQUFZLElBQWhCLENBQXNCLENBQ3BCLEdBQUlJLElBQUtqQixXQUFXYSxRQUFYLENBQVQsQ0FDQSxHQUFJSyxLQUFKLENBQ0EsTUFBTyxDQUFDLENBQUNBLEtBQU9ELEdBQUdDLElBQUgsRUFBUixFQUFtQkMsSUFBM0IsQ0FBaUMsQ0FDL0IsR0FBSSxDQUFDTCxTQUFTSSxLQUFLRSxLQUFkLENBQUwsQ0FBMkIsQ0FDekIsS0FBTSxJ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QWQsQ0FBK0IsQ0FDcEMsTUFBT1YsR0FBRVUsWUFBRixDQUFQLENBQ0QsQ0FFRCxHQUFJUixhQUFhRixDQUFiLENBQUosQ0FBcUIsQ0FDbkJXLGFBQWUsQ0FBZixDQUNBLEdBQUlwQixLQUFKLENBQVcsQ0FDVEUsT0FBT0MsY0FBUCxDQUFzQk0sQ0FBdEIsQ0FBeUJVLFlBQXpCLENBQXVDLENBQ3JDRSxXQUFZLEtBRHlCLENBRXJDakIsU0FBVSxLQUYyQixDQUdyQ2tCLGFBQWMsS0FIdUIsQ0FJckMzRCxNQUFPeUQsV0FKOEIsQ0FBdkMsRUFNRCxDQVBELElBT08sSUFBSVgsRUFBRVMsb0JBQU4sQ0FBNEIsQ0FLakNULEVBQUVTLG9CQUFGLENBQXlCLFVBQVcsQ0FDbEMsTUFBT0Qsa0JBQWlCTSxLQUFqQixDQUF1QixJQUF2QixDQUE2QkMsU0FBN0IsQ0FBUCxDQUNELENBRkQsQ0FHQWYsRUFBRVMsb0JBQUYsQ0FBdUJDLFlBQXZCLEVBQXVDQyxXQUF2QyxDQUNELENBVE0sSUFTQSxJQUFJOUUsT0FBT21FLENBQVAsQ0FBSixDQUFlLENBS3BCQSxFQUFFVSxZQUFGLEVBQWtCQyxXQUFsQixDQUNELENBTk0sSUFNQSxDQUNMLEtBQU0sSUFBSWpDLE1BQUosQ0FBVSxvREFBVixDQUFOLENBQ0QsQ0FDRCxNQUFPaUMsWUFBUCxDQUNELENBNUJELElBNEJPLENBQ0wsS0FBTSxJQUFJakMsTUFBSixDQUFVLGlEQUFWLENBQU4sQ0FDRCxDQUNGLENBOUNELENBK0NELENBMURhLEVBQWQsQ0E0REEsTUFBT3ZDLElBQVAsQ0FDRCxDQXhsQmdCLENBd2xCZDZFLFNBQVMsYUFBVCxHQXhsQmMsQ0FBakIiLCJmaWxlIjoiTWFwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgTWFwXG4gKiBAcHJldmVudE11bmdlXG4gKiBAdHlwZWNoZWNrc1xuICovXG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLWV4dGVuZC1uYXRpdmUsIG5vLXNoYWRvdy1yZXN0cmljdGVkLW5hbWVzICovXG5cbid1c2Ugc3RyaWN0JztcblxudmFyIF9zaG91bGRQb2x5ZmlsbEVTNkNvbGxlY3Rpb24gPSByZXF1aXJlKCdfc2hvdWxkUG9seWZpbGxFUzZDb2xsZWN0aW9uJyk7XG52YXIgZ3VpZCA9IHJlcXVpcmUoJ2d1aWQnKTtcbnZhciBpc05vZGUgPSByZXF1aXJlKCdmYmpzL2xpYi9pc05vZGUnKTtcbnZhciB0b0l0ZXJhdG9yID0gcmVxdWlyZSgndG9JdGVyYXRvcicpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbihnbG9iYWwsIHVuZGVmaW5lZCkge1xuICAvLyBTaW5jZSBvdXIgaW1wbGVtZW50YXRpb24gaXMgc3BlYy1jb21wbGlhbnQgZm9yIHRoZSBtb3N0IHBhcnQgd2UgY2FuIHNhZmVseVxuICAvLyBkZWxlZ2F0ZSB0byBhIGJ1aWx0LWluIHZlcnNpb24gaWYgZXhpc3RzIGFuZCBpcyBpbXBsZW1lbnRlZCBjb3JyZWN0bHkuXG4gIC8vIEZpcmVmb3ggaGFkIGdvdHRlbiBhIGZldyBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIHdyb25nIGFjcm9zcyBkaWZmZXJlbnRcbiAgLy8gdmVyc2lvbnMgc28gd2UgZ3VhcmQgYWdhaW5zdCB0aGF0LlxuICBpZiAoIV9zaG91bGRQb2x5ZmlsbEVTNkNvbGxlY3Rpb24oJ01hcCcpKSB7XG4gICAgcmV0dXJuIGdsb2JhbC5NYXA7XG4gIH1cblxuICAvKipcbiAgICogPT0gRVM2IE1hcCBDb2xsZWN0aW9uID09XG4gICAqXG4gICAqIFRoaXMgbW9kdWxlIGlzIG1lYW50IHRvIGltcGxlbWVudCBhIE1hcCBjb2xsZWN0aW9uIGFzIGRlc2NyaWJlZCBpbiBjaGFwdGVyXG4gICAqIDIzLjEgb2YgdGhlIEVTNiBzcGVjaWZpY2F0aW9uLlxuICAgKlxuICAgKiBNYXAgb2JqZWN0cyBhcmUgY29sbGVjdGlvbnMgb2Yga2V5L3ZhbHVlIHBhaXJzIHdoZXJlIGJvdGggdGhlIGtleXMgYW5kXG4gICAqIHZhbHVlcyBtYXkgYmUgYXJiaXRyYXJ5IEVDTUFTY3JpcHQgbGFuZ3VhZ2UgdmFsdWVzLiBBIGRpc3RpbmN0IGtleSB2YWx1ZVxuICAgKiBtYXkgb25seSBvY2N1ciBpbiBvbmUga2V5L3ZhbHVlIHBhaXIgd2l0aGluIHRoZSBNYXAncyBjb2xsZWN0aW9uLlxuICAgKlxuICAgKiBodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtbWFwLW9iamVjdHNcbiAgICpcbiAgICogVGhlcmUgb25seSB0d28gLS0gcmF0aGVyIHNtYWxsIC0tIGRpdmlhdGlvbnMgZnJvbSB0aGUgc3BlYzpcbiAgICpcbiAgICogMS4gVGhlIHVzZSBvZiBmcm96ZW4gb2JqZWN0cyBhcyBrZXlzLlxuICAgKiAgICBXZSBkZWNpZGVkIG5vdCB0byBhbGxvdyBhbmQgc2ltcGx5IHRocm93IGFuIGVycm9yLiBUaGUgcmVhc29uIGJlaW5nIGlzXG4gICAqICAgIHdlIHN0b3JlIGEgXCJoYXNoXCIgb24gdGhlIG9iamVjdCBmb3IgZmFzdCBhY2Nlc3MgdG8gaXQncyBwbGFjZSBpbiB0aGVcbiAgICogICAgaW50ZXJuYWwgbWFwIGVudHJpZXMuXG4gICAqICAgIElmIHRoaXMgdHVybnMgb3V0IHRvIGJlIGEgcG9wdWxhciB1c2UgY2FzZSBpdCdzIHBvc3NpYmxlIHRvIGltcGxlbWVudCBieVxuICAgKiAgICBvdmVyaWRpbmcgYE9iamVjdC5mcmVlemVgIHRvIHN0b3JlIGEgXCJoYXNoXCIgcHJvcGVydHkgb24gdGhlIG9iamVjdFxuICAgKiAgICBmb3IgbGF0ZXIgdXNlIHdpdGggdGhlIG1hcC5cbiAgICpcbiAgICogMi4gVGhlIGBzaXplYCBwcm9wZXJ0eSBvbiBhIG1hcCBvYmplY3QgaXMgYSByZWd1bGFyIHByb3BlcnR5IGFuZCBub3QgYVxuICAgKiAgICBjb21wdXRlZCBwcm9wZXJ0eSBvbiB0aGUgcHJvdG90eXBlIGFzIGRlc2NyaWJlZCBieSB0aGUgc3BlYy5cbiAgICogICAgVGhlIHJlYXNvbiBiZWluZyBpcyB0aGF0IHdlIHNpbXBseSB3YW50IHRvIHN1cHBvcnQgRVMzIGVudmlyb25tZW50c1xuICAgKiAgICB3aGljaCBkb2Vzbid0IGltcGxlbWVudCBjb21wdXRlZCBwcm9wZXJ0aWVzLlxuICAgKlxuICAgKiA9PSBVc2FnZSA9PVxuICAgKlxuICAgKiB2YXIgbWFwID0gbmV3IE1hcChpdGVyYWJsZSk7XG4gICAqXG4gICAqIG1hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAqIG1hcC5nZXQoa2V5KTsgLy8gdmFsdWVcbiAgICogbWFwLmhhcyhrZXkpOyAvLyB0cnVlXG4gICAqIG1hcC5kZWxldGUoa2V5KTsgLy8gdHJ1ZVxuICAgKlxuICAgKiB2YXIgaXRlcmF0b3IgPSBtYXAua2V5cygpO1xuICAgKiBpdGVyYXRvci5uZXh0KCk7IC8vIHt2YWx1ZToga2V5LCBkb25lOiBmYWxzZX1cbiAgICpcbiAgICogdmFyIGl0ZXJhdG9yID0gbWFwLnZhbHVlcygpO1xuICAgKiBpdGVyYXRvci5uZXh0KCk7IC8vIHt2YWx1ZTogdmFsdWUsIGRvbmU6IGZhbHNlfVxuICAgKlxuICAgKiB2YXIgaXRlcmF0b3IgPSBtYXAuZW50cmllcygpO1xuICAgKiBpdGVyYXRvci5uZXh0KCk7IC8vIHt2YWx1ZTogW2tleSwgdmFsdWVdLCBkb25lOiBmYWxzZX1cbiAgICpcbiAgICogbWFwLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSl7IHRoaXMgPT09IHRoaXNBcmcgfSwgdGhpc0FyZyk7XG4gICAqXG4gICAqIG1hcC5jbGVhcigpOyAvLyByZXNldHMgbWFwLlxuICAgKi9cblxuICAvKipcbiAgICogQ29uc3RhbnRzXG4gICAqL1xuXG4gIC8vIEtpbmRzIG9mIG1hcCBpdGVyYXRpb25zIDIzLjEuNS4zXG4gIHZhciBLSU5EX0tFWSA9ICdrZXknO1xuICB2YXIgS0lORF9WQUxVRSA9ICd2YWx1ZSc7XG4gIHZhciBLSU5EX0tFWV9WQUxVRSA9ICdrZXkrdmFsdWUnO1xuXG4gIC8vIEluIG9sZGVyIGJyb3dzZXJzIHdlIGNhbid0IGNyZWF0ZSBhIG51bGwtcHJvdG90eXBlIG9iamVjdCBzbyB3ZSBoYXZlIHRvXG4gIC8vIGRlZmVuZCBhZ2FpbnN0IGtleSBjb2xsaXNpb25zIHdpdGggYnVpbHQtaW4gbWV0aG9kcy5cbiAgdmFyIEtFWV9QUkVGSVggPSAnJG1hcF8nO1xuXG4gIC8vIFRoaXMgcHJvcGVydHkgd2lsbCBiZSB1c2VkIGFzIHRoZSBpbnRlcm5hbCBzaXplIHZhcmlhYmxlIHRvIGRpc2FsbG93XG4gIC8vIHdyaXRpbmcgYW5kIHRvIGlzc3VlIHdhcm5pbmdzIGZvciB3cml0aW5ncyBpbiBkZXZlbG9wbWVudC5cbiAgdmFyIFNFQ1JFVF9TSVpFX1BST1A7XG4gIGlmIChfX0RFVl9fKSB7XG4gICAgU0VDUkVUX1NJWkVfUFJPUCA9ICckc2l6ZScgKyBndWlkKCk7XG4gIH1cblxuICAvLyBJbiBvbGRJRSB3ZSB1c2UgdGhlIERPTSBOb2RlIGB1bmlxdWVJRGAgcHJvcGVydHkgdG8gZ2V0IGNyZWF0ZSB0aGUgaGFzaC5cbiAgdmFyIE9MRF9JRV9IQVNIX1BSRUZJWCA9ICdJRV9IQVNIXyc7XG5cbiAgY2xhc3MgTWFwIHtcblxuICAgIC8qKlxuICAgICAqIDIzLjEuMS4xXG4gICAgICogVGFrZXMgYW4gYGl0ZXJhYmxlYCB3aGljaCBpcyBiYXNpY2FsbHkgYW55IG9iamVjdCB0aGF0IGltcGxlbWVudHMgYVxuICAgICAqIFN5bWJvbC5pdGVyYXRvciAoQEBpdGVyYXRvcikgbWV0aG9kLiBUaGUgaXRlcmFibGUgaXMgZXhwZWN0ZWQgdG8gYmUgYVxuICAgICAqIGNvbGxlY3Rpb24gb2YgcGFpcnMuIEVhY2ggcGFpciBpcyBhIGtleS92YWx1ZSBwYWlyIHRoYXQgd2lsbCBiZSB1c2VkXG4gICAgICogdG8gaW5zdGFudGlhdGUgdGhlIG1hcC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Kn0gaXRlcmFibGVcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihpdGVyYWJsZSkge1xuICAgICAgaWYgKCFpc09iamVjdCh0aGlzKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdXcm9uZyBtYXAgb2JqZWN0IHR5cGUuJyk7XG4gICAgICB9XG5cbiAgICAgIGluaXRNYXAodGhpcyk7XG5cbiAgICAgIGlmIChpdGVyYWJsZSAhPSBudWxsKSB7XG4gICAgICAgIHZhciBpdCA9IHRvSXRlcmF0b3IoaXRlcmFibGUpO1xuICAgICAgICB2YXIgbmV4dDtcbiAgICAgICAgd2hpbGUgKCEobmV4dCA9IGl0Lm5leHQoKSkuZG9uZSkge1xuICAgICAgICAgIGlmICghaXNPYmplY3QobmV4dC52YWx1ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIGl0ZXJhYmxlIGl0ZW1zIHRvIGJlIHBhaXIgb2JqZWN0cy4nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zZXQobmV4dC52YWx1ZVswXSwgbmV4dC52YWx1ZVsxXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiAyMy4xLjMuMVxuICAgICAqIENsZWFycyB0aGUgbWFwIGZyb20gYWxsIGtleXMgYW5kIHZhbHVlcy5cbiAgICAgKi9cbiAgICBjbGVhcigpIHtcbiAgICAgIGluaXRNYXAodGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogMjMuMS4zLjdcbiAgICAgKiBDaGVjayBpZiBhIGtleSBleGlzdHMgaW4gdGhlIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0geyp9IGtleVxuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAgICovXG4gICAgaGFzKGtleSkge1xuICAgICAgdmFyIGluZGV4ID0gZ2V0SW5kZXgodGhpcywga2V5KTtcbiAgICAgIHJldHVybiAhIShpbmRleCAhPSBudWxsICYmIHRoaXMuX21hcERhdGFbaW5kZXhdKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiAyMy4xLjMuOVxuICAgICAqIEFkZHMgYSBrZXkvdmFsdWUgcGFpciB0byB0aGUgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Kn0ga2V5XG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZVxuICAgICAqIEByZXR1cm4ge21hcH1cbiAgICAgKi9cbiAgICBzZXQoa2V5LCB2YWx1ZSkge1xuICAgICAgdmFyIGluZGV4ID0gZ2V0SW5kZXgodGhpcywga2V5KTtcblxuICAgICAgaWYgKGluZGV4ICE9IG51bGwgJiYgdGhpcy5fbWFwRGF0YVtpbmRleF0pIHtcbiAgICAgICAgdGhpcy5fbWFwRGF0YVtpbmRleF1bMV0gPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGluZGV4ID0gdGhpcy5fbWFwRGF0YS5wdXNoKFtcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgdmFsdWVcbiAgICAgICAgXSkgLSAxO1xuICAgICAgICBzZXRJbmRleCh0aGlzLCBrZXksIGluZGV4KTtcbiAgICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgICB0aGlzW1NFQ1JFVF9TSVpFX1BST1BdICs9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zaXplICs9IDE7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogMjMuMS4zLjZcbiAgICAgKiBHZXRzIGEgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIGEga2V5IGluIHRoZSBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHsqfSBrZXlcbiAgICAgKiBAcmV0dXJuIHsqfVxuICAgICAqL1xuICAgIGdldChrZXkpIHtcbiAgICAgIHZhciBpbmRleCA9IGdldEluZGV4KHRoaXMsIGtleSk7XG4gICAgICBpZiAoaW5kZXggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX21hcERhdGFbaW5kZXhdWzFdO1xuICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogMjMuMS4zLjNcbiAgICAgKiBEZWxldGUgYSBrZXkvdmFsdWUgZnJvbSB0aGUgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Kn0ga2V5XG4gICAgICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUga2V5IHdhcyBmb3VuZCBhbmQgZGVsZXRlZC5cbiAgICAgKi9cbiAgICBkZWxldGUoa2V5KSB7XG4gICAgICB2YXIgaW5kZXggPSBnZXRJbmRleCh0aGlzLCBrZXkpO1xuICAgICAgaWYgKGluZGV4ICE9IG51bGwgJiYgdGhpcy5fbWFwRGF0YVtpbmRleF0pIHtcbiAgICAgICAgc2V0SW5kZXgodGhpcywga2V5LCB1bmRlZmluZWQpO1xuICAgICAgICB0aGlzLl9tYXBEYXRhW2luZGV4XSA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgICB0aGlzW1NFQ1JFVF9TSVpFX1BST1BdIC09IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zaXplIC09IDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogMjMuMS4zLjRcbiAgICAgKiBSZXR1cm5zIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIGtleS92YWx1ZSBwYWlycyAoaW4gdGhlIGZvcm0gb2YgYW4gQXJyYXkpIGluXG4gICAgICogdGhlIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtNYXBJdGVyYXRvcn1cbiAgICAgKi9cbiAgICBlbnRyaWVzKCkge1xuICAgICAgcmV0dXJuIG5ldyBNYXBJdGVyYXRvcih0aGlzLCBLSU5EX0tFWV9WQUxVRSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogMjMuMS4zLjhcbiAgICAgKiBSZXR1cm5zIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIGtleXMgaW4gdGhlIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtNYXBJdGVyYXRvcn1cbiAgICAgKi9cbiAgICBrZXlzKCkge1xuICAgICAgcmV0dXJuIG5ldyBNYXBJdGVyYXRvcih0aGlzLCBLSU5EX0tFWSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogMjMuMS4zLjExXG4gICAgICogUmV0dXJucyBhbiBpdGVyYXRvciBvdmVyIHRoZSB2YWx1ZXMgcGFpcnMgaW4gdGhlIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtNYXBJdGVyYXRvcn1cbiAgICAgKi9cbiAgICB2YWx1ZXMoKSB7XG4gICAgICByZXR1cm4gbmV3IE1hcEl0ZXJhdG9yKHRoaXMsIEtJTkRfVkFMVUUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIDIzLjEuMy41XG4gICAgICogSXRlcmF0ZXMgb3ZlciB0aGUga2V5L3ZhbHVlIHBhaXJzIGluIHRoZSBjb2xsZWN0aW9uIGNhbGxpbmcgYGNhbGxiYWNrYFxuICAgICAqIHdpdGggW3ZhbHVlLCBrZXksIG1hcF0uIEFuIG9wdGlvbmFsIGB0aGlzQXJnYCBjYW4gYmUgcGFzc2VkIHRvIHNldCB0aGVcbiAgICAgKiBjb250ZXh0IHdoZW4gYGNhbGxiYWNrYCBpcyBjYWxsZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICAqIEBwYXJhbSB7P29iamVjdH0gdGhpc0FyZ1xuICAgICAqL1xuICAgIGZvckVhY2goY2FsbGJhY2ssIHRoaXNBcmcpIHtcbiAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2FsbGJhY2sgbXVzdCBiZSBjYWxsYWJsZS4nKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGJvdW5kQ2FsbGJhY2sgPSBjYWxsYmFjay5iaW5kKHRoaXNBcmcgfHwgdW5kZWZpbmVkKTtcbiAgICAgIHZhciBtYXBEYXRhID0gdGhpcy5fbWFwRGF0YTtcblxuICAgICAgLy8gTm90ZSB0aGF0IGBtYXBEYXRhLmxlbmd0aGAgc2hvdWxkIGJlIGNvbXB1dGVkIG9uIGVhY2ggaXRlcmF0aW9uIHRvXG4gICAgICAvLyBzdXBwb3J0IGl0ZXJhdGluZyBvdmVyIG5ldyBpdGVtcyBpbiB0aGUgbWFwIHRoYXQgd2VyZSBhZGRlZCBhZnRlciB0aGVcbiAgICAgIC8vIHN0YXJ0IG9mIHRoZSBpdGVyYXRpb24uXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcERhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gbWFwRGF0YVtpXTtcbiAgICAgICAgaWYgKGVudHJ5ICE9IG51bGwpIHtcbiAgICAgICAgICBib3VuZENhbGxiYWNrKGVudHJ5WzFdLCBlbnRyeVswXSwgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyAyMy4xLjMuMTJcbiAgTWFwLnByb3RvdHlwZVt0b0l0ZXJhdG9yLklURVJBVE9SX1NZTUJPTF0gPSBNYXAucHJvdG90eXBlLmVudHJpZXM7XG5cbiAgY2xhc3MgTWFwSXRlcmF0b3Ige1xuXG4gICAgLyoqXG4gICAgICogMjMuMS41LjFcbiAgICAgKiBDcmVhdGUgYSBgTWFwSXRlcmF0b3JgIGZvciBhIGdpdmVuIGBtYXBgLiBXaGlsZSB0aGlzIGNsYXNzIGlzIHByaXZhdGUgaXRcbiAgICAgKiB3aWxsIGNyZWF0ZSBvYmplY3RzIHRoYXQgd2lsbCBiZSBwYXNzZWQgYXJvdW5kIHB1YmxpY2lseS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bWFwfSBtYXBcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2luZFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG1hcCwga2luZCkge1xuICAgICAgaWYgKCEoaXNPYmplY3QobWFwKSAmJiBtYXAuX21hcERhdGEpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdCBpcyBub3QgYSBtYXAuJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChbS0lORF9LRVksIEtJTkRfS0VZX1ZBTFVFLCBLSU5EX1ZBTFVFXS5pbmRleE9mKGtpbmQpID09PSAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgaXRlcmF0aW9uIGtpbmQuJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX21hcCA9IG1hcDtcbiAgICAgIHRoaXMuX25leHRJbmRleCA9IDA7XG4gICAgICB0aGlzLl9raW5kID0ga2luZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiAyMy4xLjUuMi4xXG4gICAgICogR2V0IHRoZSBuZXh0IGl0ZXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge29iamVjdH1cbiAgICAgKi9cbiAgICBuZXh0KCkge1xuICAgICAgaWYgKCF0aGlzIGluc3RhbmNlb2YgTWFwKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIHRvIGJlIGNhbGxlZCBvbiBhIE1hcEl0ZXJhdG9yLicpO1xuICAgICAgfVxuXG4gICAgICB2YXIgbWFwID0gdGhpcy5fbWFwO1xuICAgICAgdmFyIGluZGV4ID0gdGhpcy5fbmV4dEluZGV4O1xuICAgICAgdmFyIGtpbmQgPSB0aGlzLl9raW5kO1xuXG4gICAgICBpZiAobWFwID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUl0ZXJSZXN1bHRPYmplY3QodW5kZWZpbmVkLCB0cnVlKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGVudHJpZXMgPSBtYXAuX21hcERhdGE7XG5cbiAgICAgIHdoaWxlIChpbmRleCA8IGVudHJpZXMubGVuZ3RoKSB7XG4gICAgICAgIHZhciByZWNvcmQgPSBlbnRyaWVzW2luZGV4XTtcblxuICAgICAgICBpbmRleCArPSAxO1xuICAgICAgICB0aGlzLl9uZXh0SW5kZXggPSBpbmRleDtcblxuICAgICAgICBpZiAocmVjb3JkKSB7XG4gICAgICAgICAgaWYgKGtpbmQgPT09IEtJTkRfS0VZKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlSXRlclJlc3VsdE9iamVjdChyZWNvcmRbMF0sIGZhbHNlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGtpbmQgPT09IEtJTkRfVkFMVUUpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVyUmVzdWx0T2JqZWN0KHJlY29yZFsxXSwgZmFsc2UpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoa2luZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUl0ZXJSZXN1bHRPYmplY3QocmVjb3JkLCBmYWxzZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX21hcCA9IHVuZGVmaW5lZDtcblxuICAgICAgcmV0dXJuIGNyZWF0ZUl0ZXJSZXN1bHRPYmplY3QodW5kZWZpbmVkLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvLyBXZSBjYW4gcHV0IHRoaXMgaW4gdGhlIGNsYXNzIGRlZmluaXRpb24gb25jZSB3ZSBoYXZlIGNvbXB1dGVkIHByb3BzXG4gIC8vIHRyYW5zZm9ybS5cbiAgLy8gMjMuMS41LjIuMlxuICBNYXBJdGVyYXRvci5wcm90b3R5cGVbdG9JdGVyYXRvci5JVEVSQVRPUl9TWU1CT0xdID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhlbHBlciBGdW5jdGlvbnMuXG4gICAqL1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gYW4gaW5kZXggdG8gbWFwLltbTWFwRGF0YV1dIGFycmF5IGZvciBhIGdpdmVuIEtleS5cbiAgICpcbiAgICogQHBhcmFtIHttYXB9IG1hcFxuICAgKiBAcGFyYW0geyp9IGtleVxuICAgKiBAcmV0dXJuIHs/bnVtYmVyfVxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0SW5kZXgobWFwLCBrZXkpIHtcbiAgICBpZiAoaXNPYmplY3Qoa2V5KSkge1xuICAgICAgdmFyIGhhc2ggPSBnZXRIYXNoKGtleSk7XG4gICAgICByZXR1cm4gbWFwLl9vYmplY3RJbmRleFtoYXNoXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHByZWZpeGVkS2V5ID0gS0VZX1BSRUZJWCArIGtleTtcbiAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gbWFwLl9zdHJpbmdJbmRleFtwcmVmaXhlZEtleV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbWFwLl9vdGhlckluZGV4W3ByZWZpeGVkS2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0dXAgYW4gaW5kZXggdGhhdCByZWZlciB0byB0aGUga2V5J3MgbG9jYXRpb24gaW4gbWFwLltbTWFwRGF0YV1dLlxuICAgKlxuICAgKiBAcGFyYW0ge21hcH0gbWFwXG4gICAqIEBwYXJhbSB7Kn0ga2V5XG4gICAqL1xuICBmdW5jdGlvbiBzZXRJbmRleChtYXAsIGtleSwgaW5kZXgpIHtcbiAgICB2YXIgc2hvdWxkRGVsZXRlID0gaW5kZXggPT0gbnVsbDtcblxuICAgIGlmIChpc09iamVjdChrZXkpKSB7XG4gICAgICB2YXIgaGFzaCA9IGdldEhhc2goa2V5KTtcbiAgICAgIGlmIChzaG91bGREZWxldGUpIHtcbiAgICAgICAgZGVsZXRlIG1hcC5fb2JqZWN0SW5kZXhbaGFzaF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtYXAuX29iamVjdEluZGV4W2hhc2hdID0gaW5kZXg7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBwcmVmaXhlZEtleSA9IEtFWV9QUkVGSVggKyBrZXk7XG4gICAgICBpZiAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaWYgKHNob3VsZERlbGV0ZSkge1xuICAgICAgICAgIGRlbGV0ZSBtYXAuX3N0cmluZ0luZGV4W3ByZWZpeGVkS2V5XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtYXAuX3N0cmluZ0luZGV4W3ByZWZpeGVkS2V5XSA9IGluZGV4O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2hvdWxkRGVsZXRlKSB7XG4gICAgICAgICAgZGVsZXRlIG1hcC5fb3RoZXJJbmRleFtwcmVmaXhlZEtleV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFwLl9vdGhlckluZGV4W3ByZWZpeGVkS2V5XSA9IGluZGV4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluc3RhbnRpYXRlIGEgbWFwIHdpdGggaW50ZXJuYWwgc2xvdHMuXG4gICAqXG4gICAqIEBwYXJhbSB7bWFwfSBtYXBcbiAgICovXG4gIGZ1bmN0aW9uIGluaXRNYXAobWFwKSB7XG4gICAgLy8gRGF0YSBzdHJ1Y3R1cmUgZGVzaWduIGluc3BpcmVkIGJ5IFRyYWNldXIncyBNYXAgaW1wbGVtZW50YXRpb24uXG4gICAgLy8gV2UgbWFpbnRhaW4gYW4gaW50ZXJuYWwgYXJyYXkgZm9yIGFsbCB0aGUgZW50cmllcy4gVGhlIGFycmF5IGlzIG5lZWRlZFxuICAgIC8vIHRvIHJlbWVtYmVyIG9yZGVyLiBIb3dldmVyLCB0byBoYXZlIGEgcmVhc29uYWJsZSBIYXNoTWFwIHBlcmZvcm1hbmNlXG4gICAgLy8gaS5lLiBPKDEpIGZvciBpbnNlcnRpb24sIGRlbGV0aW9uLCBhbmQgcmV0cmlldmFsLiBXZSBtYWludGFpbiBpbmRpY2VzXG4gICAgLy8gaW4gb2JqZWN0cyBmb3IgZmFzdCBsb29rIHVwcy4gSW5kaWNlcyBhcmUgc3BsaXQgdXAgYWNjb3JkaW5nIHRvIGRhdGFcbiAgICAvLyB0eXBlcyB0byBhdm9pZCBjb2xsaXNpb25zLlxuICAgIG1hcC5fbWFwRGF0YSA9IFtdO1xuXG4gICAgLy8gT2JqZWN0IGluZGV4IG1hcHMgZnJvbSBhbiBvYmplY3QgXCJoYXNoXCIgdG8gaW5kZXguIFRoZSBoYXNoIGJlaW5nIGEgdW5pcXVlXG4gICAgLy8gcHJvcGVydHkgb2Ygb3VyIGNob29zaW5nIHRoYXQgd2UgYXNzb2NpYXRlIHdpdGggdGhlIG9iamVjdC4gQXNzb2NpYXRpb25cbiAgICAvLyBpcyBkb25lIGJ5IHdheXMgb2Yga2VlcGluZyBhIG5vbi1lbnVtZXJhYmxlIHByb3BlcnR5IG9uIHRoZSBvYmplY3QuXG4gICAgLy8gSWRlYWxseSB0aGVzZSB3b3VsZCBiZSBgT2JqZWN0LmNyZWF0ZShudWxsKWAgb2JqZWN0cyBidXQgc2luY2Ugd2UncmVcbiAgICAvLyB0cnlpbmcgdG8gc3VwcG9ydCBFUzMgd2UnbGwgaGF2ZSB0byBndWFyZCBhZ2FpbnN0IGNvbGxpc2lvbnMgdXNpbmdcbiAgICAvLyBwcmVmaXhlcyBvbiB0aGUga2V5cyByYXRoZXIgdGhhbiByZWx5IG9uIG51bGwgcHJvdG90eXBlIG9iamVjdHMuXG4gICAgbWFwLl9vYmplY3RJbmRleCA9IHt9O1xuXG4gICAgLy8gU3RyaW5nIGluZGV4IG1hcHMgZnJvbSBzdHJpbmdzIHRvIGluZGV4LlxuICAgIG1hcC5fc3RyaW5nSW5kZXggPSB7fTtcblxuICAgIC8vIE51bWJlcnMsIGJvb2xlYW5zLCB1bmRlZmluZWQsIGFuZCBudWxsLlxuICAgIG1hcC5fb3RoZXJJbmRleCA9IHt9O1xuXG4gICAgLy8gVW5mb3J0dW5hdGVseSB3ZSBoYXZlIHRvIHN1cHBvcnQgRVMzIGFuZCBjYW5ub3QgaGF2ZSBgTWFwLnByb3RvdHlwZS5zaXplYFxuICAgIC8vIGJlIGEgZ2V0dGVyIG1ldGhvZCBidXQganVzdCBhIHJlZ3VsYXIgbWV0aG9kLiBUaGUgYmlnZ2VzdCBwcm9ibGVtIHdpdGhcbiAgICAvLyB0aGlzIGlzIHNhZmV0eS4gQ2xpZW50cyBjYW4gY2hhbmdlIHRoZSBzaXplIHByb3BlcnR5IGVhc2lseSBhbmQgcG9zc2libHlcbiAgICAvLyB3aXRob3V0IG5vdGljaW5nIChlLmcuIGBpZiAobWFwLnNpemUgPSAxKSB7Li59YCBraW5kIG9mIHR5cG8pLiBXaGF0IHdlXG4gICAgLy8gY2FuIGRvIHRvIG1pdGlnYXRlIHVzZSBnZXR0ZXJzIGFuZCBzZXR0ZXJzIGluIGRldmVsb3BtZW50IHRvIGRpc2FsbG93XG4gICAgLy8gYW5kIGlzc3VlIGEgd2FybmluZyBmb3IgY2hhbmdpbmcgdGhlIGBzaXplYCBwcm9wZXJ0eS5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgaWYgKGlzRVM1KSB7XG4gICAgICAgIC8vIElmIHRoZSBgU0VDUkVUX1NJWkVfUFJPUGAgcHJvcGVydHkgaXMgYWxyZWFkeSBkZWZpbmVkIHRoZW4gd2UncmUgbm90XG4gICAgICAgIC8vIGluIHRoZSBmaXJzdCBjYWxsIHRvIGBpbml0TWFwYCAoZS5nLiBjb21pbmcgZnJvbSBgbWFwLmNsZWFyKClgKSBzb1xuICAgICAgICAvLyBhbGwgd2UgbmVlZCB0byBkbyBpcyByZXNldCB0aGUgc2l6ZSB3aXRob3V0IGRlZmluaW5nIHRoZSBwcm9wZXJ0aWVzLlxuICAgICAgICBpZiAobWFwLmhhc093blByb3BlcnR5KFNFQ1JFVF9TSVpFX1BST1ApKSB7XG4gICAgICAgICAgbWFwW1NFQ1JFVF9TSVpFX1BST1BdID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobWFwLCBTRUNSRVRfU0laRV9QUk9QLCB7XG4gICAgICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1hcCwgJ3NpemUnLCB7XG4gICAgICAgICAgICBzZXQ6ICh2KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgICAgICAgJ1BMRUFTRSBGSVggTUU6IFlvdSBhcmUgY2hhbmdpbmcgdGhlIG1hcCBzaXplIHByb3BlcnR5IHdoaWNoICcgK1xuICAgICAgICAgICAgICAgICdzaG91bGQgbm90IGJlIHdyaXRhYmxlIGFuZCB3aWxsIGJyZWFrIGluIHByb2R1Y3Rpb24uJ1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBtYXAgc2l6ZSBwcm9wZXJ0eSBpcyBub3Qgd3JpdGFibGUuJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiAoKSA9PiBtYXBbU0VDUkVUX1NJWkVfUFJPUF1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5PVEU6IEVhcmx5IHJldHVybiB0byBpbXBsZW1lbnQgaW1tdXRhYmxlIGAuc2l6ZWAgaW4gREVWLlxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVGhpcyBpcyBhIGRpdmlhdGlvbiBmcm9tIHRoZSBzcGVjLiBgc2l6ZWAgc2hvdWxkIGJlIGEgZ2V0dGVyIG9uXG4gICAgLy8gYE1hcC5wcm90b3R5cGVgLiBIb3dldmVyLCB3ZSBoYXZlIHRvIHN1cHBvcnQgSUU4LlxuICAgIG1hcC5zaXplID0gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBzb21ldGhpbmcgaXMgYW4gb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0geyp9IG9cbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICovXG4gIGZ1bmN0aW9uIGlzT2JqZWN0KG8pIHtcbiAgICByZXR1cm4gbyAhPSBudWxsICYmICh0eXBlb2YgbyA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIG8gPT09ICdmdW5jdGlvbicpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbiBpdGVyYXRpb24gb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0geyp9IHZhbHVlXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gZG9uZVxuICAgKiBAcmV0dXJuIHtvYmplY3R9XG4gICAqL1xuICBmdW5jdGlvbiBjcmVhdGVJdGVyUmVzdWx0T2JqZWN0KHZhbHVlLCBkb25lKSB7XG4gICAgcmV0dXJuIHt2YWx1ZSwgZG9uZX07XG4gIH1cblxuICAvLyBBcmUgd2UgaW4gYSBsZWdpdCBFUzUgZW52aXJvbm1lbnQuIFNwb2lsZXIgYWxlcnQ6IHRoYXQgZG9lc24ndCBpbmNsdWRlIElFOC5cbiAgdmFyIGlzRVM1ID0gKGZ1bmN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICd4Jywge30pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSkoKTtcblxuICAvKipcbiAgICogQ2hlY2sgaWYgYW4gb2JqZWN0IGNhbiBiZSBleHRlbmRlZC5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R8YXJyYXl8ZnVuY3Rpb258cmVnZXhwfSBvXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAqL1xuICBmdW5jdGlvbiBpc0V4dGVuc2libGUobykge1xuICAgIGlmICghaXNFUzUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gT2JqZWN0LmlzRXh0ZW5zaWJsZShvKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSUUgaGFzIGEgYHVuaXF1ZUlEYCBzZXQgb24gZXZlcnkgRE9NIG5vZGUuIFNvIHdlIGNvbnN0cnVjdCB0aGUgaGFzaCBmcm9tXG4gICAqIHRoaXMgdW5pcXVlSUQgdG8gYXZvaWQgbWVtb3J5IGxlYWtzIGFuZCB0aGUgSUUgY2xvbmVOb2RlIGJ1ZyB3aGVyZSBpdFxuICAgKiBjbG9uZXMgcHJvcGVydGllcyBpbiBhZGRpdGlvbiB0byB0aGUgYXR0cmlidXRlcy5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IG5vZGVcbiAgICogQHJldHVybiB7P3N0cmluZ31cbiAgICovXG4gIGZ1bmN0aW9uIGdldElFTm9kZUhhc2gobm9kZSkge1xuICAgIHZhciB1bmlxdWVJRDtcbiAgICBzd2l0Y2ggKG5vZGUubm9kZVR5cGUpIHtcbiAgICAgIGNhc2UgMTogLy8gRWxlbWVudFxuICAgICAgICB1bmlxdWVJRCA9IG5vZGUudW5pcXVlSUQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA5OiAvLyBEb2N1bWVudFxuICAgICAgICB1bmlxdWVJRCA9IG5vZGUuZG9jdW1lbnRFbGVtZW50LnVuaXF1ZUlEO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmICh1bmlxdWVJRCkge1xuICAgICAgcmV0dXJuICBPTERfSUVfSEFTSF9QUkVGSVggKyB1bmlxdWVJRDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgdmFyIGdldEhhc2ggPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHByb3BJc0VudW1lcmFibGUgPSBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlO1xuICAgIHZhciBoYXNoUHJvcGVydHkgPSBndWlkKCk7XG4gICAgdmFyIGhhc2hDb3VudGVyID0gMDtcblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgXCJoYXNoXCIgYXNzb2NpYXRlZCB3aXRoIGFuIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fGFycmF5fGZ1bmN0aW9ufHJlZ2V4cH0gb1xuICAgICAqIEByZXR1cm4ge251bWJlcn1cbiAgICAgKi9cbiAgICByZXR1cm4gZnVuY3Rpb24gZ2V0SGFzaChvKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2hhZG93XG4gICAgICBpZiAob1toYXNoUHJvcGVydHldKSB7XG4gICAgICAgIHJldHVybiBvW2hhc2hQcm9wZXJ0eV07XG4gICAgICB9IGVsc2UgaWYgKCFpc0VTNSAmJlxuICAgICAgICAgICAgICAgICAgby5wcm9wZXJ0eUlzRW51bWVyYWJsZSAmJlxuICAgICAgICAgICAgICAgICAgby5wcm9wZXJ0eUlzRW51bWVyYWJsZVtoYXNoUHJvcGVydHldKSB7XG4gICAgICAgIHJldHVybiBvLnByb3BlcnR5SXNFbnVtZXJhYmxlW2hhc2hQcm9wZXJ0eV07XG4gICAgICB9IGVsc2UgaWYgKCFpc0VTNSAmJlxuICAgICAgICAgICAgICAgICAgaXNOb2RlKG8pICYmXG4gICAgICAgICAgICAgICAgICBnZXRJRU5vZGVIYXNoKG8pKSB7XG4gICAgICAgIHJldHVybiBnZXRJRU5vZGVIYXNoKG8pO1xuICAgICAgfSBlbHNlIGlmICghaXNFUzUgJiYgb1toYXNoUHJvcGVydHldKSB7XG4gICAgICAgIHJldHVybiBvW2hhc2hQcm9wZXJ0eV07XG4gICAgICB9XG5cbiAgICAgIGlmIChpc0V4dGVuc2libGUobykpIHtcbiAgICAgICAgaGFzaENvdW50ZXIgKz0gMTtcbiAgICAgICAgaWYgKGlzRVM1KSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGhhc2hQcm9wZXJ0eSwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgdmFsdWU6IGhhc2hDb3VudGVyXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoby5wcm9wZXJ0eUlzRW51bWVyYWJsZSkge1xuICAgICAgICAgIC8vIFNpbmNlIHdlIGNhbid0IGRlZmluZSBhIG5vbi1lbnVtZXJhYmxlIHByb3BlcnR5IG9uIHRoZSBvYmplY3RcbiAgICAgICAgICAvLyB3ZSdsbCBoaWphY2sgb25lIG9mIHRoZSBsZXNzLXVzZWQgbm9uLWVudW1lcmFibGUgcHJvcGVydGllcyB0b1xuICAgICAgICAgIC8vIHNhdmUgb3VyIGhhc2ggb24gaXQuIEFkZGlvdGlvbmFsbHksIHNpbmNlIHRoaXMgaXMgYSBmdW5jdGlvbiBpdFxuICAgICAgICAgIC8vIHdpbGwgbm90IHNob3cgdXAgaW4gYEpTT04uc3RyaW5naWZ5YCB3aGljaCBpcyB3aGF0IHdlIHdhbnQuXG4gICAgICAgICAgby5wcm9wZXJ0eUlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHByb3BJc0VudW1lcmFibGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIG8ucHJvcGVydHlJc0VudW1lcmFibGVbaGFzaFByb3BlcnR5XSA9IGhhc2hDb3VudGVyO1xuICAgICAgICB9IGVsc2UgaWYgKGlzTm9kZShvKSkge1xuICAgICAgICAgIC8vIEF0IHRoaXMgcG9pbnQgd2UgY291bGRuJ3QgZ2V0IHRoZSBJRSBgdW5pcXVlSURgIHRvIHVzZSBhcyBhIGhhc2hcbiAgICAgICAgICAvLyBhbmQgd2UgY291bGRuJ3QgdXNlIGEgbm9uLWVudW1lcmFibGUgcHJvcGVydHkgdG8gZXhwbG9pdCB0aGVcbiAgICAgICAgICAvLyBkb250RW51bSBidWcgc28gd2Ugc2ltcGx5IGFkZCB0aGUgYGhhc2hQcm9wZXJ0eWAgb24gdGhlIG5vZGVcbiAgICAgICAgICAvLyBpdHNlbGYuXG4gICAgICAgICAgb1toYXNoUHJvcGVydHldID0gaGFzaENvdW50ZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gc2V0IGEgbm9uLWVudW1lcmFibGUgcHJvcGVydHkgb24gb2JqZWN0LicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBoYXNoQ291bnRlcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm9uLWV4dGVuc2libGUgb2JqZWN0cyBhcmUgbm90IGFsbG93ZWQgYXMga2V5cy4nKTtcbiAgICAgIH1cbiAgICB9O1xuICB9KSgpO1xuXG4gIHJldHVybiBNYXA7XG59KShGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXctZnVuY1xuIl19