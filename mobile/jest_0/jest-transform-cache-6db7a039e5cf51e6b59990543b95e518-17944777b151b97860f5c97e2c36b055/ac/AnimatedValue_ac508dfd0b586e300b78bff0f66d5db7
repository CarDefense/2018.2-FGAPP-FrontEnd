ee02cc43b36e74282015490c0a9ffcd7
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var AnimatedInterpolation=require('./AnimatedInterpolation');var AnimatedNode=require('./AnimatedNode');var AnimatedWithChildren=require('./AnimatedWithChildren');var InteractionManager=require('InteractionManager');var NativeAnimatedHelper=require('../NativeAnimatedHelper');var NativeAnimatedAPI=NativeAnimatedHelper.API;var _uniqueId=1;function _flush(rootNode){var animatedStyles=new Set();function findAnimatedStyles(node){if(typeof node.update==='function'){animatedStyles.add(node);}else{node.__getChildren().forEach(findAnimatedStyles);}}findAnimatedStyles(rootNode);animatedStyles.forEach(function(animatedStyle){return animatedStyle.update();});}var AnimatedValue=function(_AnimatedWithChildren){_inherits(AnimatedValue,_AnimatedWithChildren);function AnimatedValue(value){_classCallCheck(this,AnimatedValue);var _this=_possibleConstructorReturn(this,(AnimatedValue.__proto__||Object.getPrototypeOf(AnimatedValue)).call(this));_this._startingValue=_this._value=value;_this._offset=0;_this._animation=null;_this._listeners={};return _this;}_createClass(AnimatedValue,[{key:'__detach',value:function __detach(){this.stopAnimation();_get(AnimatedValue.prototype.__proto__||Object.getPrototypeOf(AnimatedValue.prototype),'__detach',this).call(this);}},{key:'__getValue',value:function __getValue(){return this._value+this._offset;}},{key:'__makeNative',value:function __makeNative(){_get(AnimatedValue.prototype.__proto__||Object.getPrototypeOf(AnimatedValue.prototype),'__makeNative',this).call(this);if(Object.keys(this._listeners).length){this._startListeningToNativeValueUpdates();}}},{key:'setValue',value:function setValue(value){if(this._animation){this._animation.stop();this._animation=null;}this._updateValue(value,!this.__isNative);if(this.__isNative){NativeAnimatedAPI.setAnimatedNodeValue(this.__getNativeTag(),value);}}},{key:'setOffset',value:function setOffset(offset){this._offset=offset;if(this.__isNative){NativeAnimatedAPI.setAnimatedNodeOffset(this.__getNativeTag(),offset);}}},{key:'flattenOffset',value:function flattenOffset(){this._value+=this._offset;this._offset=0;if(this.__isNative){NativeAnimatedAPI.flattenAnimatedNodeOffset(this.__getNativeTag());}}},{key:'extractOffset',value:function extractOffset(){this._offset+=this._value;this._value=0;if(this.__isNative){NativeAnimatedAPI.extractAnimatedNodeOffset(this.__getNativeTag());}}},{key:'addListener',value:function addListener(callback){var id=String(_uniqueId++);this._listeners[id]=callback;if(this.__isNative){this._startListeningToNativeValueUpdates();}return id;}},{key:'removeListener',value:function removeListener(id){delete this._listeners[id];if(this.__isNative&&Object.keys(this._listeners).length===0){this._stopListeningForNativeValueUpdates();}}},{key:'removeAllListeners',value:function removeAllListeners(){this._listeners={};if(this.__isNative){this._stopListeningForNativeValueUpdates();}}},{key:'_startListeningToNativeValueUpdates',value:function _startListeningToNativeValueUpdates(){var _this2=this;if(this.__nativeAnimatedValueListener){return;}NativeAnimatedAPI.startListeningToAnimatedNodeValue(this.__getNativeTag());this.__nativeAnimatedValueListener=NativeAnimatedHelper.nativeEventEmitter.addListener('onAnimatedValueUpdate',function(data){if(data.tag!==_this2.__getNativeTag()){return;}_this2._updateValue(data.value,false);});}},{key:'_stopListeningForNativeValueUpdates',value:function _stopListeningForNativeValueUpdates(){if(!this.__nativeAnimatedValueListener){return;}this.__nativeAnimatedValueListener.remove();this.__nativeAnimatedValueListener=null;NativeAnimatedAPI.stopListeningToAnimatedNodeValue(this.__getNativeTag());}},{key:'stopAnimation',value:function stopAnimation(callback){this.stopTracking();this._animation&&this._animation.stop();this._animation=null;callback&&callback(this.__getValue());}},{key:'resetAnimation',value:function resetAnimation(callback){this.stopAnimation(callback);this._value=this._startingValue;}},{key:'interpolate',value:function interpolate(config){return new AnimatedInterpolation(this,config);}},{key:'animate',value:function animate(animation,callback){var _this3=this;var handle=null;if(animation.__isInteraction){handle=InteractionManager.createInteractionHandle();}var previousAnimation=this._animation;this._animation&&this._animation.stop();this._animation=animation;animation.start(this._value,function(value){_this3._updateValue(value,true);},function(result){_this3._animation=null;if(handle!==null){InteractionManager.clearInteractionHandle(handle);}callback&&callback(result);},previousAnimation,this);}},{key:'stopTracking',value:function stopTracking(){this._tracking&&this._tracking.__detach();this._tracking=null;}},{key:'track',value:function track(tracking){this.stopTracking();this._tracking=tracking;}},{key:'_updateValue',value:function _updateValue(value,flush){this._value=value;if(flush){_flush(this);}for(var _key in this._listeners){this._listeners[_key]({value:this.__getValue()});}}},{key:'__getNativeConfig',value:function __getNativeConfig(){return{type:'value',value:this._value,offset:this._offset};}}]);return AnimatedValue;}(AnimatedWithChildren);module.exports=AnimatedValue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkVmFsdWUuanMiXSwibmFtZXMiOlsiQW5pbWF0ZWRJbnRlcnBvbGF0aW9uIiwicmVxdWlyZSIsIkFuaW1hdGVkTm9kZSIsIkFuaW1hdGVkV2l0aENoaWxkcmVuIiwiSW50ZXJhY3Rpb25NYW5hZ2VyIiwiTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJOYXRpdmVBbmltYXRlZEFQSSIsIkFQSSIsIl91bmlxdWVJZCIsIl9mbHVzaCIsInJvb3ROb2RlIiwiYW5pbWF0ZWRTdHlsZXMiLCJTZXQiLCJmaW5kQW5pbWF0ZWRTdHlsZXMiLCJub2RlIiwidXBkYXRlIiwiYWRkIiwiX19nZXRDaGlsZHJlbiIsImZvckVhY2giLCJhbmltYXRlZFN0eWxlIiwiQW5pbWF0ZWRWYWx1ZSIsInZhbHVlIiwiX3N0YXJ0aW5nVmFsdWUiLCJfdmFsdWUiLCJfb2Zmc2V0IiwiX2FuaW1hdGlvbiIsIl9saXN0ZW5lcnMiLCJzdG9wQW5pbWF0aW9uIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsIl9zdGFydExpc3RlbmluZ1RvTmF0aXZlVmFsdWVVcGRhdGVzIiwic3RvcCIsIl91cGRhdGVWYWx1ZSIsIl9faXNOYXRpdmUiLCJzZXRBbmltYXRlZE5vZGVWYWx1ZSIsIl9fZ2V0TmF0aXZlVGFnIiwib2Zmc2V0Iiwic2V0QW5pbWF0ZWROb2RlT2Zmc2V0IiwiZmxhdHRlbkFuaW1hdGVkTm9kZU9mZnNldCIsImV4dHJhY3RBbmltYXRlZE5vZGVPZmZzZXQiLCJjYWxsYmFjayIsImlkIiwiU3RyaW5nIiwiX3N0b3BMaXN0ZW5pbmdGb3JOYXRpdmVWYWx1ZVVwZGF0ZXMiLCJfX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lciIsInN0YXJ0TGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZSIsIm5hdGl2ZUV2ZW50RW1pdHRlciIsImFkZExpc3RlbmVyIiwiZGF0YSIsInRhZyIsInJlbW92ZSIsInN0b3BMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlIiwic3RvcFRyYWNraW5nIiwiX19nZXRWYWx1ZSIsImNvbmZpZyIsImFuaW1hdGlvbiIsImhhbmRsZSIsIl9faXNJbnRlcmFjdGlvbiIsImNyZWF0ZUludGVyYWN0aW9uSGFuZGxlIiwicHJldmlvdXNBbmltYXRpb24iLCJzdGFydCIsImNsZWFySW50ZXJhY3Rpb25IYW5kbGUiLCJyZXN1bHQiLCJfdHJhY2tpbmciLCJfX2RldGFjaCIsInRyYWNraW5nIiwiZmx1c2giLCJrZXkiLCJ0eXBlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUEsYSw0dERBRUEsR0FBTUEsdUJBQXdCQyxRQUFRLHlCQUFSLENBQTlCLENBQ0EsR0FBTUMsY0FBZUQsUUFBUSxnQkFBUixDQUFyQixDQUNBLEdBQU1FLHNCQUF1QkYsUUFBUSx3QkFBUixDQUE3QixDQUNBLEdBQU1HLG9CQUFxQkgsT0FBckIsc0JBQU4sQ0FDQSxHQUFNSSxzQkFBdUJKLFFBQVEseUJBQVIsQ0FBN0IsQ0FNQSxHQUFNSyxtQkFBb0JELHFCQUFxQkUsR0FBL0MsQ0FJQSxHQUFJQyxXQUFZLENBQWhCLENBd0JBLFFBQVNDLE9BQVQsQ0FBZ0JDLFFBQWhCLENBQStDLENBQzdDLEdBQU1DLGdCQUFpQixHQUFJQyxJQUFKLEVBQXZCLENBQ0EsUUFBU0MsbUJBQVQsQ0FBNEJDLElBQTVCLENBQWtDLENBQ2hDLEdBQUksTUFBT0EsTUFBS0MsTUFBWixHQUF1QixVQUEzQixDQUF1QyxDQUNyQ0osZUFBZUssR0FBZixDQUFtQkYsSUFBbkIsRUFDRCxDQUZELElBRU8sQ0FDTEEsS0FBS0csYUFBTCxHQUFxQkMsT0FBckIsQ0FBNkJMLGtCQUE3QixFQUNELENBQ0YsQ0FDREEsbUJBQW1CSCxRQUFuQixFQUVBQyxlQUFlTyxPQUFmLENBQXVCLDhCQUFpQkMsZUFBY0osTUFBZCxFQUFqQixFQUF2QixFQUNELEMsR0FVS0ssYyxnRkFTSix1QkFBWUMsS0FBWixDQUEyQiwySkFFekIsTUFBS0MsY0FBTCxDQUFzQixNQUFLQyxNQUFMLENBQWNGLEtBQXBDLENBQ0EsTUFBS0cs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LEVBaUJELEMsbURBS29CLENBQ25CLEtBQUtJLFNBQUwsRUFBa0IsS0FBS0EsU0FBTCxDQUFlQyxRQUFmLEVBQWxCLENBQ0EsS0FBS0QsU0FBTCxDQUFpQixJQUFqQixDQUNELEMsb0NBS0tFLFEsQ0FBa0MsQ0FDdEMsS0FBS2IsWUFBTCxHQUNBLEtBQUtXLFNBQUwsQ0FBaUJFLFFBQWpCLENBQ0QsQyxrREFFWTdDLEssQ0FBZThDLEssQ0FBc0IsQ0FDaEQsS0FBSzVDLE1BQUwsQ0FBY0YsS0FBZCxDQUNBLEdBQUk4QyxLQUFKLENBQVcsQ0FDVDFELE9BQU8sSUFBUCxFQUNELENBQ0QsSUFBSyxHQUFNMkQsS0FBWCxHQUFrQixNQUFLMUMsVUFBdkIsQ0FBbUMsQ0FDakMsS0FBS0EsVUFBTCxDQUFnQjBDLElBQWhCLEVBQXFCLENBQUMvQyxNQUFPLEtBQUtpQyxVQUFMLEVBQVIsQ0FBckIsRUFDRCxDQUNGLEMsNkRBRTJCLENBQzFCLE1BQU8sQ0FDTGUsS0FBTSxPQURELENBRUxoRCxNQUFPLEtBQUtFLE1BRlAsQ0FHTGMsT0FBUSxLQUFLYixPQUhSLENBQVAsQ0FLRCxDLDJCQXJReUJyQixvQixFQXdRNUJtRSxPQUFPQyxPQUFQLENBQWlCbkQsYUFBakIiLCJmaWxlIjoiQW5pbWF0ZWRWYWx1ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIEFuaW1hdGVkVmFsdWVcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgQW5pbWF0ZWRJbnRlcnBvbGF0aW9uID0gcmVxdWlyZSgnLi9BbmltYXRlZEludGVycG9sYXRpb24nKTtcbmNvbnN0IEFuaW1hdGVkTm9kZSA9IHJlcXVpcmUoJy4vQW5pbWF0ZWROb2RlJyk7XG5jb25zdCBBbmltYXRlZFdpdGhDaGlsZHJlbiA9IHJlcXVpcmUoJy4vQW5pbWF0ZWRXaXRoQ2hpbGRyZW4nKTtcbmNvbnN0IEludGVyYWN0aW9uTWFuYWdlciA9IHJlcXVpcmUoJ0ludGVyYWN0aW9uTWFuYWdlcicpO1xuY29uc3QgTmF0aXZlQW5pbWF0ZWRIZWxwZXIgPSByZXF1aXJlKCcuLi9OYXRpdmVBbmltYXRlZEhlbHBlcicpO1xuXG5pbXBvcnQgdHlwZSBBbmltYXRpb24sIHtFbmRDYWxsYmFja30gZnJvbSAnLi4vYW5pbWF0aW9ucy9BbmltYXRpb24nO1xuaW1wb3J0IHR5cGUge0ludGVycG9sYXRpb25Db25maWdUeXBlfSBmcm9tICcuL0FuaW1hdGVkSW50ZXJwb2xhdGlvbic7XG5pbXBvcnQgdHlwZSBBbmltYXRlZFRyYWNraW5nIGZyb20gJy4vQW5pbWF0ZWRUcmFja2luZyc7XG5cbmNvbnN0IE5hdGl2ZUFuaW1hdGVkQVBJID0gTmF0aXZlQW5pbWF0ZWRIZWxwZXIuQVBJO1xuXG50eXBlIFZhbHVlTGlzdGVuZXJDYWxsYmFjayA9IChzdGF0ZToge3ZhbHVlOiBudW1iZXJ9KSA9PiB2b2lkO1xuXG5sZXQgX3VuaXF1ZUlkID0gMTtcblxuLyoqXG4gKiBBbmltYXRlZCB3b3JrcyBieSBidWlsZGluZyBhIGRpcmVjdGVkIGFjeWNsaWMgZ3JhcGggb2YgZGVwZW5kZW5jaWVzXG4gKiB0cmFuc3BhcmVudGx5IHdoZW4geW91IHJlbmRlciB5b3VyIEFuaW1hdGVkIGNvbXBvbmVudHMuXG4gKlxuICogICAgICAgICAgICAgICBuZXcgQW5pbWF0ZWQuVmFsdWUoMClcbiAqICAgICAuaW50ZXJwb2xhdGUoKSAgICAgICAgLmludGVycG9sYXRlKCkgICAgbmV3IEFuaW1hdGVkLlZhbHVlKDEpXG4gKiAgICAgICAgIG9wYWNpdHkgICAgICAgICAgICAgICB0cmFuc2xhdGVZICAgICAgc2NhbGVcbiAqICAgICAgICAgIHN0eWxlICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVxuICogICAgICAgICBWaWV3IzIzNCAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpZXcjMTIzXG4gKlxuICogQSkgVG9wIERvd24gcGhhc2VcbiAqIFdoZW4gYW4gQW5pbWF0ZWQuVmFsdWUgaXMgdXBkYXRlZCwgd2UgcmVjdXJzaXZlbHkgZ28gZG93biB0aHJvdWdoIHRoaXNcbiAqIGdyYXBoIGluIG9yZGVyIHRvIGZpbmQgbGVhZiBub2RlczogdGhlIHZpZXdzIHRoYXQgd2UgZmxhZyBhcyBuZWVkaW5nXG4gKiBhbiB1cGRhdGUuXG4gKlxuICogQikgQm90dG9tIFVwIHBoYXNlXG4gKiBXaGVuIGEgdmlldyBpcyBmbGFnZ2VkIGFzIG5lZWRpbmcgYW4gdXBkYXRlLCB3ZSByZWN1cnNpdmVseSBnbyBiYWNrIHVwXG4gKiBpbiBvcmRlciB0byBidWlsZCB0aGUgbmV3IHZhbHVlIHRoYXQgaXQgbmVlZHMuIFRoZSByZWFzb24gd2h5IHdlIG5lZWRcbiAqIHRoaXMgdHdvLXBoYXNlcyBwcm9jZXNzIGlzIHRvIGRlYWwgd2l0aCBjb21wb3NpdGUgcHJvcHMgc3VjaCBhc1xuICogdHJhbnNmb3JtIHdoaWNoIGNhbiByZWNlaXZlIHZhbHVlcyBmcm9tIG11bHRpcGxlIHBhcmVudHMuXG4gKi9cbmZ1bmN0aW9uIF9mbHVzaChyb290Tm9kZTogQW5pbWF0ZWRWYWx1ZSk6IHZvaWQge1xuICBjb25zdCBhbmltYXRlZFN0eWxlcyA9IG5ldyBTZXQoKTtcbiAgZnVuY3Rpb24gZmluZEFuaW1hdGVkU3R5bGVzKG5vZGUpIHtcbiAgICBpZiAodHlwZW9mIG5vZGUudXBkYXRlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBhbmltYXRlZFN0eWxlcy5hZGQobm9kZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5vZGUuX19nZXRDaGlsZHJlbigpLmZvckVhY2goZmluZEFuaW1hdGVkU3R5bGVzKTtcbiAgICB9XG4gIH1cbiAgZmluZEFuaW1hdGVkU3R5bGVzKHJvb3ROb2RlKTtcbiAgLyogJEZsb3dGaXhNZSAqL1xuICBhbmltYXRlZFN0eWxlcy5mb3JFYWNoKGFuaW1hdGVkU3R5bGUgPT4gYW5pbWF0ZWRTdHlsZS51cGRhdGUoKSk7XG59XG5cbi8qKlxuICogU3RhbmRhcmQgdmFsdWUgZm9yIGRyaXZpbmcgYW5pbWF0aW9ucy4gIE9uZSBgQW5pbWF0ZWQuVmFsdWVgIGNhbiBkcml2ZVxuICogbXVsdGlwbGUgcHJvcGVydGllcyBpbiBhIHN5bmNocm9uaXplZCBmYXNoaW9uLCBidXQgY2FuIG9ubHkgYmUgZHJpdmVuIGJ5IG9uZVxuICogbWVjaGFuaXNtIGF0IGEgdGltZS4gIFVzaW5nIGEgbmV3IG1lY2hhbmlzbSAoZS5nLiBzdGFydGluZyBhIG5ldyBhbmltYXRpb24sXG4gKiBvciBjYWxsaW5nIGBzZXRWYWx1ZWApIHdpbGwgc3RvcCBhbnkgcHJldmlvdXMgb25lcy5cbiAqXG4gKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWxcbiAqL1xuY2xhc3MgQW5pbWF0ZWRWYWx1ZSBleHRlbmRzIEFuaW1hdGVkV2l0aENoaWxkcmVuIHtcbiAgX3ZhbHVlOiBudW1iZXI7XG4gIF9zdGFydGluZ1ZhbHVlOiBudW1iZXI7XG4gIF9vZmZzZXQ6IG51bWJlcjtcbiAgX2FuaW1hdGlvbjogP0FuaW1hdGlvbjtcbiAgX3RyYWNraW5nOiA/QW5pbWF0ZWRUcmFja2luZztcbiAgX2xpc3RlbmVyczoge1trZXk6IHN0cmluZ106IFZhbHVlTGlzdGVuZXJDYWxsYmFja307XG4gIF9fbmF0aXZlQW5pbWF0ZWRWYWx1ZUxpc3RlbmVyOiA/YW55O1xuXG4gIGNvbnN0cnVjdG9yKHZhbHVlOiBudW1iZXIpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3N0YXJ0aW5nVmFsdWUgPSB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgIHRoaXMuX29mZnNldCA9IDA7XG4gICAgdGhpcy5fYW5pbWF0aW9uID0gbnVsbDtcbiAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTtcbiAgfVxuXG4gIF9fZGV0YWNoKCkge1xuICAgIHRoaXMuc3RvcEFuaW1hdGlvbigpO1xuICAgIHN1cGVyLl9fZGV0YWNoKCk7XG4gIH1cblxuICBfX2dldFZhbHVlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlICsgdGhpcy5fb2Zmc2V0O1xuICB9XG5cbiAgX19tYWtlTmF0aXZlKCkge1xuICAgIHN1cGVyLl9fbWFrZU5hdGl2ZSgpO1xuXG4gICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuX2xpc3RlbmVycykubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9zdGFydExpc3RlbmluZ1RvTmF0aXZlVmFsdWVVcGRhdGVzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpcmVjdGx5IHNldCB0aGUgdmFsdWUuICBUaGlzIHdpbGwgc3RvcCBhbnkgYW5pbWF0aW9ucyBydW5uaW5nIG9uIHRoZSB2YWx1ZVxuICAgKiBhbmQgdXBkYXRlIGFsbCB0aGUgYm91bmQgcHJvcGVydGllcy5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI3NldHZhbHVlXG4gICAqL1xuICBzZXRWYWx1ZSh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX2FuaW1hdGlvbikge1xuICAgICAgdGhpcy5fYW5pbWF0aW9uLnN0b3AoKTtcbiAgICAgIHRoaXMuX2FuaW1hdGlvbiA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuX3VwZGF0ZVZhbHVlKFxuICAgICAgdmFsdWUsXG4gICAgICAhdGhpcy5fX2lzTmF0aXZlIC8qIGRvbid0IHBlcmZvcm0gYSBmbHVzaCBmb3IgbmF0aXZlbHkgZHJpdmVuIHZhbHVlcyAqLyxcbiAgICApO1xuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLnNldEFuaW1hdGVkTm9kZVZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSwgdmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIGFuIG9mZnNldCB0aGF0IGlzIGFwcGxpZWQgb24gdG9wIG9mIHdoYXRldmVyIHZhbHVlIGlzIHNldCwgd2hldGhlciB2aWFcbiAgICogYHNldFZhbHVlYCwgYW4gYW5pbWF0aW9uLCBvciBgQW5pbWF0ZWQuZXZlbnRgLiAgVXNlZnVsIGZvciBjb21wZW5zYXRpbmdcbiAgICogdGhpbmdzIGxpa2UgdGhlIHN0YXJ0IG9mIGEgcGFuIGdlc3R1cmUuXG4gICAqXG4gICAqIFNlZSBodHRwOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbCNzZXRvZmZzZXRcbiAgICovXG4gIHNldE9mZnNldChvZmZzZXQ6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuX29mZnNldCA9IG9mZnNldDtcbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICBOYXRpdmVBbmltYXRlZEFQSS5zZXRBbmltYXRlZE5vZGVPZmZzZXQodGhpcy5fX2dldE5hdGl2ZVRhZygpLCBvZmZzZXQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNZXJnZXMgdGhlIG9mZnNldCB2YWx1ZSBpbnRvIHRoZSBiYXNlIHZhbHVlIGFuZCByZXNldHMgdGhlIG9mZnNldCB0byB6ZXJvLlxuICAgKiBUaGUgZmluYWwgb3V0cHV0IG9mIHRoZSB2YWx1ZSBpcyB1bmNoYW5nZWQuXG4gICAqXG4gICAqIFNlZSBodHRwOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbCNmbGF0dGVub2Zmc2V0XG4gICAqL1xuICBmbGF0dGVuT2Zmc2V0KCk6IHZvaWQge1xuICAgIHRoaXMuX3ZhbHVlICs9IHRoaXMuX29mZnNldDtcbiAgICB0aGlzLl9vZmZzZXQgPSAwO1xuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLmZsYXR0ZW5BbmltYXRlZE5vZGVPZmZzZXQodGhpcy5fX2dldE5hdGl2ZVRhZygpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgb2Zmc2V0IHZhbHVlIHRvIHRoZSBiYXNlIHZhbHVlLCBhbmQgcmVzZXRzIHRoZSBiYXNlIHZhbHVlIHRvIHplcm8uXG4gICAqIFRoZSBmaW5hbCBvdXRwdXQgb2YgdGhlIHZhbHVlIGlzIHVuY2hhbmdlZC5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI2V4dHJhY3RvZmZzZXRcbiAgICovXG4gIGV4dHJhY3RPZmZzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5fb2Zmc2V0ICs9IHRoaXMuX3ZhbHVlO1xuICAgIHRoaXMuX3ZhbHVlID0gMDtcbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICBOYXRpdmVBbmltYXRlZEFQSS5leHRyYWN0QW5pbWF0ZWROb2RlT2Zmc2V0KHRoaXMuX19nZXROYXRpdmVUYWcoKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYW4gYXN5bmNocm9ub3VzIGxpc3RlbmVyIHRvIHRoZSB2YWx1ZSBzbyB5b3UgY2FuIG9ic2VydmUgdXBkYXRlcyBmcm9tXG4gICAqIGFuaW1hdGlvbnMuICBUaGlzIGlzIHVzZWZ1bCBiZWNhdXNlIHRoZXJlIGlzIG5vIHdheSB0b1xuICAgKiBzeW5jaHJvbm91c2x5IHJlYWQgdGhlIHZhbHVlIGJlY2F1c2UgaXQgbWlnaHQgYmUgZHJpdmVuIG5hdGl2ZWx5LlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjYWRkbGlzdGVuZXJcbiAgICovXG4gIGFkZExpc3RlbmVyKGNhbGxiYWNrOiBWYWx1ZUxpc3RlbmVyQ2FsbGJhY2spOiBzdHJpbmcge1xuICAgIGNvbnN0IGlkID0gU3RyaW5nKF91bmlxdWVJZCsrKTtcbiAgICB0aGlzLl9saXN0ZW5lcnNbaWRdID0gY2FsbGJhY2s7XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSkge1xuICAgICAgdGhpcy5fc3RhcnRMaXN0ZW5pbmdUb05hdGl2ZVZhbHVlVXBkYXRlcygpO1xuICAgIH1cbiAgICByZXR1cm4gaWQ7XG4gIH1cblxuICAvKipcbiAgICogVW5yZWdpc3RlciBhIGxpc3RlbmVyLiBUaGUgYGlkYCBwYXJhbSBzaGFsbCBtYXRjaCB0aGUgaWRlbnRpZmllclxuICAgKiBwcmV2aW91c2x5IHJldHVybmVkIGJ5IGBhZGRMaXN0ZW5lcigpYC5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI3JlbW92ZWxpc3RlbmVyXG4gICAqL1xuICByZW1vdmVMaXN0ZW5lcihpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgZGVsZXRlIHRoaXMuX2xpc3RlbmVyc1tpZF07XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSAmJiBPYmplY3Qua2V5cyh0aGlzLl9saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5fc3RvcExpc3RlbmluZ0Zvck5hdGl2ZVZhbHVlVXBkYXRlcygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYWxsIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjcmVtb3ZlYWxsbGlzdGVuZXJzXG4gICAqL1xuICByZW1vdmVBbGxMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgdGhpcy5fbGlzdGVuZXJzID0ge307XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSkge1xuICAgICAgdGhpcy5fc3RvcExpc3RlbmluZ0Zvck5hdGl2ZVZhbHVlVXBkYXRlcygpO1xuICAgIH1cbiAgfVxuXG4gIF9zdGFydExpc3RlbmluZ1RvTmF0aXZlVmFsdWVVcGRhdGVzKCkge1xuICAgIGlmICh0aGlzLl9fbmF0aXZlQW5pbWF0ZWRWYWx1ZUxpc3RlbmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgTmF0aXZlQW5pbWF0ZWRBUEkuc3RhcnRMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSk7XG4gICAgdGhpcy5fX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lciA9IE5hdGl2ZUFuaW1hdGVkSGVscGVyLm5hdGl2ZUV2ZW50RW1pdHRlci5hZGRMaXN0ZW5lcihcbiAgICAgICdvbkFuaW1hdGVkVmFsdWVVcGRhdGUnLFxuICAgICAgZGF0YSA9PiB7XG4gICAgICAgIGlmIChkYXRhLnRhZyAhPT0gdGhpcy5fX2dldE5hdGl2ZVRhZygpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZVZhbHVlKGRhdGEudmFsdWUsIGZhbHNlIC8qIGZsdXNoICovKTtcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIF9zdG9wTGlzdGVuaW5nRm9yTmF0aXZlVmFsdWVVcGRhdGVzKCkge1xuICAgIGlmICghdGhpcy5fX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXIucmVtb3ZlKCk7XG4gICAgdGhpcy5fX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lciA9IG51bGw7XG4gICAgTmF0aXZlQW5pbWF0ZWRBUEkuc3RvcExpc3RlbmluZ1RvQW5pbWF0ZWROb2RlVmFsdWUodGhpcy5fX2dldE5hdGl2ZVRhZygpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wcyBhbnkgcnVubmluZyBhbmltYXRpb24gb3IgdHJhY2tpbmcuIGBjYWxsYmFja2AgaXMgaW52b2tlZCB3aXRoIHRoZVxuICAgKiBmaW5hbCB2YWx1ZSBhZnRlciBzdG9wcGluZyB0aGUgYW5pbWF0aW9uLCB3aGljaCBpcyB1c2VmdWwgZm9yIHVwZGF0aW5nXG4gICAqIHN0YXRlIHRvIG1hdGNoIHRoZSBhbmltYXRpb24gcG9zaXRpb24gd2l0aCBsYXlvdXQuXG4gICAqXG4gICAqIFNlZSBodHRwOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbCNzdG9wYW5pbWF0aW9uXG4gICAqL1xuICBzdG9wQW5pbWF0aW9uKGNhbGxiYWNrPzogPyh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5zdG9wVHJhY2tpbmcoKTtcbiAgICB0aGlzLl9hbmltYXRpb24gJiYgdGhpcy5fYW5pbWF0aW9uLnN0b3AoKTtcbiAgICB0aGlzLl9hbmltYXRpb24gPSBudWxsO1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHRoaXMuX19nZXRWYWx1ZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wcyBhbnkgYW5pbWF0aW9uIGFuZCByZXNldHMgdGhlIHZhbHVlIHRvIGl0cyBvcmlnaW5hbC5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI3Jlc2V0YW5pbWF0aW9uXG4gICAqL1xuICByZXNldEFuaW1hdGlvbihjYWxsYmFjaz86ID8odmFsdWU6IG51bWJlcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcEFuaW1hdGlvbihjYWxsYmFjayk7XG4gICAgdGhpcy5fdmFsdWUgPSB0aGlzLl9zdGFydGluZ1ZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEludGVycG9sYXRlcyB0aGUgdmFsdWUgYmVmb3JlIHVwZGF0aW5nIHRoZSBwcm9wZXJ0eSwgZS5nLiBtYXBwaW5nIDAtMSB0b1xuICAgKiAwLTEwLlxuICAgKi9cbiAgaW50ZXJwb2xhdGUoY29uZmlnOiBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZSk6IEFuaW1hdGVkSW50ZXJwb2xhdGlvbiB7XG4gICAgcmV0dXJuIG5ldyBBbmltYXRlZEludGVycG9sYXRpb24odGhpcywgY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUeXBpY2FsbHkgb25seSB1c2VkIGludGVybmFsbHksIGJ1dCBjb3VsZCBiZSB1c2VkIGJ5IGEgY3VzdG9tIEFuaW1hdGlvblxuICAgKiBjbGFzcy5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI2FuaW1hdGVcbiAgICovXG4gIGFuaW1hdGUoYW5pbWF0aW9uOiBBbmltYXRpb24sIGNhbGxiYWNrOiA/RW5kQ2FsbGJhY2spOiB2b2lkIHtcbiAgICBsZXQgaGFuZGxlID0gbnVsbDtcbiAgICBpZiAoYW5pbWF0aW9uLl9faXNJbnRlcmFjdGlvbikge1xuICAgICAgaGFuZGxlID0gSW50ZXJhY3Rpb25NYW5hZ2VyLmNyZWF0ZUludGVyYWN0aW9uSGFuZGxlKCk7XG4gICAgfVxuICAgIGNvbnN0IHByZXZpb3VzQW5pbWF0aW9uID0gdGhpcy5fYW5pbWF0aW9uO1xuICAgIHRoaXMuX2FuaW1hdGlvbiAmJiB0aGlzLl9hbmltYXRpb24uc3RvcCgpO1xuICAgIHRoaXMuX2FuaW1hdGlvbiA9IGFuaW1hdGlvbjtcbiAgICBhbmltYXRpb24uc3RhcnQoXG4gICAgICB0aGlzLl92YWx1ZSxcbiAgICAgIHZhbHVlID0+IHtcbiAgICAgICAgLy8gTmF0aXZlbHkgZHJpdmVuIGFuaW1hdGlvbnMgd2lsbCBuZXZlciBjYWxsIGludG8gdGhhdCBjYWxsYmFjaywgdGhlcmVmb3JlIHdlIGNhbiBhbHdheXNcbiAgICAgICAgLy8gcGFzcyBmbHVzaCA9IHRydWUgdG8gYWxsb3cgdGhlIHVwZGF0ZWQgdmFsdWUgdG8gcHJvcGFnYXRlIHRvIG5hdGl2ZSB3aXRoIHNldE5hdGl2ZVByb3BzXG4gICAgICAgIHRoaXMuX3VwZGF0ZVZhbHVlKHZhbHVlLCB0cnVlIC8qIGZsdXNoICovKTtcbiAgICAgIH0sXG4gICAgICByZXN1bHQgPT4ge1xuICAgICAgICB0aGlzLl9hbmltYXRpb24gPSBudWxsO1xuICAgICAgICBpZiAoaGFuZGxlICE9PSBudWxsKSB7XG4gICAgICAgICAgSW50ZXJhY3Rpb25NYW5hZ2VyLmNsZWFySW50ZXJhY3Rpb25IYW5kbGUoaGFuZGxlKTtcbiAgICAgICAgfVxuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhyZXN1bHQpO1xuICAgICAgfSxcbiAgICAgIHByZXZpb3VzQW5pbWF0aW9uLFxuICAgICAgdGhpcyxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFR5cGljYWxseSBvbmx5IHVzZWQgaW50ZXJuYWxseS5cbiAgICovXG4gIHN0b3BUcmFja2luZygpOiB2b2lkIHtcbiAgICB0aGlzLl90cmFja2luZyAmJiB0aGlzLl90cmFja2luZy5fX2RldGFjaCgpO1xuICAgIHRoaXMuX3RyYWNraW5nID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUeXBpY2FsbHkgb25seSB1c2VkIGludGVybmFsbHkuXG4gICAqL1xuICB0cmFjayh0cmFja2luZzogQW5pbWF0ZWRUcmFja2luZyk6IHZvaWQge1xuICAgIHRoaXMuc3RvcFRyYWNraW5nKCk7XG4gICAgdGhpcy5fdHJhY2tpbmcgPSB0cmFja2luZztcbiAgfVxuXG4gIF91cGRhdGVWYWx1ZSh2YWx1ZTogbnVtYmVyLCBmbHVzaDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gICAgaWYgKGZsdXNoKSB7XG4gICAgICBfZmx1c2godGhpcyk7XG4gICAgfVxuICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuX2xpc3RlbmVycykge1xuICAgICAgdGhpcy5fbGlzdGVuZXJzW2tleV0oe3ZhbHVlOiB0aGlzLl9fZ2V0VmFsdWUoKX0pO1xuICAgIH1cbiAgfVxuXG4gIF9fZ2V0TmF0aXZlQ29uZmlnKCk6IE9iamVjdCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICd2YWx1ZScsXG4gICAgICB2YWx1ZTogdGhpcy5fdmFsdWUsXG4gICAgICBvZmZzZXQ6IHRoaXMuX29mZnNldCxcbiAgICB9O1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQW5pbWF0ZWRWYWx1ZTtcbiJdfQ==