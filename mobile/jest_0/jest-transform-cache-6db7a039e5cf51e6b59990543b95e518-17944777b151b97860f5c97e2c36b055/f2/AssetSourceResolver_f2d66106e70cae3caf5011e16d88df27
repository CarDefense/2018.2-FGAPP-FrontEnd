cbaf093f994482228a6dccb1237f3bd2
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var PixelRatio=require('PixelRatio');var Platform=require('Platform');var assetPathUtils=require('../../local-cli/bundle/assetPathUtils');var invariant=require('fbjs/lib/invariant');function getScaledAssetPath(asset){var scale=AssetSourceResolver.pickScale(asset.scales,PixelRatio.get());var scaleSuffix=scale===1?'':'@'+scale+'x';var assetDir=assetPathUtils.getBasePath(asset);return assetDir+'/'+asset.name+scaleSuffix+'.'+asset.type;}function getAssetPathInDrawableFolder(asset){var scale=AssetSourceResolver.pickScale(asset.scales,PixelRatio.get());var drawbleFolder=assetPathUtils.getAndroidResourceFolderName(asset,scale);var fileName=assetPathUtils.getAndroidResourceIdentifier(asset);return drawbleFolder+'/'+fileName+'.'+asset.type;}var AssetSourceResolver=function(){function AssetSourceResolver(serverUrl,jsbundleUrl,asset){_classCallCheck(this,AssetSourceResolver);this.serverUrl=serverUrl;this.jsbundleUrl=jsbundleUrl;this.asset=asset;}_createClass(AssetSourceResolver,[{key:'isLoadedFromServer',value:function isLoadedFromServer(){return!!this.serverUrl;}},{key:'isLoadedFromFileSystem',value:function isLoadedFromFileSystem(){return!!(this.jsbundleUrl&&this.jsbundleUrl.startsWith('file://'));}},{key:'defaultAsset',value:function defaultAsset(){if(this.isLoadedFromServer()){return this.assetServerURL();}if(Platform.OS==='android'){return this.isLoadedFromFileSystem()?this.drawableFolderInBundle():this.resourceIdentifierWithoutScale();}else{return this.scaledAssetURLNearBundle();}}},{key:'assetServerURL',value:function assetServerURL(){invariant(!!this.serverUrl,'need server to load from');return this.fromSource(this.serverUrl+getScaledAssetPath(this.asset)+'?platform='+Platform.OS+'&hash='+this.asset.hash);}},{key:'scaledAssetPath',value:function scaledAssetPath(){return this.fromSource(getScaledAssetPath(this.asset));}},{key:'scaledAssetURLNearBundle',value:function scaledAssetURLNearBundle(){var path=this.jsbundleUrl||'file://';return this.fromSource(path+getScaledAssetPath(this.asset));}},{key:'resourceIdentifierWithoutScale',value:function resourceIdentifierWithoutScale(){invariant(Platform.OS==='android','resource identifiers work on Android');return this.fromSource(assetPathUtils.getAndroidResourceIdentifier(this.asset));}},{key:'drawableFolderInBundle',value:function drawableFolderInBundle(){var path=this.jsbundleUrl||'file://';return this.fromSource(path+getAssetPathInDrawableFolder(this.asset));}},{key:'fromSource',value:function fromSource(source){return{__packager_asset:true,width:this.asset.width,height:this.asset.height,uri:source,scale:AssetSourceResolver.pickScale(this.asset.scales,PixelRatio.get())};}}],[{key:'pickScale',value:function pickScale(scales,deviceScale){for(var i=0;i<scales.length;i++){if(scales[i]>=deviceScale){return scales[i];}}return scales[scales.length-1]||1;}}]);return AssetSourceResolver;}();module.exports=AssetSourceResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFzc2V0U291cmNlUmVzb2x2ZXIuanMiXSwibmFtZXMiOlsiUGl4ZWxSYXRpbyIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsImFzc2V0UGF0aFV0aWxzIiwiaW52YXJpYW50IiwiZ2V0U2NhbGVkQXNzZXRQYXRoIiwiYXNzZXQiLCJzY2FsZSIsIkFzc2V0U291cmNlUmVzb2x2ZXIiLCJwaWNrU2NhbGUiLCJzY2FsZXMiLCJnZXQiLCJzY2FsZVN1ZmZpeCIsImFzc2V0RGlyIiwiZ2V0QmFzZVBhdGgiLCJuYW1lIiwidHlwZSIsImdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIiLCJkcmF3YmxlRm9sZGVyIiwiZ2V0QW5kcm9pZFJlc291cmNlRm9sZGVyTmFtZSIsImZpbGVOYW1lIiwiZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllciIsInNlcnZlclVybCIsImpzYnVuZGxlVXJsIiwic3RhcnRzV2l0aCIsImlzTG9hZGVkRnJvbVNlcnZlciIsImFzc2V0U2VydmVyVVJMIiwiT1MiLCJpc0xvYWRlZEZyb21GaWxlU3lzdGVtIiwiZHJhd2FibGVGb2xkZXJJbkJ1bmRsZSIsInJlc291cmNlSWRlbnRpZmllcldpdGhvdXRTY2FsZSIsInNjYWxlZEFzc2V0VVJMTmVhckJ1bmRsZSIsImZyb21Tb3VyY2UiLCJoYXNoIiwicGF0aCIsInNvdXJjZSIsIl9fcGFja2FnZXJfYXNzZXQiLCJ3aWR0aCIsImhlaWdodCIsInVyaSIsImRldmljZVNjYWxlIiwiaSIsImxlbmd0aCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBLGEsK29CQVlBLEdBQU1BLFlBQWFDLE9BQWIsY0FBTixDQUNBLEdBQU1DLFVBQVdELE9BQVgsWUFBTixDQUVBLEdBQU1FLGdCQUFpQkYsUUFBUSx1Q0FBUixDQUF2QixDQUNBLEdBQU1HLFdBQVlILE9BQVosc0JBQU4sQ0FLQSxRQUFTSSxtQkFBVCxDQUE0QkMsS0FBNUIsQ0FBMkMsQ0FDekMsR0FBSUMsT0FBUUMsb0JBQW9CQyxT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L0IsS0FBTCxDQUFXK0IsS0FGYixDQUdMQyxPQUFRLEtBQUtoQyxLQUFMLENBQVdnQyxNQUhkLENBSUxDLElBQUtKLE1BSkEsQ0FLTDVCLE1BQU9DLG9CQUFvQkMsU0FBcEIsQ0FBOEIsS0FBS0gsS0FBTCxDQUFXSSxNQUF6QyxDQUFpRFYsV0FBV1csR0FBWCxFQUFqRCxDQUxGLENBQVAsQ0FPRCxDLDhDQUVnQkQsTSxDQUF1QjhCLFcsQ0FBNkIsQ0FFbkUsSUFBSyxHQUFJQyxHQUFJLENBQWIsQ0FBZ0JBLEVBQUkvQixPQUFPZ0MsTUFBM0IsQ0FBbUNELEdBQW5DLENBQXdDLENBQ3RDLEdBQUkvQixPQUFPK0IsQ0FBUCxHQUFhRCxXQUFqQixDQUE4QixDQUM1QixNQUFPOUIsUUFBTytCLENBQVAsQ0FBUCxDQUNELENBQ0YsQ0FLRCxNQUFPL0IsUUFBT0EsT0FBT2dDLE1BQVAsQ0FBZ0IsQ0FBdkIsR0FBNkIsQ0FBcEMsQ0FDRCxDLG1DQUdIQyxPQUFPQyxPQUFQLENBQWlCcEMsbUJBQWpCIiwiZmlsZSI6IkFzc2V0U291cmNlUmVzb2x2ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBwcm92aWRlc01vZHVsZSBBc3NldFNvdXJjZVJlc29sdmVyXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydCB0eXBlIFJlc29sdmVkQXNzZXRTb3VyY2UgPSB7fFxuICArX19wYWNrYWdlcl9hc3NldDogYm9vbGVhbixcbiAgK3dpZHRoOiA/bnVtYmVyLFxuICAraGVpZ2h0OiA/bnVtYmVyLFxuICArdXJpOiBzdHJpbmcsXG4gICtzY2FsZTogbnVtYmVyLFxufH07XG5cbmltcG9ydCB0eXBlIHtQYWNrYWdlckFzc2V0fSBmcm9tICdBc3NldFJlZ2lzdHJ5JztcblxuY29uc3QgUGl4ZWxSYXRpbyA9IHJlcXVpcmUoJ1BpeGVsUmF0aW8nKTtcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnUGxhdGZvcm0nKTtcblxuY29uc3QgYXNzZXRQYXRoVXRpbHMgPSByZXF1aXJlKCcuLi8uLi9sb2NhbC1jbGkvYnVuZGxlL2Fzc2V0UGF0aFV0aWxzJyk7XG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdmYmpzL2xpYi9pbnZhcmlhbnQnKTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgcGF0aCBsaWtlICdhc3NldHMvQXdlc29tZU1vZHVsZS9pY29uQDJ4LnBuZydcbiAqL1xuZnVuY3Rpb24gZ2V0U2NhbGVkQXNzZXRQYXRoKGFzc2V0KTogc3RyaW5nIHtcbiAgdmFyIHNjYWxlID0gQXNzZXRTb3VyY2VSZXNvbHZlci5waWNrU2NhbGUoYXNzZXQuc2NhbGVzLCBQaXhlbFJhdGlvLmdldCgpKTtcbiAgdmFyIHNjYWxlU3VmZml4ID0gc2NhbGUgPT09IDEgPyAnJyA6ICdAJyArIHNjYWxlICsgJ3gnO1xuICB2YXIgYXNzZXREaXIgPSBhc3NldFBhdGhVdGlscy5nZXRCYXNlUGF0aChhc3NldCk7XG4gIHJldHVybiBhc3NldERpciArICcvJyArIGFzc2V0Lm5hbWUgKyBzY2FsZVN1ZmZpeCArICcuJyArIGFzc2V0LnR5cGU7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHBhdGggbGlrZSAnZHJhd2FibGUtbWRwaS9pY29uLnBuZydcbiAqL1xuZnVuY3Rpb24gZ2V0QXNzZXRQYXRoSW5EcmF3YWJsZUZvbGRlcihhc3NldCk6IHN0cmluZyB7XG4gIHZhciBzY2FsZSA9IEFzc2V0U291cmNlUmVzb2x2ZXIucGlja1NjYWxlKGFzc2V0LnNjYWxlcywgUGl4ZWxSYXRpby5nZXQoKSk7XG4gIHZhciBkcmF3YmxlRm9sZGVyID0gYXNzZXRQYXRoVXRpbHMuZ2V0QW5kcm9pZFJlc291cmNlRm9sZGVyTmFtZShhc3NldCwgc2NhbGUpO1xuICB2YXIgZmlsZU5hbWUgPSBhc3NldFBhdGhVdGlscy5nZXRBbmRyb2lkUmVzb3VyY2VJZGVudGlmaWVyKGFzc2V0KTtcbiAgcmV0dXJuIGRyYXdibGVGb2xkZXIgKyAnLycgKyBmaWxlTmFtZSArICcuJyArIGFzc2V0LnR5cGU7XG59XG5cbmNsYXNzIEFzc2V0U291cmNlUmVzb2x2ZXIge1xuICBzZXJ2ZXJVcmw6ID9zdHJpbmc7XG4gIC8vIHdoZXJlIHRoZSBqc2J1bmRsZSBpcyBiZWluZyBydW4gZnJvbVxuICBqc2J1bmRsZVVybDogP3N0cmluZztcbiAgLy8gdGhlIGFzc2V0IHRvIHJlc29sdmVcbiAgYXNzZXQ6IFBhY2thZ2VyQXNzZXQ7XG5cbiAgY29uc3RydWN0b3Ioc2VydmVyVXJsOiA/c3RyaW5nLCBqc2J1bmRsZVVybDogP3N0cmluZywgYXNzZXQ6IFBhY2thZ2VyQXNzZXQpIHtcbiAgICB0aGlzLnNlcnZlclVybCA9IHNlcnZlclVybDtcbiAgICB0aGlzLmpzYnVuZGxlVXJsID0ganNidW5kbGVVcmw7XG4gICAgdGhpcy5hc3NldCA9IGFzc2V0O1xuICB9XG5cbiAgaXNMb2FkZWRGcm9tU2VydmVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMuc2VydmVyVXJsO1xuICB9XG5cbiAgaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEodGhpcy5qc2J1bmRsZVVybCAmJiB0aGlzLmpzYnVuZGxlVXJsLnN0YXJ0c1dpdGgoJ2ZpbGU6Ly8nKSk7XG4gIH1cblxuICBkZWZhdWx0QXNzZXQoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgaWYgKHRoaXMuaXNMb2FkZWRGcm9tU2VydmVyKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmFzc2V0U2VydmVyVVJMKCk7XG4gICAgfVxuXG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgIHJldHVybiB0aGlzLmlzTG9hZGVkRnJvbUZpbGVTeXN0ZW0oKVxuICAgICAgICA/IHRoaXMuZHJhd2FibGVGb2xkZXJJbkJ1bmRsZSgpXG4gICAgICAgIDogdGhpcy5yZXNvdXJjZUlkZW50aWZpZXJXaXRob3V0U2NhbGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuc2NhbGVkQXNzZXRVUkxOZWFyQnVuZGxlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYWJzb2x1dGUgVVJMIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGZldGNoIHRoZSBhc3NldFxuICAgKiBmcm9tIHRoZSBkZXZzZXJ2ZXJcbiAgICovXG4gIGFzc2V0U2VydmVyVVJMKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGludmFyaWFudCghIXRoaXMuc2VydmVyVXJsLCAnbmVlZCBzZXJ2ZXIgdG8gbG9hZCBmcm9tJyk7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShcbiAgICAgIHRoaXMuc2VydmVyVXJsICtcbiAgICAgICAgZ2V0U2NhbGVkQXNzZXRQYXRoKHRoaXMuYXNzZXQpICtcbiAgICAgICAgJz9wbGF0Zm9ybT0nICtcbiAgICAgICAgUGxhdGZvcm0uT1MgK1xuICAgICAgICAnJmhhc2g9JyArXG4gICAgICAgIHRoaXMuYXNzZXQuaGFzaCxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc29sdmVzIHRvIGp1c3QgdGhlIHNjYWxlZCBhc3NldCBmaWxlbmFtZVxuICAgKiBFLmcuICdhc3NldHMvQXdlc29tZU1vZHVsZS9pY29uQDJ4LnBuZydcbiAgICovXG4gIHNjYWxlZEFzc2V0UGF0aCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKGdldFNjYWxlZEFzc2V0UGF0aCh0aGlzLmFzc2V0KSk7XG4gIH1cblxuICAvKipcbiAgICogUmVzb2x2ZXMgdG8gd2hlcmUgdGhlIGJ1bmRsZSBpcyBydW5uaW5nIGZyb20sIHdpdGggYSBzY2FsZWQgYXNzZXQgZmlsZW5hbWVcbiAgICogRS5nLiAnZmlsZTovLy9zZGNhcmQvYnVuZGxlL2Fzc2V0cy9Bd2Vzb21lTW9kdWxlL2ljb25AMngucG5nJ1xuICAgKi9cbiAgc2NhbGVkQXNzZXRVUkxOZWFyQnVuZGxlKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGNvbnN0IHBhdGggPSB0aGlzLmpzYnVuZGxlVXJsIHx8ICdmaWxlOi8vJztcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKHBhdGggKyBnZXRTY2FsZWRBc3NldFBhdGgodGhpcy5hc3NldCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBkZWZhdWx0IGxvY2F0aW9uIG9mIGFzc2V0cyBidW5kbGVkIHdpdGggdGhlIGFwcCwgbG9jYXRlZCBieVxuICAgKiByZXNvdXJjZSBpZGVudGlmaWVyXG4gICAqIFRoZSBBbmRyb2lkIHJlc291cmNlIHN5c3RlbSBwaWNrcyB0aGUgY29ycmVjdCBzY2FsZS5cbiAgICogRS5nLiAnYXNzZXRzX2F3ZXNvbWVtb2R1bGVfaWNvbidcbiAgICovXG4gIHJlc291cmNlSWRlbnRpZmllcldpdGhvdXRTY2FsZSgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnLFxuICAgICAgJ3Jlc291cmNlIGlkZW50aWZpZXJzIHdvcmsgb24gQW5kcm9pZCcsXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKFxuICAgICAgYXNzZXRQYXRoVXRpbHMuZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllcih0aGlzLmFzc2V0KSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRoZSBqc2J1bmRsZSBpcyBydW5uaW5nIGZyb20gYSBzaWRlbG9hZCBsb2NhdGlvbiwgdGhpcyByZXNvbHZlcyBhc3NldHNcbiAgICogcmVsYXRpdmUgdG8gaXRzIGxvY2F0aW9uXG4gICAqIEUuZy4gJ2ZpbGU6Ly8vc2RjYXJkL0F3ZXNvbWVNb2R1bGUvZHJhd2FibGUtbWRwaS9pY29uLnBuZydcbiAgICovXG4gIGRyYXdhYmxlRm9sZGVySW5CdW5kbGUoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgY29uc3QgcGF0aCA9IHRoaXMuanNidW5kbGVVcmwgfHwgJ2ZpbGU6Ly8nO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UocGF0aCArIGdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIodGhpcy5hc3NldCkpO1xuICB9XG5cbiAgZnJvbVNvdXJjZShzb3VyY2U6IHN0cmluZyk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIHJldHVybiB7XG4gICAgICBfX3BhY2thZ2VyX2Fzc2V0OiB0cnVlLFxuICAgICAgd2lkdGg6IHRoaXMuYXNzZXQud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMuYXNzZXQuaGVpZ2h0LFxuICAgICAgdXJpOiBzb3VyY2UsXG4gICAgICBzY2FsZTogQXNzZXRTb3VyY2VSZXNvbHZlci5waWNrU2NhbGUodGhpcy5hc3NldC5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpLFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgcGlja1NjYWxlKHNjYWxlczogQXJyYXk8bnVtYmVyPiwgZGV2aWNlU2NhbGU6IG51bWJlcik6IG51bWJlciB7XG4gICAgLy8gUGFja2FnZXIgZ3VhcmFudGVlcyB0aGF0IGBzY2FsZXNgIGFycmF5IGlzIHNvcnRlZFxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NhbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoc2NhbGVzW2ldID49IGRldmljZVNjYWxlKSB7XG4gICAgICAgIHJldHVybiBzY2FsZXNbaV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSWYgbm90aGluZyBtYXRjaGVzLCBkZXZpY2Ugc2NhbGUgaXMgbGFyZ2VyIHRoYW4gYW55IGF2YWlsYWJsZVxuICAgIC8vIHNjYWxlcywgc28gd2UgcmV0dXJuIHRoZSBiaWdnZXN0IG9uZS4gVW5sZXNzIHRoZSBhcnJheSBpcyBlbXB0eSxcbiAgICAvLyBpbiB3aGljaCBjYXNlIHdlIGRlZmF1bHQgdG8gMVxuICAgIHJldHVybiBzY2FsZXNbc2NhbGVzLmxlbmd0aCAtIDFdIHx8IDE7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBc3NldFNvdXJjZVJlc29sdmVyO1xuIl19