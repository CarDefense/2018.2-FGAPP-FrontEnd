a6013d78348c666912b76b1a0ac3cee5
'use strict';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var _require=require('./AnimatedEvent'),AnimatedEvent=_require.AnimatedEvent;var AnimatedProps=require('./nodes/AnimatedProps');var React=require('React');var ViewStylePropTypes=require('ViewStylePropTypes');var invariant=require('fbjs/lib/invariant');function createAnimatedComponent(Component){var _class,_temp;invariant(typeof Component==='string'||Component.prototype&&Component.prototype.isReactComponent,'`createAnimatedComponent` does not support stateless functional components; '+'use a class component instead.');var AnimatedComponent=(_temp=_class=function(_React$Component){_inherits(AnimatedComponent,_React$Component);function AnimatedComponent(props){_classCallCheck(this,AnimatedComponent);var _this=_possibleConstructorReturn(this,(AnimatedComponent.__proto__||Object.getPrototypeOf(AnimatedComponent)).call(this,props));_this._invokeAnimatedPropsCallbackOnMount=false;_this._eventDetachers=[];_this._animatedPropsCallback=function(){if(_this._component==null){_this._invokeAnimatedPropsCallbackOnMount=true;}else if(AnimatedComponent.__skipSetNativeProps_FOR_TESTS_ONLY||typeof _this._component.setNativeProps!=='function'){_this.forceUpdate();}else if(!_this._propsAnimated.__isNative){_this._component.setNativeProps(_this._propsAnimated.__getAnimatedValue());}else{throw new Error('Attempting to run JS driven animation on animated '+'node that has been moved to "native" earlier by starting an '+'animation with `useNativeDriver: true`');}};_this._setComponentRef=_this._setComponentRef.bind(_this);return _this;}_createClass(AnimatedComponent,[{key:'componentWillUnmount',value:function componentWillUnmount(){this._propsAnimated&&this._propsAnimated.__detach();this._detachNativeEvents();}},{key:'setNativeProps',value:function setNativeProps(props){this._component.setNativeProps(props);}},{key:'UNSAFE_componentWillMount',value:function UNSAFE_componentWillMount(){this._attachProps(this.props);}},{key:'componentDidMount',value:function componentDidMount(){if(this._invokeAnimatedPropsCallbackOnMount){this._invokeAnimatedPropsCallbackOnMount=false;this._animatedPropsCallback();}this._propsAnimated.setNativeView(this._component);this._attachNativeEvents();}},{key:'_attachNativeEvents',value:function _attachNativeEvents(){var _this2=this;var scrollableNode=this._component.getScrollableNode?this._component.getScrollableNode():this._component;var _loop=function _loop(key){var prop=_this2.props[key];if(prop instanceof AnimatedEvent&&prop.__isNative){prop.__attach(scrollableNode,key);_this2._eventDetachers.push(function(){return prop.__detach(scrollableNode,key);});}};for(var key in this.props){_loop(key);}}},{key:'_detachNativeEvents',value:function _detachNativeEvents(){this._eventDetachers.forEach(function(remove){return remove();});this._eventDetachers=[];}},{key:'_attachProps',value:function _attachProps(nextProps){var oldPropsAnimated=this._propsAnimated;this._propsAnimated=new AnimatedProps(nextProps,this._animatedPropsCallback);oldPropsAnimated&&oldPropsAnimated.__detach();}},{key:'UNSAFE_componentWillReceiveProps',value:function UNSAFE_componentWillReceiveProps(newProps){this._attachProps(newProps);}},{key:'componentDidUpdate',value:function componentDidUpdate(prevProps){if(this._component!==this._prevComponent){this._propsAnimated.setNativeView(this._component);}if(this._component!==this._prevComponent||prevProps!==this.props){this._detachNativeEvents();this._attachNativeEvents();}}},{key:'render',value:function render(){var props=this._propsAnimated.__getValue();return React.createElement(Component,_extends({},props,{ref:this._setComponentRef,collapsable:this._propsAnimated.__isNative?false:props.collapsable}));}},{key:'_setComponentRef',value:function _setComponentRef(c){this._prevComponent=this._component;this._component=c;}},{key:'getNode',value:function getNode(){return this._component;}}]);return AnimatedComponent;}(React.Component),_class.__skipSetNativeProps_FOR_TESTS_ONLY=false,_temp);var propTypes=Component.propTypes;AnimatedComponent.propTypes={style:function style(props,propName,componentName){if(!propTypes){return;}for(var key in ViewStylePropTypes){if(!propTypes[key]&&props[key]!==undefined){console.warn('You are setting the style `{ '+key+': ... }` as a prop. You '+'should nest it in a style object. '+'E.g. `{ style: { '+key+': ... } }`');}}}};return AnimatedComponent;}module.exports=createAnimatedComponent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50LmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJBbmltYXRlZEV2ZW50IiwiQW5pbWF0ZWRQcm9wcyIsIlJlYWN0IiwiVmlld1N0eWxlUHJvcFR5cGVzIiwiaW52YXJpYW50IiwiY3JlYXRlQW5pbWF0ZWRDb21wb25lbnQiLCJDb21wb25lbnQiLCJwcm90b3R5cGUiLCJpc1JlYWN0Q29tcG9uZW50IiwiQW5pbWF0ZWRDb21wb25lbnQiLCJwcm9wcyIsIl9pbnZva2VBbmltYXRlZFByb3BzQ2FsbGJhY2tPbk1vdW50IiwiX2V2ZW50RGV0YWNoZXJzIiwiX2FuaW1hdGVkUHJvcHNDYWxsYmFjayIsIl9jb21wb25lbnQiLCJfX3NraXBTZXROYXRpdmVQcm9wc19GT1JfVEVTVFNfT05MWSIsInNldE5hdGl2ZVByb3BzIiwiZm9yY2VVcGRhdGUiLCJfcHJvcHNBbmltYXRlZCIsIl9faXNOYXRpdmUiLCJfX2dldEFuaW1hdGVkVmFsdWUiLCJFcnJvciIsIl9zZXRDb21wb25lbnRSZWYiLCJiaW5kIiwiX19kZXRhY2giLCJfZGV0YWNoTmF0aXZlRXZlbnRzIiwiX2F0dGFjaFByb3BzIiwic2V0TmF0aXZlVmlldyIsIl9hdHRhY2hOYXRpdmVFdmVudHMiLCJzY3JvbGxhYmxlTm9kZSIsImdldFNjcm9sbGFibGVOb2RlIiwia2V5IiwicHJvcCIsIl9fYXR0YWNoIiwicHVzaCIsImZvckVhY2giLCJyZW1vdmUiLCJuZXh0UHJvcHMiLCJvbGRQcm9wc0FuaW1hdGVkIiwibmV3UHJvcHMiLCJwcmV2UHJvcHMiLCJfcHJldkNvbXBvbmVudCIsIl9fZ2V0VmFsdWUiLCJjb2xsYXBzYWJsZSIsImMiLCJwcm9wVHlwZXMiLCJzdHlsZSIsInByb3BOYW1lIiwiY29tcG9uZW50TmFtZSIsInVuZGVmaW5lZCIsImNvbnNvbGUiLCJ3YXJuIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUEsYSx5aERBRXdCQSxRQUFRLGlCQUFS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WXZDLFVBQVV1QyxTQUE1QixDQUVBcEMsa0JBQWtCb0MsU0FBbEIsQ0FBOEIsQ0FDNUJDLE1BQU8sZUFBU3BDLEtBQVQsQ0FBZ0JxQyxRQUFoQixDQUEwQkMsYUFBMUIsQ0FBeUMsQ0FDOUMsR0FBSSxDQUFDSCxTQUFMLENBQWdCLENBQ2QsT0FDRCxDQUVELElBQUssR0FBTWQsSUFBWCxHQUFrQjVCLG1CQUFsQixDQUFzQyxDQUNwQyxHQUFJLENBQUMwQyxVQUFVZCxHQUFWLENBQUQsRUFBbUJyQixNQUFNcUIsR0FBTixJQUFla0IsU0FBdEMsQ0FBaUQsQ0FDL0NDLFFBQVFDLElBQVIsQ0FDRSxnQ0FDRXBCLEdBREYsQ0FFRSwwQkFGRixDQUdFLG9DQUhGLENBSUUsbUJBSkYsQ0FLRUEsR0FMRixDQU1FLFlBUEosRUFTRCxDQUNGLENBQ0YsQ0FuQjJCLENBQTlCLENBc0JBLE1BQU90QixrQkFBUCxDQUNELENBRUQyQyxPQUFPQyxPQUFQLENBQWlCaEQsdUJBQWpCIiwiZmlsZSI6ImNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgY3JlYXRlQW5pbWF0ZWRDb21wb25lbnRcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3Qge0FuaW1hdGVkRXZlbnR9ID0gcmVxdWlyZSgnLi9BbmltYXRlZEV2ZW50Jyk7XG5jb25zdCBBbmltYXRlZFByb3BzID0gcmVxdWlyZSgnLi9ub2Rlcy9BbmltYXRlZFByb3BzJyk7XG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ1JlYWN0Jyk7XG5jb25zdCBWaWV3U3R5bGVQcm9wVHlwZXMgPSByZXF1aXJlKCdWaWV3U3R5bGVQcm9wVHlwZXMnKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50KENvbXBvbmVudDogYW55KTogYW55IHtcbiAgaW52YXJpYW50KFxuICAgIHR5cGVvZiBDb21wb25lbnQgPT09ICdzdHJpbmcnIHx8XG4gICAgICAoQ29tcG9uZW50LnByb3RvdHlwZSAmJiBDb21wb25lbnQucHJvdG90eXBlLmlzUmVhY3RDb21wb25lbnQpLFxuICAgICdgY3JlYXRlQW5pbWF0ZWRDb21wb25lbnRgIGRvZXMgbm90IHN1cHBvcnQgc3RhdGVsZXNzIGZ1bmN0aW9uYWwgY29tcG9uZW50czsgJyArXG4gICAgICAndXNlIGEgY2xhc3MgY29tcG9uZW50IGluc3RlYWQuJyxcbiAgKTtcblxuICBjbGFzcyBBbmltYXRlZENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxPYmplY3Q+IHtcbiAgICBfY29tcG9uZW50OiBhbnk7XG4gICAgX2ludm9rZUFuaW1hdGVkUHJvcHNDYWxsYmFja09uTW91bnQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBfcHJldkNvbXBvbmVudDogYW55O1xuICAgIF9wcm9wc0FuaW1hdGVkOiBBbmltYXRlZFByb3BzO1xuICAgIF9ldmVudERldGFjaGVyczogQXJyYXk8RnVuY3Rpb24+ID0gW107XG4gICAgX3NldENvbXBvbmVudFJlZjogRnVuY3Rpb247XG5cbiAgICBzdGF0aWMgX19za2lwU2V0TmF0aXZlUHJvcHNfRk9SX1RFU1RTX09OTFkgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBPYmplY3QpIHtcbiAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgIHRoaXMuX3NldENvbXBvbmVudFJlZiA9IHRoaXMuX3NldENvbXBvbmVudFJlZi5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgdGhpcy5fcHJvcHNBbmltYXRlZCAmJiB0aGlzLl9wcm9wc0FuaW1hdGVkLl9fZGV0YWNoKCk7XG4gICAgICB0aGlzLl9kZXRhY2hOYXRpdmVFdmVudHMoKTtcbiAgICB9XG5cbiAgICBzZXROYXRpdmVQcm9wcyhwcm9wcykge1xuICAgICAgdGhpcy5fY29tcG9uZW50LnNldE5hdGl2ZVByb3BzKHByb3BzKTtcbiAgICB9XG5cbiAgICBVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgICAgdGhpcy5fYXR0YWNoUHJvcHModGhpcy5wcm9wcyk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICBpZiAodGhpcy5faW52b2tlQW5pbWF0ZWRQcm9wc0NhbGxiYWNrT25Nb3VudCkge1xuICAgICAgICB0aGlzLl9pbnZva2VBbmltYXRlZFByb3BzQ2FsbGJhY2tPbk1vdW50ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2FuaW1hdGVkUHJvcHNDYWxsYmFjaygpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9wcm9wc0FuaW1hdGVkLnNldE5hdGl2ZVZpZXcodGhpcy5fY29tcG9uZW50KTtcbiAgICAgIHRoaXMuX2F0dGFjaE5hdGl2ZUV2ZW50cygpO1xuICAgIH1cblxuICAgIF9hdHRhY2hOYXRpdmVFdmVudHMoKSB7XG4gICAgICAvLyBNYWtlIHN1cmUgdG8gZ2V0IHRoZSBzY3JvbGxhYmxlIG5vZGUgZm9yIGNvbXBvbmVudHMgdGhhdCBpbXBsZW1lbnRcbiAgICAgIC8vIGBTY3JvbGxSZXNwb25kZXIuTWl4aW5gLlxuICAgICAgY29uc3Qgc2Nyb2xsYWJsZU5vZGUgPSB0aGlzLl9jb21wb25lbnQuZ2V0U2Nyb2xsYWJsZU5vZGVcbiAgICAgICAgPyB0aGlzLl9jb21wb25lbnQuZ2V0U2Nyb2xsYWJsZU5vZGUoKVxuICAgICAgICA6IHRoaXMuX2NvbXBvbmVudDtcblxuICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5wcm9wcykge1xuICAgICAgICBjb25zdCBwcm9wID0gdGhpcy5wcm9wc1trZXldO1xuICAgICAgICBpZiAocHJvcCBpbnN0YW5jZW9mIEFuaW1hdGVkRXZlbnQgJiYgcHJvcC5fX2lzTmF0aXZlKSB7XG4gICAgICAgICAgcHJvcC5fX2F0dGFjaChzY3JvbGxhYmxlTm9kZSwga2V5KTtcbiAgICAgICAgICB0aGlzLl9ldmVudERldGFjaGVycy5wdXNoKCgpID0+IHByb3AuX19kZXRhY2goc2Nyb2xsYWJsZU5vZGUsIGtleSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgX2RldGFjaE5hdGl2ZUV2ZW50cygpIHtcbiAgICAgIHRoaXMuX2V2ZW50RGV0YWNoZXJzLmZvckVhY2gocmVtb3ZlID0+IHJlbW92ZSgpKTtcbiAgICAgIHRoaXMuX2V2ZW50RGV0YWNoZXJzID0gW107XG4gICAgfVxuXG4gICAgLy8gVGhlIHN5c3RlbSBpcyBiZXN0IGRlc2lnbmVkIHdoZW4gc2V0TmF0aXZlUHJvcHMgaXMgaW1wbGVtZW50ZWQuIEl0IGlzXG4gICAgLy8gYWJsZSB0byBhdm9pZCByZS1yZW5kZXJpbmcgYW5kIGRpcmVjdGx5IHNldCB0aGUgYXR0cmlidXRlcyB0aGF0IGNoYW5nZWQuXG4gICAgLy8gSG93ZXZlciwgc2V0TmF0aXZlUHJvcHMgY2FuIG9ubHkgYmUgaW1wbGVtZW50ZWQgb24gbGVhZiBuYXRpdmVcbiAgICAvLyBjb21wb25lbnRzLiBJZiB5b3Ugd2FudCB0byBhbmltYXRlIGEgY29tcG9zaXRlIGNvbXBvbmVudCwgeW91IG5lZWQgdG9cbiAgICAvLyByZS1yZW5kZXIgaXQuIEluIHRoaXMgY2FzZSwgd2UgaGF2ZSBhIGZhbGxiYWNrIHRoYXQgdXNlcyBmb3JjZVVwZGF0ZS5cbiAgICBfYW5pbWF0ZWRQcm9wc0NhbGxiYWNrID0gKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuX2NvbXBvbmVudCA9PSBudWxsKSB7XG4gICAgICAgIC8vIEFuaW1hdGVkUHJvcHMgaXMgY3JlYXRlZCBpbiB3aWxsLW1vdW50IGJlY2F1c2UgaXQncyB1c2VkIGluIHJlbmRlci5cbiAgICAgICAgLy8gQnV0IHRoaXMgY2FsbGJhY2sgbWF5IGJlIGludm9rZWQgYmVmb3JlIG1vdW50IGluIGFzeW5jIG1vZGUsXG4gICAgICAgIC8vIEluIHdoaWNoIGNhc2Ugd2Ugc2hvdWxkIGRlZmVyIHRoZSBzZXROYXRpdmVQcm9wcygpIGNhbGwuXG4gICAgICAgIC8vIFJlYWN0IG1heSB0aHJvdyBhd2F5IHVuY29tbWl0dGVkIHdvcmsgaW4gYXN5bmMgbW9kZSxcbiAgICAgICAgLy8gU28gYSBkZWZlcnJlZCBjYWxsIHdvbid0IGFsd2F5cyBiZSBpbnZva2VkLlxuICAgICAgICB0aGlzLl9pbnZva2VBbmltYXRlZFByb3BzQ2FsbGJhY2tPbk1vdW50ID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIEFuaW1hdGVkQ29tcG9uZW50Ll9fc2tpcFNldE5hdGl2ZVByb3BzX0ZPUl9URVNUU19PTkxZIHx8XG4gICAgICAgIHR5cGVvZiB0aGlzLl9jb21wb25lbnQuc2V0TmF0aXZlUHJvcHMgIT09ICdmdW5jdGlvbidcbiAgICAgICkge1xuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgICB9IGVsc2UgaWYgKCF0aGlzLl9wcm9wc0FuaW1hdGVkLl9faXNOYXRpdmUpIHtcbiAgICAgICAgdGhpcy5fY29tcG9uZW50LnNldE5hdGl2ZVByb3BzKFxuICAgICAgICAgIHRoaXMuX3Byb3BzQW5pbWF0ZWQuX19nZXRBbmltYXRlZFZhbHVlKCksXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0F0dGVtcHRpbmcgdG8gcnVuIEpTIGRyaXZlbiBhbmltYXRpb24gb24gYW5pbWF0ZWQgJyArXG4gICAgICAgICAgICAnbm9kZSB0aGF0IGhhcyBiZWVuIG1vdmVkIHRvIFwibmF0aXZlXCIgZWFybGllciBieSBzdGFydGluZyBhbiAnICtcbiAgICAgICAgICAgICdhbmltYXRpb24gd2l0aCBgdXNlTmF0aXZlRHJpdmVyOiB0cnVlYCcsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIF9hdHRhY2hQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICAgIGNvbnN0IG9sZFByb3BzQW5pbWF0ZWQgPSB0aGlzLl9wcm9wc0FuaW1hdGVkO1xuXG4gICAgICB0aGlzLl9wcm9wc0FuaW1hdGVkID0gbmV3IEFuaW1hdGVkUHJvcHMoXG4gICAgICAgIG5leHRQcm9wcyxcbiAgICAgICAgdGhpcy5fYW5pbWF0ZWRQcm9wc0NhbGxiYWNrLFxuICAgICAgKTtcblxuICAgICAgLy8gV2hlbiB5b3UgY2FsbCBkZXRhY2gsIGl0IHJlbW92ZXMgdGhlIGVsZW1lbnQgZnJvbSB0aGUgcGFyZW50IGxpc3RcbiAgICAgIC8vIG9mIGNoaWxkcmVuLiBJZiBpdCBnb2VzIHRvIDAsIHRoZW4gdGhlIHBhcmVudCBhbHNvIGRldGFjaGVzIGl0c2VsZlxuICAgICAgLy8gYW5kIHNvIG9uLlxuICAgICAgLy8gQW4gb3B0aW1pemF0aW9uIGlzIHRvIGF0dGFjaCB0aGUgbmV3IGVsZW1lbnRzIGFuZCBUSEVOIGRldGFjaCB0aGUgb2xkXG4gICAgICAvLyBvbmVzIGluc3RlYWQgb2YgZGV0YWNoaW5nIGFuZCBUSEVOIGF0dGFjaGluZy5cbiAgICAgIC8vIFRoaXMgd2F5IHRoZSBpbnRlcm1lZGlhdGUgc3RhdGUgaXNuJ3QgdG8gZ28gdG8gMCBhbmQgdHJpZ2dlclxuICAgICAgLy8gdGhpcyBleHBlbnNpdmUgcmVjdXJzaXZlIGRldGFjaGluZyB0byB0aGVuIHJlLWF0dGFjaCBldmVyeXRoaW5nIG9uXG4gICAgICAvLyB0aGUgdmVyeSBuZXh0IG9wZXJhdGlvbi5cbiAgICAgIG9sZFByb3BzQW5pbWF0ZWQgJiYgb2xkUHJvcHNBbmltYXRlZC5fX2RldGFjaCgpO1xuICAgIH1cblxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5ld1Byb3BzKSB7XG4gICAgICB0aGlzLl9hdHRhY2hQcm9wcyhuZXdQcm9wcyk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgICAgaWYgKHRoaXMuX2NvbXBvbmVudCAhPT0gdGhpcy5fcHJldkNvbXBvbmVudCkge1xuICAgICAgICB0aGlzLl9wcm9wc0FuaW1hdGVkLnNldE5hdGl2ZVZpZXcodGhpcy5fY29tcG9uZW50KTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLl9jb21wb25lbnQgIT09IHRoaXMuX3ByZXZDb21wb25lbnQgfHwgcHJldlByb3BzICE9PSB0aGlzLnByb3BzKSB7XG4gICAgICAgIHRoaXMuX2RldGFjaE5hdGl2ZUV2ZW50cygpO1xuICAgICAgICB0aGlzLl9hdHRhY2hOYXRpdmVFdmVudHMoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICBjb25zdCBwcm9wcyA9IHRoaXMuX3Byb3BzQW5pbWF0ZWQuX19nZXRWYWx1ZSgpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPENvbXBvbmVudFxuICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICByZWY9e3RoaXMuX3NldENvbXBvbmVudFJlZn1cbiAgICAgICAgICAvLyBUaGUgbmF0aXZlIGRyaXZlciB1cGRhdGVzIHZpZXdzIGRpcmVjdGx5IHRocm91Z2ggdGhlIFVJIHRocmVhZCBzbyB3ZVxuICAgICAgICAgIC8vIGhhdmUgdG8gbWFrZSBzdXJlIHRoZSB2aWV3IGRvZXNuJ3QgZ2V0IG9wdGltaXplZCBhd2F5IGJlY2F1c2UgaXQgY2Fubm90XG4gICAgICAgICAgLy8gZ28gdGhyb3VnaCB0aGUgTmF0aXZlVmlld0hpZXJhcmNoeU1hbmFnZXIgc2luY2UgaXQgb3BlcmF0ZXMgb24gdGhlIHNoYWRvd1xuICAgICAgICAgIC8vIHRocmVhZC5cbiAgICAgICAgICBjb2xsYXBzYWJsZT17XG4gICAgICAgICAgICB0aGlzLl9wcm9wc0FuaW1hdGVkLl9faXNOYXRpdmUgPyBmYWxzZSA6IHByb3BzLmNvbGxhcHNhYmxlXG4gICAgICAgICAgfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG5cbiAgICBfc2V0Q29tcG9uZW50UmVmKGMpIHtcbiAgICAgIHRoaXMuX3ByZXZDb21wb25lbnQgPSB0aGlzLl9jb21wb25lbnQ7XG4gICAgICB0aGlzLl9jb21wb25lbnQgPSBjO1xuICAgIH1cblxuICAgIC8vIEEgdGhpcmQgcGFydHkgbGlicmFyeSBjYW4gdXNlIGdldE5vZGUoKVxuICAgIC8vIHRvIGdldCB0aGUgbm9kZSByZWZlcmVuY2Ugb2YgdGhlIGRlY29yYXRlZCBjb21wb25lbnRcbiAgICBnZXROb2RlKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbXBvbmVudDtcbiAgICB9XG4gIH1cblxuICBjb25zdCBwcm9wVHlwZXMgPSBDb21wb25lbnQucHJvcFR5cGVzO1xuXG4gIEFuaW1hdGVkQ29tcG9uZW50LnByb3BUeXBlcyA9IHtcbiAgICBzdHlsZTogZnVuY3Rpb24ocHJvcHMsIHByb3BOYW1lLCBjb21wb25lbnROYW1lKSB7XG4gICAgICBpZiAoIXByb3BUeXBlcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGZvciAoY29uc3Qga2V5IGluIFZpZXdTdHlsZVByb3BUeXBlcykge1xuICAgICAgICBpZiAoIXByb3BUeXBlc1trZXldICYmIHByb3BzW2tleV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICdZb3UgYXJlIHNldHRpbmcgdGhlIHN0eWxlIGB7ICcgK1xuICAgICAgICAgICAgICBrZXkgK1xuICAgICAgICAgICAgICAnOiAuLi4gfWAgYXMgYSBwcm9wLiBZb3UgJyArXG4gICAgICAgICAgICAgICdzaG91bGQgbmVzdCBpdCBpbiBhIHN0eWxlIG9iamVjdC4gJyArXG4gICAgICAgICAgICAgICdFLmcuIGB7IHN0eWxlOiB7ICcgK1xuICAgICAgICAgICAgICBrZXkgK1xuICAgICAgICAgICAgICAnOiAuLi4gfSB9YCcsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgcmV0dXJuIEFuaW1hdGVkQ29tcG9uZW50O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50O1xuIl19