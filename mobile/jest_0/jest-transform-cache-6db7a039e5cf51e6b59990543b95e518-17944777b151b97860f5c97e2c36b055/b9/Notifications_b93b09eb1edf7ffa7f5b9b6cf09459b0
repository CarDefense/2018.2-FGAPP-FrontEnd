32435ab249200b359aa385fe2dc50e65
Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _fbemitter=require('fbemitter');var _invariant=require('invariant');var _invariant2=_interopRequireDefault(_invariant);var _warning=require('fbjs/lib/warning');var _warning2=_interopRequireDefault(_warning);var _reactNative=require('react-native');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var ExponentNotifications=_reactNative.NativeModules.ExponentNotifications;var _emitter=void 0;var _initialNotification=void 0;function _maybeInitEmitter(){if(!_emitter){_emitter=new _fbemitter.EventEmitter();_reactNative.DeviceEventEmitter.addListener('Exponent.notification',_emitNotification);}}function _emitNotification(notification){if(typeof notification==='string'){notification=JSON.parse(notification);}notification=_extends({},notification);if(typeof notification.data==='string'){try{notification.data=JSON.parse(notification.data);}catch(e){}}_emitter.emit('notification',notification);}function _processNotification(notification){notification=_extends({},notification);if(!notification.data){notification.data={};}if(notification.hasOwnProperty('count')){delete notification.count;}if(_reactNative.Platform.OS==='ios'){if(notification.android){delete notification.android;}if(notification.ios){notification=_extends(notification,notification.ios);delete notification.ios;}}if(_reactNative.Platform.OS==='android'){if(notification.ios){delete notification.ios;}if(notification.android){notification=_extends(notification,notification.android);delete notification.android;}}return notification;}function _validateNotification(notification){if(_reactNative.Platform.OS==='ios'){(0,_invariant2.default)(!!notification.title&&!!notification.body,'Local notifications on iOS require both a title and a body');}else if(_reactNative.Platform.OS==='android'){(0,_invariant2.default)(!!notification.title,'Local notifications on Android require a title');}}var ASYNC_STORAGE_PREFIX='__expo_internal_channel_';var IS_USING_NEW_BINARY=typeof ExponentNotifications.createChannel==='function';function _legacyReadChannel(id){var channelString;return regeneratorRuntime.async(function _legacyReadChannel$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return regeneratorRuntime.awrap(_reactNative.AsyncStorage.getItem(''+ASYNC_STORAGE_PREFIX+id));case 3:channelString=_context.sent;if(!channelString){_context.next=6;break;}return _context.abrupt('return',JSON.parse(channelString));case 6:_context.next=10;break;case 8:_context.prev=8;_context.t0=_context['catch'](0);case 10:return _context.abrupt('return',null);case 11:case'end':return _context.stop();}}},null,this,[[0,8]]);}function _legacyDeleteChannel(id){return _reactNative.AsyncStorage.removeItem(''+ASYNC_STORAGE_PREFIX+id);}if(_reactNative.Platform.OS==='android'){_reactNative.AsyncStorage.clear=function _callee(callback){var keys,result,filteredKeys;return regeneratorRuntime.async(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return regeneratorRuntime.awrap(_reactNative.AsyncStorage.getAllKeys());case 3:keys=_context2.sent;result=null;if(!(keys&&keys.length)){_context2.next=10;break;}filteredKeys=keys.filter(function(key){return!key.startsWith(ASYNC_STORAGE_PREFIX);});_context2.next=9;return regeneratorRuntime.awrap(_reactNative.AsyncStorage.multiRemove(filteredKeys));case 9:result=_context2.sent;case 10:callback&&callback(result);return _context2.abrupt('return',result);case 14:_context2.prev=14;_context2.t0=_context2['catch'](0);callback&&callback(_context2.t0);throw _context2.t0;case 18:case'end':return _context2.stop();}}},null,this,[[0,14]]);};}function _legacySaveChannel(id,channel){return _reactNative.AsyncStorage.setItem(''+ASYNC_STORAGE_PREFIX+id,JSON.stringify(channel));}exports.default={_setInitialNotification:function _setInitialNotification(notification){_initialNotification=notification;},getExpoPushTokenAsync:function getExpoPushTokenAsync(){return ExponentNotifications.getExponentPushTokenAsync();},getDevicePushTokenAsync:ExponentNotifications.getDevicePushTokenAsync,createChannelAndroidAsync:function createChannelAndroidAsync(id,channel){if(_reactNative.Platform.OS==='ios'){console.warn('createChannelAndroidAsync(...) has no effect on iOS');return Promise.resolve();}if(!IS_USING_NEW_BINARY){return _legacySaveChannel(id,channel);}return ExponentNotifications.createChannel(id,channel);},deleteChannelAndroidAsync:function deleteChannelAndroidAsync(id){if(_reactNative.Platform.OS==='ios'){console.warn('deleteChannelAndroidAsync(...) has no effect on iOS');return Promise.resolve();}if(!IS_USING_NEW_BINARY){return Promise.resolve();}return ExponentNotifications.deleteChannel(id);},presentLocalNotificationAsync:function presentLocalNotificationAsync(notification){var _channel;return regeneratorRuntime.async(function presentLocalNotificationAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_validateNotification(notification);notification=_processNotification(notification);if(!(_reactNative.Platform.OS==='ios')){_context3.next=6;break;}return _context3.abrupt('return',ExponentNotifications.presentLocalNotification(notification));case 6:_channel=void 0;if(!notification.channelId){_context3.next=11;break;}_context3.next=10;return regeneratorRuntime.awrap(_legacyReadChannel(notification.channelId));case 10:_channel=_context3.sent;case 11:if(!IS_USING_NEW_BINARY){_context3.next=16;break;}_legacyDeleteChannel(notification.channelId);return _context3.abrupt('return',ExponentNotifications.presentLocalNotificationWithChannel(notification,_channel));case 16:if(_channel){notification.sound=_channel.sound;notification.priority=_channel.priority;notification.vibrate=_channel.vibrate;}return _context3.abrupt('return',ExponentNotifications.presentLocalNotification(notification));case 18:case'end':return _context3.stop();}}},null,this);},scheduleLocalNotificationAsync:function scheduleLocalNotificationAsync(notification){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var now,timeAsDateObj,validOptions,_channel;return regeneratorRuntime.async(function scheduleLocalNotificationAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:now=Date.now();_validateNotification(notification);notification=_processNotification(notification);if(!options.time){_context4.next=10;break;}timeAsDateObj=null;if(options.time&&typeof options.time==='number'){timeAsDateObj=new Date(options.time);if(timeAsDateObj==='Invalid Date'){timeAsDateObj=null;}}else if(options.time&&options.time instanceof Date){timeAsDateObj=options.time;}if(timeAsDateObj){_context4.next=8;break;}throw new Error('Provided value for "time" is invalid. Please verify that it\'s either a number representing Unix Epoch time in milliseconds, or a valid date object.');case 8:(0,_warning2.default)(timeAsDateObj>=now,'Provided value for "time" is before the current date. Did you possibly pass number of seconds since Unix Epoch instead of number of milliseconds?');if(_reactNative.Platform.OS==='ios'){options=_extends({},options,{time:timeAsDateObj.getTime()});}else{options=_extends({},options,{time:timeAsDateObj});}case 10:if(!(options.intervalMs!=null&&options.repeat!=null)){_context4.next=12;break;}throw new Error('Pass either the "repeat" option or "intervalMs" option, not both');case 12:if(!(options.repeat!=null)){_context4.next=16;break;}validOptions=new Set(['minute','hour','day','week','month','year']);if(validOptions.has(options.repeat)){_context4.next=16;break;}throw new Error('Pass one of [\'minute\', \'hour\', \'day\', \'week\', \'month\', \'year\'] as the value for the "repeat" option');case 16:if(!(options.intervalMs!=null)){_context4.next=21;break;}if(!(_reactNative.Platform.OS==='ios')){_context4.next=19;break;}throw new Error('The "intervalMs" option is not supported on iOS');case 19:if(!(options.intervalMs<=0||!Number.isInteger(options.intervalMs))){_context4.next=21;break;}throw new Error('Pass an integer greater than zero as the value for the "intervalMs" option');case 21:if(!(_reactNative.Platform.OS==='ios')){_context4.next=25;break;}return _context4.abrupt('return',ExponentNotifications.scheduleLocalNotification(notification,options));case 25:_channel=void 0;if(!notification.channelId){_context4.next=30;break;}_context4.next=29;return regeneratorRuntime.awrap(_legacyReadChannel(notification.channelId));case 29:_channel=_context4.sent;case 30:if(!IS_USING_NEW_BINARY){_context4.next=35;break;}_legacyDeleteChannel(notification.channelId);return _context4.abrupt('return',ExponentNotifications.scheduleLocalNotificationWithChannel(notification,options,_channel));case 35:if(_channel){notification.sound=_channel.sound;notification.priority=_channel.priority;notification.vibrate=_channel.vibrate;}return _context4.abrupt('return',ExponentNotifications.scheduleLocalNotification(notification,options));case 37:case'end':return _context4.stop();}}},null,this);},dismissNotificationAsync:function dismissNotificationAsync(notificationId){return regeneratorRuntime.async(function dismissNotificationAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(_reactNative.Platform.OS==='android')){_context5.next=4;break;}return _context5.abrupt('return',ExponentNotifications.dismissNotification(notificationId));case 4:throw new Error('Dismissing notifications is not supported on iOS');case 5:case'end':return _context5.stop();}}},null,this);},dismissAllNotificationsAsync:function dismissAllNotificationsAsync(){return regeneratorRuntime.async(function dismissAllNotificationsAsync$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!(_reactNative.Platform.OS==='android')){_context6.next=4;break;}return _context6.abrupt('return',ExponentNotifications.dismissAllNotifications());case 4:throw new Error('Dismissing notifications is not supported on iOS');case 5:case'end':return _context6.stop();}}},null,this);},cancelScheduledNotificationAsync:function cancelScheduledNotificationAsync(notificationId){return ExponentNotifications.cancelScheduledNotification(notificationId);},cancelAllScheduledNotificationsAsync:function cancelAllScheduledNotificationsAsync(){return ExponentNotifications.cancelAllScheduledNotifications();},addListener:function addListener(listener){_maybeInitEmitter();if(_initialNotification){var initialNotification=_initialNotification;_initialNotification=null;setTimeout(function(){_emitNotification(initialNotification);},0);}return _emitter.addListener('notification',listener);},getBadgeNumberAsync:function getBadgeNumberAsync(){return regeneratorRuntime.async(function getBadgeNumberAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(ExponentNotifications.getBadgeNumberAsync){_context7.next=2;break;}return _context7.abrupt('return',0);case 2:return _context7.abrupt('return',ExponentNotifications.getBadgeNumberAsync());case 3:case'end':return _context7.stop();}}},null,this);},setBadgeNumberAsync:function setBadgeNumberAsync(number){return regeneratorRuntime.async(function setBadgeNumberAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(ExponentNotifications.setBadgeNumberAsync){_context8.next=2;break;}return _context8.abrupt('return');case 2:return _context8.abrupt('return',ExponentNotifications.setBadgeNumberAsync(number));case 3:case'end':return _context8.stop();}}},null,this);}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5vdGlmaWNhdGlvbnMuanMiXSwibmFtZXMiOlsiRXhwb25lbnROb3RpZmljYXRpb25zIiwiTmF0aXZlTW9kdWxlcyIsIl9lbWl0dGVyIiwiX2luaXRpYWxOb3RpZmljYXRpb24iLCJfbWF5YmVJbml0RW1pdHRlciIsIkV2ZW50RW1pdHRlciIsIkRldmljZUV2ZW50RW1pdHRlciIsImFkZExpc3RlbmVyIiwiX2VtaXROb3RpZmljYXRpb24iLCJub3RpZmljYXRpb24iLCJKU09OIiwicGFyc2UiLCJkYXRhIiwiZSIsImVtaXQiLCJfcHJvY2Vzc05vdGlmaWNhdGlvbiIsImhhc093blByb3BlcnR5IiwiY291bnQiLCJQbGF0Zm9ybSIsIk9TIiwiYW5kcm9pZCIsImlvcyIsIl92YWxpZGF0ZU5vdGlmaWNhdGlvbiIsInRpdGxlIiwiYm9keSIsIkFTWU5DX1NUT1JBR0VfUFJFRklYIiwiSVNfVVNJTkdfTkVXX0JJTkFSWSIsImNyZWF0ZUNoYW5uZWwiLCJfbGVnYWN5UmVhZENoYW5uZWwiLCJpZCIsIkFzeW5jU3RvcmFnZSIsImdldEl0ZW0iLCJjaGFubmVsU3RyaW5nIiwiX2xlZ2FjeURlbGV0ZUNoYW5uZWwiLCJyZW1vdmVJdGVtIiwiY2xlYXIiLCJjYWxsYmFjayIsImdldEFsbEtleXMiLCJrZXlzIiwicmVzdWx0IiwibGVuZ3RoIiwiZmlsdGVyZWRLZXlzIiwiZmlsdGVyIiwia2V5Iiwic3RhcnRzV2l0aCIsIm11bHRpUmVtb3ZlIiwiX2xlZ2FjeVNhdmVDaGFubmVsIiwiY2hhbm5lbCIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJfc2V0SW5pdGlhbE5vdGlmaWNhdGlvbiIsImdldEV4cG9QdXNoVG9rZW5Bc3luYyIsImdldEV4cG9uZW50UHVzaFRva2VuQXN5bmMiLCJnZXREZXZpY2VQdXNoVG9rZW5Bc3luYyIsImNyZWF0ZUNoYW5uZWxBbmRyb2lkQXN5bmMiLCJjb25zb2xlIiwid2FybiIsIlByb21pc2UiLCJyZXNvbHZlIiwiZGVsZXRlQ2hhbm5lbEFuZHJvaWRBc3luYyIsImRlbGV0ZUNoYW5uZWwiLCJwcmVzZW50TG9jYWxOb3RpZmljYXRpb25Bc3luYyIsInByZXNlbnRMb2NhbE5vdGlmaWNhdGlvbiIsIl9jaGFubmVsIiwiY2hhbm5lbElkIiwicHJlc2VudExvY2FsTm90aWZpY2F0aW9uV2l0aENoYW5uZWwiLCJzb3VuZCIsInByaW9yaXR5IiwidmlicmF0ZSIsInNjaGVkdWxlTG9jYWxOb3RpZmljYXRpb25Bc3luYyIsIm9wdGlvbnMiLCJub3ciLCJEYXRlIiwidGltZSIsInRpbWVBc0RhdGVPYmoiLCJFcnJvciIsImdldFRpbWUiLCJpbnRlcnZhbE1zIiwicmVwZWF0IiwidmFsaWRPcHRpb25zIiwiU2V0IiwiaGFzIiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwic2NoZWR1bGVMb2NhbE5vdGlmaWNhdGlvbiIsInNjaGVkdWxlTG9jYWxOb3RpZmljYXRpb25XaXRoQ2hhbm5lbCIsImRpc21pc3NOb3RpZmljYXRpb25Bc3luYyIsIm5vdGlmaWNhdGlvbklkIiwiZGlzbWlzc05vdGlmaWNhdGlvbiIsImRpc21pc3NBbGxOb3RpZmljYXRpb25zQXN5bmMiLCJkaXNtaXNzQWxsTm90aWZpY2F0aW9ucyIsImNhbmNlbFNjaGVkdWxlZE5vdGlmaWNhdGlvbkFzeW5jIiwiY2FuY2VsU2NoZWR1bGVkTm90aWZpY2F0aW9uIiwiY2FuY2VsQWxsU2NoZWR1bGVkTm90aWZpY2F0aW9uc0FzeW5jIiwiY2FuY2VsQWxsU2NoZWR1bGVkTm90aWZpY2F0aW9ucyIsImxpc3RlbmVyIiwiaW5pdGlhbE5vdGlmaWNhdGlvbiIsInNldFRpbWVvdXQiLCJnZXRCYWRnZU51bWJlckFzeW5jIiwic2V0QmFkZ2VOdW1iZXJBc3luYyIsIm51bWJlciJdLCJtYXBwaW5ncyI6InlSQUVBLG9DQUVBLG9DLG1EQUNBLHlDLCtDQUVBLHlDLHNGQUVRQSxzQixDQUEwQkMsMEIsQ0FBMUJELHFCLENBMkNSLEdBQUlFLGdCQUFKLENBQ0EsR0FBSUMsNEJBQUosQ0FFQSxRQUFTQyxrQkFBVCxFQUE2QixDQUMzQixHQUFJLENBQUNGLFFBQUwsQ0FBZSxDQUNiQSxTQUFXLEdBQUlHLHdCQUFKLEVBQVgsQ0FDQUMsZ0NBQW1CQyxXQUFuQixDQUErQix1QkFBL0IsQ0FBd0RDLGlCQUF4RCxFQUNELENBQ0YsQ0FFRCxRQUFTQSxrQkFBVCxDQUEyQkMsWUFBM0IsQ0FBeUMsQ0FDdkMsR0FBSSxNQUFPQSxhQUFQLEdBQXdCLFFBQTVCLENBQXNDLENBQ3BDQSxhQUFlQyxLQUFLQyxLQUFMLENBQVdGLFlBQVgsQ0FBZixDQUNELENBR0RBLHlCQUFvQkEsWUFBcEIsRUFFQSxHQUFJLE1BQU9BLGNBQWFHLElBQXBCLEdBQTZCLFFBQWpDLENBQTJDLENBQ3pDLEdBQUksQ0FDRkgsYUFBYUcsSUFBYixDQUFvQkYsS0FBS0MsS0FBTCxDQUFXRixhQUFhRyxJQUF4QixDQUFwQixDQUNELENBQUMsTUFBT0MsQ0FBUCxDQUFVLENBRVgsQ0FDRixDQUVEWCxTQUFTWSxJQUFULENBQWMsY0FBZCxDQUE4QkwsWUFBOUIsRUFDRCxDQUVELFFBQVNNLHFCQUFULENBQThCTixZQUE5QixDQUE0QyxDQUMxQ0EsYUFBZSxTQUFjLEVBQWQsQ0FBa0JBLFlBQWxCLENBQWYsQ0FFQSxHQUFJLENBQUNBLGFBQWFHLElBQWxCLENBQXdCLENBQ3RCSCxhQUFhRyxJQUFiLENBQW9CLEVBQXBCLENBQ0QsQ0FFRCxHQUFJSCxhQUFhTyxjQUFiLENBQTRCLE9BQTVCLENBQUosQ0FBMEMsQ0FDeEMsTUFBT1AsY0FBYVEsS0FBcEIsQ0FDRCxDQUdELEdBQUlDLHNCQUFTQyxFQUFULEdBQWdCLEtBQXBCLENBQTJCLENBQ3pCLEdBQUlWLGFBQWFXLE9BQWpCLENBQTBCLENBQ3hCLE1BQU9YLGNBQWFXLE9BQXBCLENBQ0QsQ0FFRCxHQUFJWCxhQUFhWSxHQUFqQixDQUFzQixDQUNwQlosYUFBZSxTQUFjQSxZQUFkLENBQTRCQSxhQUFhWSxHQUF6QyxDQUFmLENBQ0EsTUFBT1osY0FBYVksR0FBcEIsQ0FDRCxDQUNGLENBSUQsR0FBSUgsc0JBQVNDLEVBQVQsR0FBZ0IsU0FBcEIsQ0FBK0IsQ0FDN0IsR0FBSVYsYUFBYVksR0FBakIsQ0FBc0IsQ0FDcEIsTUFBT1osY0FBYVksR0FBcEIsQ0FDRCxDQUVELEdBQUlaLGFBQWFXLE9BQWpCLENBQTBCLENBQ3hCWCxhQUFlLFNBQWNBLFlBQWQsQ0FBNEJBLGFBQWFXLE9BQXpDLENBQWYsQ0FDQSxNQUFPWCxjQUFhVyxPQUFwQixDQUNELENBQ0YsQ0FFRCxNQUFPWCxhQUFQLENBQ0QsQ0FFRCxRQUFTYSxzQkFBVCxDQUErQmIsWUFBL0IsQ0FBNkMsQ0FDM0MsR0FBSVMsc0JBQVNDLEVBQVQsR0FBZ0IsS0FBcEIsQ0FBMkIsQ0FDekIsd0JBQ0UsQ0FBQyxDQUFDVixhQUFhYyxLQUFmLEVBQXdCLENBQUMsQ0FBQ2QsYUFBYWUsSUFEekMsQ0FFRSw0REFGRixFQUlELENBTEQsSUFLTyxJQUFJTixzQkFBU0MsRUFBVCxHQUFnQixTQUFwQixDQUErQixDQUNwQyx3QkFBVSxDQUFDLENBQUNWLGFBQWFjLEtBQXpCLENBQWdDLGdEQUFoQyxFQUNELENBQ0YsQ0FFRCxHQUFJRSxzQkFBdUIsMEJBQTNCLENBR0EsR0FBSUMscUJBQXNCLE1BQU8xQix1QkFBc0IyQixhQUE3QixHQUErQyxVQUF6RSxDQUVBLFFBQWVDLG1CQUFmLENBQWtDQyxFQUFsQywrTUFFOEJDLDBCQUFhQyxPQUFiLElBQXdCTixvQkFBeEIsQ0FBK0NJLEVBQS9DLENBRjlCLFNBRVFHLGFBRlIsbUJBR1FBLGFBSFIseURBSWF0QixLQUFLQyxLQUFMLENBQVdxQixhQUFYLENBSmIsZ0lBT1MsSUFQVCxtRUFVQSxRQUFTQyxxQkFBVCxDQUE4QkosRUFBOUIsQ0FBeUQsQ0FDdkQsTUFBT0MsMkJBQWFJLFVBQWIsSUFBMkJULG9CQUEzQixDQUFrREksRUFBbEQsQ0FBUCxDQUNELENBRUQsR0FBSVgsc0JBQVNDLEVBQVQsR0FBZ0IsU0FBcEIsQ0FBK0IsQ0FDN0JXLDBCQUFhSyxLQUFiLENBQXFCLGlCQUFlQyxRQUFmLG9OQUVBTiwwQkFBYU8sVUFBYixFQUZBLFNBRWJDLElBRmEsZ0JBR2JDLE1BSGEsQ0FHSixJQUhJLE1BSWJELE1BQVFBLEtBQUtFLE1BSkEsNEJBS1hDLFlBTFcsQ0FLSUgsS0FBS0ksTUFBTCxDQUFZLG9CQUFPLENBQUNDLElBQUlDLFVBQUosQ0FBZW5CLG9CQUFmLENBQVIsRUFBWixDQUxKLGtEQU1BSywwQkFBYWUsV0FBYixDQUF5QkosWUFBekIsQ0FOQSxTQU1mRixNQU5lLHdCQVFqQkgsVUFBWUEsU0FBU0csTUFBVCxDQUFaLENBUmlCLGlDQVNWQSxNQVRVLCtEQVdqQkgsVUFBWUEsc0JBQVosQ0FYaUIsc0ZBQXJCLENBZUQsQ0FJRCxRQUFTVSxtQkFBVCxDQUE0QmpCLEVBQTVCLENBQXdDa0IsT0FBeEMsQ0FBeUUsQ0FDdkUsTUFBT2pCLDJCQUFha0IsT0FBYixJQUF3QnZCLG9CQUF4QixDQUErQ0ksRUFBL0MsQ0FBcURuQixLQUFLdUMsU0FBTCxDQUFlRixPQUFmLENBQXJELENBQVAsQ0FDRCxDLGdCQUVjLENBRWJHLHVCQUZhLGtDQUVXekMsWUFGWCxDQUV1QyxDQUNsRE4scUJBQXVCTSxZQUF2QixDQUNELENBSlksQ0FPYjBDLHFCQVBhLGlDQU80QixDQUN2QyxNQUFPbkQsdUJBQXNCb0QseUJBQXRCLEVBQVAsQ0FDRCxDQVRZLENBWWJDLHdCQUF5QnJELHNCQUFzQnFELHVCQVpsQyxDQWNiQyx5QkFkYSxvQ0FjYXpCLEVBZGIsQ0FjeUJrQixPQWR6QixDQWMwRCxDQUNyRSxHQUFJN0Isc0JBQVNDLEVBQVQsR0FBZ0IsS0FBcEIsQ0FBMkIsQ0FDekJvQyxRQUFRQyxJQUFSLENBQWEscURBQWIsRUFDQSxNQUFPQyxTQUFRQyxPQUFSLEVBQVAsQ0FDRCxDQUdELEdBQUksQ0FBQ2hDLG1CQUFMLENBQTBCLENBQ3hCLE1BQU9vQixvQkFBbUJqQixFQUFuQixDQUF1QmtCLE9BQXZCLENBQVAsQ0FDRCxDQUNELE1BQU8vQyx1QkFBc0IyQixhQUF0QixDQUFvQ0UsRUFBcEMsQ0FBd0NrQixPQUF4QyxDQUFQLENBQ0QsQ0F6QlksQ0EyQmJZLHlCQTNCYSxvQ0EyQmE5QixFQTNCYixDQTJCd0MsQ0FDbkQsR0FBSVgsc0JBQVNDLEVBQVQsR0FBZ0IsS0FBcEIsQ0FBMkIsQ0FDekJvQyxRQUFRQyxJQUFSLENBQWEscURBQWIsRUFDQSxNQUFPQyxTQUFRQyxPQUFSLEVBQVAsQ0FDRCxDQUdELEdBQUksQ0FBQ2hDLG1CQUFMLENBQTBCLENBQ3hCLE1BQU8rQixTQUFRQyxPQUFSLEVBQVAsQ0FDRCxDQUNELE1BQU8xRCx1QkFBc0I0RCxhQUF0QixDQUFvQy9CLEVBQXBDLENBQVAsQ0FDRCxDQXRDWSxDQXlDUGdDLDZCQXpDTyx3Q0EwQ1hwRCxZQTFDVyx3SkE0Q1hhLHNCQUFzQmIsWUFBdEIsRUFDQUEsYUFBZU0scUJBQXFCTixZQUFyQixDQUFmLENBN0NXLEtBK0NQUyxzQkFBU0MsRUFBVCxHQUFnQixLQS9DVCw0REFnREZuQixzQkFBc0I4RCx3QkFBdEIsQ0FBK0NyRCxZQUEvQyxDQWhERSxTQWtETHNELFFBbERLLFlBbURMdEQsYUFBYXVELFNBbkRSLDZFQW9EVXBDLG1CQUFtQm5CLGFBQWF1RCxTQUFoQyxDQXBEVixVQW9EUEQsUUFwRE8sNEJBdURMckMsbUJBdkRLLDJCQXlEUE8scUJBQXFCeEIsYUFBYXVELFNBQWxDLEVBekRPLGlDQTBEQWhFLHNCQUFzQmlFLG1DQUF0QixDQUEwRHhELFlBQTFELENBQXdFc0QsUUFBeEUsQ0ExREEsVUE4RFAsR0FBSUEsUUFBSixDQUFjLENBQ1p0RCxhQUFheUQsS0FBYixDQUFxQkgsU0FBU0csS0FBOUIsQ0FDQXpELGFBQWEwRCxRQUFiLENBQXdCSixTQUFTSSxRQUFqQyxDQUNBMUQsYUFBYTJELE9BQWIsQ0FBdUJMLFNBQVNLLE9BQWhDLENBQ0QsQ0FsRU0saUNBbUVBcEUsc0JBQXNCOEQsd0JBQXRCLENBQStDckQsWUFBL0MsQ0FuRUEsNkRBeUVQNEQsOEJBekVPLHlDQTBFWDVELFlBMUVXLEtBMkVYNkQsUUEzRVcsMkRBK0VQLEVBL0VPLHVMQW1GTEMsR0FuRkssQ0FtRkNDLEtBQUtELEdBQUwsRUFuRkQsQ0FzRlhqRCxzQkFBc0JiLFlBQXRCLEVBQ0FBLGFBQWVNLHFCQUFxQk4sWUFBckIsQ0FBZixDQXZGVyxJQTBGUDZELFFBQVFHLElBMUZELDJCQTJGTEMsYUEzRkssQ0EyRlcsSUEzRlgsQ0E0RlQsR0FBSUosUUFBUUcsSUFBUixFQUFnQixNQUFPSCxTQUFRRyxJQUFmLEdBQXdCLFFBQTVDLENBQXNELENBQ3BEQyxjQUFnQixHQUFJRixLQUFKLENBQVNGLFFBQVFHLElBQWpCLENBQWhCLENBRUEsR0FBTUMsYUFBRixHQUFtQyxjQUF2QyxDQUF1RCxDQUNyREEsY0FBZ0IsSUFBaEIsQ0FDRCxDQUNGLENBTkQsSUFNTyxJQUFJSixRQUFRRyxJQUFSLEVBQWdCSCxRQUFRRyxJQUFSLFdBQXdCRCxLQUE1QyxDQUFrRCxDQUN2REUsY0FBZ0JKLFFBQVFHLElBQXhCLENBQ0QsQ0FwR1EsR0F1R0pDLGFBdkdJLCtCQXdHRCxJQUFJQyxNQUFKLHdKQXhHQyxRQStHVCxzQkFDRUQsZUFBaUJILEdBRG5CLHNKQU1BLEdBQUlyRCxzQkFBU0MsRUFBVCxHQUFnQixLQUFwQixDQUEyQixDQUN6Qm1ELG9CQUNLQSxPQURMLEVBRUVHLEtBQU1DLGNBQWNFLE9BQWQsRUFGUixHQUlELENBTEQsSUFLTyxDQUNMTixvQkFDS0EsT0FETCxFQUVFRyxLQUFNQyxhQUZSLEdBSUQsQ0EvSFEsYUFrSVBKLFFBQVFPLFVBQVIsRUFBc0IsSUFBdEIsRUFBOEJQLFFBQVFRLE1BQVIsRUFBa0IsSUFsSXpDLGlDQW1JSCxJQUFJSCxNQUFKLG9FQW5JRyxjQXVJUEwsUUFBUVEsTUFBUixFQUFrQixJQXZJWCw0QkF3SUhDLFlBeElHLENBd0lZLEdBQUlDLElBQUosQ0FBUSxDQUFDLFFBQUQsQ0FBVyxNQUFYLENBQW1CLEtBQW5CLENBQTBCLE1BQTFCLENBQWtDLE9BQWxDLENBQTJDLE1BQTNDLENBQVIsQ0F4SVosSUF5SUpELGFBQWFFLEdBQWIsQ0FBaUJYLFFBQVFRLE1BQXpCLENBeklJLGdDQTBJRCxJQUFJSCxNQUFKLG1IQTFJQyxjQWdKUEwsUUFBUU8sVUFBUixFQUFzQixJQWhKZixpQ0FpSkwzRCxzQkFBU0MsRUFBVCxHQUFnQixLQWpKWCxpQ0FrSkQsSUFBSXdELE1BQUosbURBbEpDLGNBcUpMTCxRQUFRTyxVQUFSLEVBQXNCLENBQXRCLEVBQTJCLENBQUNLLE9BQU9DLFNBQVAsQ0FBaUJiLFFBQVFPLFVBQXpCLENBckp2QixpQ0FzSkQsSUFBSUYsTUFBSiw4RUF0SkMsY0E0SlB6RCxzQkFBU0MsRUFBVCxHQUFnQixLQTVKVCw2REE2SkZuQixzQkFBc0JvRix5QkFBdEIsQ0FBZ0QzRSxZQUFoRCxDQUE4RDZELE9BQTlELENBN0pFLFVBK0pMUCxRQS9KSyxZQWdLTHRELGFBQWF1RCxTQWhLUiw2RUFpS1VwQyxtQkFBbUJuQixhQUFhdUQsU0FBaEMsQ0FqS1YsVUFpS1BELFFBaktPLDRCQW9LTHJDLG1CQXBLSywyQkFzS1BPLHFCQUFxQnhCLGFBQWF1RCxTQUFsQyxFQXRLTyxpQ0F1S0FoRSxzQkFBc0JxRixvQ0FBdEIsQ0FDTDVFLFlBREssQ0FFTDZELE9BRkssQ0FHTFAsUUFISyxDQXZLQSxVQStLUCxHQUFJQSxRQUFKLENBQWMsQ0FDWnRELGFBQWF5RCxLQUFiLENBQXFCSCxTQUFTRyxLQUE5QixDQUNBekQsYUFBYTBELFFBQWIsQ0FBd0JKLFNBQVNJLFFBQWpDLENBQ0ExRCxhQUFhMkQsT0FBYixDQUF1QkwsU0FBU0ssT0FBaEMsQ0FDRCxDQW5MTSxpQ0FvTEFwRSxzQkFBc0JvRix5QkFBdEIsQ0FBZ0QzRSxZQUFoRCxDQUE4RDZELE9BQTlELENBcExBLDZEQTBMUGdCLHdCQTFMTyxtQ0EwTGtCQyxjQTFMbEIsMklBMkxQckUsc0JBQVNDLEVBQVQsR0FBZ0IsU0EzTFQsNERBNExGbkIsc0JBQXNCd0YsbUJBQXRCLENBQTBDRCxjQUExQyxDQTVMRSxjQThMSCxJQUFJWixNQUFKLENBQVUsa0RBQVYsQ0E5TEcsMkRBbU1QYyw0QkFuTU8sc0xBb01QdkUsc0JBQVNDLEVBQVQsR0FBZ0IsU0FwTVQsNERBcU1GbkIsc0JBQXNCMEYsdUJBQXRCLEVBck1FLGNBdU1ILElBQUlmLE1BQUosQ0FBVSxrREFBVixDQXZNRywyREE0TWJnQixnQ0E1TWEsMkNBNE1vQkosY0E1TXBCLENBNE13RSxDQUNuRixNQUFPdkYsdUJBQXNCNEYsMkJBQXRCLENBQWtETCxjQUFsRCxDQUFQLENBQ0QsQ0E5TVksQ0FpTmJNLG9DQWpOYSxnREFpTnlDLENBQ3BELE1BQU83Rix1QkFBc0I4RiwrQkFBdEIsRUFBUCxDQUNELENBbk5ZLENBc05idkYsV0F0TmEsc0JBc05Ed0YsUUF0TkMsQ0FzTnNDLENBQ2pEM0Ysb0JBRUEsR0FBSUQsb0JBQUosQ0FBMEIsQ0FDeEIsR0FBTTZGLHFCQUFzQjdGLG9CQUE1QixDQUNBQSxxQkFBdUIsSUFBdkIsQ0FDQThGLFdBQVcsVUFBTSxDQUNmekYsa0JBQWtCd0YsbUJBQWxCLEVBQ0QsQ0FGRCxDQUVHLENBRkgsRUFHRCxDQUVELE1BQU85RixVQUFTSyxXQUFULENBQXFCLGNBQXJCLENBQXFDd0YsUUFBckMsQ0FBUCxDQUNELENBbE9ZLENBb09QRyxtQkFwT08sa0tBcU9ObEcsc0JBQXNCa0csbUJBck9oQiwyREFzT0YsQ0F0T0UsMENBd09KbEcsc0JBQXNCa0csbUJBQXRCLEVBeE9JLDREQTJPUEMsbUJBM09PLDhCQTJPYUMsTUEzT2Isb0lBNE9OcEcsc0JBQXNCbUcsbUJBNU9oQixvR0ErT0puRyxzQkFBc0JtRyxtQkFBdEIsQ0FBMENDLE1BQTFDLENBL09JLDREIiwiZmlsZSI6Ik5vdGlmaWNhdGlvbnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIsIEV2ZW50U3Vic2NyaXB0aW9uIH0gZnJvbSAnZmJlbWl0dGVyJztcblxuaW1wb3J0IGludmFyaWFudCBmcm9tICdpbnZhcmlhbnQnO1xuaW1wb3J0IHdhcm5pbmcgZnJvbSAnZmJqcy9saWIvd2FybmluZyc7XG5cbmltcG9ydCB7IEFzeW5jU3RvcmFnZSwgRGV2aWNlRXZlbnRFbWl0dGVyLCBOYXRpdmVNb2R1bGVzLCBQbGF0Zm9ybSB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5cbmNvbnN0IHsgRXhwb25lbnROb3RpZmljYXRpb25zIH0gPSBOYXRpdmVNb2R1bGVzO1xuXG50eXBlIE5vdGlmaWNhdGlvbiA9IHtcbiAgb3JpZ2luOiAnc2VsZWN0ZWQnIHwgJ3JlY2VpdmVkJyxcbiAgZGF0YTogYW55LFxuICByZW1vdGU6IGJvb2xlYW4sXG4gIGlzTXVsdGlwbGU6IGJvb2xlYW4sXG59O1xuXG50eXBlIExvY2FsTm90aWZpY2F0aW9uID0ge1xuICB0aXRsZTogc3RyaW5nLFxuICAvLyBIb3cgc2hvdWxkIHdlIGRlYWwgd2l0aCBib2R5IGJlaW5nIHJlcXVpcmVkIG9uIGlPUyBidXQgbm90IG9uIEFuZHJvaWQ/XG4gIGJvZHk/OiBzdHJpbmcsXG4gIGRhdGE/OiBhbnksXG4gIGlvcz86IHtcbiAgICBzb3VuZD86IGJvb2xlYW4sXG4gIH0sXG4gIGFuZHJvaWQ/OiB7XG4gICAgY2hhbm5lbElkPzogc3RyaW5nLFxuICAgIGljb24/OiBzdHJpbmcsXG4gICAgY29sb3I/OiBzdHJpbmcsXG4gICAgc3RpY2t5PzogYm9vbGVhbixcbiAgICBsaW5rPzogc3RyaW5nLFxuICAgIC8vIERFUFJFQ0FURUQ6XG4gICAgc291bmQ/OiBib29sZWFuLFxuICAgIHZpYnJhdGU/OiBib29sZWFuIHwgQXJyYXk8bnVtYmVyPixcbiAgICBwcmlvcml0eTogc3RyaW5nLFxuICB9LFxufTtcblxudHlwZSBDaGFubmVsID0ge1xuICBuYW1lOiBzdHJpbmcsXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nLFxuICBwcmlvcml0eT86IHN0cmluZyxcbiAgc291bmQ/OiBib29sZWFuLFxuICB2aWJyYXRlPzogYm9vbGVhbiB8IEFycmF5PG51bWJlcj4sXG4gIGJhZGdlPzogYm9vbGVhbixcbn07XG5cbi8vIEFuZHJvaWQgYXNzaWducyB1bmlxdWUgbnVtYmVyIHRvIGVhY2ggbm90aWZpY2F0aW9uIG5hdGl2ZWx5LlxuLy8gU2luY2UgdGhhdCdzIG5vdCBzdXBwb3J0ZWQgb24gaU9TLCB3ZSBnZW5lcmF0ZSBhbiB1bmlxdWUgc3RyaW5nLlxudHlwZSBMb2NhbE5vdGlmaWNhdGlvbklkID0gc3RyaW5nIHwgbnVtYmVyO1xuXG5sZXQgX2VtaXR0ZXI7XG5sZXQgX2luaXRpYWxOb3RpZmljYXRpb247XG5cbmZ1bmN0aW9uIF9tYXliZUluaXRFbWl0dGVyKCkge1xuICBpZiAoIV9lbWl0dGVyKSB7XG4gICAgX2VtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgRGV2aWNlRXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKCdFeHBvbmVudC5ub3RpZmljYXRpb24nLCBfZW1pdE5vdGlmaWNhdGlvbik7XG4gIH1cbn1cblxuZnVuY3Rpb24gX2VtaXROb3RpZmljYXRpb24obm90aWZpY2F0aW9uKSB7XG4gIGlmICh0eXBlb2Ygbm90aWZpY2F0aW9uID09PSAnc3RyaW5nJykge1xuICAgIG5vdGlmaWNhdGlvbiA9IEpTT04ucGFyc2Uobm90aWZpY2F0aW9uKTtcbiAgfVxuXG4gIC8qIERvbid0IG11dGF0ZSB0aGUgb3JpZ2luYWwgbm90aWZpY2F0aW9uICovXG4gIG5vdGlmaWNhdGlvbiA9IHsgLi4ubm90aWZpY2F0aW9uIH07XG5cbiAgaWYgKHR5cGVvZiBub3RpZmljYXRpb24uZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICB0cnkge1xuICAgICAgbm90aWZpY2F0aW9uLmRhdGEgPSBKU09OLnBhcnNlKG5vdGlmaWNhdGlvbi5kYXRhKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBJdCdzIGFjdHVhbGx5IGp1c3QgYSBzdHJpbmcsIHRoYXQncyBmaW5lXG4gICAgfVxuICB9XG5cbiAgX2VtaXR0ZXIuZW1pdCgnbm90aWZpY2F0aW9uJywgbm90aWZpY2F0aW9uKTtcbn1cblxuZnVuY3Rpb24gX3Byb2Nlc3NOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKSB7XG4gIG5vdGlmaWNhdGlvbiA9IE9iamVjdC5hc3NpZ24oe30sIG5vdGlmaWNhdGlvbik7XG5cbiAgaWYgKCFub3RpZmljYXRpb24uZGF0YSkge1xuICAgIG5vdGlmaWNhdGlvbi5kYXRhID0ge307XG4gIH1cblxuICBpZiAobm90aWZpY2F0aW9uLmhhc093blByb3BlcnR5KCdjb3VudCcpKSB7XG4gICAgZGVsZXRlIG5vdGlmaWNhdGlvbi5jb3VudDtcbiAgfVxuXG4gIC8vIERlbGV0ZSBhbnkgQW5kcm9pZCBwcm9wZXJ0aWVzIG9uIGlPUyBhbmQgbWVyZ2UgdGhlIGlPUyBwcm9wZXJ0aWVzIG9uIHJvb3Qgbm90aWZpY2F0aW9uIG9iamVjdFxuICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgaWYgKG5vdGlmaWNhdGlvbi5hbmRyb2lkKSB7XG4gICAgICBkZWxldGUgbm90aWZpY2F0aW9uLmFuZHJvaWQ7XG4gICAgfVxuXG4gICAgaWYgKG5vdGlmaWNhdGlvbi5pb3MpIHtcbiAgICAgIG5vdGlmaWNhdGlvbiA9IE9iamVjdC5hc3NpZ24obm90aWZpY2F0aW9uLCBub3RpZmljYXRpb24uaW9zKTtcbiAgICAgIGRlbGV0ZSBub3RpZmljYXRpb24uaW9zO1xuICAgIH1cbiAgfVxuXG4gIC8vIERlbGV0ZSBhbnkgaU9TIHByb3BlcnRpZXMgb24gQW5kcm9pZCBhbmQgbWVyZ2UgdGhlIEFuZHJvaWQgcHJvcGVydGllcyBvbiByb290IG5vdGlmaWNhdGlvblxuICAvLyBvYmplY3RcbiAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICBpZiAobm90aWZpY2F0aW9uLmlvcykge1xuICAgICAgZGVsZXRlIG5vdGlmaWNhdGlvbi5pb3M7XG4gICAgfVxuXG4gICAgaWYgKG5vdGlmaWNhdGlvbi5hbmRyb2lkKSB7XG4gICAgICBub3RpZmljYXRpb24gPSBPYmplY3QuYXNzaWduKG5vdGlmaWNhdGlvbiwgbm90aWZpY2F0aW9uLmFuZHJvaWQpO1xuICAgICAgZGVsZXRlIG5vdGlmaWNhdGlvbi5hbmRyb2lkO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBub3RpZmljYXRpb247XG59XG5cbmZ1bmN0aW9uIF92YWxpZGF0ZU5vdGlmaWNhdGlvbihub3RpZmljYXRpb24pIHtcbiAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgIGludmFyaWFudChcbiAgICAgICEhbm90aWZpY2F0aW9uLnRpdGxlICYmICEhbm90aWZpY2F0aW9uLmJvZHksXG4gICAgICAnTG9jYWwgbm90aWZpY2F0aW9ucyBvbiBpT1MgcmVxdWlyZSBib3RoIGEgdGl0bGUgYW5kIGEgYm9keSdcbiAgICApO1xuICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICBpbnZhcmlhbnQoISFub3RpZmljYXRpb24udGl0bGUsICdMb2NhbCBub3RpZmljYXRpb25zIG9uIEFuZHJvaWQgcmVxdWlyZSBhIHRpdGxlJyk7XG4gIH1cbn1cblxubGV0IEFTWU5DX1NUT1JBR0VfUFJFRklYID0gJ19fZXhwb19pbnRlcm5hbF9jaGFubmVsXyc7XG4vLyBUT0RPOiByZW1vdmUgdGhpcyBiZWZvcmUgcmVsZWFzaW5nXG4vLyB0aGlzIHdpbGwgYWx3YXlzIGJlIGB0cnVlYCBmb3IgU0RLIDI4K1xubGV0IElTX1VTSU5HX05FV19CSU5BUlkgPSB0eXBlb2YgRXhwb25lbnROb3RpZmljYXRpb25zLmNyZWF0ZUNoYW5uZWwgPT09ICdmdW5jdGlvbic7XG5cbmFzeW5jIGZ1bmN0aW9uIF9sZWdhY3lSZWFkQ2hhbm5lbChpZDogc3RyaW5nKTogUHJvbWlzZTxDaGFubmVsIHwgbnVsbD4ge1xuICB0cnkge1xuICAgIGxldCBjaGFubmVsU3RyaW5nID0gYXdhaXQgQXN5bmNTdG9yYWdlLmdldEl0ZW0oYCR7QVNZTkNfU1RPUkFHRV9QUkVGSVh9JHtpZH1gKTtcbiAgICBpZiAoY2hhbm5lbFN0cmluZykge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoY2hhbm5lbFN0cmluZyk7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7fVxuICByZXR1cm4gbnVsbDtcbn1cblxuZnVuY3Rpb24gX2xlZ2FjeURlbGV0ZUNoYW5uZWwoaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gQXN5bmNTdG9yYWdlLnJlbW92ZUl0ZW0oYCR7QVNZTkNfU1RPUkFHRV9QUkVGSVh9JHtpZH1gKTtcbn1cblxuaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgQXN5bmNTdG9yYWdlLmNsZWFyID0gYXN5bmMgZnVuY3Rpb24oY2FsbGJhY2s/OiA/KGVycm9yOiA/RXJyb3IpID0+IHZvaWQpOiBQcm9taXNlIHtcbiAgICB0cnkge1xuICAgICAgbGV0IGtleXMgPSBhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0QWxsS2V5cygpO1xuICAgICAgbGV0IHJlc3VsdCA9IG51bGw7XG4gICAgICBpZiAoa2V5cyAmJiBrZXlzLmxlbmd0aCkge1xuICAgICAgICBsZXQgZmlsdGVyZWRLZXlzID0ga2V5cy5maWx0ZXIoa2V5ID0+ICFrZXkuc3RhcnRzV2l0aChBU1lOQ19TVE9SQUdFX1BSRUZJWCkpO1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBBc3luY1N0b3JhZ2UubXVsdGlSZW1vdmUoZmlsdGVyZWRLZXlzKTtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHJlc3VsdCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGUpO1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gIH07XG59XG5cbi8vIFRoaXMgY29kZXBhdGggd2lsbCBuZXZlciBiZSB0cmlnZ2VyZWQgaW4gU0RLIDI4IGFuZCBhYm92ZVxuLy8gVE9ETzogcmVtb3ZlIGJlZm9yZSByZWxlYXNpbmdcbmZ1bmN0aW9uIF9sZWdhY3lTYXZlQ2hhbm5lbChpZDogc3RyaW5nLCBjaGFubmVsOiBDaGFubmVsKTogUHJvbWlzZTx2b2lkPiB7XG4gIHJldHVybiBBc3luY1N0b3JhZ2Uuc2V0SXRlbShgJHtBU1lOQ19TVE9SQUdFX1BSRUZJWH0ke2lkfWAsIEpTT04uc3RyaW5naWZ5KGNoYW5uZWwpKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICAvKiBPbmx5IHVzZWQgaW50ZXJuYWxseSB0byBpbml0aWFsaXplIHRoZSBub3RpZmljYXRpb24gZnJvbSB0b3AgbGV2ZWwgcHJvcHMgKi9cbiAgX3NldEluaXRpYWxOb3RpZmljYXRpb24obm90aWZpY2F0aW9uOiBOb3RpZmljYXRpb24pIHtcbiAgICBfaW5pdGlhbE5vdGlmaWNhdGlvbiA9IG5vdGlmaWNhdGlvbjtcbiAgfSxcblxuICAvKiBSZS1leHBvcnQgKi9cbiAgZ2V0RXhwb1B1c2hUb2tlbkFzeW5jKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIEV4cG9uZW50Tm90aWZpY2F0aW9ucy5nZXRFeHBvbmVudFB1c2hUb2tlbkFzeW5jKCk7XG4gIH0sXG5cbiAgLyogUmUtZXhwb3J0LCB3ZSBjYW4gYWRkIGZsb3cgaGVyZSBpZiB3ZSB3YW50IGFzIHdlbGwgKi9cbiAgZ2V0RGV2aWNlUHVzaFRva2VuQXN5bmM6IEV4cG9uZW50Tm90aWZpY2F0aW9ucy5nZXREZXZpY2VQdXNoVG9rZW5Bc3luYyxcblxuICBjcmVhdGVDaGFubmVsQW5kcm9pZEFzeW5jKGlkOiBzdHJpbmcsIGNoYW5uZWw6IENoYW5uZWwpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ2NyZWF0ZUNoYW5uZWxBbmRyb2lkQXN5bmMoLi4uKSBoYXMgbm8gZWZmZWN0IG9uIGlPUycpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICAvLyBUaGlzIGNvZGVwYXRoIHdpbGwgbmV2ZXIgYmUgdHJpZ2dlcmVkIGluIFNESyAyOCBhbmQgYWJvdmVcbiAgICAvLyBUT0RPOiByZW1vdmUgYmVmb3JlIHJlbGVhc2luZ1xuICAgIGlmICghSVNfVVNJTkdfTkVXX0JJTkFSWSkge1xuICAgICAgcmV0dXJuIF9sZWdhY3lTYXZlQ2hhbm5lbChpZCwgY2hhbm5lbCk7XG4gICAgfVxuICAgIHJldHVybiBFeHBvbmVudE5vdGlmaWNhdGlvbnMuY3JlYXRlQ2hhbm5lbChpZCwgY2hhbm5lbCk7XG4gIH0sXG5cbiAgZGVsZXRlQ2hhbm5lbEFuZHJvaWRBc3luYyhpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgY29uc29sZS53YXJuKCdkZWxldGVDaGFubmVsQW5kcm9pZEFzeW5jKC4uLikgaGFzIG5vIGVmZmVjdCBvbiBpT1MnKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgLy8gVGhpcyBjb2RlcGF0aCB3aWxsIG5ldmVyIGJlIHRyaWdnZXJlZCBpbiBTREsgMjggYW5kIGFib3ZlXG4gICAgLy8gVE9ETzogcmVtb3ZlIGJlZm9yZSByZWxlYXNpbmdcbiAgICBpZiAoIUlTX1VTSU5HX05FV19CSU5BUlkpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIEV4cG9uZW50Tm90aWZpY2F0aW9ucy5kZWxldGVDaGFubmVsKGlkKTtcbiAgfSxcblxuICAvKiBTaG93cyBhIG5vdGlmaWNhdGlvbiBpbnN0YW50bHkgKi9cbiAgYXN5bmMgcHJlc2VudExvY2FsTm90aWZpY2F0aW9uQXN5bmMoXG4gICAgbm90aWZpY2F0aW9uOiBMb2NhbE5vdGlmaWNhdGlvblxuICApOiBQcm9taXNlPExvY2FsTm90aWZpY2F0aW9uSWQ+IHtcbiAgICBfdmFsaWRhdGVOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKTtcbiAgICBub3RpZmljYXRpb24gPSBfcHJvY2Vzc05vdGlmaWNhdGlvbihub3RpZmljYXRpb24pO1xuXG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgcmV0dXJuIEV4cG9uZW50Tm90aWZpY2F0aW9ucy5wcmVzZW50TG9jYWxOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IF9jaGFubmVsO1xuICAgICAgaWYgKG5vdGlmaWNhdGlvbi5jaGFubmVsSWQpIHtcbiAgICAgICAgX2NoYW5uZWwgPSBhd2FpdCBfbGVnYWN5UmVhZENoYW5uZWwobm90aWZpY2F0aW9uLmNoYW5uZWxJZCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChJU19VU0lOR19ORVdfQklOQVJZKSB7XG4gICAgICAgIC8vIGRlbGV0ZSB0aGUgbGVnYWN5IGNoYW5uZWwgZnJvbSBBc3luY1N0b3JhZ2Ugc28gdGhpcyBjb2RlcGF0aCBpc24ndCB0cmlnZ2VyZWQgYW55bW9yZVxuICAgICAgICBfbGVnYWN5RGVsZXRlQ2hhbm5lbChub3RpZmljYXRpb24uY2hhbm5lbElkKTtcbiAgICAgICAgcmV0dXJuIEV4cG9uZW50Tm90aWZpY2F0aW9ucy5wcmVzZW50TG9jYWxOb3RpZmljYXRpb25XaXRoQ2hhbm5lbChub3RpZmljYXRpb24sIF9jaGFubmVsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRPRE86IHJlbW92ZSB0aGlzIGNvZGVwYXRoIGJlZm9yZSByZWxlYXNpbmcsIGl0IHdpbGwgbmV2ZXIgYmUgdHJpZ2dlcmVkIG9uIFNESyAyOCtcbiAgICAgICAgLy8gY2hhbm5lbCBkb2VzIG5vdCBhY3R1YWxseSBleGlzdCwgc28gYWRkIGl0cyBzZXR0aW5ncyB0byB0aGUgaW5kaXZpZHVhbCBub3RpZmljYXRpb25cbiAgICAgICAgaWYgKF9jaGFubmVsKSB7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLnNvdW5kID0gX2NoYW5uZWwuc291bmQ7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLnByaW9yaXR5ID0gX2NoYW5uZWwucHJpb3JpdHk7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLnZpYnJhdGUgPSBfY2hhbm5lbC52aWJyYXRlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBFeHBvbmVudE5vdGlmaWNhdGlvbnMucHJlc2VudExvY2FsTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbik7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIC8qIFNjaGVkdWxlIGEgbm90aWZpY2F0aW9uIGF0IGEgbGF0ZXIgZGF0ZSAqL1xuICBhc3luYyBzY2hlZHVsZUxvY2FsTm90aWZpY2F0aW9uQXN5bmMoXG4gICAgbm90aWZpY2F0aW9uOiBMb2NhbE5vdGlmaWNhdGlvbixcbiAgICBvcHRpb25zOiB7XG4gICAgICB0aW1lPzogRGF0ZSB8IG51bWJlcixcbiAgICAgIHJlcGVhdD86ICdtaW51dGUnIHwgJ2hvdXInIHwgJ2RheScgfCAnd2VlaycgfCAnbW9udGgnIHwgJ3llYXInLFxuICAgICAgaW50ZXJ2YWxNcz86IG51bWJlcixcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTxMb2NhbE5vdGlmaWNhdGlvbklkPiB7XG4gICAgLy8gc2V0IG5vdyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBtZXRob2QsIHRvIHByZXZlbnQgcG90ZW50aWFsIHdlaXJkIHdhcm5pbmdzIHdoZW4gd2UgdmFsaWRhdGVcbiAgICAvLyBvcHRpb25zLnRpbWUgbGF0ZXIgb25cbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgLy8gVmFsaWRhdGUgYW5kIHByb2Nlc3MgdGhlIG5vdGlmaWNhdGlvbiBkYXRhXG4gICAgX3ZhbGlkYXRlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbik7XG4gICAgbm90aWZpY2F0aW9uID0gX3Byb2Nlc3NOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKTtcblxuICAgIC8vIFZhbGlkYXRlIGBvcHRpb25zLnRpbWVgXG4gICAgaWYgKG9wdGlvbnMudGltZSkge1xuICAgICAgbGV0IHRpbWVBc0RhdGVPYmogPSBudWxsO1xuICAgICAgaWYgKG9wdGlvbnMudGltZSAmJiB0eXBlb2Ygb3B0aW9ucy50aW1lID09PSAnbnVtYmVyJykge1xuICAgICAgICB0aW1lQXNEYXRlT2JqID0gbmV3IERhdGUob3B0aW9ucy50aW1lKTtcbiAgICAgICAgLy8gZ29kLCBKUyBpcyB0aGUgd29yc3RcbiAgICAgICAgaWYgKCgodGltZUFzRGF0ZU9iajogYW55KTogc3RyaW5nKSA9PT0gJ0ludmFsaWQgRGF0ZScpIHtcbiAgICAgICAgICB0aW1lQXNEYXRlT2JqID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChvcHRpb25zLnRpbWUgJiYgb3B0aW9ucy50aW1lIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICB0aW1lQXNEYXRlT2JqID0gb3B0aW9ucy50aW1lO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiB3ZSBjb3VsZG4ndCBjb252ZXJ0IHByb3Blcmx5LCB0aHJvdyBhbiBlcnJvclxuICAgICAgaWYgKCF0aW1lQXNEYXRlT2JqKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgUHJvdmlkZWQgdmFsdWUgZm9yIFwidGltZVwiIGlzIGludmFsaWQuIFBsZWFzZSB2ZXJpZnkgdGhhdCBpdCdzIGVpdGhlciBhIG51bWJlciByZXByZXNlbnRpbmcgVW5peCBFcG9jaCB0aW1lIGluIG1pbGxpc2Vjb25kcywgb3IgYSB2YWxpZCBkYXRlIG9iamVjdC5gXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIElmIHNvbWVvbmUgcGFzc2VzIGluIGEgdmFsdWUgdGhhdCBpcyB0b28gc21hbGwsIHNheSwgYnkgYW4gb3JkZXIgb2YgMTAwMCAoaXQncyBjb21tb24gdG9cbiAgICAgIC8vIGFjY2lkZW50bHkgcGFzcyBzZWNvbmRzIGluc3RlYWQgb2YgbXMpLCBkaXNwbGF5IGEgd2FybmluZy5cbiAgICAgIHdhcm5pbmcoXG4gICAgICAgIHRpbWVBc0RhdGVPYmogPj0gbm93LFxuICAgICAgICBgUHJvdmlkZWQgdmFsdWUgZm9yIFwidGltZVwiIGlzIGJlZm9yZSB0aGUgY3VycmVudCBkYXRlLiBEaWQgeW91IHBvc3NpYmx5IHBhc3MgbnVtYmVyIG9mIHNlY29uZHMgc2luY2UgVW5peCBFcG9jaCBpbnN0ZWFkIG9mIG51bWJlciBvZiBtaWxsaXNlY29uZHM/YFxuICAgICAgKTtcblxuICAgICAgLy8gSWYgaU9TLCBwYXNzIHRpbWUgYXMgbWlsbGlzZWNvbmRzXG4gICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICB0aW1lOiB0aW1lQXNEYXRlT2JqLmdldFRpbWUoKSxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICB0aW1lOiB0aW1lQXNEYXRlT2JqLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmludGVydmFsTXMgIT0gbnVsbCAmJiBvcHRpb25zLnJlcGVhdCAhPSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFBhc3MgZWl0aGVyIHRoZSBcInJlcGVhdFwiIG9wdGlvbiBvciBcImludGVydmFsTXNcIiBvcHRpb24sIG5vdCBib3RoYCk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgb3B0aW9ucy5yZXBlYXRcbiAgICBpZiAob3B0aW9ucy5yZXBlYXQgIT0gbnVsbCkge1xuICAgICAgY29uc3QgdmFsaWRPcHRpb25zID0gbmV3IFNldChbJ21pbnV0ZScsICdob3VyJywgJ2RheScsICd3ZWVrJywgJ21vbnRoJywgJ3llYXInXSk7XG4gICAgICBpZiAoIXZhbGlkT3B0aW9ucy5oYXMob3B0aW9ucy5yZXBlYXQpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgUGFzcyBvbmUgb2YgWydtaW51dGUnLCAnaG91cicsICdkYXknLCAnd2VlaycsICdtb250aCcsICd5ZWFyJ10gYXMgdGhlIHZhbHVlIGZvciB0aGUgXCJyZXBlYXRcIiBvcHRpb25gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuaW50ZXJ2YWxNcyAhPSBudWxsKSB7XG4gICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIFwiaW50ZXJ2YWxNc1wiIG9wdGlvbiBpcyBub3Qgc3VwcG9ydGVkIG9uIGlPU2ApO1xuICAgICAgfVxuXG4gICAgICBpZiAob3B0aW9ucy5pbnRlcnZhbE1zIDw9IDAgfHwgIU51bWJlci5pc0ludGVnZXIob3B0aW9ucy5pbnRlcnZhbE1zKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYFBhc3MgYW4gaW50ZWdlciBncmVhdGVyIHRoYW4gemVybyBhcyB0aGUgdmFsdWUgZm9yIHRoZSBcImludGVydmFsTXNcIiBvcHRpb25gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgcmV0dXJuIEV4cG9uZW50Tm90aWZpY2F0aW9ucy5zY2hlZHVsZUxvY2FsTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbiwgb3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBfY2hhbm5lbDtcbiAgICAgIGlmIChub3RpZmljYXRpb24uY2hhbm5lbElkKSB7XG4gICAgICAgIF9jaGFubmVsID0gYXdhaXQgX2xlZ2FjeVJlYWRDaGFubmVsKG5vdGlmaWNhdGlvbi5jaGFubmVsSWQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoSVNfVVNJTkdfTkVXX0JJTkFSWSkge1xuICAgICAgICAvLyBkZWxldGUgdGhlIGxlZ2FjeSBjaGFubmVsIGZyb20gQXN5bmNTdG9yYWdlIHNvIHRoaXMgY29kZXBhdGggaXNuJ3QgdHJpZ2dlcmVkIGFueW1vcmVcbiAgICAgICAgX2xlZ2FjeURlbGV0ZUNoYW5uZWwobm90aWZpY2F0aW9uLmNoYW5uZWxJZCk7XG4gICAgICAgIHJldHVybiBFeHBvbmVudE5vdGlmaWNhdGlvbnMuc2NoZWR1bGVMb2NhbE5vdGlmaWNhdGlvbldpdGhDaGFubmVsKFxuICAgICAgICAgIG5vdGlmaWNhdGlvbixcbiAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgIF9jaGFubmVsXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUT0RPOiByZW1vdmUgdGhpcyBjb2RlcGF0aCBiZWZvcmUgcmVsZWFzaW5nLCBpdCB3aWxsIG5ldmVyIGJlIHRyaWdnZXJlZCBvbiBTREsgMjgrXG4gICAgICAgIC8vIGNoYW5uZWwgZG9lcyBub3QgYWN0dWFsbHkgZXhpc3QsIHNvIGFkZCBpdHMgc2V0dGluZ3MgdG8gdGhlIGluZGl2aWR1YWwgbm90aWZpY2F0aW9uXG4gICAgICAgIGlmIChfY2hhbm5lbCkge1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi5zb3VuZCA9IF9jaGFubmVsLnNvdW5kO1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi5wcmlvcml0eSA9IF9jaGFubmVsLnByaW9yaXR5O1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi52aWJyYXRlID0gX2NoYW5uZWwudmlicmF0ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gRXhwb25lbnROb3RpZmljYXRpb25zLnNjaGVkdWxlTG9jYWxOb3RpZmljYXRpb24obm90aWZpY2F0aW9uLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgLyogRGlzbWlzcyBjdXJyZW50bHkgc2hvd24gbm90aWZpY2F0aW9uIHdpdGggSUQgKEFuZHJvaWQgb25seSkgKi9cbiAgYXN5bmMgZGlzbWlzc05vdGlmaWNhdGlvbkFzeW5jKG5vdGlmaWNhdGlvbklkOiBMb2NhbE5vdGlmaWNhdGlvbklkKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgIHJldHVybiBFeHBvbmVudE5vdGlmaWNhdGlvbnMuZGlzbWlzc05vdGlmaWNhdGlvbihub3RpZmljYXRpb25JZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGlzbWlzc2luZyBub3RpZmljYXRpb25zIGlzIG5vdCBzdXBwb3J0ZWQgb24gaU9TJyk7XG4gICAgfVxuICB9LFxuXG4gIC8qIERpc21pc3MgYWxsIGN1cnJlbnRseSBzaG93biBub3RpZmljYXRpb25zIChBbmRyb2lkIG9ubHkpICovXG4gIGFzeW5jIGRpc21pc3NBbGxOb3RpZmljYXRpb25zQXN5bmMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgIHJldHVybiBFeHBvbmVudE5vdGlmaWNhdGlvbnMuZGlzbWlzc0FsbE5vdGlmaWNhdGlvbnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEaXNtaXNzaW5nIG5vdGlmaWNhdGlvbnMgaXMgbm90IHN1cHBvcnRlZCBvbiBpT1MnKTtcbiAgICB9XG4gIH0sXG5cbiAgLyogQ2FuY2VsIHNjaGVkdWxlZCBub3RpZmljYXRpb24gbm90aWZpY2F0aW9uIHdpdGggSUQgKi9cbiAgY2FuY2VsU2NoZWR1bGVkTm90aWZpY2F0aW9uQXN5bmMobm90aWZpY2F0aW9uSWQ6IExvY2FsTm90aWZpY2F0aW9uSWQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gRXhwb25lbnROb3RpZmljYXRpb25zLmNhbmNlbFNjaGVkdWxlZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb25JZCk7XG4gIH0sXG5cbiAgLyogQ2FuY2VsIGFsbCBzY2hlZHVsZWQgbm90aWZpY2F0aW9ucyAqL1xuICBjYW5jZWxBbGxTY2hlZHVsZWROb3RpZmljYXRpb25zQXN5bmMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIEV4cG9uZW50Tm90aWZpY2F0aW9ucy5jYW5jZWxBbGxTY2hlZHVsZWROb3RpZmljYXRpb25zKCk7XG4gIH0sXG5cbiAgLyogUHJpbWFyeSBwdWJsaWMgYXBpICovXG4gIGFkZExpc3RlbmVyKGxpc3RlbmVyOiBGdW5jdGlvbik6IEV2ZW50U3Vic2NyaXB0aW9uIHtcbiAgICBfbWF5YmVJbml0RW1pdHRlcigpO1xuXG4gICAgaWYgKF9pbml0aWFsTm90aWZpY2F0aW9uKSB7XG4gICAgICBjb25zdCBpbml0aWFsTm90aWZpY2F0aW9uID0gX2luaXRpYWxOb3RpZmljYXRpb247XG4gICAgICBfaW5pdGlhbE5vdGlmaWNhdGlvbiA9IG51bGw7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgX2VtaXROb3RpZmljYXRpb24oaW5pdGlhbE5vdGlmaWNhdGlvbik7XG4gICAgICB9LCAwKTtcbiAgICB9XG5cbiAgICByZXR1cm4gX2VtaXR0ZXIuYWRkTGlzdGVuZXIoJ25vdGlmaWNhdGlvbicsIGxpc3RlbmVyKTtcbiAgfSxcblxuICBhc3luYyBnZXRCYWRnZU51bWJlckFzeW5jKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgaWYgKCFFeHBvbmVudE5vdGlmaWNhdGlvbnMuZ2V0QmFkZ2VOdW1iZXJBc3luYykge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHJldHVybiBFeHBvbmVudE5vdGlmaWNhdGlvbnMuZ2V0QmFkZ2VOdW1iZXJBc3luYygpO1xuICB9LFxuXG4gIGFzeW5jIHNldEJhZGdlTnVtYmVyQXN5bmMobnVtYmVyOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIUV4cG9uZW50Tm90aWZpY2F0aW9ucy5zZXRCYWRnZU51bWJlckFzeW5jKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiBFeHBvbmVudE5vdGlmaWNhdGlvbnMuc2V0QmFkZ2VOdW1iZXJBc3luYyhudW1iZXIpO1xuICB9LFxufTtcbiJdfQ==