83d92a2fdd3976345bfdb895b1bbed44
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var AnimatedValue=require('../nodes/AnimatedValue');var AnimatedValueXY=require('../nodes/AnimatedValueXY');var Animation=require('./Animation');var _require=require('../NativeAnimatedHelper'),shouldUseNativeDriver=_require.shouldUseNativeDriver;var _easeInOut=void 0;function easeInOut(){if(!_easeInOut){var Easing=require('Easing');_easeInOut=Easing.inOut(Easing.ease);}return _easeInOut;}var TimingAnimation=function(_Animation){_inherits(TimingAnimation,_Animation);function TimingAnimation(config){_classCallCheck(this,TimingAnimation);var _this=_possibleConstructorReturn(this,(TimingAnimation.__proto__||Object.getPrototypeOf(TimingAnimation)).call(this));_this._toValue=config.toValue;_this._easing=config.easing!==undefined?config.easing:easeInOut();_this._duration=config.duration!==undefined?config.duration:500;_this._delay=config.delay!==undefined?config.delay:0;_this.__iterations=config.iterations!==undefined?config.iterations:1;_this.__isInteraction=config.isInteraction!==undefined?config.isInteraction:true;_this._useNativeDriver=shouldUseNativeDriver(config);return _this;}_createClass(TimingAnimation,[{key:'__getNativeAnimationConfig',value:function __getNativeAnimationConfig(){var frameDuration=1000.0/60.0;var frames=[];for(var dt=0.0;dt<this._duration;dt+=frameDuration){frames.push(this._easing(dt/this._duration));}frames.push(this._easing(1));return{type:'frames',frames:frames,toValue:this._toValue,iterations:this.__iterations};}},{key:'start',value:function start(fromValue,onUpdate,onEnd,previousAnimation,animatedValue){var _this2=this;this.__active=true;this._fromValue=fromValue;this._onUpdate=onUpdate;this.__onEnd=onEnd;var start=function start(){if(_this2._duration===0&&!_this2._useNativeDriver){_this2._onUpdate(_this2._toValue);_this2.__debouncedOnEnd({finished:true});}else{_this2._startTime=Date.now();if(_this2._useNativeDriver){_this2.__startNativeAnimation(animatedValue);}else{_this2._animationFrame=requestAnimationFrame(_this2.onUpdate.bind(_this2));}}};if(this._delay){this._timeout=setTimeout(start,this._delay);}else{start();}}},{key:'onUpdate',value:function onUpdate(){var now=Date.now();if(now>=this._startTime+this._duration){if(this._duration===0){this._onUpdate(this._toValue);}else{this._onUpdate(this._fromValue+this._easing(1)*(this._toValue-this._fromValue));}this.__debouncedOnEnd({finished:true});return;}this._onUpdate(this._fromValue+this._easing((now-this._startTime)/this._duration)*(this._toValue-this._fromValue));if(this.__active){this._animationFrame=requestAnimationFrame(this.onUpdate.bind(this));}}},{key:'stop',value:function stop(){_get(TimingAnimation.prototype.__proto__||Object.getPrototypeOf(TimingAnimation.prototype),'stop',this).call(this);this.__active=false;clearTimeout(this._timeout);global.cancelAnimationFrame(this._animationFrame);this.__debouncedOnEnd({finished:false});}}]);return TimingAnimation;}(Animation);module.exports=TimingAnimation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRpbWluZ0FuaW1hdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZFZhbHVlIiwicmVxdWlyZSIsIkFuaW1hdGVkVmFsdWVYWSIsIkFuaW1hdGlvbiIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIl9lYXNlSW5PdXQiLCJlYXNlSW5PdXQiLCJFYXNpbmciLCJpbk91dCIsImVhc2UiLCJUaW1pbmdBbmltYXRpb24iLCJjb25maWciLCJfdG9WYWx1ZSIsInRvVmFsdWUiLCJfZWFzaW5nIiwiZWFzaW5nIiwidW5kZWZpbmVkIiwiX2R1cmF0aW9uIiwiZHVyYXRpb24iLCJfZGVsYXkiLCJkZWxheSIsIl9faXRlcmF0aW9ucyIsIml0ZXJhdGlvbnMiLCJfX2lzSW50ZXJhY3Rpb24iLCJpc0ludGVyYWN0aW9uIiwiX3VzZU5hdGl2ZURyaXZlciIsImZyYW1lRHVyYXRpb24iLCJmcmFtZXMiLCJkdCIsInB1c2giLCJ0eXBlIiwiZnJvbVZhbHVlIiwib25VcGRhdGUiLCJvbkVuZCIsInByZXZpb3VzQW5pbWF0aW9uIiwiYW5pbWF0ZWRWYWx1ZSIsIl9fYWN0aXZlIiwiX2Zyb21WYWx1ZSIsIl9vblVwZGF0ZSIsIl9fb25FbmQiLCJzdGFydCIsIl9fZGVib3VuY2VkT25FbmQiLCJmaW5pc2hlZCIsIl9zdGFydFRpbWUiLCJEYXRlIiwibm93IiwiX19zdGFydE5hdGl2ZUFuaW1hdGlvbiIsIl9hbmltYXRpb25GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJfdGltZW91dCIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJnbG9iYWwiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBLGEsNHREQUVBLEdBQU1BLGVBQWdCQyxRQUFRLHdCQUFSLENBQXRCLENBQ0EsR0FBTUMsaUJBQWtCRCxRQUFRLDBCQUFSLENBQXhCLENBQ0EsR0FBTUUsV0FBWUYsUUFBUSxhQUFSLENBQWxCLEMsYUFF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R0FBSUEsS0FBTyxLQUFLRixVQUFMLENBQWtCLEtBQUsxQixTQUFsQyxDQUE2QyxDQUMzQyxHQUFJLEtBQUtBLFNBQUwsR0FBbUIsQ0FBdkIsQ0FBMEIsQ0FDeEIsS0FBS3FCLFNBQUwsQ0FBZSxLQUFLMUIsUUFBcEIsRUFDRCxDQUZELElBRU8sQ0FDTCxLQUFLMEIsU0FBTCxDQUNFLEtBQUtELFVBQUwsQ0FBa0IsS0FBS3ZCLE9BQUwsQ0FBYSxDQUFiLEdBQW1CLEtBQUtGLFFBQUwsQ0FBZ0IsS0FBS3lCLFVBQXhDLENBRHBCLEVBR0QsQ0FDRCxLQUFLSSxnQkFBTCxDQUFzQixDQUFDQyxTQUFVLElBQVgsQ0FBdEIsRUFDQSxPQUNELENBRUQsS0FBS0osU0FBTCxDQUNFLEtBQUtELFVBQUwsQ0FDRSxLQUFLdkIsT0FBTCxDQUFhLENBQUMrQixJQUFNLEtBQUtGLFVBQVosRUFBMEIsS0FBSzFCLFNBQTVDLEdBQ0csS0FBS0wsUUFBTCxDQUFnQixLQUFLeUIsVUFEeEIsQ0FGSixFQUtBLEdBQUksS0FBS0QsUUFBVCxDQUFtQixDQUNqQixLQUFLVyxlQUFMLENBQXVCQyxzQkFBc0IsS0FBS2hCLFFBQUwsQ0FBY2lCLElBQWQsQ0FBbUIsSUFBbkIsQ0FBdEIsQ0FBdkIsQ0FDRCxDQUNGLEMsbUNBRVksQ0FDWCxtSEFDQSxLQUFLYixRQUFMLENBQWdCLEtBQWhCLENBQ0FnQixhQUFhLEtBQUtGLFFBQWxCLEVBQ0FHLE9BQU9DLG9CQUFQLENBQTRCLEtBQUtQLGVBQWpDLEVBQ0EsS0FBS04sZ0JBQUwsQ0FBc0IsQ0FBQ0MsU0FBVSxLQUFYLENBQXRCLEVBQ0QsQyw2QkExRzJCdkMsUyxFQTZHOUJvRCxPQUFPQyxPQUFQLENBQWlCOUMsZUFBakIiLCJmaWxlIjoiVGltaW5nQW5pbWF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgVGltaW5nQW5pbWF0aW9uXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkVmFsdWUgPSByZXF1aXJlKCcuLi9ub2Rlcy9BbmltYXRlZFZhbHVlJyk7XG5jb25zdCBBbmltYXRlZFZhbHVlWFkgPSByZXF1aXJlKCcuLi9ub2Rlcy9BbmltYXRlZFZhbHVlWFknKTtcbmNvbnN0IEFuaW1hdGlvbiA9IHJlcXVpcmUoJy4vQW5pbWF0aW9uJyk7XG5cbmNvbnN0IHtzaG91bGRVc2VOYXRpdmVEcml2ZXJ9ID0gcmVxdWlyZSgnLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXInKTtcblxuaW1wb3J0IHR5cGUge0FuaW1hdGlvbkNvbmZpZywgRW5kQ2FsbGJhY2t9IGZyb20gJy4vQW5pbWF0aW9uJztcblxuZXhwb3J0IHR5cGUgVGltaW5nQW5pbWF0aW9uQ29uZmlnID0gQW5pbWF0aW9uQ29uZmlnICYge1xuICB0b1ZhbHVlOiBudW1iZXIgfCBBbmltYXRlZFZhbHVlIHwge3g6IG51bWJlciwgeTogbnVtYmVyfSB8IEFuaW1hdGVkVmFsdWVYWSxcbiAgZWFzaW5nPzogKHZhbHVlOiBudW1iZXIpID0+IG51bWJlcixcbiAgZHVyYXRpb24/OiBudW1iZXIsXG4gIGRlbGF5PzogbnVtYmVyLFxufTtcblxuZXhwb3J0IHR5cGUgVGltaW5nQW5pbWF0aW9uQ29uZmlnU2luZ2xlID0gQW5pbWF0aW9uQ29uZmlnICYge1xuICB0b1ZhbHVlOiBudW1iZXIgfCBBbmltYXRlZFZhbHVlLFxuICBlYXNpbmc/OiAodmFsdWU6IG51bWJlcikgPT4gbnVtYmVyLFxuICBkdXJhdGlvbj86IG51bWJlcixcbiAgZGVsYXk/OiBudW1iZXIsXG59O1xuXG5sZXQgX2Vhc2VJbk91dDtcbmZ1bmN0aW9uIGVhc2VJbk91dCgpIHtcbiAgaWYgKCFfZWFzZUluT3V0KSB7XG4gICAgY29uc3QgRWFzaW5nID0gcmVxdWlyZSgnRWFzaW5nJyk7XG4gICAgX2Vhc2VJbk91dCA9IEVhc2luZy5pbk91dChFYXNpbmcuZWFzZSk7XG4gIH1cbiAgcmV0dXJuIF9lYXNlSW5PdXQ7XG59XG5cbmNsYXNzIFRpbWluZ0FuaW1hdGlvbiBleHRlbmRzIEFuaW1hdGlvbiB7XG4gIF9zdGFydFRpbWU6IG51bWJlcjtcbiAgX2Zyb21WYWx1ZTogbnVtYmVyO1xuICBfdG9WYWx1ZTogYW55O1xuICBfZHVyYXRpb246IG51bWJlcjtcbiAgX2RlbGF5OiBudW1iZXI7XG4gIF9lYXNpbmc6ICh2YWx1ZTogbnVtYmVyKSA9PiBudW1iZXI7XG4gIF9vblVwZGF0ZTogKHZhbHVlOiBudW1iZXIpID0+IHZvaWQ7XG4gIF9hbmltYXRpb25GcmFtZTogYW55O1xuICBfdGltZW91dDogYW55O1xuICBfdXNlTmF0aXZlRHJpdmVyOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogVGltaW5nQW5pbWF0aW9uQ29uZmlnU2luZ2xlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl90b1ZhbHVlID0gY29uZmlnLnRvVmFsdWU7XG4gICAgdGhpcy5fZWFzaW5nID0gY29uZmlnLmVhc2luZyAhPT0gdW5kZWZpbmVkID8gY29uZmlnLmVhc2luZyA6IGVhc2VJbk91dCgpO1xuICAgIHRoaXMuX2R1cmF0aW9uID0gY29uZmlnLmR1cmF0aW9uICE9PSB1bmRlZmluZWQgPyBjb25maWcuZHVyYXRpb24gOiA1MDA7XG4gICAgdGhpcy5fZGVsYXkgPSBjb25maWcuZGVsYXkgIT09IHVuZGVmaW5lZCA/IGNvbmZpZy5kZWxheSA6IDA7XG4gICAgdGhpcy5fX2l0ZXJhdGlvbnMgPSBjb25maWcuaXRlcmF0aW9ucyAhPT0gdW5kZWZpbmVkID8gY29uZmlnLml0ZXJhdGlvbnMgOiAxO1xuICAgIHRoaXMuX19pc0ludGVyYWN0aW9uID1cbiAgICAgIGNvbmZpZy5pc0ludGVyYWN0aW9uICE9PSB1bmRlZmluZWQgPyBjb25maWcuaXNJbnRlcmFjdGlvbiA6IHRydWU7XG4gICAgdGhpcy5fdXNlTmF0aXZlRHJpdmVyID0gc2hvdWxkVXNlTmF0aXZlRHJpdmVyKGNvbmZpZyk7XG4gIH1cblxuICBfX2dldE5hdGl2ZUFuaW1hdGlvbkNvbmZpZygpOiBhbnkge1xuICAgIGNvbnN0IGZyYW1lRHVyYXRpb24gPSAxMDAwLjAgLyA2MC4wO1xuICAgIGNvbnN0IGZyYW1lcyA9IFtdO1xuICAgIGZvciAobGV0IGR0ID0gMC4wOyBkdCA8IHRoaXMuX2R1cmF0aW9uOyBkdCArPSBmcmFtZUR1cmF0aW9uKSB7XG4gICAgICBmcmFtZXMucHVzaCh0aGlzLl9lYXNpbmcoZHQgLyB0aGlzLl9kdXJhdGlvbikpO1xuICAgIH1cbiAgICBmcmFtZXMucHVzaCh0aGlzLl9lYXNpbmcoMSkpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnZnJhbWVzJyxcbiAgICAgIGZyYW1lcyxcbiAgICAgIHRvVmFsdWU6IHRoaXMuX3RvVmFsdWUsXG4gICAgICBpdGVyYXRpb25zOiB0aGlzLl9faXRlcmF0aW9ucyxcbiAgICB9O1xuICB9XG5cbiAgc3RhcnQoXG4gICAgZnJvbVZhbHVlOiBudW1iZXIsXG4gICAgb25VcGRhdGU6ICh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkLFxuICAgIG9uRW5kOiA/RW5kQ2FsbGJhY2ssXG4gICAgcHJldmlvdXNBbmltYXRpb246ID9BbmltYXRpb24sXG4gICAgYW5pbWF0ZWRWYWx1ZTogQW5pbWF0ZWRWYWx1ZSxcbiAgKTogdm9pZCB7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5fZnJvbVZhbHVlID0gZnJvbVZhbHVlO1xuICAgIHRoaXMuX29uVXBkYXRlID0gb25VcGRhdGU7XG4gICAgdGhpcy5fX29uRW5kID0gb25FbmQ7XG5cbiAgICBjb25zdCBzdGFydCA9ICgpID0+IHtcbiAgICAgIC8vIEFuaW1hdGlvbnMgdGhhdCBzb21ldGltZXMgaGF2ZSAwIGR1cmF0aW9uIGFuZCBzb21ldGltZXMgZG8gbm90XG4gICAgICAvLyBzdGlsbCBuZWVkIHRvIHVzZSB0aGUgbmF0aXZlIGRyaXZlciB3aGVuIGR1cmF0aW9uIGlzIDAgc28gYXMgdG9cbiAgICAgIC8vIG5vdCBjYXVzZSBpbnRlcm1peGVkIEpTIGFuZCBuYXRpdmUgYW5pbWF0aW9ucy5cbiAgICAgIGlmICh0aGlzLl9kdXJhdGlvbiA9PT0gMCAmJiAhdGhpcy5fdXNlTmF0aXZlRHJpdmVyKSB7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlKHRoaXMuX3RvVmFsdWUpO1xuICAgICAgICB0aGlzLl9fZGVib3VuY2VkT25FbmQoe2ZpbmlzaGVkOiB0cnVlfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBpZiAodGhpcy5fdXNlTmF0aXZlRHJpdmVyKSB7XG4gICAgICAgICAgdGhpcy5fX3N0YXJ0TmF0aXZlQW5pbWF0aW9uKGFuaW1hdGVkVmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKFxuICAgICAgICAgICAgdGhpcy5vblVwZGF0ZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIGlmICh0aGlzLl9kZWxheSkge1xuICAgICAgdGhpcy5fdGltZW91dCA9IHNldFRpbWVvdXQoc3RhcnQsIHRoaXMuX2RlbGF5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhcnQoKTtcbiAgICB9XG4gIH1cblxuICBvblVwZGF0ZSgpOiB2b2lkIHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGlmIChub3cgPj0gdGhpcy5fc3RhcnRUaW1lICsgdGhpcy5fZHVyYXRpb24pIHtcbiAgICAgIGlmICh0aGlzLl9kdXJhdGlvbiA9PT0gMCkge1xuICAgICAgICB0aGlzLl9vblVwZGF0ZSh0aGlzLl90b1ZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlKFxuICAgICAgICAgIHRoaXMuX2Zyb21WYWx1ZSArIHRoaXMuX2Vhc2luZygxKSAqICh0aGlzLl90b1ZhbHVlIC0gdGhpcy5fZnJvbVZhbHVlKSxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX19kZWJvdW5jZWRPbkVuZCh7ZmluaXNoZWQ6IHRydWV9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9vblVwZGF0ZShcbiAgICAgIHRoaXMuX2Zyb21WYWx1ZSArXG4gICAgICAgIHRoaXMuX2Vhc2luZygobm93IC0gdGhpcy5fc3RhcnRUaW1lKSAvIHRoaXMuX2R1cmF0aW9uKSAqXG4gICAgICAgICAgKHRoaXMuX3RvVmFsdWUgLSB0aGlzLl9mcm9tVmFsdWUpLFxuICAgICk7XG4gICAgaWYgKHRoaXMuX19hY3RpdmUpIHtcbiAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSk7XG4gICAgfVxuICB9XG5cbiAgc3RvcCgpOiB2b2lkIHtcbiAgICBzdXBlci5zdG9wKCk7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IGZhbHNlO1xuICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KTtcbiAgICBnbG9iYWwuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5fYW5pbWF0aW9uRnJhbWUpO1xuICAgIHRoaXMuX19kZWJvdW5jZWRPbkVuZCh7ZmluaXNoZWQ6IGZhbHNlfSk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBUaW1pbmdBbmltYXRpb247XG4iXX0=