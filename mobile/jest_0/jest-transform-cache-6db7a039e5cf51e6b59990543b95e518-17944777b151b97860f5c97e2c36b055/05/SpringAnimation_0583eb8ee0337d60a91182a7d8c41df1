5e39ffffbb6af89ec9b72221cd3664e3
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var AnimatedValue=require('../nodes/AnimatedValue');var AnimatedValueXY=require('../nodes/AnimatedValueXY');var Animation=require('./Animation');var SpringConfig=require('../SpringConfig');var invariant=require('fbjs/lib/invariant');var _require=require('../NativeAnimatedHelper'),shouldUseNativeDriver=_require.shouldUseNativeDriver;function withDefault(value,defaultValue){if(value===undefined||value===null){return defaultValue;}return value;}var SpringAnimation=function(_Animation){_inherits(SpringAnimation,_Animation);function SpringAnimation(config){_classCallCheck(this,SpringAnimation);var _this=_possibleConstructorReturn(this,(SpringAnimation.__proto__||Object.getPrototypeOf(SpringAnimation)).call(this));_this._overshootClamping=withDefault(config.overshootClamping,false);_this._restDisplacementThreshold=withDefault(config.restDisplacementThreshold,0.001);_this._restSpeedThreshold=withDefault(config.restSpeedThreshold,0.001);_this._initialVelocity=withDefault(config.velocity,0);_this._lastVelocity=withDefault(config.velocity,0);_this._toValue=config.toValue;_this._delay=withDefault(config.delay,0);_this._useNativeDriver=shouldUseNativeDriver(config);_this.__isInteraction=config.isInteraction!==undefined?config.isInteraction:true;_this.__iterations=config.iterations!==undefined?config.iterations:1;if(config.stiffness!==undefined||config.damping!==undefined||config.mass!==undefined){invariant(config.bounciness===undefined&&config.speed===undefined&&config.tension===undefined&&config.friction===undefined,'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');_this._stiffness=withDefault(config.stiffness,100);_this._damping=withDefault(config.damping,10);_this._mass=withDefault(config.mass,1);}else if(config.bounciness!==undefined||config.speed!==undefined){invariant(config.tension===undefined&&config.friction===undefined&&config.stiffness===undefined&&config.damping===undefined&&config.mass===undefined,'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');var springConfig=SpringConfig.fromBouncinessAndSpeed(withDefault(config.bounciness,8),withDefault(config.speed,12));_this._stiffness=springConfig.stiffness;_this._damping=springConfig.damping;_this._mass=1;}else{var _springConfig=SpringConfig.fromOrigamiTensionAndFriction(withDefault(config.tension,40),withDefault(config.friction,7));_this._stiffness=_springConfig.stiffness;_this._damping=_springConfig.damping;_this._mass=1;}invariant(_this._stiffness>0,'Stiffness value must be greater than 0');invariant(_this._damping>0,'Damping value must be greater than 0');invariant(_this._mass>0,'Mass value must be greater than 0');return _this;}_createClass(SpringAnimation,[{key:'__getNativeAnimationConfig',value:function __getNativeAnimationConfig(){return{type:'spring',overshootClamping:this._overshootClamping,restDisplacementThreshold:this._restDisplacementThreshold,restSpeedThreshold:this._restSpeedThreshold,stiffness:this._stiffness,damping:this._damping,mass:this._mass,initialVelocity:withDefault(this._initialVelocity,this._lastVelocity),toValue:this._toValue,iterations:this.__iterations};}},{key:'start',value:function start(fromValue,onUpdate,onEnd,previousAnimation,animatedValue){var _this2=this;this.__active=true;this._startPosition=fromValue;this._lastPosition=this._startPosition;this._onUpdate=onUpdate;this.__onEnd=onEnd;this._lastTime=Date.now();this._frameTime=0.0;if(previousAnimation instanceof SpringAnimation){var internalState=previousAnimation.getInternalState();this._lastPosition=internalState.lastPosition;this._lastVelocity=internalState.lastVelocity;this._initialVelocity=this._lastVelocity;this._lastTime=internalState.lastTime;}var start=function start(){if(_this2._useNativeDriver){_this2.__startNativeAnimation(animatedValue);}else{_this2.onUpdate();}};if(this._delay){this._timeout=setTimeout(start,this._delay);}else{start();}}},{key:'getInternalState',value:function getInternalState(){return{lastPosition:this._lastPosition,lastVelocity:this._lastVelocity,lastTime:this._lastTime};}},{key:'onUpdate',value:function onUpdate(){var MAX_STEPS=64;var now=Date.now();if(now>this._lastTime+MAX_STEPS){now=this._lastTime+MAX_STEPS;}var deltaTime=(now-this._lastTime)/1000;this._frameTime+=deltaTime;var c=this._damping;var m=this._mass;var k=this._stiffness;var v0=-this._initialVelocity;var zeta=c/(2*Math.sqrt(k*m));var omega0=Math.sqrt(k/m);var omega1=omega0*Math.sqrt(1.0-zeta*zeta);var x0=this._toValue-this._startPosition;var position=0.0;var velocity=0.0;var t=this._frameTime;if(zeta<1){var envelope=Math.exp(-zeta*omega0*t);position=this._toValue-envelope*((v0+zeta*omega0*x0)/omega1*Math.sin(omega1*t)+x0*Math.cos(omega1*t));velocity=zeta*omega0*envelope*(Math.sin(omega1*t)*(v0+zeta*omega0*x0)/omega1+x0*Math.cos(omega1*t))-envelope*(Math.cos(omega1*t)*(v0+zeta*omega0*x0)-omega1*x0*Math.sin(omega1*t));}else{var _envelope=Math.exp(-omega0*t);position=this._toValue-_envelope*(x0+(v0+omega0*x0)*t);velocity=_envelope*(v0*(t*omega0-1)+t*x0*(omega0*omega0));}this._lastTime=now;this._lastPosition=position;this._lastVelocity=velocity;this._onUpdate(position);if(!this.__active){return;}var isOvershooting=false;if(this._overshootClamping&&this._stiffness!==0){if(this._startPosition<this._toValue){isOvershooting=position>this._toValue;}else{isOvershooting=position<this._toValue;}}var isVelocity=Math.abs(velocity)<=this._restSpeedThreshold;var isDisplacement=true;if(this._stiffness!==0){isDisplacement=Math.abs(this._toValue-position)<=this._restDisplacementThreshold;}if(isOvershooting||isVelocity&&isDisplacement){if(this._stiffness!==0){this._lastPosition=this._toValue;this._lastVelocity=0;this._onUpdate(this._toValue);}this.__debouncedOnEnd({finished:true});return;}this._animationFrame=requestAnimationFrame(this.onUpdate.bind(this));}},{key:'stop',value:function stop(){_get(SpringAnimation.prototype.__proto__||Object.getPrototypeOf(SpringAnimation.prototype),'stop',this).call(this);this.__active=false;clearTimeout(this._timeout);global.cancelAnimationFrame(this._animationFrame);this.__debouncedOnEnd({finished:false});}}]);return SpringAnimation;}(Animation);module.exports=SpringAnimation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNwcmluZ0FuaW1hdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZFZhbHVlIiwicmVxdWlyZSIsIkFuaW1hdGVkVmFsdWVYWSIsIkFuaW1hdGlvbiIsIlNwcmluZ0NvbmZpZyIsImludmFyaWFudCIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIndpdGhEZWZhdWx0IiwidmFsdWUiLCJkZWZhdWx0VmFsdWUiLCJ1bmRlZmluZWQiLCJTcHJpbmdBbmltYXRpb24iLCJjb25maWciLCJfb3ZlcnNob290Q2xhbXBpbmciLCJvdmVyc2hvb3RDbGFtcGluZyIsIl9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkIiwicmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCIsIl9yZXN0U3BlZWRUaHJlc2hvbGQiLCJyZXN0U3BlZWRUaHJlc2hvbGQiLCJfaW5pdGlhbFZlbG9jaXR5IiwidmVsb2NpdHkiLCJfbGFzdFZlbG9jaXR5IiwiX3RvVmFsdWUiLCJ0b1ZhbHVlIiwiX2RlbGF5IiwiZGVsYXkiLCJfdXNlTmF0aXZlRHJpdmVyIiwiX19pc0ludGVyYWN0aW9uIiwiaXNJbnRlcmFjdGlvbiIsIl9faXRlcmF0aW9ucyIsIml0ZXJhdGlvbnMiLCJzdGlmZm5lc3MiLCJkYW1waW5nIiwibWFzcyIsImJvdW5jaW5lc3MiLCJzcGVlZCIsInRlbnNpb24iLCJmcmljdGlvbiIsIl9zdGlmZm5lc3MiLCJfZGFtcGluZyIsIl9tYXNzIiwic3ByaW5nQ29uZmlnIiwiZnJvbUJvdW5jaW5lc3NBbmRTcGVlZCIsImZyb21PcmlnYW1pVGVuc2lvbkFuZEZyaWN0aW9uIiwidHlwZSIsImluaXRpYWxWZWxvY2l0eSIsImZyb21WYWx1ZSIsIm9uVXBkYXRlIiwib25FbmQiLCJwcmV2aW91c0FuaW1hdGlvbiIsImFuaW1hdGVkVmFsdWUiLCJfX2FjdGl2ZSIsIl9zdGFydFBvc2l0aW9uIiwiX2xhc3RQb3NpdGlvbiIsIl9vblVwZGF0ZSIsIl9fb25FbmQiLCJfbGFzdFRpbWUiLCJEYXRlIiwibm93IiwiX2ZyYW1lVGltZSIsImludGVybmFsU3RhdGUiLCJnZXRJbnRlcm5hbFN0YXRlIiwibGFzdFBvc2l0aW9uIiwibGFzdFZlbG9jaXR5IiwibGFzdFRpbWUiLCJzdGFydCIsIl9fc3RhcnROYXRpdmVBbmltYXRpb24iLCJfdGltZW91dCIsInNldFRpbWVvdXQiLCJNQVhfU1RFUFMiLCJkZWx0YVRpbWUiLCJjIiwibSIsImsiLCJ2MCIsInpldGEiLCJNYXRoIiwic3FydCIsIm9tZWdhMCIsIm9tZWdhMSIsIngwIiwicG9zaXRpb24iLCJ0IiwiZW52ZWxvcGUiLCJleHAiLCJzaW4iLCJjb3MiLCJpc092ZXJzaG9vdGluZyIsImlzVmVsb2NpdHkiLCJhYnMiLCJpc0Rpc3BsYWNlbWVudCIsIl9fZGVib3VuY2VkT25FbmQiLCJmaW5pc2hlZCIsIl9hbmltYXRpb25GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJjbGVhclRpbWVvdXQiLCJnbG9iYWwiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBLGEsNHREQUVBLEdBQU1BLGVBQWdCQyxRQUFRLHdCQUFSLENBQXRCLENBQ0EsR0FBTUMsaUJBQWtCRCxRQUFRLDBCQUFSLENBQXhCLENBQ0EsR0FBTUUsV0FBWUYsUUFBUSxhQUFSLENBQWxCLENBQ0EsR0FBTUcsY0FBZUgsUUFBUSxpQkFBUixDQUFyQixDQUVBLEdBQU1JLFdBQVlKLE9BQVosc0JBQU4sQyxhQUNnQ0EsUUFBUSx5QkFBUixDLENBQXpCSyxxQixVQUFBQSxxQixDQW9DUCxRQUFTQyxZQUFULENBQXdCQyxLQUF4QixDQUFtQ0MsWUFBbkMsQ0FBdUQsQ0FDckQsR0FBSUQsUUFBVUUsU0FBVixFQUF1QkYsUUFBVSxJQUFyQyxDQUEyQyxDQUN6QyxNQUFPQyxhQUFQLENBQ0QsQ0FDRCxNQUFPRCxNQUFQLENBQ0QsQyxHQUVLRyxnQiw0REFzQkoseUJBQVlDLE1BQVosQ0FBaUQsaUtBRy9DLE1BQUtDLGtCQUFMLENB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LENBQXVCQyxzQkFBc0IsS0FBSy9DLFFBQUwsQ0FBY2dELElBQWQsQ0FBbUIsSUFBbkIsQ0FBdEIsQ0FBdkIsQ0FDRCxDLG1DQUVZLENBQ1gsbUhBQ0EsS0FBSzVDLFFBQUwsQ0FBZ0IsS0FBaEIsQ0FDQTZDLGFBQWEsS0FBSzdCLFFBQWxCLEVBQ0E4QixPQUFPQyxvQkFBUCxDQUE0QixLQUFLTCxlQUFqQyxFQUNBLEtBQUtGLGdCQUFMLENBQXNCLENBQUNDLFNBQVUsS0FBWCxDQUF0QixFQUNELEMsNkJBblIyQnpGLFMsRUFzUjlCZ0csT0FBT0MsT0FBUCxDQUFpQnpGLGVBQWpCIiwiZmlsZSI6IlNwcmluZ0FuaW1hdGlvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIFNwcmluZ0FuaW1hdGlvblxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBBbmltYXRlZFZhbHVlID0gcmVxdWlyZSgnLi4vbm9kZXMvQW5pbWF0ZWRWYWx1ZScpO1xuY29uc3QgQW5pbWF0ZWRWYWx1ZVhZID0gcmVxdWlyZSgnLi4vbm9kZXMvQW5pbWF0ZWRWYWx1ZVhZJyk7XG5jb25zdCBBbmltYXRpb24gPSByZXF1aXJlKCcuL0FuaW1hdGlvbicpO1xuY29uc3QgU3ByaW5nQ29uZmlnID0gcmVxdWlyZSgnLi4vU3ByaW5nQ29uZmlnJyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuY29uc3Qge3Nob3VsZFVzZU5hdGl2ZURyaXZlcn0gPSByZXF1aXJlKCcuLi9OYXRpdmVBbmltYXRlZEhlbHBlcicpO1xuXG5pbXBvcnQgdHlwZSB7QW5pbWF0aW9uQ29uZmlnLCBFbmRDYWxsYmFja30gZnJvbSAnLi9BbmltYXRpb24nO1xuXG5leHBvcnQgdHlwZSBTcHJpbmdBbmltYXRpb25Db25maWcgPSBBbmltYXRpb25Db25maWcgJiB7XG4gIHRvVmFsdWU6IG51bWJlciB8IEFuaW1hdGVkVmFsdWUgfCB7eDogbnVtYmVyLCB5OiBudW1iZXJ9IHwgQW5pbWF0ZWRWYWx1ZVhZLFxuICBvdmVyc2hvb3RDbGFtcGluZz86IGJvb2xlYW4sXG4gIHJlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQ/OiBudW1iZXIsXG4gIHJlc3RTcGVlZFRocmVzaG9sZD86IG51bWJlcixcbiAgdmVsb2NpdHk/OiBudW1iZXIgfCB7eDogbnVtYmVyLCB5OiBudW1iZXJ9LFxuICBib3VuY2luZXNzPzogbnVtYmVyLFxuICBzcGVlZD86IG51bWJlcixcbiAgdGVuc2lvbj86IG51bWJlcixcbiAgZnJpY3Rpb24/OiBudW1iZXIsXG4gIHN0aWZmbmVzcz86IG51bWJlcixcbiAgZGFtcGluZz86IG51bWJlcixcbiAgbWFzcz86IG51bWJlcixcbiAgZGVsYXk/OiBudW1iZXIsXG59O1xuXG5leHBvcnQgdHlwZSBTcHJpbmdBbmltYXRpb25Db25maWdTaW5nbGUgPSBBbmltYXRpb25Db25maWcgJiB7XG4gIHRvVmFsdWU6IG51bWJlciB8IEFuaW1hdGVkVmFsdWUsXG4gIG92ZXJzaG9vdENsYW1waW5nPzogYm9vbGVhbixcbiAgcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZD86IG51bWJlcixcbiAgcmVzdFNwZWVkVGhyZXNob2xkPzogbnVtYmVyLFxuICB2ZWxvY2l0eT86IG51bWJlcixcbiAgYm91bmNpbmVzcz86IG51bWJlcixcbiAgc3BlZWQ/OiBudW1iZXIsXG4gIHRlbnNpb24/OiBudW1iZXIsXG4gIGZyaWN0aW9uPzogbnVtYmVyLFxuICBzdGlmZm5lc3M/OiBudW1iZXIsXG4gIGRhbXBpbmc/OiBudW1iZXIsXG4gIG1hc3M/OiBudW1iZXIsXG4gIGRlbGF5PzogbnVtYmVyLFxufTtcblxuZnVuY3Rpb24gd2l0aERlZmF1bHQ8VD4odmFsdWU6ID9ULCBkZWZhdWx0VmFsdWU6IFQpOiBUIHtcbiAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cblxuY2xhc3MgU3ByaW5nQW5pbWF0aW9uIGV4dGVuZHMgQW5pbWF0aW9uIHtcbiAgX292ZXJzaG9vdENsYW1waW5nOiBib29sZWFuO1xuICBfcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZDogbnVtYmVyO1xuICBfcmVzdFNwZWVkVGhyZXNob2xkOiBudW1iZXI7XG4gIF9sYXN0VmVsb2NpdHk6IG51bWJlcjtcbiAgX3N0YXJ0UG9zaXRpb246IG51bWJlcjtcbiAgX2xhc3RQb3NpdGlvbjogbnVtYmVyO1xuICBfZnJvbVZhbHVlOiBudW1iZXI7XG4gIF90b1ZhbHVlOiBhbnk7XG4gIF9zdGlmZm5lc3M6IG51bWJlcjtcbiAgX2RhbXBpbmc6IG51bWJlcjtcbiAgX21hc3M6IG51bWJlcjtcbiAgX2luaXRpYWxWZWxvY2l0eTogbnVtYmVyO1xuICBfZGVsYXk6IG51bWJlcjtcbiAgX3RpbWVvdXQ6IGFueTtcbiAgX3N0YXJ0VGltZTogbnVtYmVyO1xuICBfbGFzdFRpbWU6IG51bWJlcjtcbiAgX2ZyYW1lVGltZTogbnVtYmVyO1xuICBfb25VcGRhdGU6ICh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkO1xuICBfYW5pbWF0aW9uRnJhbWU6IGFueTtcbiAgX3VzZU5hdGl2ZURyaXZlcjogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFNwcmluZ0FuaW1hdGlvbkNvbmZpZ1NpbmdsZSkge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLl9vdmVyc2hvb3RDbGFtcGluZyA9IHdpdGhEZWZhdWx0KGNvbmZpZy5vdmVyc2hvb3RDbGFtcGluZywgZmFsc2UpO1xuICAgIHRoaXMuX3Jlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQgPSB3aXRoRGVmYXVsdChcbiAgICAgIGNvbmZpZy5yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkLFxuICAgICAgMC4wMDEsXG4gICAgKTtcbiAgICB0aGlzLl9yZXN0U3BlZWRUaHJlc2hvbGQgPSB3aXRoRGVmYXVsdChjb25maWcucmVzdFNwZWVkVGhyZXNob2xkLCAwLjAwMSk7XG4gICAgdGhpcy5faW5pdGlhbFZlbG9jaXR5ID0gd2l0aERlZmF1bHQoY29uZmlnLnZlbG9jaXR5LCAwKTtcbiAgICB0aGlzLl9sYXN0VmVsb2NpdHkgPSB3aXRoRGVmYXVsdChjb25maWcudmVsb2NpdHksIDApO1xuICAgIHRoaXMuX3RvVmFsdWUgPSBjb25maWcudG9WYWx1ZTtcbiAgICB0aGlzLl9kZWxheSA9IHdpdGhEZWZhdWx0KGNvbmZpZy5kZWxheSwgMCk7XG4gICAgdGhpcy5fdXNlTmF0aXZlRHJpdmVyID0gc2hvdWxkVXNlTmF0aXZlRHJpdmVyKGNvbmZpZyk7XG4gICAgdGhpcy5fX2lzSW50ZXJhY3Rpb24gPVxuICAgICAgY29uZmlnLmlzSW50ZXJhY3Rpb24gIT09IHVuZGVmaW5lZCA/IGNvbmZpZy5pc0ludGVyYWN0aW9uIDogdHJ1ZTtcbiAgICB0aGlzLl9faXRlcmF0aW9ucyA9IGNvbmZpZy5pdGVyYXRpb25zICE9PSB1bmRlZmluZWQgPyBjb25maWcuaXRlcmF0aW9ucyA6IDE7XG5cbiAgICBpZiAoXG4gICAgICBjb25maWcuc3RpZmZuZXNzICE9PSB1bmRlZmluZWQgfHxcbiAgICAgIGNvbmZpZy5kYW1waW5nICE9PSB1bmRlZmluZWQgfHxcbiAgICAgIGNvbmZpZy5tYXNzICE9PSB1bmRlZmluZWRcbiAgICApIHtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgY29uZmlnLmJvdW5jaW5lc3MgPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy5zcGVlZCA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLnRlbnNpb24gPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy5mcmljdGlvbiA9PT0gdW5kZWZpbmVkLFxuICAgICAgICAnWW91IGNhbiBkZWZpbmUgb25lIG9mIGJvdW5jaW5lc3Mvc3BlZWQsIHRlbnNpb24vZnJpY3Rpb24sIG9yIHN0aWZmbmVzcy9kYW1waW5nL21hc3MsIGJ1dCBub3QgbW9yZSB0aGFuIG9uZScsXG4gICAgICApO1xuICAgICAgdGhpcy5fc3RpZmZuZXNzID0gd2l0aERlZmF1bHQoY29uZmlnLnN0aWZmbmVzcywgMTAwKTtcbiAgICAgIHRoaXMuX2RhbXBpbmcgPSB3aXRoRGVmYXVsdChjb25maWcuZGFtcGluZywgMTApO1xuICAgICAgdGhpcy5fbWFzcyA9IHdpdGhEZWZhdWx0KGNvbmZpZy5tYXNzLCAxKTtcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy5ib3VuY2luZXNzICE9PSB1bmRlZmluZWQgfHwgY29uZmlnLnNwZWVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIENvbnZlcnQgdGhlIG9yaWdhbWkgYm91bmNpbmVzcy9zcGVlZCB2YWx1ZXMgdG8gc3RpZmZuZXNzL2RhbXBpbmdcbiAgICAgIC8vIFdlIGFzc3VtZSBtYXNzIGlzIDEuXG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIGNvbmZpZy50ZW5zaW9uID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBjb25maWcuZnJpY3Rpb24gPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy5zdGlmZm5lc3MgPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy5kYW1waW5nID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBjb25maWcubWFzcyA9PT0gdW5kZWZpbmVkLFxuICAgICAgICAnWW91IGNhbiBkZWZpbmUgb25lIG9mIGJvdW5jaW5lc3Mvc3BlZWQsIHRlbnNpb24vZnJpY3Rpb24sIG9yIHN0aWZmbmVzcy9kYW1waW5nL21hc3MsIGJ1dCBub3QgbW9yZSB0aGFuIG9uZScsXG4gICAgICApO1xuICAgICAgY29uc3Qgc3ByaW5nQ29uZmlnID0gU3ByaW5nQ29uZmlnLmZyb21Cb3VuY2luZXNzQW5kU3BlZWQoXG4gICAgICAgIHdpdGhEZWZhdWx0KGNvbmZpZy5ib3VuY2luZXNzLCA4KSxcbiAgICAgICAgd2l0aERlZmF1bHQoY29uZmlnLnNwZWVkLCAxMiksXG4gICAgICApO1xuICAgICAgdGhpcy5fc3RpZmZuZXNzID0gc3ByaW5nQ29uZmlnLnN0aWZmbmVzcztcbiAgICAgIHRoaXMuX2RhbXBpbmcgPSBzcHJpbmdDb25maWcuZGFtcGluZztcbiAgICAgIHRoaXMuX21hc3MgPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDb252ZXJ0IHRoZSBvcmlnYW1pIHRlbnNpb24vZnJpY3Rpb24gdmFsdWVzIHRvIHN0aWZmbmVzcy9kYW1waW5nXG4gICAgICAvLyBXZSBhc3N1bWUgbWFzcyBpcyAxLlxuICAgICAgY29uc3Qgc3ByaW5nQ29uZmlnID0gU3ByaW5nQ29uZmlnLmZyb21PcmlnYW1pVGVuc2lvbkFuZEZyaWN0aW9uKFxuICAgICAgICB3aXRoRGVmYXVsdChjb25maWcudGVuc2lvbiwgNDApLFxuICAgICAgICB3aXRoRGVmYXVsdChjb25maWcuZnJpY3Rpb24sIDcpLFxuICAgICAgKTtcbiAgICAgIHRoaXMuX3N0aWZmbmVzcyA9IHNwcmluZ0NvbmZpZy5zdGlmZm5lc3M7XG4gICAgICB0aGlzLl9kYW1waW5nID0gc3ByaW5nQ29uZmlnLmRhbXBpbmc7XG4gICAgICB0aGlzLl9tYXNzID0gMTtcbiAgICB9XG5cbiAgICBpbnZhcmlhbnQodGhpcy5fc3RpZmZuZXNzID4gMCwgJ1N0aWZmbmVzcyB2YWx1ZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7XG4gICAgaW52YXJpYW50KHRoaXMuX2RhbXBpbmcgPiAwLCAnRGFtcGluZyB2YWx1ZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7XG4gICAgaW52YXJpYW50KHRoaXMuX21hc3MgPiAwLCAnTWFzcyB2YWx1ZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7XG4gIH1cblxuICBfX2dldE5hdGl2ZUFuaW1hdGlvbkNvbmZpZygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ3NwcmluZycsXG4gICAgICBvdmVyc2hvb3RDbGFtcGluZzogdGhpcy5fb3ZlcnNob290Q2xhbXBpbmcsXG4gICAgICByZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkOiB0aGlzLl9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkLFxuICAgICAgcmVzdFNwZWVkVGhyZXNob2xkOiB0aGlzLl9yZXN0U3BlZWRUaHJlc2hvbGQsXG4gICAgICBzdGlmZm5lc3M6IHRoaXMuX3N0aWZmbmVzcyxcbiAgICAgIGRhbXBpbmc6IHRoaXMuX2RhbXBpbmcsXG4gICAgICBtYXNzOiB0aGlzLl9tYXNzLFxuICAgICAgaW5pdGlhbFZlbG9jaXR5OiB3aXRoRGVmYXVsdCh0aGlzLl9pbml0aWFsVmVsb2NpdHksIHRoaXMuX2xhc3RWZWxvY2l0eSksXG4gICAgICB0b1ZhbHVlOiB0aGlzLl90b1ZhbHVlLFxuICAgICAgaXRlcmF0aW9uczogdGhpcy5fX2l0ZXJhdGlvbnMsXG4gICAgfTtcbiAgfVxuXG4gIHN0YXJ0KFxuICAgIGZyb21WYWx1ZTogbnVtYmVyLFxuICAgIG9uVXBkYXRlOiAodmFsdWU6IG51bWJlcikgPT4gdm9pZCxcbiAgICBvbkVuZDogP0VuZENhbGxiYWNrLFxuICAgIHByZXZpb3VzQW5pbWF0aW9uOiA/QW5pbWF0aW9uLFxuICAgIGFuaW1hdGVkVmFsdWU6IEFuaW1hdGVkVmFsdWUsXG4gICk6IHZvaWQge1xuICAgIHRoaXMuX19hY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMuX3N0YXJ0UG9zaXRpb24gPSBmcm9tVmFsdWU7XG4gICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gdGhpcy5fc3RhcnRQb3NpdGlvbjtcblxuICAgIHRoaXMuX29uVXBkYXRlID0gb25VcGRhdGU7XG4gICAgdGhpcy5fX29uRW5kID0gb25FbmQ7XG4gICAgdGhpcy5fbGFzdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuX2ZyYW1lVGltZSA9IDAuMDtcblxuICAgIGlmIChwcmV2aW91c0FuaW1hdGlvbiBpbnN0YW5jZW9mIFNwcmluZ0FuaW1hdGlvbikge1xuICAgICAgY29uc3QgaW50ZXJuYWxTdGF0ZSA9IHByZXZpb3VzQW5pbWF0aW9uLmdldEludGVybmFsU3RhdGUoKTtcbiAgICAgIHRoaXMuX2xhc3RQb3NpdGlvbiA9IGludGVybmFsU3RhdGUubGFzdFBvc2l0aW9uO1xuICAgICAgdGhpcy5fbGFzdFZlbG9jaXR5ID0gaW50ZXJuYWxTdGF0ZS5sYXN0VmVsb2NpdHk7XG4gICAgICAvLyBTZXQgdGhlIGluaXRpYWwgdmVsb2NpdHkgdG8gdGhlIGxhc3QgdmVsb2NpdHlcbiAgICAgIHRoaXMuX2luaXRpYWxWZWxvY2l0eSA9IHRoaXMuX2xhc3RWZWxvY2l0eTtcbiAgICAgIHRoaXMuX2xhc3RUaW1lID0gaW50ZXJuYWxTdGF0ZS5sYXN0VGltZTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGFydCA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLl91c2VOYXRpdmVEcml2ZXIpIHtcbiAgICAgICAgdGhpcy5fX3N0YXJ0TmF0aXZlQW5pbWF0aW9uKGFuaW1hdGVkVmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vblVwZGF0ZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyAgSWYgdGhpcy5fZGVsYXkgaXMgbW9yZSB0aGFuIDAsIHdlIHN0YXJ0IGFmdGVyIHRoZSB0aW1lb3V0LlxuICAgIGlmICh0aGlzLl9kZWxheSkge1xuICAgICAgdGhpcy5fdGltZW91dCA9IHNldFRpbWVvdXQoc3RhcnQsIHRoaXMuX2RlbGF5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhcnQoKTtcbiAgICB9XG4gIH1cblxuICBnZXRJbnRlcm5hbFN0YXRlKCk6IE9iamVjdCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhc3RQb3NpdGlvbjogdGhpcy5fbGFzdFBvc2l0aW9uLFxuICAgICAgbGFzdFZlbG9jaXR5OiB0aGlzLl9sYXN0VmVsb2NpdHksXG4gICAgICBsYXN0VGltZTogdGhpcy5fbGFzdFRpbWUsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIHNwcmluZyBtb2RlbCBpcyBiYXNlZCBvZmYgb2YgYSBkYW1wZWQgaGFybW9uaWMgb3NjaWxsYXRvclxuICAgKiAoaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSGFybW9uaWNfb3NjaWxsYXRvciNEYW1wZWRfaGFybW9uaWNfb3NjaWxsYXRvcikuXG4gICAqXG4gICAqIFdlIHVzZSB0aGUgY2xvc2VkIGZvcm0gb2YgdGhlIHNlY29uZCBvcmRlciBkaWZmZXJlbnRpYWwgZXF1YXRpb246XG4gICAqXG4gICAqIHgnJyArICgyzrbijbVfMCl4JyArIOKNtV4yeCA9IDBcbiAgICpcbiAgICogd2hlcmVcbiAgICogICAg4o21XzAgPSDiiJooayAvIG0pICh1bmRhbXBlZCBhbmd1bGFyIGZyZXF1ZW5jeSBvZiB0aGUgb3NjaWxsYXRvciksXG4gICAqICAgIM62ID0gYyAvIDLiiJptayAoZGFtcGluZyByYXRpbyksXG4gICAqICAgIGMgPSBkYW1waW5nIGNvbnN0YW50XG4gICAqICAgIGsgPSBzdGlmZm5lc3NcbiAgICogICAgbSA9IG1hc3NcbiAgICpcbiAgICogVGhlIGRlcml2YXRpb24gb2YgdGhlIGNsb3NlZCBmb3JtIGlzIGRlc2NyaWJlZCBpbiBkZXRhaWwgaGVyZTpcbiAgICogaHR0cDovL3BsYW5ldG1hdGgub3JnL3NpdGVzL2RlZmF1bHQvZmlsZXMvdGV4cGRmLzM5NzQ1LnBkZlxuICAgKlxuICAgKiBUaGlzIGFsZ29yaXRobSBoYXBwZW5zIHRvIG1hdGNoIHRoZSBhbGdvcml0aG0gdXNlZCBieSBDQVNwcmluZ0FuaW1hdGlvbixcbiAgICogYSBRdWFydHpDb3JlIChpT1MpIEFQSSB0aGF0IGNyZWF0ZXMgc3ByaW5nIGFuaW1hdGlvbnMuXG4gICAqL1xuICBvblVwZGF0ZSgpOiB2b2lkIHtcbiAgICAvLyBJZiBmb3Igc29tZSByZWFzb24gd2UgbG9zdCBhIGxvdCBvZiBmcmFtZXMgKGUuZy4gcHJvY2VzcyBsYXJnZSBwYXlsb2FkIG9yXG4gICAgLy8gc3RvcHBlZCBpbiB0aGUgZGVidWdnZXIpLCB3ZSBvbmx5IGFkdmFuY2UgYnkgNCBmcmFtZXMgd29ydGggb2ZcbiAgICAvLyBjb21wdXRhdGlvbiBhbmQgd2lsbCBjb250aW51ZSBvbiB0aGUgbmV4dCBmcmFtZS4gSXQncyBiZXR0ZXIgdG8gaGF2ZSBpdFxuICAgIC8vIHJ1bm5pbmcgYXQgZmFzdGVyIHNwZWVkIHRoYW4ganVtcGluZyB0byB0aGUgZW5kLlxuICAgIGNvbnN0IE1BWF9TVEVQUyA9IDY0O1xuICAgIGxldCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGlmIChub3cgPiB0aGlzLl9sYXN0VGltZSArIE1BWF9TVEVQUykge1xuICAgICAgbm93ID0gdGhpcy5fbGFzdFRpbWUgKyBNQVhfU1RFUFM7XG4gICAgfVxuXG4gICAgY29uc3QgZGVsdGFUaW1lID0gKG5vdyAtIHRoaXMuX2xhc3RUaW1lKSAvIDEwMDA7XG4gICAgdGhpcy5fZnJhbWVUaW1lICs9IGRlbHRhVGltZTtcblxuICAgIGNvbnN0IGM6IG51bWJlciA9IHRoaXMuX2RhbXBpbmc7XG4gICAgY29uc3QgbTogbnVtYmVyID0gdGhpcy5fbWFzcztcbiAgICBjb25zdCBrOiBudW1iZXIgPSB0aGlzLl9zdGlmZm5lc3M7XG4gICAgY29uc3QgdjA6IG51bWJlciA9IC10aGlzLl9pbml0aWFsVmVsb2NpdHk7XG5cbiAgICBjb25zdCB6ZXRhID0gYyAvICgyICogTWF0aC5zcXJ0KGsgKiBtKSk7IC8vIGRhbXBpbmcgcmF0aW9cbiAgICBjb25zdCBvbWVnYTAgPSBNYXRoLnNxcnQoayAvIG0pOyAvLyB1bmRhbXBlZCBhbmd1bGFyIGZyZXF1ZW5jeSBvZiB0aGUgb3NjaWxsYXRvciAocmFkL21zKVxuICAgIGNvbnN0IG9tZWdhMSA9IG9tZWdhMCAqIE1hdGguc3FydCgxLjAgLSB6ZXRhICogemV0YSk7IC8vIGV4cG9uZW50aWFsIGRlY2F5XG4gICAgY29uc3QgeDAgPSB0aGlzLl90b1ZhbHVlIC0gdGhpcy5fc3RhcnRQb3NpdGlvbjsgLy8gY2FsY3VsYXRlIHRoZSBvc2NpbGxhdGlvbiBmcm9tIHgwID0gMSB0byB4ID0gMFxuXG4gICAgbGV0IHBvc2l0aW9uID0gMC4wO1xuICAgIGxldCB2ZWxvY2l0eSA9IDAuMDtcbiAgICBjb25zdCB0ID0gdGhpcy5fZnJhbWVUaW1lO1xuICAgIGlmICh6ZXRhIDwgMSkge1xuICAgICAgLy8gVW5kZXIgZGFtcGVkXG4gICAgICBjb25zdCBlbnZlbG9wZSA9IE1hdGguZXhwKC16ZXRhICogb21lZ2EwICogdCk7XG4gICAgICBwb3NpdGlvbiA9XG4gICAgICAgIHRoaXMuX3RvVmFsdWUgLVxuICAgICAgICBlbnZlbG9wZSAqXG4gICAgICAgICAgKCh2MCArIHpldGEgKiBvbWVnYTAgKiB4MCkgLyBvbWVnYTEgKiBNYXRoLnNpbihvbWVnYTEgKiB0KSArXG4gICAgICAgICAgICB4MCAqIE1hdGguY29zKG9tZWdhMSAqIHQpKTtcbiAgICAgIC8vIFRoaXMgbG9va3MgY3JhenkgLS0gaXQncyBhY3R1YWxseSBqdXN0IHRoZSBkZXJpdmF0aXZlIG9mIHRoZVxuICAgICAgLy8gb3NjaWxsYXRpb24gZnVuY3Rpb25cbiAgICAgIHZlbG9jaXR5ID1cbiAgICAgICAgemV0YSAqXG4gICAgICAgICAgb21lZ2EwICpcbiAgICAgICAgICBlbnZlbG9wZSAqXG4gICAgICAgICAgKE1hdGguc2luKG9tZWdhMSAqIHQpICogKHYwICsgemV0YSAqIG9tZWdhMCAqIHgwKSAvIG9tZWdhMSArXG4gICAgICAgICAgICB4MCAqIE1hdGguY29zKG9tZWdhMSAqIHQpKSAtXG4gICAgICAgIGVudmVsb3BlICpcbiAgICAgICAgICAoTWF0aC5jb3Mob21lZ2ExICogdCkgKiAodjAgKyB6ZXRhICogb21lZ2EwICogeDApIC1cbiAgICAgICAgICAgIG9tZWdhMSAqIHgwICogTWF0aC5zaW4ob21lZ2ExICogdCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDcml0aWNhbGx5IGRhbXBlZFxuICAgICAgY29uc3QgZW52ZWxvcGUgPSBNYXRoLmV4cCgtb21lZ2EwICogdCk7XG4gICAgICBwb3NpdGlvbiA9IHRoaXMuX3RvVmFsdWUgLSBlbnZlbG9wZSAqICh4MCArICh2MCArIG9tZWdhMCAqIHgwKSAqIHQpO1xuICAgICAgdmVsb2NpdHkgPVxuICAgICAgICBlbnZlbG9wZSAqICh2MCAqICh0ICogb21lZ2EwIC0gMSkgKyB0ICogeDAgKiAob21lZ2EwICogb21lZ2EwKSk7XG4gICAgfVxuXG4gICAgdGhpcy5fbGFzdFRpbWUgPSBub3c7XG4gICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgdGhpcy5fbGFzdFZlbG9jaXR5ID0gdmVsb2NpdHk7XG5cbiAgICB0aGlzLl9vblVwZGF0ZShwb3NpdGlvbik7XG4gICAgaWYgKCF0aGlzLl9fYWN0aXZlKSB7XG4gICAgICAvLyBhIGxpc3RlbmVyIG1pZ2h0IGhhdmUgc3RvcHBlZCB1cyBpbiBfb25VcGRhdGVcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDb25kaXRpb25zIGZvciBzdG9wcGluZyB0aGUgc3ByaW5nIGFuaW1hdGlvblxuICAgIGxldCBpc092ZXJzaG9vdGluZyA9IGZhbHNlO1xuICAgIGlmICh0aGlzLl9vdmVyc2hvb3RDbGFtcGluZyAmJiB0aGlzLl9zdGlmZm5lc3MgIT09IDApIHtcbiAgICAgIGlmICh0aGlzLl9zdGFydFBvc2l0aW9uIDwgdGhpcy5fdG9WYWx1ZSkge1xuICAgICAgICBpc092ZXJzaG9vdGluZyA9IHBvc2l0aW9uID4gdGhpcy5fdG9WYWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlzT3ZlcnNob290aW5nID0gcG9zaXRpb24gPCB0aGlzLl90b1ZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBpc1ZlbG9jaXR5ID0gTWF0aC5hYnModmVsb2NpdHkpIDw9IHRoaXMuX3Jlc3RTcGVlZFRocmVzaG9sZDtcbiAgICBsZXQgaXNEaXNwbGFjZW1lbnQgPSB0cnVlO1xuICAgIGlmICh0aGlzLl9zdGlmZm5lc3MgIT09IDApIHtcbiAgICAgIGlzRGlzcGxhY2VtZW50ID1cbiAgICAgICAgTWF0aC5hYnModGhpcy5fdG9WYWx1ZSAtIHBvc2l0aW9uKSA8PSB0aGlzLl9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkO1xuICAgIH1cblxuICAgIGlmIChpc092ZXJzaG9vdGluZyB8fCAoaXNWZWxvY2l0eSAmJiBpc0Rpc3BsYWNlbWVudCkpIHtcbiAgICAgIGlmICh0aGlzLl9zdGlmZm5lc3MgIT09IDApIHtcbiAgICAgICAgLy8gRW5zdXJlIHRoYXQgd2UgZW5kIHVwIHdpdGggYSByb3VuZCB2YWx1ZVxuICAgICAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSB0aGlzLl90b1ZhbHVlO1xuICAgICAgICB0aGlzLl9sYXN0VmVsb2NpdHkgPSAwO1xuICAgICAgICB0aGlzLl9vblVwZGF0ZSh0aGlzLl90b1ZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fX2RlYm91bmNlZE9uRW5kKHtmaW5pc2hlZDogdHJ1ZX0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl9hbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcykpO1xuICB9XG5cbiAgc3RvcCgpOiB2b2lkIHtcbiAgICBzdXBlci5zdG9wKCk7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IGZhbHNlO1xuICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KTtcbiAgICBnbG9iYWwuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5fYW5pbWF0aW9uRnJhbWUpO1xuICAgIHRoaXMuX19kZWJvdW5jZWRPbkVuZCh7ZmluaXNoZWQ6IGZhbHNlfSk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTcHJpbmdBbmltYXRpb247XG4iXX0=